{
	"Id": "25260678491ba67008573830183596c46f096e91",
	"code": "shs_arbfw_appd_Script_File",
	"date": "2025-07-02T08:19:47.426Z",
	"name": "store",
	"remark": "W3siYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsIl9fY29uc3VtZXIiOiJcbiAgICAoZnVuY3Rpb24ocyl7XG5cdGdzLmluZm8oXCIyMDI1LTA3LTAyVDA4OjE5OjQ0LjUwM1o6IFwiICsgcy5hcGlfbmFtZSArICc6ICcgKyBzLnN5c19pZCk7XG5cdGlmKHMuc3lzX3Njb3BlLm5hbWUhPSdBcHBsaWNhdGlvbiBEZXNpZ25lcicpIHJldHVybjtcblxuICAgIHZhciBzYyA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3Njb3BlJyk7XG4gICAgc2MuZ2V0KCduYW1lJywgcy5zeXNfc2NvcGUubmFtZSk7XG4gICAgcy5zeXNfc2NvcGUgPSBzYy5zeXNfaWQudG9TdHJpbmcoKTtcblxuXHR2YXIgc2dyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0c2dyLmFkZFF1ZXJ5KCduYW1lJywgJz0nLCBzLm5hbWUpO1xuXHRzZ3IucXVlcnkoKTtcblx0aWYgKCFzZ3IubmV4dCgpKSBzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0T2JqZWN0LmtleXMocykuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gay5pbmRleE9mKCdfXycpIDwgMDtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0c2dyLnNldFZhbHVlKGssIHNba10pO1xuXHR9KTtcblx0c2dyLnVwZGF0ZSgpO1xuXHRcblx0dmFyIGVzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lc19sYXRlc3Rfc2NyaXB0Jyk7XG5cdGVzZ3IuYWRkUXVlcnkoJ2lkJywgc2dyLnN5c19pZCk7XG5cdGVzZ3IuYWRkUXVlcnkoJ3RhYmxlJywgJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRlc2dyLnF1ZXJ5KCk7XG5cdGlmKCFlc2dyLm5leHQoKSkgZXNnciA9IG5ldyBHbGlkZVJlY29yZChlc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0ZXNnci5zZXRWYWx1ZSgnaWQnLCBzZ3Iuc3lzX2lkKTtcblx0ZXNnci5zZXRWYWx1ZSgndGFibGUnLCAnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cdGVzZ3Iuc2V0VmFsdWUoJ3VzZV9lc19sYXRlc3QnLCB0cnVlKTtcblx0ZXNnci51cGRhdGUoKTtcblx0XG5cdGlmKCFzLmRlc2NyaXB0aW9uKSByZXR1cm47XG5cbiAgICB2YXIgb1RhYmxlID0gSlNPTi5wYXJzZShzLmRlc2NyaXB0aW9uKTtcblxuICAgIHZhciB0ID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG4gICAgdC5hZGRRdWVyeSgnbmFtZScsIG9UYWJsZS5uYW1lKTtcbiAgICB0LnNldExpbWl0KDEpO1xuICAgIHQucXVlcnkoKTtcbiAgICBpZih0Lm5leHQoKSl7XG4gICAgICAgIG9UYWJsZS5JZCA9IHQuc3lzX2lkLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgdmFyIHNjID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NvcGUnKTtcbiAgICBzYy5nZXQoJ3Njb3BlJywgJ3hfMTc5MDU5M19hcmJvYXJkJyk7XG5cbiAgICBpZih0LnN5c19zY29wZS5zY29wZT09J3hfMTc5MDU5M19hcmJvYXJkJyl7XG4gICAgICAgIHZhciBhY2xPcHMgPSB7cmVhZDogJ2ZpbmQnLCB3cml0ZTogJ3VwZGF0ZScsIGNyZWF0ZTogJ2luc2VydCcvKiwgZGVsZXRlOiAnJywgZXhlY3V0ZTogJycqL307XG4gICAgICAgIE9iamVjdC5rZXlzKGFjbE9wcykuZm9yRWFjaChmdW5jdGlvbihhayl7XG4gICAgICAgICAgICB2YXIgYWNsID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2VjdXJpdHlfYWNsJyk7XG4gICAgICAgICAgICB2YXIgb0FDTCA9IHthY3RpdmU6IHRydWUsIGFkbWluX292ZXJyaWRlczogZmFsc2UsIGFkdmFuY2VkOiB0cnVlLCBuYW1lOiBvVGFibGUubmFtZSsnLionLFxuICAgICAgICAgICAgICAgIHNjcmlwdDogJ2Fuc3dlciA9IG5ldyAnICsgcy5uYW1lICsgJygpLl9mcm9tR2xpZGVSZWNvcmQoY3VycmVudCkuXycgKyBhY2xPcHNbYWtdICsgJ0Fzc2VydCgpOycsXG4gICAgICAgICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2FsbG93JywgdHlwZTogJ3JlY29yZCcsIG9wZXJhdGlvbjogYWssXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdBbGxvdyAnICsgYWsgKyAnIGZvciBhbGwgZmllbGRzIGluICcgKyBvVGFibGUubGFiZWwgKyAnKCcgKyBvVGFibGUubmFtZSArICcpLCBpZiB0aGUgQUNMIHNjcmlwdCBhbnN3ZXJzIHRydWUuJ307XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ25hbWUnLCBvQUNMLm5hbWUpO1xuICAgICAgICAgICAgYWNsLmFkZFF1ZXJ5KCdvcGVyYXRpb24nLCBvQUNMLm9wZXJhdGlvbik7XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ3R5cGUnLCBvQUNMLnR5cGUpO1xuICAgICAgICAgICAgYWNsLnNldExpbWl0KDEpO1xuICAgICAgICAgICAgYWNsLnF1ZXJ5KCk7XG4gICAgICAgICAgICBpZighYWNsLm5leHQoKSkgYWNsID0gbmV3IEdsaWRlUmVjb3JkKGFjbC5nZXRUYWJsZU5hbWUoKSk7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvQUNMKS5mb3JFYWNoKGZ1bmN0aW9uKGspe2FjbC5zZXRWYWx1ZShrLCBvQUNMW2tdKTt9KTtcbiAgICAgICAgICAgIGFjbC51cGRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYnIgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHQnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ2NvbGxlY3Rpb24nLCBvVGFibGUubmFtZSk7XG4gICAgICAgIGJyLmFkZFF1ZXJ5KCdzeXNfc2NvcGUnLCBzYy5zeXNfaWQpO1xuICAgICAgICBici5hZGRRdWVyeSgnd2hlbicsICdiZWZvcmUnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ25hbWUnLCBvVGFibGUubGFiZWwgKyAnIGFzc2VydGlvbicpO1xuICAgICAgICBici5zZXRMaW1pdCgxKTtcbiAgICAgICAgYnIucXVlcnkoKTtcbiAgICAgICAgLy9ncy5pbmZvKFwiYnIgY291bnQ6IFwiICsgYnIuZ2V0Um93Q291bnQoKSArIFwiLCBxdWVyeTogXCIgKyBici5nZXRFbmNvZGVkUXVlcnkoKSk7XG4gICAgICAgIGlmKCFici5uZXh0KCkpIGJyID0gbmV3IEdsaWRlUmVjb3JkKGJyLmdldFRhYmxlTmFtZSgpKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGl2ZScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnY29sbGVjdGlvbicsIG9UYWJsZS5uYW1lKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3N5c19zY29wZScsIHNjLnN5c19pZCk7XG4gICAgICAgIGJyLnNldFZhbHVlKCd3aGVuJywgJ2JlZm9yZScpO1xuICAgICAgICBici5zZXRWYWx1ZSgnbmFtZScsIG9UYWJsZS5sYWJlbCArICcgYXNzZXJ0aW9uJyk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdkZXNjcmlwdGlvbicsICdSdWxlIGZvciAnICsgb1RhYmxlLmxhYmVsICsgJygnICsgb1RhYmxlLm5hbWUgKyAnKSwgdG8gYXNzZXJ0IG9wZXJhdGlvbiB2YWxpZGl0eS4nKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9pbnNlcnQnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl91cGRhdGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9kZWxldGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9xdWVyeScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWJvcnRfYWN0aW9uJywgZmFsc2UpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWRkX21lc3NhZ2UnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ21lc3NhZ2UnLCAnT3BlcmF0aW9uIGFib3J0ZWQ6IGFzc2VydGlvbiBmYWlsZWQnKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3NjcmlwdCcsICdjdXJyZW50LnNldEFib3J0QWN0aW9uKCFuZXcgJyArIHMubmFtZSArICcoKS5fZnJvbUdsaWRlUmVjb3JkKGN1cnJlbnQpW1wiX1wiICsgKHtpbnNlcnQ6IFwiaW5zZXJ0XCIsIHVwZGF0ZTogXCJ1cGRhdGVcIiwgcXVlcnk6IFwiZmluZFwiLCBkZWxldGU6IFwidXBkYXRlXCJ9KVtjdXJyZW50Lm9wZXJhdGlvbigpIHx8IFwiaW5zZXJ0XCJdICsgXCJBc3NlcnRcIl0oKSk7Jyk7XG4gICAgICAgIGJyLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBcbiAgICBpZih0LmlzVmFsaWRSZWNvcmQoKSkgcmV0dXJuO1xuXG4gICAgdCA9IG5ldyBHbGlkZVJlY29yZCh0LmdldFRhYmxlTmFtZSgpKTtcbiAgICB0LnNldE5ld0d1aWRWYWx1ZShvVGFibGUuSWQpO1xuICAgIFsnbmFtZScsICdsYWJlbCcsICdzeXNfbmFtZSddLmZvckVhY2goZnVuY3Rpb24oZil7dC5zZXRWYWx1ZShmLCBvVGFibGVbZl0pO30pO1xuICAgIHQuc3lzX3Njb3BlID0gc2Muc3lzX2lkO1xuICAgIGlmKG9UYWJsZS5zdXBlcl9jbGFzcykge1xuICAgICAgICB2YXIgc3VwZXJfY2xhc3MgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kYl9vYmplY3QnKTtcbiAgICAgICAgc3VwZXJfY2xhc3MuZ2V0KCduYW1lJywgb1RhYmxlLnN1cGVyX2NsYXNzKTtcbiAgICAgICAgaWYoc3VwZXJfY2xhc3MuaXNWYWxpZFJlY29yZCgpKSB0LnNldFZhbHVlKCdzdXBlcl9jbGFzcycsIHN1cGVyX2NsYXNzLnN5c19pZCk7XG4gICAgfVxuICAgIGdzLmluZm8oJ2NyZWF0aW5nIHRhYmxlOiAnICsgb1RhYmxlLm5hbWUgKyBcIiB4XzE3OTA1OTNfYXJib2FyZCAtIFwiICsgcy5zeXNfaWQpO1xuICAgIFxuICAgIHQuaW5zZXJ0KCk7XG4gICAgXG4gICAgb1RhYmxlLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjKXtcbiAgICAgICAgdmFyIGdyYyA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RpY3Rpb25hcnknKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYykuZm9yRWFjaChmdW5jdGlvbihmKXtncmMuc2V0VmFsdWUoZiwgY1tmXSk7fSk7XG4gICAgICAgIGdyYy5pbnNlcnQoKTtcbiAgICB9KTtcbiAgICBcblx0fSlcbiAgICAiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmFsdWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3ZhbHVlID0gdjtcblx0XHRcdHRoaXMuX3ZhbHVlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZhbHVlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmluc3RhbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5zdGFuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2luc3RhbmNlID0gdjtcblx0XHRcdHRoaXMuX2luc3RhbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuYWN0aW9uSW5wdXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25JbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uSW5wdXQgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uSW5wdXRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uSW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZmxvd0lucHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd0lucHV0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93SW5wdXQgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd0lucHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dJbnB1dDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5tYXBwaW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFwcGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFwcGluZyA9IHY7XG5cdFx0XHR0aGlzLl9tYXBwaW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hcHBpbmc7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3ZhcmlhYmxlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhbHVlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndmFsdWUnICsgKHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nKSArIHRoaXMudmFsdWUoKTtcblxuXHRcdGlmICh0aGlzLl9pbnN0YW5jZSkgcmV0ICs9IC8qKHRoaXMuX2luc3RhbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuaW5zdGFuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAnaW5zdGFuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb25JbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uSW5wdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uSW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvd0lucHV0KSByZXQgKz0gLyoodGhpcy5fZmxvd0lucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvd0lucHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3dJbnB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl9tYXBwaW5nKSByZXQgKz0gLyoodGhpcy5fbWFwcGluZ19jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWFwcGluZy4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHZhcmlhYmxlOiBvYmouZ2V0VmFsdWUoXCJ2YXJpYWJsZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dmFsdWU6IG9iai5nZXRWYWx1ZShcInZhbHVlXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnN0YW5jZTogb2JqLmdldFZhbHVlKFwiaW5zdGFuY2VcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb25JbnB1dDogb2JqLmdldFZhbHVlKFwiYWN0aW9uSW5wdXRcIiksXG5cblx0XHRcdFx0XHRcdGZsb3dJbnB1dDogb2JqLmdldFZhbHVlKFwiZmxvd0lucHV0XCIpLFxuXG5cdFx0XHRcdFx0XHRtYXBwaW5nOiBvYmouZ2V0VmFsdWUoXCJtYXBwaW5nXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai52YXJpYWJsZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnZhbHVlID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai52YWx1ZSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZhbHVlKG9iai52YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmluc3RhbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbklucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25JbnB1dCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvd0lucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd0lucHV0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFwcGluZyhuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubWFwcGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJWYXJpYWJsZV9WYWx1ZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC52YXJpYWJsZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZhbHVlID0gdGhpcy52YWx1ZSgpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC52YWx1ZSkgPT09ICdvYmplY3QnKSByZXQudmFsdWUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQudmFsdWUpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5faW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0Lmluc3RhbmNlKSB7XG5cdFx0XHRcdHJldC5pbnN0YW5jZSA9IHJldC5pbnN0YW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGlvbklucHV0ID0gdGhpcy5hY3Rpb25JbnB1dCgpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbklucHV0KSB7XG5cdFx0XHRcdHJldC5hY3Rpb25JbnB1dCA9IHJldC5hY3Rpb25JbnB1dC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb25JbnB1dCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uSW5wdXQpLmxlbmd0aCkgcmV0LmFjdGlvbklucHV0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvd0lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mbG93SW5wdXQgPSB0aGlzLmZsb3dJbnB1dCgpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3dJbnB1dCkge1xuXHRcdFx0XHRyZXQuZmxvd0lucHV0ID0gcmV0LmZsb3dJbnB1dC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93SW5wdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3dJbnB1dCkubGVuZ3RoKSByZXQuZmxvd0lucHV0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFwcGluZyA9IHRoaXMubWFwcGluZygpO1xuXG5cdFx0XHRpZiAocmV0Lm1hcHBpbmcpIHtcblx0XHRcdFx0cmV0Lm1hcHBpbmcgPSByZXQubWFwcGluZy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tYXBwaW5nKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tYXBwaW5nKS5sZW5ndGgpIHJldC5tYXBwaW5nID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YXJpYWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInZhbHVlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmFsdWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFsdWUodGhpcy52YWx1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImluc3RhbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuaW5zdGFuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2UodGhpcy5pbnN0YW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGlvbklucHV0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uSW5wdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uSW5wdXQodGhpcy5hY3Rpb25JbnB1dCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93SW5wdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93SW5wdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd0lucHV0KHRoaXMuZmxvd0lucHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1hcHBpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYXBwaW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hcHBpbmcodGhpcy5tYXBwaW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3ZhcmlhYmxlX3ZhbHVlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd2YXJpYWJsZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3ZhcmlhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd2YXJpYWJsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2YXJpYWJsZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl92YWx1ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl92YWx1ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudmFsdWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZhbHVlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFsdWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhbHVlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhbHVlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2luc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5faW5zdGFuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcImluc3RhbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJpbnN0YW5jZVtpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnN0YW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnN0YW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb25JbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uSW5wdXQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb25JbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwiYWN0aW9uSW5wdXRbYWN0aW9uSW5wdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uSW5wdXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uaW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb25pbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uaW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uaW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvd0lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd0lucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvd0lucHV0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiZmxvd0lucHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJmbG93SW5wdXRbZmxvd0lucHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3dJbnB1dCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93aW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93aW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3dpbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93aW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hcHBpbmdfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYXBwaW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwibWFwcGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwibWFwcGluZ1ttYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1hcHBpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFwcGluZycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFwcGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3ZhcmlhYmxlX3ZhbHVlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfQWdlbmRhX0l0ZW0iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19BZ2VuZGFfSXRlbSIsIm5hbWUiOiJzaHNfYXJiZndfQWdlbmRhX0l0ZW0iLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQWdlbmRhX0l0ZW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5hZ2VuZGEgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhZ2VuZGEodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FnZW5kYSA9IHY7XG5cdFx0XHR0aGlzLl9hZ2VuZGFfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWdlbmRhO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FnZW5kYSkgcmV0ICs9IC8qKHRoaXMuX2FnZW5kYV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFnZW5kYSgpLl90b0VRdWVyeShzUGF0aCArICdhZ2VuZGEuJyk7XG5cblx0XHRpZiAodGhpcy5fcmVxdWlyZW1lbnQpIHJldCArPSAvKih0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlcXVpcmVtZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlcXVpcmVtZW50LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhZ2VuZGE6IG9iai5nZXRWYWx1ZShcImFnZW5kYVwiKSxcblxuXHRcdFx0XHRcdFx0cmVxdWlyZW1lbnQ6IG9iai5nZXRWYWx1ZShcInJlcXVpcmVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWdlbmRhKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hZ2VuZGEobmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQob2JqLmFnZW5kYSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZXF1aXJlbWVudChuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWdlbmRhX0l0ZW1cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZVxuXG5cdFx0XHQmJlxuXHRcdFx0KChmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2luc2VydEFzc2VydCgpOiBcIiArIFwiRXhjZXB0aW9uIGluIF9pbnNlcnRBc3NlcnQ6OigpOiBcIiArIGV4LmdldE1lc3NhZ2UoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pKHRoaXMpKTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWVcblxuXHRcdFx0JiZcblx0XHRcdCgoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zdG9yZUFzc2VydCgpOiBcIiArIFwiRXhjZXB0aW9uIGluIF9zdG9yZUFzc2VydDo6KCk6IFwiICsgZXguZ2V0TWVzc2FnZSgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkodGhpcykpO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FnZW5kYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWdlbmRhID0gdGhpcy5hZ2VuZGEoKTtcblxuXHRcdFx0aWYgKHJldC5hZ2VuZGEpIHtcblx0XHRcdFx0cmV0LmFnZW5kYSA9IHJldC5hZ2VuZGEuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWdlbmRhKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hZ2VuZGEpLmxlbmd0aCkgcmV0LmFnZW5kYSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHJldC5yZXF1aXJlbWVudCkge1xuXHRcdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYWdlbmRhKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFnZW5kYSh0aGlzLmFnZW5kYSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFnZW5kYVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFnZW5kYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hZ2VuZGEodGhpcy5hZ2VuZGEoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVxdWlyZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXF1aXJlbWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudCh0aGlzLnJlcXVpcmVtZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hZ2VuZGEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hZ2VuZGFfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hZ2VuZGEoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBZ2VuZGEgSXRlbVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJhZ2VuZGEgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIgKyBcImFnZW5kYVthZ2VuZGFdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWdlbmRhKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FnZW5kYScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FnZW5kYScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWdlbmRhJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FnZW5kYScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBZ2VuZGEgSXRlbVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJyZXF1aXJlbWVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIiArIFwicmVxdWlyZW1lbnRbcmVxdWlyZW1lbnRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVxdWlyZW1lbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVxdWlyZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZXF1aXJlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVxdWlyZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc3ViZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YmZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3N1YmZsb3cgPSB2O1xuXHRcdFx0dGhpcy5fc3ViZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJmbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndWlfaWQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbW1lbnQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdwYXJlbnRfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdGlmICh0aGlzLl9zdWJmbG93KSByZXQgKz0gLyoodGhpcy5fc3ViZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnc3ViZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMuaW5zdGFuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3ZhcmlhYmxlX3ZhbHVlLmluc3RhbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHVpX2lkOiBvYmouZ2V0VmFsdWUoXCJ1aV9pZFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRjb21tZW50OiBvYmouZ2V0VmFsdWUoXCJjb21tZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRwYXJlbnRfdWlfaWQ6IG9iai5nZXRWYWx1ZShcInBhcmVudF91aV9pZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdHN1YmZsb3c6IG9iai5nZXRWYWx1ZShcInN1YmZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnVpX2lkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai51aV9pZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29tbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5jb21tZW50ID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5jb21tZW50KSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5jb21tZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfdWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF91aV9pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3ViZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3ViZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLnN1YmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfSW5zdGFuY2VcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnVpX2lkID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5jb21tZW50KSA9PT0gJ29iamVjdCcpIHJldC5jb21tZW50ID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfdWlfaWQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF91aV9pZCkge1xuXHRcdFx0XHRyZXQucGFyZW50X3VpX2lkID0gcmV0LnBhcmVudF91aV9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfdWlfaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudF91aV9pZCkubGVuZ3RoKSByZXQucGFyZW50X3VpX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN1YmZsb3cgPSB0aGlzLnN1YmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5zdWJmbG93KSB7XG5cdFx0XHRcdHJldC5zdWJmbG93ID0gcmV0LnN1YmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3ViZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3ViZmxvdykubGVuZ3RoKSByZXQuc3ViZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ1aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfdWlfaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3ViZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN1YmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3ViZmxvdyh0aGlzLnN1YmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd1aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd1aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb21tZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb21tZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb21tZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInBhcmVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJwYXJlbnRbcGFyZW50X3VpX2lkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnRfdWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGFyZW50X3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudF91aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1YmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdWJmbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3ViZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJzdWJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIgKyBcInN1YmZsb3dbc3ViZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zdWJmbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N1YmZsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N1YmZsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1YmZsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3ViZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIm9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKSB0aGlzLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lmluc3RhbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5zdGFuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2luc3RhbmNlID0gdjtcblx0XHRcdHRoaXMuX2luc3RhbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnRiMlJsYkY5cFpDSmRmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm1heF9sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbWF4X2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm1vZGVsX2lkIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfaWQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5tb2RlbF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuYXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfYXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VsZW1lbnQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdhdHRyaWJ1dGVzJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaW50ZXJuYWxfdHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5faW5zdGFuY2UpIHJldCArPSAvKih0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmluc3RhbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2luc3RhbmNlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0YXR0cmlidXRlczogb2JqLmdldFZhbHVlKFwiYXR0cmlidXRlc1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnN0YW5jZTogb2JqLmdldFZhbHVlKFwiaW5zdGFuY2VcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmF0dHJpYnV0ZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouYXR0cmlidXRlcyA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYXR0cmlidXRlcykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouYXR0cmlidXRlcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmouaW50ZXJuYWxfdHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmluc3RhbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnN0YW5jZV9JbnB1dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXR0cmlidXRlcyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmF0dHJpYnV0ZXMpID09PSAnb2JqZWN0JykgcmV0LmF0dHJpYnV0ZXMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuYXR0cmlidXRlcykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF90eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5faW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0Lmluc3RhbmNlKSB7XG5cdFx0XHRcdHJldC5pbnN0YW5jZSA9IHJldC5pbnN0YW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXhfbGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1heF9sZW5ndGggPSB0aGlzLm1heF9sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF9pZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF9pZCA9IHRoaXMubW9kZWxfaWQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF90YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF90YWJsZSA9IHRoaXMubW9kZWxfdGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuaW5zdGFuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2UodGhpcy5pbnN0YW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmluc3RhbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmluc3RhbmNlKHRoaXMuaW5zdGFuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2F0dHJpYnV0ZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXR0cmlidXRlcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2luc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5faW5zdGFuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2UgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJpbnN0YW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJpbnN0YW5jZVtpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnN0YW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnN0YW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW5zdGFuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2luc3RhbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3VpX2lkJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdjb21tZW50JyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldCArPSAvKih0aGlzLl9wYXJlbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wYXJlbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50X3VpX2lkLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbl90eXBlLicpO1xuXG5cdFx0KHRoaXMuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3ZhcmlhYmxlX3ZhbHVlLmFjdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHVpX2lkOiBvYmouZ2V0VmFsdWUoXCJ1aV9pZFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRjb21tZW50OiBvYmouZ2V0VmFsdWUoXCJjb21tZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRwYXJlbnRfdWlfaWQ6IG9iai5nZXRWYWx1ZShcInBhcmVudF91aV9pZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbl90eXBlOiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25fdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnVpX2lkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb21tZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmNvbW1lbnQgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmNvbW1lbnQpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmNvbW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF91aV9pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGFyZW50KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X3VpX2lkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl90eXBlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9JbnN0YW5jZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnVpX2lkID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5jb21tZW50KSA9PT0gJ29iamVjdCcpIHJldC5jb21tZW50ID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfdWlfaWQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF91aV9pZCkge1xuXHRcdFx0XHRyZXQucGFyZW50X3VpX2lkID0gcmV0LnBhcmVudF91aV9pZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfdWlfaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudF91aV9pZCkubGVuZ3RoKSByZXQucGFyZW50X3VpX2lkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uX3R5cGUgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbl90eXBlKSB7XG5cdFx0XHRcdHJldC5hY3Rpb25fdHlwZSA9IHJldC5hY3Rpb25fdHlwZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb25fdHlwZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uX3R5cGUpLmxlbmd0aCkgcmV0LmFjdGlvbl90eXBlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInVpX2lkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb21tZW50XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBhcmVudF91aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25fdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb24odGhpcy5hY3Rpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndWlfaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3VpX2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwicGFyZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF91aV9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGFyZW50X3VpX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudF91aV9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5zdGFuY2VcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uX3R5cGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbl90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbl90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb25fdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb25fdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyhvYmouYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwucGx1cmFsIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGx1cmFsKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wbHVyYWwgPSB2O1xuXHRcdFx0dGhpcy5fcGx1cmFsX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BsdXJhbDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5sYW5ndWFnZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxhbmd1YWdlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9sYW5ndWFnZSA9IHY7XG5cdFx0XHR0aGlzLl9sYW5ndWFnZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9sYW5ndWFnZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5pbnB1dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGlucHV0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnB1dCA9IHY7XG5cdFx0XHR0aGlzLl9pbnB1dF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnB1dDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5vdXRwdXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvdXRwdXQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX291dHB1dCA9IHY7XG5cdFx0XHR0aGlzLl9vdXRwdXRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3V0cHV0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnZhcmlhYmxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmFyaWFibGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3ZhcmlhYmxlID0gdjtcblx0XHRcdHRoaXMuX3ZhcmlhYmxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZhcmlhYmxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmNvbHVtbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uID0gdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VsZW1lbnQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wbHVyYWwpIHJldCArPSAnXicgKyBzUGF0aCArICdwbHVyYWwnICsgKHRoaXMuX3BsdXJhbF9jb29wIHx8ICc9JykgKyB0aGlzLnBsdXJhbCgpO1xuXG5cdFx0aWYgKHRoaXMuX2xhbmd1YWdlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFuZ3VhZ2UnICsgKHRoaXMuX2xhbmd1YWdlX2Nvb3AgfHwgJz0nKSArIHRoaXMubGFuZ3VhZ2UoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2lucHV0KSByZXQgKz0gLyoodGhpcy5faW5wdXRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5pbnB1dCgpLl90b0VRdWVyeShzUGF0aCArICdpbnB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl9vdXRwdXQpIHJldCArPSAvKih0aGlzLl9vdXRwdXRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5vdXRwdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnb3V0cHV0LicpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhcmlhYmxlKSByZXQgKz0gLyoodGhpcy5fdmFyaWFibGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy52YXJpYWJsZSgpLl90b0VRdWVyeShzUGF0aCArICd2YXJpYWJsZS4nKTtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4pIHJldCArPSAvKih0aGlzLl9jb2x1bW5fY29vcCB8fCAnPScpICsgKi8gdGhpcy5jb2x1bW4oKS5fdG9FUXVlcnkoc1BhdGggKyAnY29sdW1uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZWxlbWVudDogb2JqLmdldFZhbHVlKFwiZWxlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdHBsdXJhbDogb2JqLmdldFZhbHVlKFwicGx1cmFsXCIpLFxuXG5cdFx0XHRcdFx0XHRsYW5ndWFnZTogb2JqLmdldFZhbHVlKFwibGFuZ3VhZ2VcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnB1dDogb2JqLmdldFZhbHVlKFwiaW5wdXRcIiksXG5cblx0XHRcdFx0XHRcdG91dHB1dDogb2JqLmdldFZhbHVlKFwib3V0cHV0XCIpLFxuXG5cdFx0XHRcdFx0XHR2YXJpYWJsZTogb2JqLmdldFZhbHVlKFwidmFyaWFibGVcIiksXG5cblx0XHRcdFx0XHRcdGNvbHVtbjogb2JqLmdldFZhbHVlKFwiY29sdW1uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVsZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmxhYmVsID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5sYWJlbCkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGx1cmFsKG9iai5wbHVyYWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhbmd1YWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5sYW5ndWFnZShvYmoubGFuZ3VhZ2UpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmlucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouaW5wdXQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vdXRwdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm91dHB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG9iai5vdXRwdXQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai52YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudmFyaWFibGUobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai52YXJpYWJsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29sdW1uKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW4pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmllbGRfTGFiZWxcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmxhYmVsKSA9PT0gJ29iamVjdCcpIHJldC5sYWJlbCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5sYWJlbCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wbHVyYWwpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBsdXJhbCA9IHRoaXMucGx1cmFsKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2xhbmd1YWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYW5ndWFnZSA9IHRoaXMubGFuZ3VhZ2UoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnB1dCA9IHRoaXMuaW5wdXQoKTtcblxuXHRcdFx0aWYgKHJldC5pbnB1dCkge1xuXHRcdFx0XHRyZXQuaW5wdXQgPSByZXQuaW5wdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuaW5wdXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmlucHV0KS5sZW5ndGgpIHJldC5pbnB1dCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX291dHB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3V0cHV0ID0gdGhpcy5vdXRwdXQoKTtcblxuXHRcdFx0aWYgKHJldC5vdXRwdXQpIHtcblx0XHRcdFx0cmV0Lm91dHB1dCA9IHJldC5vdXRwdXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQub3V0cHV0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5vdXRwdXQpLmxlbmd0aCkgcmV0Lm91dHB1dCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZhcmlhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC52YXJpYWJsZSA9IHRoaXMudmFyaWFibGUoKTtcblxuXHRcdFx0aWYgKHJldC52YXJpYWJsZSkge1xuXHRcdFx0XHRyZXQudmFyaWFibGUgPSByZXQudmFyaWFibGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQudmFyaWFibGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnZhcmlhYmxlKS5sZW5ndGgpIHJldC52YXJpYWJsZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29sdW1uID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdFx0aWYgKHJldC5jb2x1bW4pIHtcblx0XHRcdFx0cmV0LmNvbHVtbiA9IHJldC5jb2x1bW4uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuY29sdW1uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5jb2x1bW4pLmxlbmd0aCkgcmV0LmNvbHVtbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubGFuZ3VhZ2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGFuZ3VhZ2UodGhpcy5sYW5ndWFnZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBsdXJhbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBsdXJhbCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wbHVyYWwodGhpcy5wbHVyYWwoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYW5ndWFnZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmxhbmd1YWdlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxhbmd1YWdlKHRoaXMubGFuZ3VhZ2UoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlucHV0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuaW5wdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5wdXQodGhpcy5pbnB1dCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvdXRwdXRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vdXRwdXQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3V0cHV0KHRoaXMub3V0cHV0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInZhcmlhYmxlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmFyaWFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFyaWFibGUodGhpcy52YXJpYWJsZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2x1bW5cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2x1bW4oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29sdW1uKHRoaXMuY29sdW1uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19kb2N1bWVudGF0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhYmVsJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BsdXJhbF9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9wbHVyYWxfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBsdXJhbCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGx1cmFsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGx1cmFsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwbHVyYWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGx1cmFsJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2xhbmd1YWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbGFuZ3VhZ2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbGFuZ3VhZ2VfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmxhbmd1YWdlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdsYW5ndWFnZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhbmd1YWdlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYW5ndWFnZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYW5ndWFnZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2lucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuaW5wdXQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJpbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiaW5wdXRbaW5wdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuaW5wdXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3V0cHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3V0cHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3V0cHV0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwib3V0cHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJvdXRwdXRbb3V0cHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm91dHB1dCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvdXRwdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvdXRwdXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ291dHB1dCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvdXRwdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFyaWFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl92YXJpYWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnZhcmlhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidmFyaWFibGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIgKyBcInZhcmlhYmxlW3ZhcmlhYmxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnZhcmlhYmxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZhcmlhYmxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhcmlhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhcmlhYmxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImNvbHVtbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiY29sdW1uW2NvbHVtbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5jb2x1bW4oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29sdW1uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2x1bW4nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29sdW1uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2RvY3VtZW50YXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kb2N1bWVudGF0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubG9naWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbG9naWMgPSB2O1xuXHRcdFx0dGhpcy5fbG9naWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9naWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VkVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9yZWZlcmVuY2VkX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5yZWZlcmVuY2VkVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJ4dloybGpYMFpzYjNkZlNXNXdkWFJmVTJOeWFYQjBjMXR5WldabGNtVnVZMlZrWDNSaFlteGxQVndpZTN0cFpIMTlYQ0pkWFM1d1lYSmxiblJmUVdOMGFXOXVYMGx1YzNSaGJtTmxjeWsvSjNONWMxOW9kV0pmWVdOMGFXOXVYMmx1YzNSaGJtTmxKem9uYzNselgyaDFZbDltYkc5M1gyeHZaMmxqSno0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnB1dF9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzY3JpcHQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2xvZ2ljKSByZXQgKz0gLyoodGhpcy5fbG9naWNfY29vcCB8fCAnPScpICsgKi8gdGhpcy5sb2dpYygpLl90b0VRdWVyeShzUGF0aCArICdpbnN0YW5jZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGlucHV0X25hbWU6IG9iai5nZXRWYWx1ZShcImlucHV0X25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0c2NyaXB0OiBvYmouZ2V0VmFsdWUoXCJzY3JpcHRcIiksXG5cblx0XHRcdFx0XHRcdGluc3RhbmNlOiBvYmouZ2V0VmFsdWUoXCJpbnN0YW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnB1dF9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5pbnB1dF9uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY3JpcHQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouc2NyaXB0ID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zY3JpcHQpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnNjcmlwdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmxvZ2ljKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnB1dF9TY3JpcHRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW5wdXRfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zY3JpcHQgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5zY3JpcHQpID09PSAnb2JqZWN0JykgcmV0LnNjcmlwdCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zY3JpcHQpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbG9naWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5sb2dpYygpO1xuXG5cdFx0XHRpZiAocmV0Lmluc3RhbmNlKSB7XG5cdFx0XHRcdHJldC5pbnN0YW5jZSA9IHJldC5pbnN0YW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VkX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZWRfdGFibGUgPSB0aGlzLnJlZmVyZW5jZWRfdGFibGUoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlucHV0X25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjcmlwdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmxvZ2ljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljKHRoaXMubG9naWMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycsIFsnKiddKVsnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2lucHV0X3NjcmlwdHMnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2lucHV0X25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnB1dF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnB1dF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2lucHV0X25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2NyaXB0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2NyaXB0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY3JpcHQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2NyaXB0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2xvZ2ljKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbG9naWNfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5sb2dpYygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXQgU2NyaXB0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcImxvZ2ljIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiICsgXCJsb2dpY1tpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5sb2dpYygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnN0YW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJywgWycqJ10pWydzeXNfaHViX2lucHV0X3NjcmlwdHMnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSIsIm5hbWUiOiJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ19BZ2VuZGFcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5tZWV0aW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVldGluZyA9IHY7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmc7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuYWdlbmRhX0FnZW5kYV9JdGVtcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFnZW5kYV9BZ2VuZGFfSXRlbXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hZ2VuZGFfQWdlbmRhX0l0ZW1zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWdlbmRhX0FnZW5kYV9JdGVtc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWdlbmRhX0FnZW5kYV9JdGVtcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9tZWV0aW5nKSByZXQgKz0gLyoodGhpcy5fbWVldGluZ19jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lZXRpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWVldGluZy4nKTtcblxuXHRcdCh0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtLmFnZW5kYSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRtZWV0aW5nOiBvYmouZ2V0VmFsdWUoXCJtZWV0aW5nXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVldGluZyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWdlbmRhX0FnZW5kYV9JdGVtcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMobmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nX0FnZW5kYVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWVldGluZykge1xuXHRcdFx0XHRyZXQubWVldGluZyA9IHJldC5tZWV0aW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhX0FnZW5kYV9JdGVtcyA9IHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lZXRpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVldGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nIEFnZW5kYVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJtZWV0aW5nIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiICsgXCJtZWV0aW5nW21lZXRpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVldGluZygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZWV0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZWV0aW5nJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJvYmouYWdlbmRhX0FnZW5kYV9JdGVtczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWdlbmRhX0FnZW5kYV9JdGVtcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zKSkgdGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZ19NaW51dGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSIsIm5hbWUiOiJzaHNfYXJiZndfTWVldGluZ19NaW51dGUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ19NaW51dGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5tZWV0aW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVldGluZyA9IHY7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmc7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdG1lZXRpbmc6IG9iai5nZXRWYWx1ZShcIm1lZXRpbmdcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tZWV0aW5nKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmcpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ19NaW51dGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWVldGluZyA9IHRoaXMubWVldGluZygpO1xuXG5cdFx0XHRpZiAocmV0Lm1lZXRpbmcpIHtcblx0XHRcdFx0cmV0Lm1lZXRpbmcgPSByZXQubWVldGluZy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZWV0aW5nKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tZWV0aW5nKS5sZW5ndGgpIHJldC5tZWV0aW5nID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWVldGluZ1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1lZXRpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZyh0aGlzLm1lZXRpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tZWV0aW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVldGluZygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmcgTWludXRlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcIm1lZXRpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIgKyBcIm1lZXRpbmdbbWVldGluZ10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tZWV0aW5nKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lZXRpbmcnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21lZXRpbmcnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpY1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mbG93ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZGVmaW5pdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlZmluaXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWZpbml0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnBhcmVudF9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50X0Zsb3dfSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfQWN0aW9uX0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpY19GbG93X0lucHV0X1NjcmlwdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndWlfaWQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbW1lbnQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BhcmVudCkgcmV0ICs9IC8qKHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnBhcmVudCgpLl90b0VRdWVyeShzUGF0aCArICdwYXJlbnRfdWlfaWQuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0aWYgKHRoaXMuX2RlZmluaXRpb24pIHJldCArPSAvKih0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVmaW5pdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdsb2dpY19kZWZpbml0aW9uLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UucGFyZW50X3VpX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfaW5wdXRfc2NyaXB0cy5pbnN0YW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHR1aV9pZDogb2JqLmdldFZhbHVlKFwidWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0Y29tbWVudDogb2JqLmdldFZhbHVlKFwiY29tbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0cGFyZW50X3VpX2lkOiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRfdWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0bG9naWNfZGVmaW5pdGlvbjogb2JqLmdldFZhbHVlKFwibG9naWNfZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnVpX2lkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai51aV9pZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29tbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5jb21tZW50ID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5jb21tZW50KSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5jb21tZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfdWlfaWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF91aV9pZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sb2dpY19kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWZpbml0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoubG9naWNfZGVmaW5pdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBhcmVudF9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0xvZ2ljXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC51aV9pZCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb21tZW50ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuY29tbWVudCkgPT09ICdvYmplY3QnKSByZXQuY29tbWVudCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5jb21tZW50KSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGFyZW50X3VpX2lkID0gdGhpcy5wYXJlbnQoKTtcblxuXHRcdFx0aWYgKHJldC5wYXJlbnRfdWlfaWQpIHtcblx0XHRcdFx0cmV0LnBhcmVudF91aV9pZCA9IHJldC5wYXJlbnRfdWlfaWQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucGFyZW50X3VpX2lkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wYXJlbnRfdWlfaWQpLmxlbmd0aCkgcmV0LnBhcmVudF91aV9pZCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxvZ2ljX2RlZmluaXRpb24gPSB0aGlzLmRlZmluaXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5sb2dpY19kZWZpbml0aW9uKSB7XG5cdFx0XHRcdHJldC5sb2dpY19kZWZpbml0aW9uID0gcmV0LmxvZ2ljX2RlZmluaXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubG9naWNfZGVmaW5pdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubG9naWNfZGVmaW5pdGlvbikubGVuZ3RoKSByZXQubG9naWNfZGVmaW5pdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHJldC5ibG9jaykge1xuXHRcdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfRmxvd19Mb2dpY3MgPSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudF9GbG93X0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyA9IHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMgPSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ1aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfdWlfaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsb2dpY19kZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19sb2dpYycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd1aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndWlfaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29tbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29tbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF91aV9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwYXJlbnRfdWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudF91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnRfdWlfaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBMb2dpY1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJkZWZpbml0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIgKyBcImRlZmluaXRpb25bbG9naWNfZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZpbml0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xvZ2ljX2RlZmluaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xvZ2ljX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xvZ2ljX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbG9naWNfZGVmaW5pdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19sb2dpYycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWMnLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpYyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5wYXJlbnRfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfRmxvd19Mb2dpY3MpKSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcyhvYmoucGFyZW50X0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzKSkgdGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykpIHRoaXMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMpKSB0aGlzLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyhvYmoubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfbG9naWMnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWMnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1BsYW4iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1BsYW5cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdwbGFuX2lkJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdwbGFuJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0cGxhbl9pZDogb2JqLmdldFZhbHVlKFwicGxhbl9pZFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRwbGFuOiBvYmouZ2V0VmFsdWUoXCJwbGFuXCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYW5faWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnBsYW5faWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYW4pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucGxhbiA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucGxhbikpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucGxhbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19QbGFuXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGxhbl9pZCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wbGFuID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucGxhbikgPT09ICdvYmplY3QnKSByZXQucGxhbiA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5wbGFuKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBsYW5faWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBsYW5cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nLCBbJyonXSlbJ3N5c19mbG93X3N1YmZsb3dfcGxhbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BsYW5faWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhbl9pZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGxhbl9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwbGFuX2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BsYW4nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGxhbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwbGFuJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgUGxhblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3ViZmxvd19wbGFuJywgWycqJ10pWydzeXNfZmxvd19zdWJmbG93X3BsYW4nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19zdWJmbG93X3BsYW4nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19zdWJmbG93X3BsYW4nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3ViZmxvd19wbGFuJywgWycqJ10pWydzeXNfZmxvd19zdWJmbG93X3BsYW4nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlIiwibmFtZSI6InNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnBlcnNvbkRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBlcnNvbkRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGVyc29uRGF5ID0gdjtcblx0XHRcdHRoaXMuX3BlcnNvbkRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wZXJzb25EYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmVmZm9ydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVmZm9ydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWZmb3J0ID0gdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGVyc29uRGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncGVyc29uRGF5JyArICh0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPScpICsgdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdGlmICh0aGlzLl9lZmZvcnQpIHJldCArPSAvKih0aGlzLl9lZmZvcnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lZmZvcnQoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWZmb3J0LicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlcXVpcmVtZW50KSByZXQgKz0gLyoodGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZXF1aXJlbWVudCgpLl90b0VRdWVyeShzUGF0aCArICdyZXF1aXJlbWVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBlcnNvbkRheTogb2JqLmdldFZhbHVlKFwicGVyc29uRGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRlZmZvcnQ6IG9iai5nZXRWYWx1ZShcImVmZm9ydFwiKSxcblxuXHRcdFx0XHRcdFx0cmVxdWlyZW1lbnQ6IG9iai5nZXRWYWx1ZShcInJlcXVpcmVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRyb2xlOiBvYmouZ2V0VmFsdWUoXCJyb2xlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBlcnNvbkRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGVyc29uRGF5KG9iai5wZXJzb25EYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWZmb3J0KG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvYmouZWZmb3J0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlcXVpcmVtZW50KG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJvbGUobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJFZmZvcnRfRXN0aW1hdGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBlcnNvbkRheSA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWZmb3J0ID0gdGhpcy5lZmZvcnQoKTtcblxuXHRcdFx0aWYgKHJldC5lZmZvcnQpIHtcblx0XHRcdFx0cmV0LmVmZm9ydCA9IHJldC5lZmZvcnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZWZmb3J0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5lZmZvcnQpLmxlbmd0aCkgcmV0LmVmZm9ydCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHJldC5yZXF1aXJlbWVudCkge1xuXHRcdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJvbGUgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHJldC5yb2xlKSB7XG5cdFx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucm9sZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucm9sZSkubGVuZ3RoKSByZXQucm9sZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGVyc29uRGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGVyc29uRGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBlcnNvbkRheSh0aGlzLnBlcnNvbkRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVmZm9ydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVmZm9ydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnQodGhpcy5lZmZvcnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVxdWlyZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXF1aXJlbWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudCh0aGlzLnJlcXVpcmVtZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJvbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yb2xlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGUodGhpcy5yb2xlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGVyc29uRGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGVyc29uRGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwZXJzb25kYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGVyc29uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwZXJzb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGVyc29uZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VmZm9ydF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVmZm9ydCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwiZWZmb3J0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwiZWZmb3J0W2VmZm9ydF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5lZmZvcnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWZmb3J0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VmZm9ydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWZmb3J0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VmZm9ydCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJFZmZvcnQgRXN0aW1hdGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInJlcXVpcmVtZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwicmVxdWlyZW1lbnRbcmVxdWlyZW1lbnRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVxdWlyZW1lbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVxdWlyZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlcXVpcmVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yb2xlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucm9sZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwicm9sZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIgKyBcInJvbGVbcm9sZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yb2xlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JvbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyb2xlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19NZWV0aW5nIiwibmFtZSI6InNoc19hcmJmd19NZWV0aW5nIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19NZWV0aW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0YXJ0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhcnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5zdGFydCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3N0YXJ0ID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0YXJ0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZW5kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuZW5kKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZW5kID0gdjtcblx0XHRcdHRoaXMuX2VuZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zdGFydGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhcnRlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLnN0YXJ0ZWQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydGVkID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0ZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnRlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmVuZGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5lbmRlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2VuZGVkID0gdjtcblx0XHRcdHRoaXMuX2VuZGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuc2VyaWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VyaWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZXJpZXMgPSB2O1xuXHRcdFx0dGhpcy5fc2VyaWVzX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Nlcmllcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm9yZ2FuaXplciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZ2FuaXplcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JnYW5pemVyID0gdjtcblx0XHRcdHRoaXMuX29yZ2FuaXplcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmdhbml6ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5tb2RlcmF0b3IgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb2RlcmF0b3IodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21vZGVyYXRvciA9IHY7XG5cdFx0XHR0aGlzLl9tb2RlcmF0b3JfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZXJhdG9yO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcucHJvamVjdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2plY3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3Byb2plY3QgPSB2O1xuXHRcdFx0dGhpcy5fcHJvamVjdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5kZWNpc2lvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWNpc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZ19NZWV0aW5nX0FnZW5kYXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nX01lZXRpbmdfQWdlbmRhcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1lZXRpbmdfTWVldGluZ19NaW51dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZ19NZWV0aW5nX01pbnV0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX01lZXRpbmdfTWludXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nX01lZXRpbmdfTWludXRlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zdGFydCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXJ0JyArICh0aGlzLl9zdGFydF9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXJ0KCk7XG5cblx0XHRpZiAodGhpcy5fZW5kKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kJyArICh0aGlzLl9lbmRfY29vcCB8fCAnPScpICsgdGhpcy5lbmQoKTtcblxuXHRcdGlmICh0aGlzLl9zdGFydGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3RhcnRlZCcgKyAodGhpcy5fc3RhcnRlZF9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXJ0ZWQoKTtcblxuXHRcdGlmICh0aGlzLl9lbmRlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZGVkJyArICh0aGlzLl9lbmRlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuZGVkKCk7XG5cblx0XHRpZiAodGhpcy5fc2VyaWVzKSByZXQgKz0gLyoodGhpcy5fc2VyaWVzX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2VyaWVzKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Nlcmllcy4nKTtcblxuXHRcdGlmICh0aGlzLl9vcmdhbml6ZXIpIHJldCArPSAvKih0aGlzLl9vcmdhbml6ZXJfY29vcCB8fCAnPScpICsgKi8gdGhpcy5vcmdhbml6ZXIoKS5fdG9FUXVlcnkoc1BhdGggKyAnb3JnYW5pemVyLicpO1xuXG5cdFx0aWYgKHRoaXMuX21vZGVyYXRvcikgcmV0ICs9IC8qKHRoaXMuX21vZGVyYXRvcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1vZGVyYXRvcigpLl90b0VRdWVyeShzUGF0aCArICdtb2RlcmF0b3IuJyk7XG5cblx0XHRpZiAodGhpcy5fcHJvamVjdCkgcmV0ICs9IC8qKHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wcm9qZWN0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Byb2plY3QuJyk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX2RlY2lzaW9uKSByZXQgKz0gLyoodGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZWNpc2lvbigpLl90b0VRdWVyeShzUGF0aCArICdkZWNpc2lvbi4nKTtcblxuXHRcdCh0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYS5tZWV0aW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUubWVldGluZyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHN0YXJ0OiBvYmouZ2V0VmFsdWUoXCJzdGFydFwiKSxcblxuXHRcdFx0XHRcdFx0ZW5kOiBvYmouZ2V0VmFsdWUoXCJlbmRcIiksXG5cblx0XHRcdFx0XHRcdHN0YXJ0ZWQ6IG9iai5nZXRWYWx1ZShcInN0YXJ0ZWRcIiksXG5cblx0XHRcdFx0XHRcdGVuZGVkOiBvYmouZ2V0VmFsdWUoXCJlbmRlZFwiKSxcblxuXHRcdFx0XHRcdFx0c2VyaWVzOiBvYmouZ2V0VmFsdWUoXCJzZXJpZXNcIiksXG5cblx0XHRcdFx0XHRcdG9yZ2FuaXplcjogb2JqLmdldFZhbHVlKFwib3JnYW5pemVyXCIpLFxuXG5cdFx0XHRcdFx0XHRtb2RlcmF0b3I6IG9iai5nZXRWYWx1ZShcIm1vZGVyYXRvclwiKSxcblxuXHRcdFx0XHRcdFx0cHJvamVjdDogb2JqLmdldFZhbHVlKFwicHJvamVjdFwiKSxcblxuXHRcdFx0XHRcdFx0Ym9hcmQ6IG9iai5nZXRWYWx1ZShcImJvYXJkXCIpLFxuXG5cdFx0XHRcdFx0XHRkZWNpc2lvbjogb2JqLmdldFZhbHVlKFwiZGVjaXNpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGFydChvYmouc3RhcnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5kKG9iai5lbmQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXJ0ZWQob2JqLnN0YXJ0ZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmRlZChvYmouZW5kZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNlcmllcykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2VyaWVzKG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KG9iai5zZXJpZXMpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZ2FuaXplcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5vcmdhbml6ZXIpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2RlcmF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vZGVyYXRvcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tb2RlcmF0b3IpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wcm9qZWN0KG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYm9hcmQobmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQob2JqLmJvYXJkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlY2lzaW9uKG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMobmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdGFydCA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdFx0aWYgKHJldC5zdGFydCAmJiB0eXBlb2YocmV0LnN0YXJ0LnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LnN0YXJ0ID0gcmV0LnN0YXJ0LnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuZCA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmIChyZXQuZW5kICYmIHR5cGVvZihyZXQuZW5kLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmVuZCA9IHJldC5lbmQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXJ0ZWQgPSB0aGlzLnN0YXJ0ZWQoKTtcblxuXHRcdFx0aWYgKHJldC5zdGFydGVkICYmIHR5cGVvZihyZXQuc3RhcnRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydGVkID0gcmV0LnN0YXJ0ZWQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmRlZCA9IHRoaXMuZW5kZWQoKTtcblxuXHRcdFx0aWYgKHJldC5lbmRlZCAmJiB0eXBlb2YocmV0LmVuZGVkLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmVuZGVkID0gcmV0LmVuZGVkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNlcmllcyA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRcdGlmIChyZXQuc2VyaWVzKSB7XG5cdFx0XHRcdHJldC5zZXJpZXMgPSByZXQuc2VyaWVzLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNlcmllcykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc2VyaWVzKS5sZW5ndGgpIHJldC5zZXJpZXMgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZ2FuaXplciA9IHRoaXMub3JnYW5pemVyKCk7XG5cblx0XHRcdGlmIChyZXQub3JnYW5pemVyKSB7XG5cdFx0XHRcdHJldC5vcmdhbml6ZXIgPSByZXQub3JnYW5pemVyLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm9yZ2FuaXplcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQub3JnYW5pemVyKS5sZW5ndGgpIHJldC5vcmdhbml6ZXIgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb2RlcmF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vZGVyYXRvciA9IHRoaXMubW9kZXJhdG9yKCk7XG5cblx0XHRcdGlmIChyZXQubW9kZXJhdG9yKSB7XG5cdFx0XHRcdHJldC5tb2RlcmF0b3IgPSByZXQubW9kZXJhdG9yLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1vZGVyYXRvcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubW9kZXJhdG9yKS5sZW5ndGgpIHJldC5tb2RlcmF0b3IgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9qZWN0ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmIChyZXQucHJvamVjdCkge1xuXHRcdFx0XHRyZXQucHJvamVjdCA9IHJldC5wcm9qZWN0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2plY3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2plY3QpLmxlbmd0aCkgcmV0LnByb2plY3QgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYm9hcmQgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRcdGlmIChyZXQuYm9hcmQpIHtcblx0XHRcdFx0cmV0LmJvYXJkID0gcmV0LmJvYXJkLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJvYXJkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ib2FyZCkubGVuZ3RoKSByZXQuYm9hcmQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVjaXNpb24gPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRcdGlmIChyZXQuZGVjaXNpb24pIHtcblx0XHRcdFx0cmV0LmRlY2lzaW9uID0gcmV0LmRlY2lzaW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlY2lzaW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWNpc2lvbikubGVuZ3RoKSByZXQuZGVjaXNpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gdGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZ19NZWV0aW5nX01pbnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgPSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTWVldGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3RhcnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGFydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydCh0aGlzLnN0YXJ0KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5kXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5kKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuZCh0aGlzLmVuZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXJ0ZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGFydGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0ZWQodGhpcy5zdGFydGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5kZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmRlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmRlZCh0aGlzLmVuZGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2VyaWVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VyaWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlcmllcyh0aGlzLnNlcmllcygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmdhbml6ZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmdhbml6ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JnYW5pemVyKHRoaXMub3JnYW5pemVyKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vZGVyYXRvclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vZGVyYXRvcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlcmF0b3IodGhpcy5tb2RlcmF0b3IoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvamVjdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2plY3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdCh0aGlzLnByb2plY3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlY2lzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhcnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0YXJ0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdGFydCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5kJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0ZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGFydGVkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0YXJ0ZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0YXJ0ZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXJ0ZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnRlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuZGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5kZWQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5kZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuZGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmRlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmRlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zZXJpZXNfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zZXJpZXMoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwic2VyaWVzIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcInNlcmllc1tzZXJpZXNdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc2VyaWVzKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NlcmllcycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2VyaWVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzZXJpZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2VyaWVzJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZ2FuaXplcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZ2FuaXplcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZ2FuaXplcigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJvcmdhbml6ZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwib3JnYW5pemVyW29yZ2FuaXplcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5vcmdhbml6ZXIoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JnYW5pemVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmdhbml6ZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZ2FuaXplcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmdhbml6ZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kZXJhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbW9kZXJhdG9yX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubW9kZXJhdG9yKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcIm1vZGVyYXRvciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJtb2RlcmF0b3JbbW9kZXJhdG9yXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1vZGVyYXRvcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb2RlcmF0b3InKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vZGVyYXRvcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbW9kZXJhdG9yJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21vZGVyYXRvcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwicHJvamVjdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJwcm9qZWN0W3Byb2plY3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucHJvamVjdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9qZWN0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcm9qZWN0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Byb2plY3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9ib2FyZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcImJvYXJkIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcImJvYXJkW2JvYXJkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJvYXJkKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2JvYXJkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdib2FyZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYm9hcmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcImRlY2lzaW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcImRlY2lzaW9uW2RlY2lzaW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlY2lzaW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RlY2lzaW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWNpc2lvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVjaXNpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdGlmIChfb2JqLnN0YXJ0ICYmIHR5cGVvZihfb2JqLnN0YXJ0LmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5zdGFydCA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouc3RhcnQpO1xuXG5cdFx0XHRpZiAoX29iai5lbmQgJiYgdHlwZW9mKF9vYmouZW5kLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5lbmQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmVuZCk7XG5cblx0XHRcdGlmIChfb2JqLnN0YXJ0ZWQgJiYgdHlwZW9mKF9vYmouc3RhcnRlZC5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouc3RhcnRlZCA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouc3RhcnRlZCk7XG5cblx0XHRcdGlmIChfb2JqLmVuZGVkICYmIHR5cGVvZihfb2JqLmVuZGVkLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5lbmRlZCA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZW5kZWQpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwib2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykpIHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQubW9kZWxfaWQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tb2RlbF9pZCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Lk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5tb2RlbF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VsZW1lbnQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdhdHRyaWJ1dGVzJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaW50ZXJuYWxfdHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodGhpcy5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c192YXJpYWJsZV92YWx1ZS5hY3Rpb25JbnB1dCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG9iai5nZXRWYWx1ZShcImVsZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRhdHRyaWJ1dGVzOiBvYmouZ2V0VmFsdWUoXCJhdHRyaWJ1dGVzXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF90eXBlOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF90eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0YWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVsZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXR0cmlidXRlcykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5hdHRyaWJ1dGVzID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5hdHRyaWJ1dGVzKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5hdHRyaWJ1dGVzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnRlcm5hbF90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG9iai5pbnRlcm5hbF90eXBlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9JbnB1dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnQgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmF0dHJpYnV0ZXMgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hdHRyaWJ1dGVzKSA9PT0gJ29iamVjdCcpIHJldC5hdHRyaWJ1dGVzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmF0dHJpYnV0ZXMpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfdHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tYXhfbGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1heF9sZW5ndGggPSB0aGlzLm1heF9sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF9pZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF9pZCA9IHRoaXMubW9kZWxfaWQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlbF90YWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlbF90YWJsZSA9IHRoaXMubW9kZWxfdGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl9pbnB1dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhYmVsJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXR0cmlidXRlcycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5wdXQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl9pbnB1dCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25faW5wdXQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Qub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5ibG9jayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ibG9jayA9IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9jaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19PdXRwdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19PdXRwdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X091dHB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfQWN0aW9uX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19QbGFucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfUGxhbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X1BsYW5zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19QbGFuc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19QbGFucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsX2NhY2hlJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50X2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fYmxvY2spIHJldCArPSAvKih0aGlzLl9ibG9ja19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJsb2NrKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Jsb2NrLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2lucHV0LnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19vdXRwdXQuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfdmFyaWFibGUuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2FjdGlvbl9pbnB1dC5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19QbGFucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2Zsb3dfc3ViZmxvd19wbGFuLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZmxvd19kYXRhX3Zhci5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmcm9tRmxvd1wiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZyb21GbG93KHBheWxvYWRbXCJmbG93XCJdLCApO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfbmFtZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbF9jYWNoZTogb2JqLmdldFZhbHVlKFwibGFiZWxfY2FjaGVcIiksXG5cblx0XHRcdFx0XHRcdHBhcmVudF9mbG93OiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRfZmxvd1wiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmludGVybmFsX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsX2NhY2hlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmxhYmVsX2NhY2hlID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5sYWJlbF9jYWNoZSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoubGFiZWxfY2FjaGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X2Zsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19QbGFucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19TbmFwc2hvdFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbF9jYWNoZSA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmxhYmVsX2NhY2hlKSA9PT0gJ29iamVjdCcpIHJldC5sYWJlbF9jYWNoZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5sYWJlbF9jYWNoZSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnRfZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudF9mbG93KSB7XG5cdFx0XHRcdHJldC5wYXJlbnRfZmxvdyA9IHJldC5wYXJlbnRfZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnRfZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucGFyZW50X2Zsb3cpLmxlbmd0aCkgcmV0LnBhcmVudF9mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJsb2NrID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAocmV0LmJsb2NrKSB7XG5cdFx0XHRcdHJldC5ibG9jayA9IHJldC5ibG9jay5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ibG9jaykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYmxvY2spLmxlbmd0aCkgcmV0LmJsb2NrID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19JbnB1dHMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19PdXRwdXRzID0gdGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzID0gdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19Mb2dpY3MgPSB0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyA9IHRoaXMuc25hcHNob3RfRmxvd19JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfQWN0aW9uX0lucHV0cyA9IHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19QbGFucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X1BsYW5zID0gdGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnRlcm5hbF9uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbF9jYWNoZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRfZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfc25hcHNob3QnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF9uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWxfY2FjaGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsX2NhY2hlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbF9jYWNoZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbF9jYWNoZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W3BhcmVudF9mbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50X2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudF9mbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXJlbnRfZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnRfZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFNuYXBzaG90XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19JbnB1dHMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKG9iai5zbmFwc2hvdF9GbG93X0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19PdXRwdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cykpIHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyhvYmouc25hcHNob3RfRmxvd19WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19Mb2dpY3MpKSB0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKG9iai5zbmFwc2hvdF9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcykpIHRoaXMuc25hcHNob3RfRmxvd19JbnN0YW5jZXMob2JqLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSkgdGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X1BsYW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X1BsYW5zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMob2JqLnNuYXBzaG90X0Zsb3dfUGxhbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcykpIHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyhvYmouc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyb21GbG93KF9fZXZlbnQsIGZsb3cpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGZsb3cgPSBldkpTT04uZmxvdztcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZnJvbUZsb3coKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gZXZKU09OO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZ2V0UGFyYW1ldGVyKSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YoZmxvdykgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcignZmxvdycpKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0ZmxvdyA9IHRoaXMuZ2V0UGFyYW1ldGVyKCdmbG93Jyk7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmlucHV0X0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGlucHV0X0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5wdXRfRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5tb2RlbF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubW9kZWxfaWQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tb2RlbF9pZCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5Nb2RlbF9JRCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3ZTNCd1lYUm9mWDB1WDE5MGVYQmxQVDBuYzNselgzWmhjbWxoWW14bFgzWmhiSFZsSnlBbUppQjdlMTlmZlgwdWMzVmlabXh2ZHlrL2UzdGZYMzE5TG5OMVltWnNiM2N1U1dRNmUzdHdjR0YwYUgxOUxrbGtLVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UEZzcUtsdG1iRzkzWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVczTnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhWMHVjM1ZpWm14dmR5NUpaQ3dnS2lwYllXTjBhVzl1WDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRoWTNScGIyNUpibkIxZEZ0dGIyUmxiRjlwWkQwbmUzdHBaSDE5SjExZFhTNTdYQ0pKWkZ3aU9pQmNJbDltZTJkekxtbHVabThvWDNSdlUzUnlhVzVuSUNzZ0p6b2dSa2xLVTA5T09pQW5JQ3NnU2xOUFRpNXpkSEpwYm1kcFpua29jbVZtY3k1dFlXNTVVbVZtY3lrcGZWd2lmUzVKWkYxYk1GMCtQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdlbGVtZW50JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFiZWwnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYXR0cmlidXRlcycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0aGlzLmlucHV0X0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2RvY3VtZW50YXRpb24uaW5wdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c192YXJpYWJsZV92YWx1ZS5mbG93SW5wdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZWxlbWVudDogb2JqLmdldFZhbHVlKFwiZWxlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGF0dHJpYnV0ZXM6IG9iai5nZXRWYWx1ZShcImF0dHJpYnV0ZXNcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX3R5cGU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZWxlbWVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmxhYmVsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hdHRyaWJ1dGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmF0dHJpYnV0ZXMgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmF0dHJpYnV0ZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnB1dF9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvYmouaW5wdXRfRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnB1dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXR0cmlidXRlcyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmF0dHJpYnV0ZXMpID09PSAnb2JqZWN0JykgcmV0LmF0dHJpYnV0ZXMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuYXR0cmlidXRlcykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF90eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5wdXRfRmllbGRfTGFiZWxzID0gdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWF4X2xlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXhfbGVuZ3RoID0gdGhpcy5tYXhfbGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfdGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfdGFibGUgPSB0aGlzLm1vZGVsX3RhYmxlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kZWxfaWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZWxfaWQgPSB0aGlzLm1vZGVsX2lkKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfaW5wdXQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2F0dHJpYnV0ZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXR0cmlidXRlcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF90eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfaW5wdXQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2lucHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfaW5wdXQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJvYmouaW5wdXRfRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5pbnB1dF9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5wdXRfRmllbGRfTGFiZWxzKSkgdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMob2JqLmlucHV0X0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19pbnB1dCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm91dHB1dF9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvdXRwdXRfRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fb3V0cHV0X0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX291dHB1dF9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX291dHB1dF9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQubWF4X2xlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tYXhfbGVuZ3RoID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiAoe1xuXHRcdFx0XHRcdFx0XCJTdHJpbmdcIjogMjU1LFxuXHRcdFx0XHRcdFx0XCJUZXh0XCI6IDQwMDAsXG5cdFx0XHRcdFx0fSlbdGhpcy50eXBlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5Nb2RlbF9JRCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3ZTNCd1lYUm9mWDB1WDE5MGVYQmxQVDBuYzNselgzWmhjbWxoWW14bFgzWmhiSFZsSnlBbUppQjdlMTlmZlgwdWMzVmlabXh2ZHlrL2UzdGZYMzE5TG5OMVltWnNiM2N1U1dRNmUzdHdjR0YwYUgxOUxrbGtLVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UEZzcUtsdG1iRzkzWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcyWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVczTnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhWMHVjM1ZpWm14dmR5NUpaQ3dnS2lwYllXTjBhVzl1WDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRoWTNScGIyNUpibkIxZEZ0dGIyUmxiRjlwWkQwbmUzdHBaSDE5SjExZFhTNTdYQ0pKWkZ3aU9pQmNJbDltZTJkekxtbHVabThvWDNSdlUzUnlhVzVuSUNzZ0p6b2dSa2xLVTA5T09pQW5JQ3NnU2xOUFRpNXpkSEpwYm1kcFpua29jbVZtY3k1dFlXNTVVbVZtY3lrcGZWd2lmUzVKWkYxYk1GMCtQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5tb2RlbF90YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5hdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdEF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VsZW1lbnQnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdsYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdhdHRyaWJ1dGVzJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaW50ZXJuYWxfdHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2RvY3VtZW50YXRpb24ub3V0cHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0YXR0cmlidXRlczogb2JqLmdldFZhbHVlKFwiYXR0cmlidXRlc1wiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfdHlwZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfdHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZWxlbWVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmxhYmVsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hdHRyaWJ1dGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmF0dHJpYnV0ZXMgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmF0dHJpYnV0ZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vdXRwdXRfRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5vdXRwdXRfRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19PdXRwdXRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXR0cmlidXRlcyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmF0dHJpYnV0ZXMpID09PSAnb2JqZWN0JykgcmV0LmF0dHJpYnV0ZXMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuYXR0cmlidXRlcykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF90eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm91dHB1dF9GaWVsZF9MYWJlbHMgPSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX2lkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX2lkID0gdGhpcy5tb2RlbF9pZCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX3RhYmxlID0gdGhpcy5tb2RlbF90YWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbGVtZW50XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXR0cmlidXRlc1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnRlcm5hbF90eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1hbmRhdG9yeVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1hbmRhdG9yeSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYW5kYXRvcnkodGhpcy5tYW5kYXRvcnkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X291dHB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X291dHB1dCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X291dHB1dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhYmVsJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXR0cmlidXRlcycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2F0dHJpYnV0ZXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXR0cmlidXRlcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnRlcm5hbF90eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgT3V0cHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgT3V0cHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBPdXRwdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19vdXRwdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19vdXRwdXQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLm91dHB1dF9GaWVsZF9MYWJlbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoub3V0cHV0X0ZpZWxkX0xhYmVscykpIHRoaXMub3V0cHV0X0ZpZWxkX0xhYmVscyhvYmoub3V0cHV0X0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X291dHB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X291dHB1dCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS52YXJpYWJsZV9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2YXJpYWJsZV9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl92YXJpYWJsZV9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl92YXJpYWJsZV9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZhcmlhYmxlX0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLl9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUubW9kZWxfdGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tb2RlbF90YWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdlbGVtZW50JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFiZWwnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYXR0cmlidXRlcycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2RvY3VtZW50YXRpb24udmFyaWFibGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZWxlbWVudDogb2JqLmdldFZhbHVlKFwiZWxlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGF0dHJpYnV0ZXM6IG9iai5nZXRWYWx1ZShcImF0dHJpYnV0ZXNcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX3R5cGU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZWxlbWVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubGFiZWwpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmxhYmVsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hdHRyaWJ1dGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmF0dHJpYnV0ZXMgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmF0dHJpYnV0ZXMpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmF0dHJpYnV0ZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMobmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19WYXJpYWJsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmxhYmVsID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXR0cmlidXRlcyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LmF0dHJpYnV0ZXMpID09PSAnb2JqZWN0JykgcmV0LmF0dHJpYnV0ZXMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuYXR0cmlidXRlcykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF90eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFyaWFibGVfRmllbGRfTGFiZWxzID0gdGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX2lkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX2lkID0gdGhpcy5tb2RlbF9pZCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX3RhYmxlID0gdGhpcy5tb2RlbF90YWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhdHRyaWJ1dGVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX3R5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhdHRyaWJ1dGVzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhdHRyaWJ1dGVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2F0dHJpYnV0ZXMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfdHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnRlcm5hbF90eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlZmVyZW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJmbG93W2Zsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJywgWycqJ10pWydzeXNfaHViX2Zsb3dfdmFyaWFibGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd192YXJpYWJsZScsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykpIHRoaXMudmFyaWFibGVfRmllbGRfTGFiZWxzKG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd192YXJpYWJsZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm1heF9sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbWF4X2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tb2RlbF9pZCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21vZGVsX2lkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm1vZGVsX3RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbW9kZWxfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuYXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfYXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2F0dHJpYnV0ZXMnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF90eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZWxlbWVudDogb2JqLmdldFZhbHVlKFwiZWxlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRsYWJlbDogb2JqLmdldFZhbHVlKFwibGFiZWxcIiksXG5cblx0XHRcdFx0XHRcdGF0dHJpYnV0ZXM6IG9iai5nZXRWYWx1ZShcImF0dHJpYnV0ZXNcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX3R5cGU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0Zmxvdzogb2JqLmdldFZhbHVlKFwiZmxvd1wiKSxcblxuXHRcdFx0XHRcdFx0c25hcHNob3Q6IG9iai5nZXRWYWx1ZShcInNuYXBzaG90XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5lbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmF0dHJpYnV0ZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouYXR0cmlidXRlcyA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYXR0cmlidXRlcykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouYXR0cmlidXRlcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW50ZXJuYWxfdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmouaW50ZXJuYWxfdHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0RhdGFfVmFyaWFibGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbGVtZW50ID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubGFiZWwgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hdHRyaWJ1dGVzID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuYXR0cmlidXRlcykgPT09ICdvYmplY3QnKSByZXQuYXR0cmlidXRlcyA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5hdHRyaWJ1dGVzKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmludGVybmFsX3R5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlZmVyZW5jZSA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmIChyZXQucmVmZXJlbmNlKSB7XG5cdFx0XHRcdHJldC5yZWZlcmVuY2UgPSByZXQucmVmZXJlbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJlZmVyZW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucmVmZXJlbmNlKS5sZW5ndGgpIHJldC5yZWZlcmVuY2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc25hcHNob3QgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmIChyZXQuc25hcHNob3QpIHtcblx0XHRcdFx0cmV0LnNuYXBzaG90ID0gcmV0LnNuYXBzaG90Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNuYXBzaG90KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zbmFwc2hvdCkubGVuZ3RoKSByZXQuc25hcHNob3QgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX2lkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX2lkID0gdGhpcy5tb2RlbF9pZCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVsX3RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZGVsX3RhYmxlID0gdGhpcy5tb2RlbF90YWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWxlbWVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhYmVsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImF0dHJpYnV0ZXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfdmFyJywgWycqJ10pWydzeXNfZmxvd19kYXRhX3ZhciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZGF0YV92YXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VsZW1lbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2F0dHJpYnV0ZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXR0cmlidXRlcycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXR0cmlidXRlcycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhdHRyaWJ1dGVzJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ludGVybmFsX3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW50ZXJuYWxfdHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnRlcm5hbF90eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IERhdGEgVmFyaWFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBEYXRhIFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBEYXRhIFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX3ZhcicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV92YXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19kYXRhX3ZhcicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19kYXRhX3ZhcicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX3ZhcicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV92YXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfUmVxdWlyZW1lbnQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19SZXF1aXJlbWVudCIsIm5hbWUiOiJzaHNfYXJiZndfUmVxdWlyZW1lbnQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X1JlcXVpcmVtZW50IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUmVxdWlyZW1lbnRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5wcm9qZWN0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvamVjdCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuY2FwYWJpbGl0eSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNhcGFiaWxpdHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NhcGFiaWxpdHkgPSB2O1xuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jYXBhYmlsaXR5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcHJvamVjdCkgcmV0ICs9IC8qKHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wcm9qZWN0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Byb2plY3QuJyk7XG5cblx0XHRpZiAodGhpcy5fY2FwYWJpbGl0eSkgcmV0ICs9IC8qKHRoaXMuX2NhcGFiaWxpdHlfY29vcCB8fCAnPScpICsgKi8gdGhpcy5jYXBhYmlsaXR5KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2NhcGFiaWxpdHkuJyk7XG5cblx0XHQodGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUucmVxdWlyZW1lbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0ucmVxdWlyZW1lbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cHJvamVjdDogb2JqLmdldFZhbHVlKFwicHJvamVjdFwiKSxcblxuXHRcdFx0XHRcdFx0Y2FwYWJpbGl0eTogb2JqLmdldFZhbHVlKFwiY2FwYWJpbGl0eVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnByb2plY3QobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNhcGFiaWxpdHkobmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouY2FwYWJpbGl0eSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJSZXF1aXJlbWVudFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9qZWN0ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmIChyZXQucHJvamVjdCkge1xuXHRcdFx0XHRyZXQucHJvamVjdCA9IHJldC5wcm9qZWN0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2plY3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2plY3QpLmxlbmd0aCkgcmV0LnByb2plY3QgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jYXBhYmlsaXR5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jYXBhYmlsaXR5ID0gdGhpcy5jYXBhYmlsaXR5KCk7XG5cblx0XHRcdGlmIChyZXQuY2FwYWJpbGl0eSkge1xuXHRcdFx0XHRyZXQuY2FwYWJpbGl0eSA9IHJldC5jYXBhYmlsaXR5Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmNhcGFiaWxpdHkpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmNhcGFiaWxpdHkpLmxlbmd0aCkgcmV0LmNhcGFiaWxpdHkgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyA9IHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyA9IHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInByb2plY3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9qZWN0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3QodGhpcy5wcm9qZWN0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNhcGFiaWxpdHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jYXBhYmlsaXR5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNhcGFiaWxpdHkodGhpcy5jYXBhYmlsaXR5KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJSZXF1aXJlbWVudFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJwcm9qZWN0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiICsgXCJwcm9qZWN0W3Byb2plY3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucHJvamVjdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9qZWN0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jYXBhYmlsaXR5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY2FwYWJpbGl0eSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlJlcXVpcmVtZW50XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcImNhcGFiaWxpdHkgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIgKyBcImNhcGFiaWxpdHlbY2FwYWJpbGl0eV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5jYXBhYmlsaXR5KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NhcGFiaWxpdHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjYXBhYmlsaXR5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjYXBhYmlsaXR5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NhcGFiaWxpdHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIm9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMpKSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSkgdGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmNvbHVtbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uID0gdjtcblx0XHRcdHRoaXMuX2NvbHVtbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3Vic2NyaXB0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3Vic2NyaXB0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb24gPSB2O1xuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4pIHJldCArPSAvKih0aGlzLl9jb2x1bW5fY29vcCB8fCAnPScpICsgKi8gdGhpcy5jb2x1bW4oKS5fdG9FUXVlcnkoc1BhdGggKyAnY29sdW1uLicpO1xuXG5cdFx0aWYgKHRoaXMuX3N1YnNjcmlwdGlvbikgcmV0ICs9IC8qKHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnN1YnNjcmlwdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzdWJzY3JpcHRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2x1bW46IG9iai5nZXRWYWx1ZShcImNvbHVtblwiKSxcblxuXHRcdFx0XHRcdFx0c3Vic2NyaXB0aW9uOiBvYmouZ2V0VmFsdWUoXCJzdWJzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29sdW1uKG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW4pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN1YnNjcmlwdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zdWJzY3JpcHRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU3Vic2NyaXB0aW9uX1RyaWdnZXJcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2x1bW4gPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAocmV0LmNvbHVtbikge1xuXHRcdFx0XHRyZXQuY29sdW1uID0gcmV0LmNvbHVtbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5jb2x1bW4pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmNvbHVtbikubGVuZ3RoKSByZXQuY29sdW1uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3Vic2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdWJzY3JpcHRpb24gPSB0aGlzLnN1YnNjcmlwdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN1YnNjcmlwdGlvbikge1xuXHRcdFx0XHRyZXQuc3Vic2NyaXB0aW9uID0gcmV0LnN1YnNjcmlwdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zdWJzY3JpcHRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN1YnNjcmlwdGlvbikubGVuZ3RoKSByZXQuc3Vic2NyaXB0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29sdW1uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29sdW1uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbih0aGlzLmNvbHVtbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdWJzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdWJzY3JpcHRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3Vic2NyaXB0aW9uKHRoaXMuc3Vic2NyaXB0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2x1bW4pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2x1bW5fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2x1bW4oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTdWJzY3JpcHRpb24gVHJpZ2dlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJjb2x1bW4gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcImNvbHVtbltjb2x1bW5dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY29sdW1uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbHVtbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbHVtbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29sdW1uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdWJzY3JpcHRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdWJzY3JpcHRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTdWJzY3JpcHRpb24gVHJpZ2dlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJzdWJzY3JpcHRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIgKyBcInN1YnNjcmlwdGlvbltzdWJzY3JpcHRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc3Vic2NyaXB0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N1YnNjcmlwdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N1YnNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3Vic2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1YnNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU3Vic2NyaXB0aW9uX1RyaWdnZXInLCBbJyonXSlbJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5zb3VyY2VfdHlwZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzb3VyY2VUeXBlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfc291cmNlX3R5cGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3lzX2h1Yl9mbG93XCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zb3VyY2VUeXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNselgyaDFZbDltYkc5M0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdyZXBvcnRpbmcnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NvdXJjZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRyZXBvcnRpbmc6IG9iai5nZXRWYWx1ZShcInJlcG9ydGluZ1wiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0c291cmNlOiBvYmouZ2V0VmFsdWUoXCJzb3VyY2VcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcG9ydGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoucmVwb3J0aW5nKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc291cmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc291cmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfU2V0dGluZ1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlcG9ydGluZyA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc291cmNlID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuc291cmNlKSB7XG5cdFx0XHRcdHJldC5zb3VyY2UgPSByZXQuc291cmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNvdXJjZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc291cmNlKS5sZW5ndGgpIHJldC5zb3VyY2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNvdXJjZV90eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNvdXJjZV90eXBlID0gdGhpcy5zb3VyY2VfdHlwZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlcG9ydGluZ1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNvdXJjZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVwb3J0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcG9ydGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVwb3J0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlcG9ydGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgU2V0dGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIgKyBcImZsb3dbc291cmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc291cmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NvdXJjZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc291cmNlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NvdXJjZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnLCBbJyonXSlbJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycsIFsnKiddKVsnc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3ciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3ciLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvdyIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuYmxvY2sgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9jayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYmxvY2sgPSB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2s7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5zZWN1cml0eUNvbnRyb2wgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzZWN1cml0eUNvbnRyb2wodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NlY3VyaXR5Q29udHJvbCA9IHY7XG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2xfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VjdXJpdHlDb250cm9sO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19PdXRwdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X091dHB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfT3V0cHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19PdXRwdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfT3V0cHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0Zsb3dfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfRmxvd19WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfTG9naWNzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X0xvZ2ljcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfTG9naWNzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfTG9naWNzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc3ViZmxvd19GbG93X0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YmZsb3dfRmxvd19JbnN0YW5jZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zdWJmbG93X0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc3ViZmxvd19GbG93X0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3ViZmxvd19GbG93X0luc3RhbmNlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfQWN0aW9uX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfQWN0aW9uX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19BY3Rpb25fSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X1NldHRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X1NldHRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1NldHRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1NldHRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfU2V0dGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfU25hcHNob3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X1NuYXBzaG90cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TbmFwc2hvdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfU25hcHNob3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfU25hcHNob3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X0RhdGFfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0RhdGFfVmFyaWFibGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0RhdGFfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5jYWxsYWJsZV9ieV9jbGllbnRfYXBpIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNsaWVudENhbGxhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfY2FsbGFibGVfYnlfY2xpZW50X2FwaSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5jbGllbnRDYWxsYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLSHQ3WDE5OWZTNWhZMnh6UHlkMGNuVmxKem9uWm1Gc2MyVW5LVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UENSbGVHbHpkSE1vZTN0ZlgzMTlMbUZqYkhNcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnN5c19wb2xpY3kgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cG9saWN5KCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfc3lzX3BvbGljeSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5wb2xpY3koKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6UHlkd2NtOTBaV04wWldRbk9pY25LVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UENSbGVHbHpkSE1vZTN0ZlgzMTlMbVpzYjNkZlJteHZkMTlUYm1Gd2MyaHZkSE1wUHlkd2NtOTBaV04wWldRbk9pY25QajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5zdGF0dXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhdHVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfc3RhdHVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LnN0YXR1cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLSHQ3WDE5OWZTNW1iRzkzWDBac2IzZGZVMjVoY0hOb2IzUnpQeWR3ZFdKc2FYTm9aV1FuT2lka2NtRm1kQ2NwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEpHVjRhWE4wY3loN2UxOWZmWDB1Wm14dmQxOUdiRzkzWDFOdVlYQnphRzkwY3lrL0ozQjFZbXhwYzJobFpDYzZKMlJ5WVdaMEp6NCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnR5cGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3R5cGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3ViZmxvd1wiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LnR5cGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2ljM1ZpWm14dmR5SjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cubGF0ZXN0X3NuYXBzaG90IEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxhc3RTbmFwc2hvdCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xhdGVzdF9zbmFwc2hvdCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5sYXN0U25hcHNob3QoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6UDN0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6V3pCZExrbGtPaWNuS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSeld6QmRMa2xrUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cubWFzdGVyX3NuYXBzaG90IEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1haW5TbmFwc2hvdCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21hc3Rlcl9zbmFwc2hvdCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5tYWluU25hcHNob3QoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVzWVhSbGMzUmZjMjVoY0hOb2IzUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4ZTN0ZlgzMTlMbVpzYjNkZlJteHZkMTlUYm1Gd2MyaHZkSE5iTUYwdVNXUStQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwiYnJvd3NlckFjdGl2YXRlZEluPWNocm9tZSxpbnRlZ3JhdGlvbkFjdGl2YXRlZEluPXN0YW5kYWxvbmUsbGFiZWxDYWNoZUNsZWFuVXBFeGVjdXRlZD10cnVlLHRpbWVGcm9tQ3JlYXRlVG9BY3RpdmF0ZT0zOTcwMDAsdmlld0FjdGl2YXRlZEluPW5hdHVyYWxMYW5ndWFnZVwiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lZbkp2ZDNObGNrRmpkR2wyWVhSbFpFbHVQV05vY205dFpTeHBiblJsWjNKaGRHbHZia0ZqZEdsMllYUmxaRWx1UFhOMFlXNWtZV3h2Ym1Vc2JHRmlaV3hEWVdOb1pVTnNaV0Z1VlhCRmVHVmpkWFJsWkQxMGNuVmxMSFJwYldWR2NtOXRRM0psWVhSbFZHOUJZM1JwZG1GMFpUMHpPVGN3TURBc2RtbGxkMEZqZEdsMllYUmxaRWx1UFc1aGRIVnlZV3hNWVc1bmRXRm5aU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmxhYmVsX2NhY2hlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxhYmVsQ2FjaGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYWJlbF9jYWNoZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gYDw8JGFwcGVuZCgkYXBwZW5kKCoqLnBhcmVudF9GbG93X0luc3RhbmNlc1tsYWJlbF9jYWNoZT0ne3tpZH19J10ue1wibmFtZVwiOiB1aV9pZCZcIi5cIiZzdWJmbG93LmludGVybmFsX25hbWUsIFwicmVmZXJlbmNlX2Rpc3BsYXlcIjogJyR7dGhpcy5FbnRpdHlDbGFzcy5OYW1lfScsIFwibGFiZWxcIjogb3JkZXImJyAtICcmc3ViZmxvdy5uYW1lJidcXHUyNzliJyZzdWJmbG93Lm5hbWUsIFwiYmFzZV90eXBlXCI6IGludGVybmFsX3R5cGUsIFwidHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcImF0dHJpYnV0ZXNcIjoge1wiZWxlbWVudF9tYXBwaW5nX3Byb3ZpZGVyXCI6ICdjb20uZ2xpZGUuZmxvd19kZXNpZ24uYWN0aW9uLmRhdGEuRmxvd0Rlc2lnblZhcmlhYmxlTWFwcGVyJywgXCJ1aVR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJ1aVVuaXF1ZUlkXCI6IElkfX1bJF0sXG5cbiQuZmxvd19GbG93X1ZhcmlhYmxlcy57XCJuYW1lXCI6ICdmbG93X3ZhcmlhYmxlLicmZWxlbWVudCwgXCJyZWZlcmVuY2VfZGlzcGxheVwiOiAnbGFiZWwnXG4sIFwibGFiZWxcIjogJ0Zsb3cgVmFyaWFibGVzXFx1Mjc5YicmZWxlbWVudCwgXCJiYXNlX3R5cGVcIjogaW50ZXJuYWxfdHlwZSxcblwidHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcImF0dHJpYnV0ZXNcIjoge1xuICAgIFwiZWxlbWVudF9tYXBwaW5nX3Byb3ZpZGVyXCI6ICdjb20uZ2xpZGUuZmxvd19kZXNpZ24uYWN0aW9uLmRhdGEuRmxvd0Rlc2lnblZhcmlhYmxlTWFwcGVyJyxcbiAgICBcInVpVHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInVpVW5pcXVlSWRcIjogSWRcbn1cbn0pXG4sXG4kLmZsb3dfRmxvd19JbnB1dHMue1wibmFtZVwiOiAnc3ViZmxvdy4nJmVsZW1lbnQsIFwicmVmZXJlbmNlX2Rpc3BsYXlcIjogJ2xhYmVsJ1xuLCBcImxhYmVsXCI6ICdJbnB1dFxcdTI3OWInJmVsZW1lbnQsIFwiYmFzZV90eXBlXCI6IGludGVybmFsX3R5cGUsXG5cInR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJhdHRyaWJ1dGVzXCI6IHtcbiAgICBcImVsZW1lbnRfbWFwcGluZ19wcm92aWRlclwiOiAnY29tLmdsaWRlLmZsb3dfZGVzaWduLmFjdGlvbi5kYXRhLkZsb3dEZXNpZ25WYXJpYWJsZU1hcHBlcicsXG4gICAgXCJ1aVR5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJ1aVVuaXF1ZUlkXCI6IElkXG59fSk+PmA7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubGFiZWxDYWNoZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnWUR3OEpHRndjR1Z1WkNna1lYQndaVzVrS0NvcUxuQmhjbVZ1ZEY5R2JHOTNYMGx1YzNSaGJtTmxjMXRzWVdKbGJGOWpZV05vWlQwbmUzdHBaSDE5SjEwdWUxd2libUZ0WlZ3aU9pQjFhVjlwWkNaY0lpNWNJaVp6ZFdKbWJHOTNMbWx1ZEdWeWJtRnNYMjVoYldVc0lGd2ljbVZtWlhKbGJtTmxYMlJwYzNCc1lYbGNJam9nSjF4Y0pIdDBhR2x6TGtWdWRHbDBlVU5zWVhOekxrNWhiV1Y5Snl3Z1hDSnNZV0psYkZ3aU9pQnZjbVJsY2lZbklDMGdKeVp6ZFdKbWJHOTNMbTVoYldVbUoxeGNYRngxTWpjNVlpY21jM1ZpWm14dmR5NXVZVzFsTENCY0ltSmhjMlZmZEhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJblI1Y0dWY0lqb2dhVzUwWlhKdVlXeGZkSGx3WlN3Z1hDSmhkSFJ5YVdKMWRHVnpYQ0k2SUh0Y0ltVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2x3aU9pQW5ZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2ljc0lGd2lkV2xVZVhCbFhDSTZJR2x1ZEdWeWJtRnNYM1I1Y0dVc0lGd2lkV2xWYm1seGRXVkpaRndpT2lCSlpIMTlXeVJkTEZ4dVhHNGtMbVpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE11ZTF3aWJtRnRaVndpT2lBblpteHZkMTkyWVhKcFlXSnNaUzRuSm1Wc1pXMWxiblFzSUZ3aWNtVm1aWEpsYm1ObFgyUnBjM0JzWVhsY0lqb2dKMnhoWW1Wc0oxeHVMQ0JjSW14aFltVnNYQ0k2SUNkR2JHOTNJRlpoY21saFlteGxjMXhjWEZ4MU1qYzVZaWNtWld4bGJXVnVkQ3dnWENKaVlYTmxYM1I1Y0dWY0lqb2dhVzUwWlhKdVlXeGZkSGx3WlN4Y2Jsd2lkSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0ltRjBkSEpwWW5WMFpYTmNJam9nZTF4dUlDQWdJRndpWld4bGJXVnVkRjl0WVhCd2FXNW5YM0J5YjNacFpHVnlYQ0k2SUNkamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlKeXhjYmlBZ0lDQmNJblZwVkhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJblZwVlc1cGNYVmxTV1JjSWpvZ1NXUmNibjFjYm4wcFhHNHNYRzRrTG1ac2IzZGZSbXh2ZDE5SmJuQjFkSE11ZTF3aWJtRnRaVndpT2lBbmMzVmlabXh2ZHk0bkptVnNaVzFsYm5Rc0lGd2ljbVZtWlhKbGJtTmxYMlJwYzNCc1lYbGNJam9nSjJ4aFltVnNKMXh1TENCY0lteGhZbVZzWENJNklDZEpibkIxZEZ4Y1hGeDFNamM1WWljbVpXeGxiV1Z1ZEN3Z1hDSmlZWE5sWDNSNWNHVmNJam9nYVc1MFpYSnVZV3hmZEhsd1pTeGNibHdpZEhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJbUYwZEhKcFluVjBaWE5jSWpvZ2UxeHVJQ0FnSUZ3aVpXeGxiV1Z1ZEY5dFlYQndhVzVuWDNCeWIzWnBaR1Z5WENJNklDZGpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5Snl4Y2JpQWdJQ0JjSW5WcFZIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW5WcFZXNXBjWFZsU1dSY0lqb2dTV1JjYm4xOUtUNCtZQ0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaW50ZXJuYWxfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Jsb2NrKSByZXQgKz0gLyoodGhpcy5fYmxvY2tfY29vcCB8fCAnPScpICsgKi8gdGhpcy5ibG9jaygpLl90b0VRdWVyeShzUGF0aCArICdibG9jay4nKTtcblxuXHRcdGlmICh0aGlzLl9zZWN1cml0eUNvbnRyb2wpIHJldCArPSAvKih0aGlzLl9zZWN1cml0eUNvbnRyb2xfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zZWN1cml0eUNvbnRyb2woKS5fdG9FUXVlcnkoc1BhdGggKyAnYWNscy4nKTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19pbnB1dC5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5mbG93X0Zsb3dfT3V0cHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X291dHB1dC5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfdmFyaWFibGUuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2xvZ2ljLmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2Uuc3ViZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2FjdGlvbl9pbnB1dC5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5mbG93X0Zsb3dfU2V0dGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nLnNvdXJjZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X1NuYXBzaG90cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X3NuYXBzaG90LnBhcmVudF9mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19mbG93X2RhdGFfdmFyLmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0aW50ZXJuYWxfbmFtZTogb2JqLmdldFZhbHVlKFwiaW50ZXJuYWxfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdGJsb2NrOiBvYmouZ2V0VmFsdWUoXCJibG9ja1wiKSxcblxuXHRcdFx0XHRcdFx0YWNsczogb2JqLmdldFZhbHVlKFwiYWNsc1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmludGVybmFsX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWNscykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2VjdXJpdHlDb250cm9sKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmouYWNscykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfT3V0cHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfT3V0cHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0FjdGlvbl9JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19TZXR0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19TZXR0aW5ncyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X1NldHRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfU25hcHNob3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X1NuYXBzaG90cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW50ZXJuYWxfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHJldC5ibG9jaykge1xuXHRcdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlY3VyaXR5Q29udHJvbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWNscyA9IHRoaXMuc2VjdXJpdHlDb250cm9sKCk7XG5cblx0XHRcdGlmIChyZXQuYWNscykge1xuXHRcdFx0XHRyZXQuYWNscyA9IHJldC5hY2xzLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFjbHMpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjbHMpLmxlbmd0aCkgcmV0LmFjbHMgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0lucHV0cyA9IHRoaXMuZmxvd19GbG93X0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X091dHB1dHMgPSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19WYXJpYWJsZXMgPSB0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0xvZ2ljcyA9IHRoaXMuZmxvd19GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc3ViZmxvd19GbG93X0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzID0gdGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19BY3Rpb25fSW5wdXRzID0gdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfU2V0dGluZ3MgPSB0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X1NuYXBzaG90cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfU25hcHNob3RzID0gdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzID0gdGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNhbGxhYmxlX2J5X2NsaWVudF9hcGkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2FsbGFibGVfYnlfY2xpZW50X2FwaSA9IHRoaXMuY2FsbGFibGVfYnlfY2xpZW50X2FwaSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnN5c19wb2xpY3koKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX3BvbGljeSA9IHRoaXMuc3lzX3BvbGljeSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnN0YXR1cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGF0dXMgPSB0aGlzLnN0YXR1cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxhdGVzdF9zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sYXRlc3Rfc25hcHNob3QgPSB0aGlzLmxhdGVzdF9zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1hc3Rlcl9zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXN0ZXJfc25hcHNob3QgPSB0aGlzLm1hc3Rlcl9zbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxhYmVsX2NhY2hlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxhYmVsX2NhY2hlID0gdGhpcy5sYWJlbF9jYWNoZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnRlcm5hbF9uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWNsc1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlY3VyaXR5Q29udHJvbCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZWN1cml0eUNvbnRyb2wodGhpcy5zZWN1cml0eUNvbnRyb2woKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvdycsIFsnKiddKVsnc3lzX2h1Yl9mbG93J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3cnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF9uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnRlcm5hbF9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2ludGVybmFsX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvd1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZWN1cml0eUNvbnRyb2wpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zZWN1cml0eUNvbnRyb2xfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zZWN1cml0eUNvbnRyb2woKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwic2VjdXJpdHlDb250cm9sIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIgKyBcInNlY3VyaXR5Q29udHJvbFthY2xzXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNlY3VyaXR5Q29udHJvbCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY2xzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY2xzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY2xzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjbHMnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvdycsIFsnKiddKVsnc3lzX2h1Yl9mbG93J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0lucHV0cykpIHRoaXMuZmxvd19GbG93X0lucHV0cyhvYmouZmxvd19GbG93X0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19PdXRwdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfT3V0cHV0cykpIHRoaXMuZmxvd19GbG93X091dHB1dHMob2JqLmZsb3dfRmxvd19PdXRwdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X1ZhcmlhYmxlcykpIHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcyhvYmouZmxvd19GbG93X1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X0xvZ2ljcykpIHRoaXMuZmxvd19GbG93X0xvZ2ljcyhvYmouZmxvd19GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcykpIHRoaXMuc3ViZmxvd19GbG93X0luc3RhbmNlcyhvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19BY3Rpb25fSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfQWN0aW9uX0lucHV0cykpIHRoaXMuZmxvd19BY3Rpb25fSW5wdXRzKG9iai5mbG93X0FjdGlvbl9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19TZXR0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X1NldHRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19TZXR0aW5ncykpIHRoaXMuZmxvd19GbG93X1NldHRpbmdzKG9iai5mbG93X0Zsb3dfU2V0dGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19TbmFwc2hvdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X1NuYXBzaG90cykpIHRoaXMuZmxvd19GbG93X1NuYXBzaG90cyhvYmouZmxvd19GbG93X1NuYXBzaG90cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIiArIFwib2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcykpIHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKG9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3cnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zY2hlbWEgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzY2hlbWEodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NjaGVtYSA9IHY7XG5cdFx0XHR0aGlzLl9zY2hlbWFfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NoZW1hO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnRhYmxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RhYmxlID0gdjtcblx0XHRcdHRoaXMuX3RhYmxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RhYmxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnByb2ZpbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9maWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wcm9maWxlID0gdjtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvZmlsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3N1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3NjaGVtYSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NjaGVtYScgKyAodGhpcy5fc2NoZW1hX2Nvb3AgfHwgJz0nKSArIHRoaXMuc2NoZW1hKCk7XG5cblx0XHRpZiAodGhpcy5fdGFibGUpIHJldCArPSAvKih0aGlzLl90YWJsZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnRhYmxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RhYmxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2ZpbGUpIHJldCArPSAvKih0aGlzLl9wcm9maWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucHJvZmlsZSgpLl90b0VRdWVyeShzUGF0aCArICdwcm9maWxlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTdWJzY3JpcHRpb25fVHJpZ2dlci5zdWJzY3JpcHRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHNjaGVtYTogb2JqLmdldFZhbHVlKFwic2NoZW1hXCIpLFxuXG5cdFx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRcdHByb2ZpbGU6IG9iai5nZXRWYWx1ZShcInByb2ZpbGVcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouc2NoZW1hID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zY2hlbWEpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5zY2hlbWEob2JqLnNjaGVtYSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnRhYmxlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvZmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvZmlsZShuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnByb2ZpbGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTYXZlX1N1YnNjcmlwdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNjaGVtYSA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnNjaGVtYSkgPT09ICdvYmplY3QnKSByZXQuc2NoZW1hID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNjaGVtYSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGFibGUgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmIChyZXQudGFibGUpIHtcblx0XHRcdFx0cmV0LnRhYmxlID0gcmV0LnRhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRhYmxlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50YWJsZSkubGVuZ3RoKSByZXQudGFibGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9maWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9maWxlID0gdGhpcy5wcm9maWxlKCk7XG5cblx0XHRcdGlmIChyZXQucHJvZmlsZSkge1xuXHRcdFx0XHRyZXQucHJvZmlsZSA9IHJldC5wcm9maWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2ZpbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2ZpbGUpLmxlbmd0aCkgcmV0LnByb2ZpbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSB0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjaGVtYVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNjaGVtYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY2hlbWEodGhpcy5zY2hlbWEoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0YWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvZmlsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2ZpbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvZmlsZSh0aGlzLnByb2ZpbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2NoZW1hKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2NoZW1hX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3NjaGVtYV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzY2hlbWEnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY2hlbWEnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NjaGVtYScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzY2hlbWEnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90YWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2F2ZSBTdWJzY3JpcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGFibGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcInRhYmxlW3RhYmxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRhYmxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RhYmxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGFibGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RhYmxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2ZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wcm9maWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucHJvZmlsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNhdmUgU3Vic2NyaXB0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInByb2ZpbGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcInByb2ZpbGVbcHJvZmlsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9maWxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2ZpbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9maWxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcm9maWxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Byb2ZpbGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2F2ZSBTdWJzY3JpcHRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1NhdmVfU3Vic2NyaXB0aW9uJywgWycqJ10pWydTYXZlX1N1YnNjcmlwdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKSB0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdTYXZlX1N1YnNjcmlwdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5wYXJlbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwYXJlbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3BhcmVudCA9IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5lbGVtZW50TWFwcGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVsZW1lbnRNYXBwaW5nKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZyA9IHY7XG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbGVtZW50TWFwcGluZztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnRyYW5zZm9ybSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRyYW5zZm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHJhbnNmb3JtID0gdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5wYXJlbnRfUGlsbF9Db21wb3VuZHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwYXJlbnRfUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wYXJlbnRfUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfUGlsbF9Db21wb3VuZHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudF9QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLl9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcInVpX2lkXCIsIFwiYXR0YWNoZWRfdG9cIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW5WcFgybGtJaXdpWVhSMFlXTm9aV1JmZEc4aVhYMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQudWlfaWQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0VUlkKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfdWlfaWQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuVUlkKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4N2UxOWZmWDB1U1dRK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuYXR0YWNoZWRfdG8gRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXR0YWNoZWRUbygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dGFjaGVkX3RvID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmF0dGFjaGVkVG8oKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHdxS2tBa1psdGZYM1I1Y0dVZ2FXNGdXeWR6ZVhOZmFIVmlYMlpzYjNjbkxDQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSjEwZ1lXNWtJSHQ3Ym5KOWZWMHVKR1l1ZTN0ZlgzMTlMaVJtV3kweFhTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdwcmVzY3JpcHRpb24nICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHJhbnNmb3JtX2NvbXBvc2l0aW9ucycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGFyZW50KSByZXQgKz0gLyoodGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGFyZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NvdXJjZV91aV9pZC4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2VsZW1lbnRNYXBwaW5nKSByZXQgKz0gLyoodGhpcy5fZWxlbWVudE1hcHBpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lbGVtZW50TWFwcGluZygpLl90b0VRdWVyeShzUGF0aCArICdlbGVtZW50TWFwcGluZy4nKTtcblxuXHRcdGlmICh0aGlzLl90cmFuc2Zvcm0pIHJldCArPSAvKih0aGlzLl90cmFuc2Zvcm1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50cmFuc2Zvcm0oKS5fdG9FUXVlcnkoc1BhdGggKyAndHJhbnNmb3JtX2RlZmluaXRpb25faWQuJyk7XG5cblx0XHQodGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfcGlsbF9jb21wb3VuZC5zb3VyY2VfdWlfaWQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRwcmVzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcInByZXNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0dHJhbnNmb3JtX2NvbXBvc2l0aW9uczogb2JqLmdldFZhbHVlKFwidHJhbnNmb3JtX2NvbXBvc2l0aW9uc1wiKSxcblxuXHRcdFx0XHRcdFx0c291cmNlX3VpX2lkOiBvYmouZ2V0VmFsdWUoXCJzb3VyY2VfdWlfaWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50TWFwcGluZzogb2JqLmdldFZhbHVlKFwiZWxlbWVudE1hcHBpbmdcIiksXG5cblx0XHRcdFx0XHRcdHRyYW5zZm9ybV9kZWZpbml0aW9uX2lkOiBvYmouZ2V0VmFsdWUoXCJ0cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoucHJlc2NyaXB0aW9uKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50cmFuc2Zvcm1fY29tcG9zaXRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnRyYW5zZm9ybV9jb21wb3NpdGlvbnMgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNvdXJjZV91aV9pZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGFyZW50KG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmouc291cmNlX3VpX2lkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50TWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudE1hcHBpbmcobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLmVsZW1lbnRNYXBwaW5nKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHJhbnNmb3JtX2RlZmluaXRpb25faWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRyYW5zZm9ybShuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtX2RlZmluaXRpb25faWQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQaWxsX0NvbXBvdW5kXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJlc2NyaXB0aW9uID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHJhbnNmb3JtX2NvbXBvc2l0aW9ucyA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnRyYW5zZm9ybV9jb21wb3NpdGlvbnMpID09PSAnb2JqZWN0JykgcmV0LnRyYW5zZm9ybV9jb21wb3NpdGlvbnMgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQudHJhbnNmb3JtX2NvbXBvc2l0aW9ucykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNvdXJjZV91aV9pZCA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmIChyZXQuc291cmNlX3VpX2lkKSB7XG5cdFx0XHRcdHJldC5zb3VyY2VfdWlfaWQgPSByZXQuc291cmNlX3VpX2lkLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNvdXJjZV91aV9pZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc291cmNlX3VpX2lkKS5sZW5ndGgpIHJldC5zb3VyY2VfdWlfaWQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVsZW1lbnRNYXBwaW5nID0gdGhpcy5lbGVtZW50TWFwcGluZygpO1xuXG5cdFx0XHRpZiAocmV0LmVsZW1lbnRNYXBwaW5nKSB7XG5cdFx0XHRcdHJldC5lbGVtZW50TWFwcGluZyA9IHJldC5lbGVtZW50TWFwcGluZy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5lbGVtZW50TWFwcGluZykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZWxlbWVudE1hcHBpbmcpLmxlbmd0aCkgcmV0LmVsZW1lbnRNYXBwaW5nID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHJhbnNmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRcdGlmIChyZXQudHJhbnNmb3JtX2RlZmluaXRpb25faWQpIHtcblx0XHRcdFx0cmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkID0gcmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCkubGVuZ3RoKSByZXQudHJhbnNmb3JtX2RlZmluaXRpb25faWQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfUGlsbF9Db21wb3VuZHMgPSB0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudWlfaWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudWlfaWQgPSB0aGlzLnVpX2lkKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0YWNoZWRfdG8oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0YWNoZWRfdG8gPSB0aGlzLmF0dGFjaGVkX3RvKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInByZXNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0cmFuc2Zvcm1fY29tcG9zaXRpb25zXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNvdXJjZV91aV9pZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbGVtZW50TWFwcGluZ1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVsZW1lbnRNYXBwaW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVsZW1lbnRNYXBwaW5nKHRoaXMuZWxlbWVudE1hcHBpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHJhbnNmb3JtX2RlZmluaXRpb25faWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3BpbGxfY29tcG91bmQnLCBbJyonXSlbJ3N5c19odWJfcGlsbF9jb21wb3VuZCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ByZXNjcmlwdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwcmVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncHJlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHJhbnNmb3JtX2NvbXBvc2l0aW9ucycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHJhbnNmb3JtX2NvbXBvc2l0aW9ucycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHJhbnNmb3JtX2NvbXBvc2l0aW9ucycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0cmFuc2Zvcm1fY29tcG9zaXRpb25zJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3NvdXJjZV91aV9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc291cmNlX3VpX2lkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzb3VyY2VfdWlfaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NvdXJjZV91aV9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzb3VyY2VfdWlfaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbGVtZW50TWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZWxlbWVudE1hcHBpbmcoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQaWxsIENvbXBvdW5kXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwiZWxlbWVudE1hcHBpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIiArIFwiZWxlbWVudE1hcHBpbmdbZWxlbWVudE1hcHBpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZWxlbWVudE1hcHBpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWxlbWVudG1hcHBpbmcnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnRtYXBwaW5nJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbGVtZW50bWFwcGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbGVtZW50bWFwcGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90cmFuc2Zvcm1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50cmFuc2Zvcm0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQaWxsIENvbXBvdW5kXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidHJhbnNmb3JtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcInRyYW5zZm9ybVt0cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50cmFuc2Zvcm0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHJhbnNmb3JtX2RlZmluaXRpb25faWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RyYW5zZm9ybV9kZWZpbml0aW9uX2lkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0cmFuc2Zvcm1fZGVmaW5pdGlvbl9pZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3BpbGxfY29tcG91bmQnLCBbJyonXSlbJ3N5c19odWJfcGlsbF9jb21wb3VuZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3BpbGxfY29tcG91bmQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzKSkgdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMob2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3BpbGxfY29tcG91bmQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2wgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wub3BlcmF0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3BlcmF0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcGVyYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fb3BlcmF0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29wZXJhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuc2VjdXJpdHlDb250cm9sX0Zsb3dzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VjdXJpdHlDb250cm9sX0Zsb3dzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2VjdXJpdHlDb250cm9sX0Zsb3dzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc2VjdXJpdHlDb250cm9sX0Zsb3dzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zZWN1cml0eUNvbnRyb2xfRmxvd3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb25kaXRpb24nICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGVzY3JpcHRpb24nICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAvKih0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHlwZSgpLl90b0VRdWVyeShzUGF0aCArICd0eXBlLicpO1xuXG5cdFx0aWYgKHRoaXMuX29wZXJhdGlvbikgcmV0ICs9IC8qKHRoaXMuX29wZXJhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9wZXJhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdvcGVyYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdCh0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93LmFjbHMsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRjb25kaXRpb246IG9iai5nZXRWYWx1ZShcImNvbmRpdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0ZGVzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcImRlc2NyaXB0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcGVyYXRpb246IG9iai5nZXRWYWx1ZShcIm9wZXJhdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb25kaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLmNvbmRpdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouZGVzY3JpcHRpb24gPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmRlc2NyaXB0aW9uKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcGVyYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9wZXJhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoub3BlcmF0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zZWN1cml0eUNvbnRyb2xfRmxvd3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTZWN1cml0eV9Db250cm9sXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29uZGl0aW9uID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVzY3JpcHRpb24gPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5kZXNjcmlwdGlvbikgPT09ICdvYmplY3QnKSByZXQuZGVzY3JpcHRpb24gPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuZGVzY3JpcHRpb24pKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAocmV0LnR5cGUpIHtcblx0XHRcdFx0cmV0LnR5cGUgPSByZXQudHlwZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50eXBlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50eXBlKS5sZW5ndGgpIHJldC50eXBlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcGVyYXRpb24gPSB0aGlzLm9wZXJhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0Lm9wZXJhdGlvbikge1xuXHRcdFx0XHRyZXQub3BlcmF0aW9uID0gcmV0Lm9wZXJhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5vcGVyYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm9wZXJhdGlvbikubGVuZ3RoKSByZXQub3BlcmF0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlY3VyaXR5Q29udHJvbF9GbG93cyA9IHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5vcGVyYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3BlcmF0aW9uKHRoaXMub3BlcmF0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb25kaXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3BlcmF0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3BlcmF0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9wZXJhdGlvbih0aGlzLm9wZXJhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfYWNsJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbmRpdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29uZGl0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb25kaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29uZGl0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBDb250cm9sXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidHlwZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiICsgXCJ0eXBlW3R5cGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudHlwZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3BlcmF0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3BlcmF0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgQ29udHJvbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcIm9wZXJhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiICsgXCJvcGVyYXRpb25bb3BlcmF0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm9wZXJhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcGVyYXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29wZXJhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3BlcmF0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29wZXJhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBDb250cm9sXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9hY2wnLCBbJyonXSlbJ3N5c19zZWN1cml0eV9hY2wnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X2FjbCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fc2F2ZSgpOiBcIiArIFwib2JqLnNlY3VyaXR5Q29udHJvbF9GbG93czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNlY3VyaXR5Q29udHJvbF9GbG93cykpIHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X2FjbCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19UZWFtX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfVGVhbV9NZW1iZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci50ZWFtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdGVhbSA9IHY7XG5cdFx0XHR0aGlzLl90ZWFtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIubWVtYmVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVtYmVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tZW1iZXIgPSB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdGVhbSkgcmV0ICs9IC8qKHRoaXMuX3RlYW1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50ZWFtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RlYW0uJyk7XG5cblx0XHRpZiAodGhpcy5fbWVtYmVyKSByZXQgKz0gLyoodGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubWVtYmVyKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lbWJlci4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dGVhbTogb2JqLmdldFZhbHVlKFwidGVhbVwiKSxcblxuXHRcdFx0XHRcdFx0bWVtYmVyOiBvYmouZ2V0VmFsdWUoXCJtZW1iZXJcIiksXG5cblx0XHRcdFx0XHRcdHJvbGU6IG9iai5nZXRWYWx1ZShcInJvbGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50ZWFtKG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lbWJlcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXIpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yb2xlKG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVGVhbV9NZW1iZXJcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGVhbSA9IHRoaXMudGVhbSgpO1xuXG5cdFx0XHRpZiAocmV0LnRlYW0pIHtcblx0XHRcdFx0cmV0LnRlYW0gPSByZXQudGVhbS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50ZWFtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50ZWFtKS5sZW5ndGgpIHJldC50ZWFtID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZW1iZXIgPSB0aGlzLm1lbWJlcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1lbWJlcikge1xuXHRcdFx0XHRyZXQubWVtYmVyID0gcmV0Lm1lbWJlci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZW1iZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lbWJlcikubGVuZ3RoKSByZXQubWVtYmVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucm9sZSA9IHRoaXMucm9sZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJvbGUpIHtcblx0XHRcdFx0cmV0LnJvbGUgPSByZXQucm9sZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yb2xlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yb2xlKS5sZW5ndGgpIHJldC5yb2xlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRlYW1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50ZWFtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW0odGhpcy50ZWFtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lbWJlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1lbWJlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXIodGhpcy5tZW1iZXIoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicm9sZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJvbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZSh0aGlzLnJvbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90ZWFtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudGVhbSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlRlYW0gTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRlYW0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIgKyBcInRlYW1bdGVhbV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50ZWFtKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RlYW0nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwibWVtYmVyIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJtZW1iZXJbbWVtYmVyXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lbWJlcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZW1iZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lbWJlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZW1iZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JvbGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yb2xlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwicm9sZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwicm9sZVtyb2xlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJvbGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncm9sZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncm9sZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9Db2x1bW4iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0NvbHVtbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Db2x1bW4iLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0NvbHVtblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4udHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi50YWJsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90YWJsZSA9IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uY29sdW1uX0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvbHVtbl9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jb2x1bW5fRmllbGRfTGFiZWxzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fY29sdW1uX0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uX0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm5hbWVcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p1WVcxbElsMTlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5tYXhfbGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX21heF9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZGlzcGxheSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkaXNwbGF5KCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfZGlzcGxheSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gdHlwZW9mKHRoaXMudGFibGUoKSkgPT09IFwib2JqZWN0XCIgJiYgdGhpcy50YWJsZSgpLnRhYmxlX0NvbHVtbnMoKS5maW5kKGMgPT4gYy50eXBlKCkgPT0gJ1N0cmluZycpID09IHRoaXM7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5kaXNwbGF5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdkSGx3Wlc5bUtIUm9hWE11ZEdGaWJHVW9LU2tnUFQwOUlGd2liMkpxWldOMFhDSWdKaVlnZEdocGN5NTBZV0pzWlNncExuUmhZbXhsWDBOdmJIVnRibk1vS1M1bWFXNWtLR01nUFQ0Z1l5NTBlWEJsS0NrZ1BUMGdKMU4wY21sdVp5Y3BJRDA5SUhSb2FYTWlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZWxlbWVudCcgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvbHVtbl9sYWJlbCcgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdjb21tZW50cycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ludGVybmFsX3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl90YWJsZSkgcmV0ICs9IC8qKHRoaXMuX3RhYmxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGFibGUoKS5fdG9FUXVlcnkoc1BhdGggKyAnbmFtZS4nKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0KHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU3Vic2NyaXB0aW9uX1RyaWdnZXIuY29sdW1uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZG9jdW1lbnRhdGlvbi5jb2x1bW4sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50OiBvYmouZ2V0VmFsdWUoXCJlbGVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGNvbHVtbl9sYWJlbDogb2JqLmdldFZhbHVlKFwiY29sdW1uX2xhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRjb21tZW50czogb2JqLmdldFZhbHVlKFwiY29tbWVudHNcIiksXG5cblx0XHRcdFx0XHRcdGludGVybmFsX3R5cGU6IG9iai5nZXRWYWx1ZShcImludGVybmFsX3R5cGVcIiksXG5cblx0XHRcdFx0XHRcdG1hbmRhdG9yeTogb2JqLmdldFZhbHVlKFwibWFuZGF0b3J5XCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZWxlbWVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uX2xhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5jb2x1bW5fbGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbW1lbnRzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLmNvbW1lbnRzID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5jb21tZW50cykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouY29tbWVudHMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLmludGVybmFsX3R5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLm5hbWUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyhuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY29sdW1uX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ29sdW1uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbHVtbl9sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbW1lbnRzID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuY29tbWVudHMpID09PSAnb2JqZWN0JykgcmV0LmNvbW1lbnRzID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmNvbW1lbnRzKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmludGVybmFsX3R5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tYW5kYXRvcnkgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMudGFibGUoKTtcblxuXHRcdFx0aWYgKHJldC5uYW1lKSB7XG5cdFx0XHRcdHJldC5uYW1lID0gcmV0Lm5hbWUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubmFtZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubmFtZSkubGVuZ3RoKSByZXQubmFtZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzID0gdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbl9GaWVsZF9MYWJlbHMgPSB0aGlzLmNvbHVtbl9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1heF9sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWF4X2xlbmd0aCA9IHRoaXMubWF4X2xlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRpc3BsYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlzcGxheSA9IHRoaXMuZGlzcGxheSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2x1bW5fbGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29tbWVudHNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW50ZXJuYWxfdHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlKHRoaXMudGFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RpY3Rpb25hcnknLCBbJyonXSlbJ3N5c19kaWN0aW9uYXJ5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGljdGlvbmFyeScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbGVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VsZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uX2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbHVtbl9sYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29sdW1uX2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvbHVtbl9sYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvbW1lbnRzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvbW1lbnRzJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb21tZW50cycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb21tZW50cycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnRlcm5hbF90eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfdHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90YWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0YWJsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIgKyBcInRhYmxlW25hbWVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGFibGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGljdGlvbmFyeScsIFsnKiddKVsnc3lzX2RpY3Rpb25hcnknXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKSkgdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJvYmouY29sdW1uX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY29sdW1uX0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jb2x1bW5fRmllbGRfTGFiZWxzKSkgdGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKG9iai5jb2x1bW5fRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJuYW1lIjoic2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3Rvcnkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZGVzaWduIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZXNpZ24gPSB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZWRpdG9yIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWRpdG9yKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lZGl0b3IgPSB2O1xuXHRcdFx0dGhpcy5fZWRpdG9yX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VkaXRvcjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZXNpZ24pIHJldCArPSAvKih0aGlzLl9kZXNpZ25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZXNpZ24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVzaWduLicpO1xuXG5cdFx0aWYgKHRoaXMuX2VkaXRvcikgcmV0ICs9IC8qKHRoaXMuX2VkaXRvcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmVkaXRvcigpLl90b0VRdWVyeShzUGF0aCArICdlZGl0b3IuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNpZ246IG9iai5nZXRWYWx1ZShcImRlc2lnblwiKSxcblxuXHRcdFx0XHRcdFx0ZWRpdG9yOiBvYmouZ2V0VmFsdWUoXCJlZGl0b3JcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZXNpZ24obmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZGl0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVkaXRvcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5lZGl0b3IpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVmVyc2lvbl9IaXN0b3J5XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZXNpZ24gPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlc2lnbikge1xuXHRcdFx0XHRyZXQuZGVzaWduID0gcmV0LmRlc2lnbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZXNpZ24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlc2lnbikubGVuZ3RoKSByZXQuZGVzaWduID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWRpdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lZGl0b3IgPSB0aGlzLmVkaXRvcigpO1xuXG5cdFx0XHRpZiAocmV0LmVkaXRvcikge1xuXHRcdFx0XHRyZXQuZWRpdG9yID0gcmV0LmVkaXRvci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5lZGl0b3IpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmVkaXRvcikubGVuZ3RoKSByZXQuZWRpdG9yID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNpZ25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZXNpZ24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduKHRoaXMuZGVzaWduKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVkaXRvclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVkaXRvcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZGl0b3IodGhpcy5lZGl0b3IoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZXNpZ25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZXNpZ24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWZXJzaW9uIEhpc3RvcnlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcImRlc2lnbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIgKyBcImRlc2lnbltkZXNpZ25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVzaWduKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2lnbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWRpdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZWRpdG9yX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZWRpdG9yKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmVyc2lvbiBIaXN0b3J5XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJlZGl0b3IgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiICsgXCJlZGl0b3JbZWRpdG9yXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVkaXRvcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlZGl0b3InKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZWRpdG9yJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlZGl0b3InKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWRpdG9yJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmRlc2lnbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlc2lnbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVzaWduID0gdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVzaWduKSByZXQgKz0gLyoodGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVzaWduKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Rlc2lnbi4nKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gLyoodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnR5cGUoKS5fdG9FUXVlcnkoc1BhdGggKyAndHlwZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNpZ246IG9iai5nZXRWYWx1ZShcImRlc2lnblwiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZXNpZ24obmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9TZWN0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRcdHJldC5kZXNpZ24gPSByZXQuZGVzaWduLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChyZXQudHlwZSkge1xuXHRcdFx0XHRyZXQudHlwZSA9IHJldC50eXBlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnR5cGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnR5cGUpLmxlbmd0aCkgcmV0LnR5cGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNpZ25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZXNpZ24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduKHRoaXMuZGVzaWduKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNvbHV0aW9uIFNlY3Rpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJkZXNpZ24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzaWduJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gU2VjdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInR5cGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwidHlwZVt0eXBlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmciLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yYWdlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmFnZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RvcmFnZSA9IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2U7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHRpZiAodGhpcy5fc3RvcmFnZSkgcmV0ICs9IC8qKHRoaXMuX3N0b3JhZ2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zdG9yYWdlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N0b3JhZ2UuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRzdG9yYWdlOiBvYmouZ2V0VmFsdWUoXCJzdG9yYWdlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUobmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RvcmFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RvcmFnZShuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KG9iai5zdG9yYWdlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnR5cGUgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHJldC50eXBlKSB7XG5cdFx0XHRcdHJldC50eXBlID0gcmV0LnR5cGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQudHlwZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHlwZSkubGVuZ3RoKSByZXQudHlwZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0b3JhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0b3JhZ2UgPSB0aGlzLnN0b3JhZ2UoKTtcblxuXHRcdFx0aWYgKHJldC5zdG9yYWdlKSB7XG5cdFx0XHRcdHJldC5zdG9yYWdlID0gcmV0LnN0b3JhZ2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3RvcmFnZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3RvcmFnZSkubGVuZ3RoKSByZXQuc3RvcmFnZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3RvcmFnZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0b3JhZ2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RvcmFnZSh0aGlzLnN0b3JhZ2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTdG9yYWdlIE1hcHBpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInR5cGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiICsgXCJ0eXBlW3R5cGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudHlwZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3RvcmFnZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN0b3JhZ2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTb2x1dGlvbiBTdG9yYWdlIE1hcHBpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInN0b3JhZ2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiICsgXCJzdG9yYWdlW3N0b3JhZ2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc3RvcmFnZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdG9yYWdlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0b3JhZ2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0b3JhZ2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RvcmFnZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Cb2FyZF9NZW1iZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Cb2FyZF9NZW1iZXIiLCJuYW1lIjoic2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRfTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuc3RhcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RhcnQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydCA9IHY7XG5cdFx0XHR0aGlzLl9zdGFydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdGFydDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZW5kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm1lbWJlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVtYmVyID0gdjtcblx0XHRcdHRoaXMuX21lbWJlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXI7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc3RhcnQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydCcgKyAodGhpcy5fc3RhcnRfY29vcCB8fCAnPScpICsgdGhpcy5zdGFydCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZCcgKyAodGhpcy5fZW5kX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kKCk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX21lbWJlcikgcmV0ICs9IC8qKHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lbWJlcigpLl90b0VRdWVyeShzUGF0aCArICdtZW1iZXIuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydDogb2JqLmdldFZhbHVlKFwic3RhcnRcIiksXG5cblx0XHRcdFx0XHRcdGVuZDogb2JqLmdldFZhbHVlKFwiZW5kXCIpLFxuXG5cdFx0XHRcdFx0XHRib2FyZDogb2JqLmdldFZhbHVlKFwiYm9hcmRcIiksXG5cblx0XHRcdFx0XHRcdG1lbWJlcjogb2JqLmdldFZhbHVlKFwibWVtYmVyXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGFydChvYmouc3RhcnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5kKG9iai5lbmQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ib2FyZChuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lbWJlcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXIpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQm9hcmRfTWVtYmVyXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXJ0ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAocmV0LnN0YXJ0ICYmIHR5cGVvZihyZXQuc3RhcnQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnQgPSByZXQuc3RhcnQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5kID0gdGhpcy5lbmQoKTtcblxuXHRcdFx0aWYgKHJldC5lbmQgJiYgdHlwZW9mKHJldC5lbmQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZW5kID0gcmV0LmVuZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJvYXJkID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAocmV0LmJvYXJkKSB7XG5cdFx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ib2FyZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYm9hcmQpLmxlbmd0aCkgcmV0LmJvYXJkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZW1iZXIgPSB0aGlzLm1lbWJlcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1lbWJlcikge1xuXHRcdFx0XHRyZXQubWVtYmVyID0gcmV0Lm1lbWJlci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZW1iZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lbWJlcikubGVuZ3RoKSByZXQubWVtYmVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0YXJ0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0KHRoaXMuc3RhcnQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5kKHRoaXMuZW5kKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lbWJlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1lbWJlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXIodGhpcy5tZW1iZXIoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhcnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXJ0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXJ0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5kJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkJvYXJkIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwiYm9hcmQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJib2FyZFtib2FyZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ib2FyZCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdib2FyZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdib2FyZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYm9hcmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQm9hcmQgTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJtZW1iZXJbbWVtYmVyXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lbWJlcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZW1iZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVtYmVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0aWYgKF9vYmouc3RhcnQgJiYgdHlwZW9mKF9vYmouc3RhcnQuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLnN0YXJ0ID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5zdGFydCk7XG5cblx0XHRcdGlmIChfb2JqLmVuZCAmJiB0eXBlb2YoX29iai5lbmQuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmVuZCA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZW5kKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlciddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0NhcGFiaWxpdHkiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19DYXBhYmlsaXR5IiwibmFtZSI6InNoc19hcmJmd19DYXBhYmlsaXR5IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19DYXBhYmlsaXR5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQ2FwYWJpbGl0eVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5Lm1vZHVsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZHVsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9kdWxlID0gdjtcblx0XHRcdHRoaXMuX21vZHVsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2R1bGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY2FwYWJpbGl0eV9SZXF1aXJlbWVudHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbW9kdWxlKSByZXQgKz0gLyoodGhpcy5fbW9kdWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubW9kdWxlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21vZHVsZS4nKTtcblxuXHRcdCh0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudC5jYXBhYmlsaXR5LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0bW9kdWxlOiBvYmouZ2V0VmFsdWUoXCJtb2R1bGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZHVsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubW9kdWxlKG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kdWxlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyhuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJDYXBhYmlsaXR5XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vZHVsZSA9IHRoaXMubW9kdWxlKCk7XG5cblx0XHRcdGlmIChyZXQubW9kdWxlKSB7XG5cdFx0XHRcdHJldC5tb2R1bGUgPSByZXQubW9kdWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1vZHVsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubW9kdWxlKS5sZW5ndGgpIHJldC5tb2R1bGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzID0gdGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vZHVsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vZHVsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2R1bGUodGhpcy5tb2R1bGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kdWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbW9kdWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubW9kdWxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ2FwYWJpbGl0eVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcIm1vZHVsZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiICsgXCJtb2R1bGVbbW9kdWxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1vZHVsZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb2R1bGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vZHVsZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbW9kdWxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21vZHVsZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIm9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMpKSB0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1Byb2plY3QiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Qcm9qZWN0IiwibmFtZSI6InNoc19hcmJmd19Qcm9qZWN0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19Qcm9qZWN0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUHJvamVjdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnRlYW0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90ZWFtID0gdjtcblx0XHRcdHRoaXMuX3RlYW1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmJ1ZGdldCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJ1ZGdldCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYnVkZ2V0ID0gdjtcblx0XHRcdHRoaXMuX2J1ZGdldF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9idWRnZXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5wcm9qZWN0X1JlcXVpcmVtZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2plY3RfUmVxdWlyZW1lbnRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcHJvamVjdF9SZXF1aXJlbWVudHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvamVjdF9SZXF1aXJlbWVudHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5wcm9qZWN0X01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdF9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3Byb2plY3RfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0X01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3RlYW0pIHJldCArPSAvKih0aGlzLl90ZWFtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGVhbSgpLl90b0VRdWVyeShzUGF0aCArICd0ZWFtLicpO1xuXG5cdFx0aWYgKHRoaXMuX2J1ZGdldCkgcmV0ICs9IC8qKHRoaXMuX2J1ZGdldF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJ1ZGdldCgpLl90b0VRdWVyeShzUGF0aCArICdidWRnZXQuJyk7XG5cblx0XHQodGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQucHJvamVjdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucHJvamVjdF9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZy5wcm9qZWN0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJhY3R1YWxDb3N0XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuYWN0dWFsQ29zdChwYXlsb2FkW1widGlsbERhdGVcIl0sICk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dGVhbTogb2JqLmdldFZhbHVlKFwidGVhbVwiKSxcblxuXHRcdFx0XHRcdFx0YnVkZ2V0OiBvYmouZ2V0VmFsdWUoXCJidWRnZXRcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRlYW0obmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJ1ZGdldCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYnVkZ2V0KG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cyhuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3RfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X01lZXRpbmdzKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3RfTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQcm9qZWN0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50ZWFtID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmIChyZXQudGVhbSkge1xuXHRcdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRlYW0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRlYW0pLmxlbmd0aCkgcmV0LnRlYW0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9idWRnZXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJ1ZGdldCA9IHRoaXMuYnVkZ2V0KCk7XG5cblx0XHRcdGlmIChyZXQuYnVkZ2V0KSB7XG5cdFx0XHRcdHJldC5idWRnZXQgPSByZXQuYnVkZ2V0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJ1ZGdldCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYnVkZ2V0KS5sZW5ndGgpIHJldC5idWRnZXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3RfUmVxdWlyZW1lbnRzID0gdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucHJvamVjdF9NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0X01lZXRpbmdzID0gdGhpcy5wcm9qZWN0X01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUHJvamVjdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGVhbVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRlYW0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbSh0aGlzLnRlYW0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYnVkZ2V0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYnVkZ2V0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJ1ZGdldCh0aGlzLmJ1ZGdldCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGVhbV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRlYW0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQcm9qZWN0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiICsgXCJ0ZWFtW3RlYW1dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGVhbSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0ZWFtJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYnVkZ2V0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUHJvamVjdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcImJ1ZGdldCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiICsgXCJidWRnZXRbYnVkZ2V0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJ1ZGdldCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdidWRnZXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2J1ZGdldCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYnVkZ2V0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2J1ZGdldCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIm9iai5wcm9qZWN0X1JlcXVpcmVtZW50czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKSB0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKG9iai5wcm9qZWN0X1JlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJvYmoucHJvamVjdF9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvamVjdF9NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wcm9qZWN0X01lZXRpbmdzKSkgdGhpcy5wcm9qZWN0X01lZXRpbmdzKG9iai5wcm9qZWN0X01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYWN0dWFsQ29zdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdHVhbENvc3QoX19ldmVudCwgdGlsbERhdGUpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi50aWxsRGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRpbGxEYXRlID0gZXZKU09OLnRpbGxEYXRlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmFjdHVhbENvc3QoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gZXZKU09OO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5nZXRQYXJhbWV0ZXIpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZih0aWxsRGF0ZSkgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0aGlzLmdldFBhcmFtZXRlcigndGlsbERhdGUnKSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRpbGxEYXRlID0gdGhpcy5nZXRQYXJhbWV0ZXIoJ3RpbGxEYXRlJyk7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuc2NyaXB0RmlsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjcmlwdEZpbGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NjcmlwdEZpbGUgPSB2O1xuXHRcdFx0dGhpcy5fc2NyaXB0RmlsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zY3JpcHRGaWxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnRhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfdGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3lzX3NjcmlwdF9pbmNsdWRlXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnRhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNselgzTmpjbWx3ZEY5cGJtTnNkV1JsSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX3NjcmlwdEZpbGUpIHJldCArPSAvKih0aGlzLl9zY3JpcHRGaWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2NyaXB0RmlsZSgpLl90b0VRdWVyeShzUGF0aCArICdpZC4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0aWQ6IG9iai5nZXRWYWx1ZShcImlkXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmlkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zY3JpcHRGaWxlKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmlkKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNjcmlwdF9Db21wYXRpYmlsaXR5XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2NyaXB0RmlsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaWQgPSB0aGlzLnNjcmlwdEZpbGUoKTtcblxuXHRcdFx0aWYgKHJldC5pZCkge1xuXHRcdFx0XHRyZXQuaWQgPSByZXQuaWQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuaWQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmlkKS5sZW5ndGgpIHJldC5pZCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGUgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNjcmlwdEZpbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2NyaXB0RmlsZSh0aGlzLnNjcmlwdEZpbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImlkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2NyaXB0RmlsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zY3JpcHRGaWxlKHRoaXMuc2NyaXB0RmlsZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZXNfbGF0ZXN0X3NjcmlwdCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY3JpcHRGaWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2NyaXB0RmlsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNjcmlwdEZpbGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTY3JpcHQgQ29tcGF0aWJpbGl0eVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJzY3JpcHRGaWxlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiICsgXCJzY3JpcHRGaWxlW2lkXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNjcmlwdEZpbGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZXNfbGF0ZXN0X3NjcmlwdCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lc19sYXRlc3Rfc2NyaXB0JywgWycqJ10pWydzeXNfZXNfbGF0ZXN0X3NjcmlwdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9TdGVwXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb24odGhpcy5hY3Rpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBTdGVwXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3RlcF9pbnN0YW5jZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhY3Rpb246IG9iai5nZXRWYWx1ZShcImFjdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3Rpb24obmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9TdGVwX0lucHV0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hY3Rpb24pIHtcblx0XHRcdFx0cmV0LmFjdGlvbiA9IHJldC5hY3Rpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWN0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb24pLmxlbmd0aCkgcmV0LmFjdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb24odGhpcy5hY3Rpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBTdGVwIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiYWN0aW9uW2FjdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hY3Rpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnLCBbJyonXSlbJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4IiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXggZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXgub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmRlc2lnbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlc2lnbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVzaWduID0gdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVzaWduKSByZXQgKz0gLyoodGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVzaWduKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Rlc2lnbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVzaWduOiBvYmouZ2V0VmFsdWUoXCJkZXNpZ25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9BcHBlbmRpeFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRcdHJldC5kZXNpZ24gPSByZXQuZGVzaWduLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzaWduXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVzaWduKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbih0aGlzLmRlc2lnbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gQXBwZW5kaXhcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwiZGVzaWduIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiICsgXCJkZXNpZ25bZGVzaWduXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlc2lnbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNpZ24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZGVjaXNpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVjaXNpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVjaXNpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVjaXNpb24pIHJldCArPSAvKih0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlY2lzaW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlY2lzaW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVjaXNpb246IG9iai5nZXRWYWx1ZShcImRlY2lzaW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWNpc2lvbihuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRGVjaXNpb25fT3B0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlY2lzaW9uID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRcdHJldC5kZWNpc2lvbiA9IHJldC5kZWNpc2lvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWNpc2lvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVjaXNpb24pLmxlbmd0aCkgcmV0LmRlY2lzaW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlY2lzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkRlY2lzaW9uIE9wdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwiZGVjaXNpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJkZWNpc2lvbltkZWNpc2lvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWNpc2lvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWNpc2lvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWNpc2lvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVjaXNpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfTWVldGluZ19TZXJpZXMiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19NZWV0aW5nX1NlcmllcyIsIm5hbWUiOiJzaHNfYXJiZndfTWVldGluZ19TZXJpZXMiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ19TZXJpZXNcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5mcmVxdWVuY3kgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmVxdWVuY3kodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeSA9IHY7XG5cdFx0XHR0aGlzLl9mcmVxdWVuY3lfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJlcXVlbmN5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLnNlcmllc19NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNlcmllc19NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3Nlcmllc19NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Nlcmllc19NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VyaWVzX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2ZyZXF1ZW5jeSkgcmV0ICs9IC8qKHRoaXMuX2ZyZXF1ZW5jeV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZyZXF1ZW5jeSgpLl90b0VRdWVyeShzUGF0aCArICdmcmVxdWVuY3kuJyk7XG5cblx0XHQodGhpcy5zZXJpZXNfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcuc2VyaWVzLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGZyZXF1ZW5jeTogb2JqLmdldFZhbHVlKFwiZnJlcXVlbmN5XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mcmVxdWVuY3kobmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3kpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZXJpZXNfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zZXJpZXNfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouc2VyaWVzX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ19TZXJpZXNcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mcmVxdWVuY3kgPSB0aGlzLmZyZXF1ZW5jeSgpO1xuXG5cdFx0XHRpZiAocmV0LmZyZXF1ZW5jeSkge1xuXHRcdFx0XHRyZXQuZnJlcXVlbmN5ID0gcmV0LmZyZXF1ZW5jeS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mcmVxdWVuY3kpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZyZXF1ZW5jeSkubGVuZ3RoKSByZXQuZnJlcXVlbmN5ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zZXJpZXNfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2VyaWVzX01lZXRpbmdzID0gdGhpcy5zZXJpZXNfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJlcXVlbmN5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZnJlcXVlbmN5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyZXF1ZW5jeSh0aGlzLmZyZXF1ZW5jeSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZnJlcXVlbmN5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZnJlcXVlbmN5KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZyBTZXJpZXNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwiZnJlcXVlbmN5IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiICsgXCJmcmVxdWVuY3lbZnJlcXVlbmN5XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZyZXF1ZW5jeSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmcmVxdWVuY3knKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmcmVxdWVuY3knKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ZyZXF1ZW5jeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcmVxdWVuY3knLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIm9iai5zZXJpZXNfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNlcmllc19NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zZXJpZXNfTWVldGluZ3MpKSB0aGlzLnNlcmllc19NZWV0aW5ncyhvYmouc2VyaWVzX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Nb2R1bGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Nb2R1bGUiLCJuYW1lIjoic2hzX2FyYmZ3X01vZHVsZSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfTW9kdWxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTW9kdWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucGxhdGZvcm0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbGF0Zm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGxhdGZvcm0gPSB2O1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGxhdGZvcm07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm1vZHVsZV9DYXBhYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZHVsZV9DYXBhYmlsaXR5cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kdWxlX0NhcGFiaWxpdHlzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BsYXRmb3JtKSByZXQgKz0gLyoodGhpcy5fcGxhdGZvcm1fY29vcCB8fCAnPScpICsgKi8gdGhpcy5wbGF0Zm9ybSgpLl90b0VRdWVyeShzUGF0aCArICdwbGF0Zm9ybS4nKTtcblxuXHRcdCh0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfY2FwYWJpbGl0eS5tb2R1bGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBsYXRmb3JtOiBvYmouZ2V0VmFsdWUoXCJwbGF0Zm9ybVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGxhdGZvcm0obmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQob2JqLnBsYXRmb3JtKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kdWxlX0NhcGFiaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1vZHVsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsYXRmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wbGF0Zm9ybSA9IHRoaXMucGxhdGZvcm0oKTtcblxuXHRcdFx0aWYgKHJldC5wbGF0Zm9ybSkge1xuXHRcdFx0XHRyZXQucGxhdGZvcm0gPSByZXQucGxhdGZvcm0uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucGxhdGZvcm0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBsYXRmb3JtKS5sZW5ndGgpIHJldC5wbGF0Zm9ybSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZHVsZV9DYXBhYmlsaXR5cyA9IHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTW9kdWxlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwbGF0Zm9ybVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBsYXRmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBsYXRmb3JtKHRoaXMucGxhdGZvcm0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGxhdGZvcm0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNb2R1bGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInBsYXRmb3JtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIiArIFwicGxhdGZvcm1bcGxhdGZvcm1dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucGxhdGZvcm0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGxhdGZvcm0nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BsYXRmb3JtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BsYXRmb3JtJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIm9iai5tb2R1bGVfQ2FwYWJpbGl0eXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1vZHVsZV9DYXBhYmlsaXR5cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMpKSB0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cyhvYmoubW9kdWxlX0NhcGFiaWxpdHlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ19fZW5jb2RlZFF1ZXJ5JyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdF9fZW5jb2RlZFF1ZXJ5OiBvYmouZ2V0VmFsdWUoXCJfX2VuY29kZWRRdWVyeVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5fX2VuY29kZWRRdWVyeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouX19lbmNvZGVkUXVlcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJSb2xsYmFja19Db250ZXh0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5fX2VuY29kZWRRdWVyeSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIl9fZW5jb2RlZFF1ZXJ5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ19fZW5jb2RlZHF1ZXJ5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdfX2VuY29kZWRxdWVyeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnX19lbmNvZGVkcXVlcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnX19lbmNvZGVkcXVlcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUm9sbGJhY2sgQ29udGV4dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3JvbGxiYWNrX2NvbnRleHQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FwaV9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzY3JpcHQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2VzX2xhdGVzdF9zY3JpcHQuaWQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGFwaV9uYW1lOiBvYmouZ2V0VmFsdWUoXCJhcGlfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRzY3JpcHQ6IG9iai5nZXRWYWx1ZShcInNjcmlwdFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX3Njb3BlOiBvYmouZ2V0VmFsdWUoXCJzeXNfc2NvcGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBpX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmFwaV9uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY3JpcHQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouc2NyaXB0ID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zY3JpcHQpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnNjcmlwdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2NyaXB0X0ZpbGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBpX25hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2NyaXB0ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuc2NyaXB0KSA9PT0gJ29iamVjdCcpIHJldC5zY3JpcHQgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuc2NyaXB0KSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzID0gdGhpcy5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBpX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjcmlwdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2luY2x1ZGUnLCBbJyonXSlbJ3N5c19zY3JpcHRfaW5jbHVkZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcGlfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwaV9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcGlfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcGlfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzY3JpcHQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY3JpcHQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NjcmlwdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzY3JpcHQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2NyaXB0IEZpbGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW3N5c19zY29wZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfc2NvcGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9pbmNsdWRlJywgWycqJ10pWydzeXNfc2NyaXB0X2luY2x1ZGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cykpIHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzY3JpcHQnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdHNjcmlwdDogb2JqLmdldFZhbHVlKFwic2NyaXB0XCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5zY3JpcHQgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnNjcmlwdCkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouc2NyaXB0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRml4X1NjcmlwdFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2NyaXB0ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuc2NyaXB0KSA9PT0gJ29iamVjdCcpIHJldC5zY3JpcHQgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuc2NyaXB0KSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NyaXB0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2NyaXB0X2ZpeCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2NyaXB0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY3JpcHQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NjcmlwdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzY3JpcHQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRml4IFNjcmlwdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zY3JpcHRfZml4Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NjcmlwdF9maXgnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1RhYmxlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9UYWJsZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9UYWJsZSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9UYWJsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9UYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUudGFibGVfQ29sdW1ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlX0NvbHVtbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90YWJsZV9Db2x1bW5zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGFibGVfQ29sdW1uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGFibGVfQ29sdW1ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfQ29sdW1ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9Db2x1bW5zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0NvbHVtbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQ29sdW1uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0NvbHVtbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0Zsb3dfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X091dHB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfT3V0cHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19WYXJpYWJsZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0FjdGlvbl9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnN1cGVyX2NsYXNzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGV4dGVuZHMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9zdXBlcl9jbGFzcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKF90aGlzKSA9PiBfdGhpcy5fbWFwKCdjbGFzcy5leHRlbmRzJywgZmFsc2UsICdfdG9KU09OJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgX3RoaXMubmFtZSgpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZXh0ZW5kcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtGOTBhR2x6S1NBOVBpQmZkR2hwY3k1ZmJXRndLQ2RqYkdGemN5NWxlSFJsYm1Sekp5d2dabUZzYzJVc0lDZGZkRzlLVTA5T0p5d2dkVzVrWldacGJtVmtMQ0IxYm1SbFptbHVaV1FzSUhWdVpHVm1hVzVsWkN3Z1gzUm9hWE11Ym1GdFpTZ3BLU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5fX2lkRmllbGQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19pZEZpZWxkKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19pZEZpZWxkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcIm5hbWVcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX19pZEZpZWxkKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYm1GdFpTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbGFiZWwnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdzeXNfc2NvcGUuJyk7XG5cblx0XHQodGhpcy50YWJsZV9Db2x1bW5zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZGljdGlvbmFyeS5uYW1lLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfQ29sdW1ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2RpY3Rpb25hcnkucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNhdmVfU3Vic2NyaXB0aW9uLnRhYmxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19pbnB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19vdXRwdXQucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd192YXJpYWJsZS5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5wdXQucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2Zsb3dfZGF0YV92YXIucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdGxhYmVsOiBvYmouZ2V0VmFsdWUoXCJsYWJlbFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sYWJlbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubGFiZWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnN5c19uYW1lID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zeXNfbmFtZSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN5c19zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouc3lzX3Njb3BlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGVfQ29sdW1ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRhYmxlX0NvbHVtbnMobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLnRhYmxlX0NvbHVtbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9Db2x1bW5zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0NvbHVtbnMobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9Db2x1bW5zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUYWJsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubGFiZWwgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19uYW1lKSA9PT0gJ29iamVjdCcpIHJldC5zeXNfbmFtZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zeXNfbmFtZSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX3Njb3BlID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LnN5c19zY29wZSkge1xuXHRcdFx0XHRyZXQuc3lzX3Njb3BlID0gcmV0LnN5c19zY29wZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zeXNfc2NvcGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN5c19zY29wZSkubGVuZ3RoKSByZXQuc3lzX3Njb3BlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy50YWJsZV9Db2x1bW5zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlX0NvbHVtbnMgPSB0aGlzLnRhYmxlX0NvbHVtbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9Db2x1bW5zID0gdGhpcy5yZWZlcmVuY2VfQ29sdW1ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9IHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzID0gdGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdXBlcl9jbGFzcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdXBlcl9jbGFzcyA9IHRoaXMuc3VwZXJfY2xhc3MoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2lkRmllbGQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19pZEZpZWxkID0gdGhpcy5fX2lkRmllbGQoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJsYWJlbFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbGFiZWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbGFiZWwnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbGFiZWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19zY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RiX29iamVjdCcsIFsnKiddKVsnc3lzX2RiX29iamVjdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai50YWJsZV9Db2x1bW5zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50YWJsZV9Db2x1bW5zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRhYmxlX0NvbHVtbnMpKSB0aGlzLnRhYmxlX0NvbHVtbnMob2JqLnRhYmxlX0NvbHVtbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfQ29sdW1uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0NvbHVtbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0NvbHVtbnMpKSB0aGlzLnJlZmVyZW5jZV9Db2x1bW5zKG9iai5yZWZlcmVuY2VfQ29sdW1ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucykpIHRoaXMudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zKG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X0lucHV0cykpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5wdXRzKG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKSkgdGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKG9iai5yZWZlcmVuY2VfRmxvd19PdXRwdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyhvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykpIHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKSkgdGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyhvYmoucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kYl9vYmplY3QnLCBbJyonXSlbJ3N5c19kYl9vYmplY3QnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcudmFsdWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2YWx1ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdmFsdWUgPSB2O1xuXHRcdFx0dGhpcy5fdmFsdWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmFsdWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gXCJbJ2lkJywgJ2ZpZWxkJywgJ3RhYmxlJ11cIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVd5ZHBaQ2NzSUNkbWFXVnNaQ2NzSUNkMFlXSnNaU2RkSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ZpZWxkJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnaWQnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAndGFibGUnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhbHVlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndmFsdWUnICsgKHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nKSArIHRoaXMudmFsdWUoKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHQodGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3ZhcmlhYmxlX3ZhbHVlLm1hcHBpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3BpbGxfY29tcG91bmQuZWxlbWVudE1hcHBpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRmaWVsZDogb2JqLmdldFZhbHVlKFwiZmllbGRcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0aWQ6IG9iai5nZXRWYWx1ZShcImlkXCIpLFxuXG5cdFx0XHRcdFx0XHR0YWJsZTogb2JqLmdldFZhbHVlKFwidGFibGVcIiksXG5cblx0XHRcdFx0XHRcdHZhbHVlOiBvYmouZ2V0VmFsdWUoXCJ2YWx1ZVwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5maWVsZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouZmllbGQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmlkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5pZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoudGFibGUgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnRhYmxlKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai50YWJsZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZhbHVlKG9iai52YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJsb2NrKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2spKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJFbGVtZW50X01hcHBpbmdcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5maWVsZCA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmlkID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGFibGUgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC50YWJsZSkgPT09ICdvYmplY3QnKSByZXQudGFibGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQudGFibGUpKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZhbHVlID0gdGhpcy52YWx1ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdFx0cmV0LmJsb2NrID0gcmV0LmJsb2NrLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMgPSB0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZpZWxkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGFibGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidmFsdWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy52YWx1ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52YWx1ZSh0aGlzLnZhbHVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYmxvY2tcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ibG9jaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9jayh0aGlzLmJsb2NrKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZWxlbWVudF9tYXBwaW5nJywgWycqJ10pWydzeXNfZWxlbWVudF9tYXBwaW5nJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZWxlbWVudF9tYXBwaW5nJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ZpZWxkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ZpZWxkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmaWVsZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmaWVsZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnaWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2lkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2lkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGFibGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGFibGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RhYmxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdmFsdWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdmFsdWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd2YWx1ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd2YWx1ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmFsdWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndmFsdWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9ibG9ja19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRWxlbWVudCBNYXBwaW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIgKyBcImJsb2NrW2Jsb2NrXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmJsb2NrKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Jsb2NrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZWxlbWVudF9tYXBwaW5nJywgWycqJ10pWydzeXNfZWxlbWVudF9tYXBwaW5nJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2VsZW1lbnRfbWFwcGluZycpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwib2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcykpIHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2VsZW1lbnRfbWFwcGluZycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZWxlbWVudF9tYXBwaW5nJywgWycqJ10pWydzeXNfZWxlbWVudF9tYXBwaW5nJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9JbnN0YW5jZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX0luc3RhbmNlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbl9BY3Rpb25fSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX0FjdGlvbl9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYWN0aW9uX0FjdGlvbl9TdGVwcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbl9BY3Rpb25fU3RlcHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdpbnRlcm5hbF9uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdhbm5vdGF0aW9uJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfYWN0aW9uX2luc3RhbmNlLmFjdGlvbl90eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5wdXQuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3N0ZXBfaW5zdGFuY2UuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRpbnRlcm5hbF9uYW1lOiBvYmouZ2V0VmFsdWUoXCJpbnRlcm5hbF9uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdGFubm90YXRpb246IG9iai5nZXRWYWx1ZShcImFubm90YXRpb25cIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmludGVybmFsX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmludGVybmFsX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFubm90YXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouYW5ub3RhdGlvbiA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouYW5ub3RhdGlvbikpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouYW5ub3RhdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX3Njb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5zeXNfc2NvcGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJBY3Rpb25fVHlwZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5pbnRlcm5hbF9uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFubm90YXRpb24gPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5hbm5vdGF0aW9uKSA9PT0gJ29iamVjdCcpIHJldC5hbm5vdGF0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmFubm90YXRpb24pKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19zY29wZSA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5zeXNfc2NvcGUpIHtcblx0XHRcdFx0cmV0LnN5c19zY29wZSA9IHJldC5zeXNfc2NvcGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc3lzX3Njb3BlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zeXNfc2NvcGUpLmxlbmd0aCkgcmV0LnN5c19zY29wZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX0lucHV0cyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9TdGVwcyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzID0gdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImludGVybmFsX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFubm90YXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX3Njb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW50ZXJuYWxfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2ludGVybmFsX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ludGVybmFsX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW50ZXJuYWxfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhbm5vdGF0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYW5ub3RhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYW5ub3RhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhbm5vdGF0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBUeXBlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3lzX3Njb3BlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKG9iai5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbl9BY3Rpb25fSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cykpIHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMob2JqLmFjdGlvbl9BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmouYWN0aW9uX0FjdGlvbl9TdGVwczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9TdGVwcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBzKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMpKSB0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMob2JqLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24udHJhbnNmb3JtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90cmFuc2Zvcm0gPSB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RyYW5zZm9ybTtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybV9kZWZpbml0aW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19uYW1lOiBvYmouZ2V0VmFsdWUoXCJzeXNfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dHJhbnNmb3JtX2RlZmluaXRpb246IG9iai5nZXRWYWx1ZShcInRyYW5zZm9ybV9kZWZpbml0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50cmFuc2Zvcm1fZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHJhbnNmb3JtKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm1fZGVmaW5pdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUcmFuc2Zvcm1fQ29tcG9zaXRpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHJhbnNmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbiA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRcdGlmIChyZXQudHJhbnNmb3JtX2RlZmluaXRpb24pIHtcblx0XHRcdFx0cmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uID0gcmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRyYW5zZm9ybV9kZWZpbml0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50cmFuc2Zvcm1fZGVmaW5pdGlvbikubGVuZ3RoKSByZXQudHJhbnNmb3JtX2RlZmluaXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnRyYW5zZm9ybSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50cmFuc2Zvcm0odGhpcy50cmFuc2Zvcm0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHJhbnNmb3JtX2RlZmluaXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RyYW5zZm9ybV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlRyYW5zZm9ybSBDb21wb3NpdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidHJhbnNmb3JtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIiArIFwidHJhbnNmb3JtW3RyYW5zZm9ybV9kZWZpbml0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRyYW5zZm9ybSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0cmFuc2Zvcm1fZGVmaW5pdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHJhbnNmb3JtX2RlZmluaXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c190cmFuc2Zvcm1fY29tcG9zaXRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0RhdGEiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmRlZmluaXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVmaW5pdGlvbikgcmV0ICs9IC8qKHRoaXMuX2RlZmluaXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZWZpbml0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlZmluaXRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkZWZpbml0aW9uOiBvYmouZ2V0VmFsdWUoXCJkZWZpbml0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWZpbml0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZWZpbml0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfRGF0YVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWZpbml0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kZWZpbml0aW9uID0gdGhpcy5kZWZpbml0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuZGVmaW5pdGlvbikge1xuXHRcdFx0XHRyZXQuZGVmaW5pdGlvbiA9IHJldC5kZWZpbml0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlZmluaXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmRlZmluaXRpb24pLmxlbmd0aCkgcmV0LmRlZmluaXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlZmluaXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZWZpbml0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlZmluaXRpb24odGhpcy5kZWZpbml0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19kYXRhJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19uYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgRGF0YVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwiZGVmaW5pdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIgKyBcImRlZmluaXRpb25bZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZpbml0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RlZmluaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVmaW5pdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVmaW5pdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZWZpbml0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGEnLCBbJyonXSlbJ3N5c19mbG93X2RhdGEnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19kYXRhJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19kYXRhJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGEnLCBbJyonXSlbJ3N5c19mbG93X2RhdGEnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUudHlwZV9TZWN1cml0eV9Db250cm9scyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGVfU2VjdXJpdHlfQ29udHJvbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90eXBlX1NlY3VyaXR5X0NvbnRyb2xzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHlwZV9TZWN1cml0eV9Db250cm9sc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZV9TZWN1cml0eV9Db250cm9scztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2Rlc2NyaXB0aW9uJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3lzX3Njb3BlLicpO1xuXG5cdFx0KHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3NlY3VyaXR5X2FjbC50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHN5c19uYW1lOiBvYmouZ2V0VmFsdWUoXCJzeXNfbmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwiZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdHN5c19zY29wZTogb2JqLmdldFZhbHVlKFwic3lzX3Njb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5kZXNjcmlwdGlvbiA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouZGVzY3JpcHRpb24pKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmRlc2NyaXB0aW9uKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3VyaXR5X1R5cGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LmRlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmRlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZV9TZWN1cml0eV9Db250cm9scyA9IHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfc2NvcGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfdHlwZScsIFsnKiddKVsnc3lzX3NlY3VyaXR5X3R5cGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zZWN1cml0eV90eXBlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNjcmlwdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNlY3VyaXR5IFR5cGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvbltzeXNfc2NvcGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX3Njb3BlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zZWN1cml0eV90eXBlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpKSB0aGlzLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X3R5cGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbiIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fb3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fb3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N5c19uYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdkZXNjcmlwdGlvbicgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N5c19zY29wZS4nKTtcblxuXHRcdCh0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3NlY3VyaXR5X2FjbC5vcGVyYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0ZGVzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcImRlc2NyaXB0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfc2NvcGU6IG9iai5nZXRWYWx1ZShcInN5c19zY29wZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5kZXNjcmlwdGlvbiA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouZGVzY3JpcHRpb24pKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLmRlc2NyaXB0aW9uKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfc2NvcGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN5c19zY29wZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3VyaXR5X09wZXJhdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LmRlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmRlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zeXNfc2NvcGUgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3lzX3Njb3BlKSB7XG5cdFx0XHRcdHJldC5zeXNfc2NvcGUgPSByZXQuc3lzX3Njb3BlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN5c19zY29wZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3lzX3Njb3BlKS5sZW5ndGgpIHJldC5zeXNfc2NvcGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgPSB0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3lzX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2NyaXB0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19zY29wZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nLCBbJyonXSlbJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBPcGVyYXRpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bc3lzX3Njb3BlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N5c19zY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzeXNfc2NvcGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19zY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfc2NvcGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nLCBbJyonXSlbJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSkgdGhpcy5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zZWN1cml0eV9vcGVyYXRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X29wZXJhdGlvbicsIFsnKiddKVsnc3lzX3NlY3VyaXR5X29wZXJhdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19QbGF0Zm9ybSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1BsYXRmb3JtIiwibmFtZSI6InNoc19hcmJmd19QbGF0Zm9ybSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfUGxhdGZvcm0gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19QbGF0Zm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLnBsYXRmb3JtX01vZHVsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbGF0Zm9ybV9Nb2R1bGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fTW9kdWxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX01vZHVsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYXRmb3JtX01vZHVsZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5wbGF0Zm9ybV9Nb2R1bGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUucGxhdGZvcm0sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJpbml0XCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuaW5pdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybV9Nb2R1bGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucGxhdGZvcm1fTW9kdWxlcyhuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnBsYXRmb3JtX01vZHVsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQbGF0Zm9ybVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBsYXRmb3JtX01vZHVsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGxhdGZvcm1fTW9kdWxlcyA9IHRoaXMucGxhdGZvcm1fTW9kdWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIm9iai5wbGF0Zm9ybV9Nb2R1bGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wbGF0Zm9ybV9Nb2R1bGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBsYXRmb3JtX01vZHVsZXMpKSB0aGlzLnBsYXRmb3JtX01vZHVsZXMob2JqLnBsYXRmb3JtX01vZHVsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5pbml0KCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5pdChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmluaXQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1VzZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Vc2VyIiwibmFtZSI6InNoc19hcmJmd19Vc2VyIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19Vc2VyIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfVXNlclwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2VkaXRvcl9WZXJzaW9uX0hpc3RvcnlzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm9yZ2FuaXplcl9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZ2FuaXplcl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX29yZ2FuaXplcl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX29yZ2FuaXplcl9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JnYW5pemVyX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubW9kZXJhdG9yX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9kZXJhdG9yX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbW9kZXJhdG9yX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbW9kZXJhdG9yX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2RlcmF0b3JfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5tZW1iZXJfQm9hcmRfTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcl9Cb2FyZF9NZW1iZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbWVtYmVyX0JvYXJkX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tZW1iZXJfQm9hcmRfTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyX0JvYXJkX01lbWJlcnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5tZW1iZXJfVGVhbV9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVtYmVyX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lbWJlcl9UZWFtX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tZW1iZXJfVGVhbV9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXJfVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICd1c2VyX25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5LmVkaXRvciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nLm9yZ2FuaXplciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMubW9kZXJhdG9yX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nLm1vZGVyYXRvciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlci5tZW1iZXIsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyLm1lbWJlciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdHVzZXJfbmFtZTogb2JqLmdldFZhbHVlKFwidXNlcl9uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnVzZXJfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoudXNlcl9uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyhuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmdhbml6ZXJfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5vcmdhbml6ZXJfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoub3JnYW5pemVyX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2RlcmF0b3JfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tb2RlcmF0b3JfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kZXJhdG9yX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXJfVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVXNlclwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudXNlcl9uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzID0gdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcl9NZWV0aW5ncyA9IHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZXJhdG9yX01lZXRpbmdzID0gdGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcl9Cb2FyZF9NZW1iZXJzID0gdGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXJfVGVhbV9NZW1iZXJzID0gdGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVXNlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ1c2VyX25hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3VzZXInLCBbJyonXSlbJ3N5c191c2VyJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdXNlcicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3VzZXJfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndXNlcl9uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd1c2VyX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndXNlcl9uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Vc2VyKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfdXNlcicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKSkgdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyhvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5vcmdhbml6ZXJfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm9yZ2FuaXplcl9NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5vcmdhbml6ZXJfTWVldGluZ3MpKSB0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncyhvYmoub3JnYW5pemVyX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwib2JqLm1vZGVyYXRvcl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubW9kZXJhdG9yX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykpIHRoaXMubW9kZXJhdG9yX01lZXRpbmdzKG9iai5tb2RlcmF0b3JfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubWVtYmVyX0JvYXJkX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKSkgdGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycyhvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5tZW1iZXJfVGVhbV9NZW1iZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tZW1iZXJfVGVhbV9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpKSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfdXNlcicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19FZmZvcnQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19FZmZvcnQiLCJuYW1lIjoic2hzX2FyYmZ3X0VmZm9ydCIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfRWZmb3J0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRWZmb3J0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlZmZvcnRfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZS5lZmZvcnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWZmb3J0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyA9IHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19FZmZvcnQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwib2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0J1ZGdldCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0J1ZGdldCIsIm5hbWUiOiJzaHNfYXJiZndfQnVkZ2V0IiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19CdWRnZXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19CdWRnZXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5idWRnZXRfUHJvamVjdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRidWRnZXRfUHJvamVjdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldF9Qcm9qZWN0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJ1ZGdldF9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdC5idWRnZXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYnVkZ2V0X1Byb2plY3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYnVkZ2V0X1Byb2plY3RzKG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQob2JqLmJ1ZGdldF9Qcm9qZWN0cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkJ1ZGdldFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJ1ZGdldF9Qcm9qZWN0cyA9IHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQnVkZ2V0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcIm9iai5idWRnZXRfUHJvamVjdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJ1ZGdldF9Qcm9qZWN0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5idWRnZXRfUHJvamVjdHMpKSB0aGlzLmJ1ZGdldF9Qcm9qZWN0cyhvYmouYnVkZ2V0X1Byb2plY3RzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19UYXNrIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfVGFzayIsIm5hbWUiOiJzaHNfYXJiZndfVGFzayIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfVGFzayBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1Rhc2tcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2sub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ251bWJlcicgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UYXNrKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRudW1iZXI6IG9iai5nZXRWYWx1ZShcIm51bWJlclwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5udW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLm51bWJlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUYXNrXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5udW1iZXIgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1Rhc2soKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibnVtYmVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3Rhc2snLCBbJyonXSlbJ3Rhc2snXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3Rhc2snKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdudW1iZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ251bWJlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbnVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ251bWJlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGFzaygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGFzaygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3Rhc2snKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgndGFzaycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU2VjdGlvbl9UeXBlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfU2VjdGlvbl9UeXBlIiwibmFtZSI6InNoc19hcmJmd19TZWN0aW9uX1R5cGUiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnR5cGVfU29sdXRpb25fU2VjdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlX1NvbHV0aW9uX1NlY3Rpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU2VjdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVfU29sdXRpb25fU2VjdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbi50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZy50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3Rpb25fVHlwZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlX1NvbHV0aW9uX1NlY3Rpb25zID0gdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gdGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwib2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucykpIHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyhvYmoudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwib2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpIHRoaXMudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UiLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZy5zdG9yYWdlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fU3RvcmFnZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gdGhpcy5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIm9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MpKSB0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfRGVjaXNpb24iLCJuYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19EZWNpc2lvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0RlY2lzaW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fRGVjaXNpb25fT3B0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5kZWNpc2lvbl9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVjaXNpb25fTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24uZGVjaXNpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nLmRlY2lzaW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyhuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVjaXNpb25fTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb25fTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJEZWNpc2lvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9IHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fTWVldGluZ3MgPSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykpIHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyhvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWNpc2lvbl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVjaXNpb25fTWVldGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVjaXNpb25fTWVldGluZ3MpKSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKG9iai5kZWNpc2lvbl9NZWV0aW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfQm9hcmQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Cb2FyZCIsIm5hbWUiOiJzaHNfYXJiZndfQm9hcmQiLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X0JvYXJkIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5ib2FyZF9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYm9hcmRfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYm9hcmRfQm9hcmRfTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX0JvYXJkX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJvYXJkX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nLmJvYXJkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXIuYm9hcmQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYm9hcmRfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmRfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmRfQm9hcmRfTWVtYmVycykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkJvYXJkXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYm9hcmRfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYm9hcmRfTWVldGluZ3MgPSB0aGlzLmJvYXJkX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJvYXJkX0JvYXJkX01lbWJlcnMgPSB0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Cb2FyZCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJvYmouYm9hcmRfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJvYXJkX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJvYXJkX01lZXRpbmdzKSkgdGhpcy5ib2FyZF9NZWV0aW5ncyhvYmouYm9hcmRfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwib2JqLmJvYXJkX0JvYXJkX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYm9hcmRfQm9hcmRfTWVtYmVycykpIHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycyhvYmouYm9hcmRfQm9hcmRfTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19GcmVxdWVuY3kiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19GcmVxdWVuY3kiLCJuYW1lIjoic2hzX2FyYmZ3X0ZyZXF1ZW5jeSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfRnJlcXVlbmN5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRnJlcXVlbmN5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGFpbHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYWlseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGFpbHkgPSB2O1xuXHRcdFx0dGhpcy5fZGFpbHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGFpbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZWtseSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZWtseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2Vla2x5ID0gdjtcblx0XHRcdHRoaXMuX3dlZWtseV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWVrbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm1vbnRobHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb250aGx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb250aGx5ID0gdjtcblx0XHRcdHRoaXMuX21vbnRobHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9udGhseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucXVhcnRlcmx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cXVhcnRlcmx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9xdWFydGVybHkgPSB2O1xuXHRcdFx0dGhpcy5fcXVhcnRlcmx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3F1YXJ0ZXJseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGF5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRheXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RheXMgPSB2O1xuXHRcdFx0dGhpcy5fZGF5c19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXlzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5tb25kYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb25kYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21vbmRheSA9IHY7XG5cdFx0XHR0aGlzLl9tb25kYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9uZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS50dWVzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHVlc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHVlc2RheSA9IHY7XG5cdFx0XHR0aGlzLl90dWVzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R1ZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZG5lc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZG5lc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2VkbmVzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3dlZG5lc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWRuZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnRodXJzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGh1cnNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RodXJzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3RodXJzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RodXJzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5mcmlkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmlkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2ZyaWRheSA9IHY7XG5cdFx0XHR0aGlzLl9mcmlkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJpZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5zYXR1cmRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNhdHVyZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zYXR1cmRheSA9IHY7XG5cdFx0XHR0aGlzLl9zYXR1cmRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zYXR1cmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc3VuZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3VuZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdW5kYXkgPSB2O1xuXHRcdFx0dGhpcy5fc3VuZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1bmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kYWlseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhaWx5JyArICh0aGlzLl9kYWlseV9jb29wIHx8ICc9JykgKyB0aGlzLmRhaWx5KCk7XG5cblx0XHRpZiAodGhpcy5fd2Vla2x5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2Vla2x5JyArICh0aGlzLl93ZWVrbHlfY29vcCB8fCAnPScpICsgdGhpcy53ZWVrbHkoKTtcblxuXHRcdGlmICh0aGlzLl9tb250aGx5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbW9udGhseScgKyAodGhpcy5fbW9udGhseV9jb29wIHx8ICc9JykgKyB0aGlzLm1vbnRobHkoKTtcblxuXHRcdGlmICh0aGlzLl9xdWFydGVybHkpIHJldCArPSAnXicgKyBzUGF0aCArICdxdWFydGVybHknICsgKHRoaXMuX3F1YXJ0ZXJseV9jb29wIHx8ICc9JykgKyB0aGlzLnF1YXJ0ZXJseSgpO1xuXG5cdFx0aWYgKHRoaXMuX2RheXMpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXlzJyArICh0aGlzLl9kYXlzX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF5cygpO1xuXG5cdFx0aWYgKHRoaXMuX21vbmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21vbmRheScgKyAodGhpcy5fbW9uZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMubW9uZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fdHVlc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R1ZXNkYXknICsgKHRoaXMuX3R1ZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy50dWVzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fd2VkbmVzZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2VkbmVzZGF5JyArICh0aGlzLl93ZWRuZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdGlmICh0aGlzLl90aHVyc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3RodXJzZGF5JyArICh0aGlzLl90aHVyc2RheV9jb29wIHx8ICc9JykgKyB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fZnJpZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnZnJpZGF5JyArICh0aGlzLl9mcmlkYXlfY29vcCB8fCAnPScpICsgdGhpcy5mcmlkYXkoKTtcblxuXHRcdGlmICh0aGlzLl9zYXR1cmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NhdHVyZGF5JyArICh0aGlzLl9zYXR1cmRheV9jb29wIHx8ICc9JykgKyB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fc3VuZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3VuZGF5JyArICh0aGlzLl9zdW5kYXlfY29vcCB8fCAnPScpICsgdGhpcy5zdW5kYXkoKTtcblxuXHRcdCh0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzLmZyZXF1ZW5jeSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGFpbHk6IG9iai5nZXRWYWx1ZShcImRhaWx5XCIpLFxuXG5cdFx0XHRcdFx0XHR3ZWVrbHk6IG9iai5nZXRWYWx1ZShcIndlZWtseVwiKSxcblxuXHRcdFx0XHRcdFx0bW9udGhseTogb2JqLmdldFZhbHVlKFwibW9udGhseVwiKSxcblxuXHRcdFx0XHRcdFx0cXVhcnRlcmx5OiBvYmouZ2V0VmFsdWUoXCJxdWFydGVybHlcIiksXG5cblx0XHRcdFx0XHRcdGRheXM6IG9iai5nZXRWYWx1ZShcImRheXNcIiksXG5cblx0XHRcdFx0XHRcdG1vbmRheTogb2JqLmdldFZhbHVlKFwibW9uZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHR0dWVzZGF5OiBvYmouZ2V0VmFsdWUoXCJ0dWVzZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHR3ZWRuZXNkYXk6IG9iai5nZXRWYWx1ZShcIndlZG5lc2RheVwiKSxcblxuXHRcdFx0XHRcdFx0dGh1cnNkYXk6IG9iai5nZXRWYWx1ZShcInRodXJzZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRmcmlkYXk6IG9iai5nZXRWYWx1ZShcImZyaWRheVwiKSxcblxuXHRcdFx0XHRcdFx0c2F0dXJkYXk6IG9iai5nZXRWYWx1ZShcInNhdHVyZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRzdW5kYXk6IG9iai5nZXRWYWx1ZShcInN1bmRheVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYWlseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGFpbHkob2JqLmRhaWx5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai53ZWVrbHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLndlZWtseShvYmoud2Vla2x5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tb250aGx5KG9iai5tb250aGx5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5xdWFydGVybHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnF1YXJ0ZXJseShvYmoucXVhcnRlcmx5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXlzKG9iai5kYXlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb25kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vbmRheShvYmoubW9uZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50dWVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50dWVzZGF5KG9iai50dWVzZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai53ZWRuZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLndlZG5lc2RheShvYmoud2VkbmVzZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudGh1cnNkYXkob2JqLnRodXJzZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mcmlkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZyaWRheShvYmouZnJpZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zYXR1cmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2F0dXJkYXkob2JqLnNhdHVyZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdW5kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN1bmRheShvYmouc3VuZGF5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvYmouZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZyZXF1ZW5jeVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYWlseSA9IHRoaXMuZGFpbHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2Vla2x5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC53ZWVrbHkgPSB0aGlzLndlZWtseSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb250aGx5ID0gdGhpcy5tb250aGx5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3F1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucXVhcnRlcmx5ID0gdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF5cyA9IHRoaXMuZGF5cygpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb25kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vbmRheSA9IHRoaXMubW9uZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnR1ZXNkYXkgPSB0aGlzLnR1ZXNkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2VkbmVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC53ZWRuZXNkYXkgPSB0aGlzLndlZG5lc2RheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGh1cnNkYXkgPSB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZnJpZGF5ID0gdGhpcy5mcmlkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2F0dXJkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNhdHVyZGF5ID0gdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdW5kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN1bmRheSA9IHRoaXMuc3VuZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYWlseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhaWx5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhaWx5KHRoaXMuZGFpbHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWVrbHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWVrbHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2Vla2x5KHRoaXMud2Vla2x5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibW9udGhseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vbnRobHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9udGhseSh0aGlzLm1vbnRobHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJxdWFydGVybHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5xdWFydGVybHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucXVhcnRlcmx5KHRoaXMucXVhcnRlcmx5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF5c1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRheXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF5cyh0aGlzLmRheXMoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb25kYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb25kYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9uZGF5KHRoaXMubW9uZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHVlc2RheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR1ZXNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHVlc2RheSh0aGlzLnR1ZXNkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWRuZXNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWRuZXNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2VkbmVzZGF5KHRoaXMud2VkbmVzZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGh1cnNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50aHVyc2RheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50aHVyc2RheSh0aGlzLnRodXJzZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJpZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZnJpZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyaWRheSh0aGlzLmZyaWRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNhdHVyZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2F0dXJkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2F0dXJkYXkodGhpcy5zYXR1cmRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN1bmRheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN1bmRheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdW5kYXkodGhpcy5zdW5kYXkoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGFpbHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYWlseSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGFpbHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGFpbHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhaWx5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhaWx5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3dlZWtseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3dlZWtseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLndlZWtseSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignd2Vla2x5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3dlZWtseScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2Vla2x5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3dlZWtseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbW9udGhseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vbnRobHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21vbnRobHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbW9udGhseScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbW9udGhseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb250aGx5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3F1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3F1YXJ0ZXJseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnF1YXJ0ZXJseSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncXVhcnRlcmx5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3F1YXJ0ZXJseScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncXVhcnRlcmx5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3F1YXJ0ZXJseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF5c19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRheXMoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RheXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF5cycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF5cycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXlzJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vbmRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vbmRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9uZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vbmRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbW9uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21vbmRheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90dWVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHVlc2RheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR1ZXNkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R1ZXNkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHVlc2RheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHVlc2RheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0dWVzZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3dlZG5lc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3dlZG5lc2RheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLndlZG5lc2RheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignd2VkbmVzZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3dlZG5lc2RheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2VkbmVzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3dlZG5lc2RheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RodXJzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudGh1cnNkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RodXJzZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RodXJzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0aHVyc2RheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0aHVyc2RheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mcmlkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mcmlkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mcmlkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ZyaWRheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmcmlkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ZyaWRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcmlkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2F0dXJkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zYXR1cmRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzYXR1cmRheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzYXR1cmRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2F0dXJkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2F0dXJkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3VuZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3VuZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3VuZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdW5kYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3VuZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdW5kYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3VuZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5Jyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIm9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpKSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3Mob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19UZWFtIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfVGVhbSIsIm5hbWUiOiJzaHNfYXJiZndfVGVhbSIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfVGVhbSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS50ZWFtX1Byb2plY3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbV9Qcm9qZWN0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90ZWFtX1Byb2plY3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtX1Byb2plY3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0udGVhbV9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGVhbV9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudGVhbV9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdC50ZWFtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50ZWFtX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXIudGVhbSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW1fUHJvamVjdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50ZWFtX1Byb2plY3RzKG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW1fUHJvamVjdHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW1fVGVhbV9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudGVhbV9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW1fVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVGVhbVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy50ZWFtX1Byb2plY3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW1fUHJvamVjdHMgPSB0aGlzLnRlYW1fUHJvamVjdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW1fVGVhbV9NZW1iZXJzID0gdGhpcy50ZWFtX1RlYW1fTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1RlYW0oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwib2JqLnRlYW1fUHJvamVjdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRlYW1fUHJvamVjdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9Qcm9qZWN0cykpIHRoaXMudGVhbV9Qcm9qZWN0cyhvYmoudGVhbV9Qcm9qZWN0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIm9iai50ZWFtX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudGVhbV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9UZWFtX01lbWJlcnMpKSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKG9iai50ZWFtX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1JvbGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Sb2xlIiwibmFtZSI6InNoc19hcmJmd19Sb2xlIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19Sb2xlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUm9sZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJvbGVfRWZmb3J0X0VzdGltYXRlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJvbGVfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZV9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUucm9sZV9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcm9sZV9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUucm9sZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucm9sZV9UZWFtX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXhfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyLnJvbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMobmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGVfVGVhbV9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucm9sZV9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGVfVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUm9sZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZV9FZmZvcnRfRXN0aW1hdGVzID0gdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGVfVGVhbV9NZW1iZXJzID0gdGhpcy5yb2xlX1RlYW1fTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1JvbGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfUm9sZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfcm9sZScpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIm9iai5yb2xlX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucm9sZV9UZWFtX01lbWJlcnMpKSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKG9iai5yb2xlX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcm9sZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcm9sZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24iLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHsgLy90ZXN0XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLnZlcnNpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2ZXJzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92ZXJzaW9uID0gdjtcblx0XHRcdHRoaXMuX3ZlcnNpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmVyc2lvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRml4X1NjcmlwdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRml4X1NjcmlwdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1RhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1RhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fVGFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9sc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3Njb3BlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdzaG9ydF9kZXNjcmlwdGlvbicgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdmVyc2lvbikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3ZlcnNpb24nICsgKHRoaXMuX3ZlcnNpb25fY29vcCB8fCAnPScpICsgdGhpcy52ZXJzaW9uKCk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3JvbGxiYWNrX2NvbnRleHQuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19zY3JpcHRfaW5jbHVkZS5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2NyaXB0X2ZpeC5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fVGFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfZGJfb2JqZWN0LnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTYXZlX1N1YnNjcmlwdGlvbi5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3cuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19kb2N1bWVudGF0aW9uLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfZmxvd19sb2dpYy5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2Uuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbi5zeXNfc2NvcGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfc25hcHNob3Quc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9waWxsX2NvbXBvdW5kLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19zZWN1cml0eV9hY2wuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3NlY3VyaXR5X3R5cGUuc3lzX3Njb3BlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfc2VjdXJpdHlfb3BlcmF0aW9uLnN5c19zY29wZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c2NvcGU6IG9iai5nZXRWYWx1ZShcInNjb3BlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHNob3J0X2Rlc2NyaXB0aW9uOiBvYmouZ2V0VmFsdWUoXCJzaG9ydF9kZXNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0dmVyc2lvbjogb2JqLmdldFZhbHVlKFwidmVyc2lvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zY29wZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouc2NvcGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNob3J0X2Rlc2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnNob3J0X2Rlc2NyaXB0aW9uID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5zaG9ydF9kZXNjcmlwdGlvbikpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmouc2hvcnRfZGVzY3JpcHRpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZlcnNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZlcnNpb24ob2JqLnZlcnNpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMobmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fVGFibGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GbG93cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmxvd3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFwcGxpY2F0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNjb3BlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNob3J0X2Rlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuc2hvcnRfZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LnNob3J0X2Rlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNob3J0X2Rlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZlcnNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZlcnNpb24gPSB0aGlzLnZlcnNpb24oKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyA9IHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMgPSB0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRml4X1NjcmlwdHMgPSB0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fVGFibGVzID0gdGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgPSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd3MgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzID0gdGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzID0gdGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyA9IHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMgPSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgPSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNjb3BlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzaG9ydF9kZXNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2ZXJzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmVyc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52ZXJzaW9uKHRoaXMudmVyc2lvbigpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NvcGUnLCBbJyonXSlbJ3N5c19zY29wZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3Njb3BlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzY29wZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Njb3BlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY29wZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzY29wZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzaG9ydF9kZXNjcmlwdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Nob3J0X2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzaG9ydF9kZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzaG9ydF9kZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92ZXJzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdmVyc2lvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl92ZXJzaW9uX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy52ZXJzaW9uKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd2ZXJzaW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmVyc2lvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmVyc2lvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2ZXJzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2NvcGUnKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NvcGUnLCBbJyonXSlbJ3N5c19zY29wZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMpKSB0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyhvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpKSB0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9UYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1RhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcyhvYmouYXBwbGljYXRpb25fVGFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpKSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyhvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd3MpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKG9iai5hcHBsaWNhdGlvbl9GbG93cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpKSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyhvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyhvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpKSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9sczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfUXVldWUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1F1ZXVlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1F1ZXVlIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1F1ZXVlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1F1ZXVlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5jbHVzdGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2x1c3Rlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2x1c3RlciA9IHY7XG5cdFx0XHR0aGlzLl9jbHVzdGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NsdXN0ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUudG9waWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0b3BpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdG9waWMgPSB2O1xuXHRcdFx0dGhpcy5fdG9waWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdG9waWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucHJvY2Vzc2VkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvY2Vzc2VkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3NlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3Byb2Nlc3NlZCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9jZXNzZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvY2Vzc2VkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRpcmVjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRpcmVjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGlyZWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RpcmVjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fc3RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VuZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZW5kZXIgPSB2O1xuXHRcdFx0dGhpcy5fc2VuZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlbmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZWNpcGllbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWNpcGllbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlY2lwaWVudCA9IHY7XG5cdFx0XHR0aGlzLl9yZWNpcGllbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVjaXBpZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnJlc3BvbnNlVG8gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXNwb25zZVRvKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvID0gdjtcblx0XHRcdHRoaXMuX3Jlc3BvbnNlVG9fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUbztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZXNwb25zZVRvX1F1ZXVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlc3BvbnNlVG9fUXVldWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVzcG9uc2VUb19RdWV1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvX1F1ZXVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUb19RdWV1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NvdXJjZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncGF5bG9hZCcgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fY2x1c3RlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FnZW50JyArICh0aGlzLl9jbHVzdGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMuY2x1c3RlcigpO1xuXG5cdFx0aWYgKHRoaXMuX3RvcGljKSByZXQgKz0gJ14nICsgc1BhdGggKyAndG9waWMnICsgKHRoaXMuX3RvcGljX2Nvb3AgfHwgJz0nKSArIHRoaXMudG9waWMoKTtcblxuXHRcdGlmICh0aGlzLl9wcm9jZXNzZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdwcm9jZXNzZWQnICsgKHRoaXMuX3Byb2Nlc3NlZF9jb29wIHx8ICc9JykgKyB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2RpcmVjdGlvbikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3F1ZXVlJyArICh0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPScpICsgdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdGlmICh0aGlzLl9zdGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXRlJyArICh0aGlzLl9zdGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXRlKCk7XG5cblx0XHRpZiAodGhpcy5fc2VuZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZnJvbV9ob3N0JyArICh0aGlzLl9zZW5kZXJfY29vcCB8fCAnPScpICsgdGhpcy5zZW5kZXIoKTtcblxuXHRcdGlmICh0aGlzLl9yZWNpcGllbnQpIHJldCArPSAnXicgKyBzUGF0aCArICdhZ2VudF9jb3JyZWxhdG9yJyArICh0aGlzLl9yZWNpcGllbnRfY29vcCB8fCAnPScpICsgdGhpcy5yZWNpcGllbnQoKTtcblxuXHRcdGlmICh0aGlzLl9yZXNwb25zZVRvKSByZXQgKz0gLyoodGhpcy5fcmVzcG9uc2VUb19jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlc3BvbnNlVG8oKS5fdG9FUXVlcnkoc1BhdGggKyAncmVzcG9uc2VfdG8uJyk7XG5cblx0XHQodGhpcy5yZXNwb25zZVRvX1F1ZXVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZZWNjX3F1ZXVlLnJlc3BvbnNlX3RvLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9pbnZva2UoKTogXCIgKyBcIkVtcHR5IHBheWxvYWRcIik7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJwcm9jZXNzXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvY2VzcygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c291cmNlOiBvYmouZ2V0VmFsdWUoXCJzb3VyY2VcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cGF5bG9hZDogb2JqLmdldFZhbHVlKFwicGF5bG9hZFwiKSxcblxuXHRcdFx0XHRcdFx0YWdlbnQ6IG9iai5nZXRWYWx1ZShcImFnZW50XCIpLFxuXG5cdFx0XHRcdFx0XHR0b3BpYzogb2JqLmdldFZhbHVlKFwidG9waWNcIiksXG5cblx0XHRcdFx0XHRcdHByb2Nlc3NlZDogb2JqLmdldFZhbHVlKFwicHJvY2Vzc2VkXCIpLFxuXG5cdFx0XHRcdFx0XHRxdWV1ZTogb2JqLmdldFZhbHVlKFwicXVldWVcIiksXG5cblx0XHRcdFx0XHRcdHN0YXRlOiBvYmouZ2V0VmFsdWUoXCJzdGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZnJvbV9ob3N0OiBvYmouZ2V0VmFsdWUoXCJmcm9tX2hvc3RcIiksXG5cblx0XHRcdFx0XHRcdGFnZW50X2NvcnJlbGF0b3I6IG9iai5nZXRWYWx1ZShcImFnZW50X2NvcnJlbGF0b3JcIiksXG5cblx0XHRcdFx0XHRcdHJlc3BvbnNlX3RvOiBvYmouZ2V0VmFsdWUoXCJyZXNwb25zZV90b1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zb3VyY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLnNvdXJjZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGF5bG9hZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5wYXlsb2FkID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5wYXlsb2FkKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5wYXlsb2FkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hZ2VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY2x1c3RlcihvYmouYWdlbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRvcGljKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50b3BpYyhvYmoudG9waWMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2Nlc3NlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvY2Vzc2VkKG9iai5wcm9jZXNzZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnF1ZXVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kaXJlY3Rpb24ob2JqLnF1ZXVlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RhdGUob2JqLnN0YXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mcm9tX2hvc3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNlbmRlcihvYmouZnJvbV9ob3N0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hZ2VudF9jb3JyZWxhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWNpcGllbnQob2JqLmFnZW50X2NvcnJlbGF0b3IpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlc3BvbnNlX3RvKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZXNwb25zZVRvKG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlX3RvKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVzcG9uc2VUb19RdWV1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZXNwb25zZVRvX1F1ZXVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fZnJvbURvY3VtZW50KG9iai5yZXNwb25zZVRvX1F1ZXVlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlF1ZXVlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNvdXJjZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXlsb2FkID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucGF5bG9hZCkgPT09ICdvYmplY3QnKSByZXQucGF5bG9hZCA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5wYXlsb2FkKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NsdXN0ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFnZW50ID0gdGhpcy5jbHVzdGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RvcGljKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50b3BpYyA9IHRoaXMudG9waWMoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvY2Vzc2VkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9jZXNzZWQgPSB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0XHRpZiAocmV0LnByb2Nlc3NlZCAmJiB0eXBlb2YocmV0LnByb2Nlc3NlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5wcm9jZXNzZWQgPSByZXQucHJvY2Vzc2VkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kaXJlY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnF1ZXVlID0gdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXRlID0gdGhpcy5zdGF0ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZW5kZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZyb21faG9zdCA9IHRoaXMuc2VuZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlY2lwaWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWdlbnRfY29ycmVsYXRvciA9IHRoaXMucmVjaXBpZW50KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Jlc3BvbnNlVG8pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlc3BvbnNlX3RvID0gdGhpcy5yZXNwb25zZVRvKCk7XG5cblx0XHRcdGlmIChyZXQucmVzcG9uc2VfdG8pIHtcblx0XHRcdFx0cmV0LnJlc3BvbnNlX3RvID0gcmV0LnJlc3BvbnNlX3RvLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJlc3BvbnNlX3RvKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZXNwb25zZV90bykubGVuZ3RoKSByZXQucmVzcG9uc2VfdG8gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlc3BvbnNlVG9fUXVldWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG9fUXVldWVzID0gdGhpcy5yZXNwb25zZVRvX1F1ZXVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY2x1c3RlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jbHVzdGVyKHRoaXMuY2x1c3RlcigpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnRvcGljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRvcGljKHRoaXMudG9waWMoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5kaXJlY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc2VuZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlbmRlcih0aGlzLnNlbmRlcigpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnJlY2lwaWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWNpcGllbnQodGhpcy5yZWNpcGllbnQoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5yZXNwb25zZVRvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG8odGhpcy5yZXNwb25zZVRvKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzb3VyY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBheWxvYWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWdlbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jbHVzdGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNsdXN0ZXIodGhpcy5jbHVzdGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidG9waWNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50b3BpYygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50b3BpYyh0aGlzLnRvcGljKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvY2Vzc2VkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucHJvY2Vzc2VkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2Nlc3NlZCh0aGlzLnByb2Nlc3NlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInF1ZXVlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGlyZWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRpcmVjdGlvbih0aGlzLmRpcmVjdGlvbigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RhdGUodGhpcy5zdGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZyb21faG9zdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlbmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZW5kZXIodGhpcy5zZW5kZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhZ2VudF9jb3JyZWxhdG9yXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVjaXBpZW50KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlY2lwaWVudCh0aGlzLnJlY2lwaWVudCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlc3BvbnNlX3RvXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVzcG9uc2VUbygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXNwb25zZVRvKHRoaXMucmVzcG9uc2VUbygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignZWNjX3F1ZXVlJywgWycqJ10pWydlY2NfcXVldWUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ2VjY19xdWV1ZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc291cmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc291cmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzb3VyY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc291cmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BheWxvYWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwYXlsb2FkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXlsb2FkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BheWxvYWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2x1c3RlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NsdXN0ZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY2x1c3Rlcl9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY2x1c3RlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWdlbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhZ2VudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWdlbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWdlbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90b3BpY19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90b3BpY19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudG9waWMoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RvcGljJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndG9waWMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RvcGljJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RvcGljJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2Nlc3NlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2Nlc3NlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9jZXNzZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9jZXNzZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2Nlc3NlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9jZXNzZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGlyZWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGlyZWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2RpcmVjdGlvbl9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGlyZWN0aW9uKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdxdWV1ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3F1ZXVlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdxdWV1ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdxdWV1ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3N0YXRlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGF0ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VuZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2VuZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3NlbmRlcl9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2VuZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmcm9tX2hvc3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmcm9tX2hvc3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zyb21faG9zdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcm9tX2hvc3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVjaXBpZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVjaXBpZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlY2lwaWVudF9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVjaXBpZW50KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhZ2VudF9jb3JyZWxhdG9yJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWdlbnRfY29ycmVsYXRvcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWdlbnRfY29ycmVsYXRvcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhZ2VudF9jb3JyZWxhdG9yJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Jlc3BvbnNlVG8pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXNwb25zZVRvX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVzcG9uc2VUbygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlF1ZXVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInJlc3BvbnNlVG8gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIgKyBcInJlc3BvbnNlVG9bcmVzcG9uc2VfdG9dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVzcG9uc2VUbygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZXNwb25zZV90bycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Jlc3BvbnNlX3RvJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZXNwb25zZV90bycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZXNwb25zZV90bycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdlY2NfcXVldWUnLCBbJyonXSlbJ2VjY19xdWV1ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnZWNjX3F1ZXVlJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHRpZiAoX29iai5wcm9jZXNzZWQgJiYgdHlwZW9mKF9vYmoucHJvY2Vzc2VkLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5wcm9jZXNzZWQgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLnByb2Nlc3NlZCk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdlY2NfcXVldWUnLCBbJyonXSlbJ2VjY19xdWV1ZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcIm9iai5yZXNwb25zZVRvX1F1ZXVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVzcG9uc2VUb19RdWV1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVzcG9uc2VUb19RdWV1ZXMpKSB0aGlzLnJlc3BvbnNlVG9fUXVldWVzKG9iai5yZXNwb25zZVRvX1F1ZXVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuc3RvcmUoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdlY2NfcXVldWUnLCBbJyonXSlbJ2VjY19xdWV1ZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5wcm9jZXNzKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvY2VzcyhfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bG9nKFwiR09UIEhFUkU6IFwiICsgdGhpcy5yZW1hcmsoKS5zdWJzdHJpbmcoMCwgMTApKTtcblxuXHRcdFx0dGhpcy5zdGF0ZShcInByb2Nlc3NpbmdcIikucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnJlc3BvbnNlVG8obnVsbCkuc3RvcmUoKTtcblxuXHRcdFx0bG9nKFwiR09UIEhFUkU6IFwiICsgdGhpcy5yZW1hcmsoKS5zdWJzdHJpbmcoMCwgMTApKTtcblxuXHRcdFx0bGV0IHIgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmRpcmVjdGlvbihcIm91dHB1dFwiKS5uYW1lKHRoaXMubmFtZSgpKS50b3BpYyh0aGlzLnRvcGljKCkpLmNsdXN0ZXIodGhpcy5jbHVzdGVyKCkpLnNlbmRlcih0aGlzLnJlY2lwaWVudCgpKS5yZWNpcGllbnQodGhpcy5zZW5kZXIoKSkuY29kZSh0aGlzLmNvZGUoKSkuc3RhdGUoXCJwcm9jZXNzZWRcIikucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnJlc3BvbnNlVG8odGhpcyk7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRsZXQgcmV0ID0gKG5ldyB0aGlzLl9fb1Njb3BlW3RoaXMuY29kZSgpXSgpKS5faW52b2tlKHRoaXMubmFtZSgpLCB0aGlzLnJlbWFyaygpKTtcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHIucmVtYXJrKHJldCk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRsb2coXCJFeGNlcHRpb246IFwiICsgZXgpO1xuXHRcdFx0XHRyLnN0YXRlKFwiZXJyb3JcIikucmVtYXJrKGV4LnRvU3RyaW5nKCkpO1xuXHRcdFx0fVxuXHRcdFx0ci5zdG9yZSgpO1xuXG5cdFx0XHR0aGlzLnByb2Nlc3NlZChuZXcgRGF0ZSgpKS5zdGF0ZShcInByb2Nlc3NlZFwiKS5zdG9yZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTYXZlX1N1YnNjcmlwdGlvbi5wcm9maWxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKHBheWxvYWQpKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkNvbm5lY3Rpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMgPSB0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnQ29ubmVjdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdDb25uZWN0aW9uJywgWycqJ10pWydDb25uZWN0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ0Nvbm5lY3Rpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblxuXHRcdFx0aWYgKF9vYmouZGF0ZSAmJiB0eXBlb2YoX29iai5kYXRlLmdldERpc3BsYXlWYWx1ZUludGVybmFsKSAhPT0gJ2Z1bmN0aW9uJykgX29iai5kYXRlID0gbmV3IEdsaWRlRGF0ZVRpbWUoX29iai5kYXRlKTtcblxuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIm9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKSB0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKG1zZykgeyAvLyBuZWVkZWQgZm9yIGxvZyBjYWxscyBpbiBTblNjcmlwdFxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnQ29ubmVjdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdDb25uZWN0aW9uJywgWycqJ10pWydDb25uZWN0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmRlZmluaXRpb25fRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uX0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlZmluaXRpb25fRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9mbG93X2xvZ2ljLmxvZ2ljX2RlZmluaXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlZmluaXRpb25fRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTG9naWNfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uX0Zsb3dfTG9naWNzID0gdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzeXNfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzeXNfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzeXNfbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKSkgdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2siLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2sub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5ibG9ja19GbG93cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrX0Zsb3dzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2tfRmxvd3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5ibG9ja19GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrX0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2tfRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5ibG9ja19FbGVtZW50X01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2tfRWxlbWVudF9NYXBwaW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0VsZW1lbnRfTWFwcGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19FbGVtZW50X01hcHBpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9ja19FbGVtZW50X01hcHBpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suYmxvY2tfRmxvd19TbmFwc2hvdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19GbG93X1NuYXBzaG90cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd19TbmFwc2hvdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0Zsb3dfU25hcHNob3RzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3lzX25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJsb2NrX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3cuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfbG9naWMuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWXN5c19lbGVtZW50X21hcHBpbmcuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJsb2NrX0Zsb3dfU25hcHNob3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllzeXNfaHViX2Zsb3dfc25hcHNob3QuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXBheWxvYWQpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzeXNfbmFtZTogb2JqLmdldFZhbHVlKFwic3lzX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3lzX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLnN5c19uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmoucmVtYXJrID0gU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2tfRmxvd3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ibG9ja19GbG93cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrX0Zsb3dzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRmxvd19Mb2dpY3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ibG9ja19FbGVtZW50X01hcHBpbmdzKG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai5ibG9ja19FbGVtZW50X01hcHBpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19GbG93X1NuYXBzaG90cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJsb2NrX0Zsb3dfU25hcHNob3RzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRmxvd19TbmFwc2hvdHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0Jsb2NrXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3lzX25hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5ibG9ja19GbG93cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19GbG93cyA9IHRoaXMuYmxvY2tfRmxvd3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrX0Zsb3dfTG9naWNzID0gdGhpcy5ibG9ja19GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19FbGVtZW50X01hcHBpbmdzID0gdGhpcy5ibG9ja19FbGVtZW50X01hcHBpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5ibG9ja19GbG93X1NuYXBzaG90cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19GbG93X1NuYXBzaG90cyA9IHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19ibG9jaycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzeXNfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X2Jsb2NrJyk7XG5cblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19ibG9jaycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2Jsb2NrJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0Zsb3dzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19GbG93cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ibG9ja19GbG93cykpIHRoaXMuYmxvY2tfRmxvd3Mob2JqLmJsb2NrX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJvYmouYmxvY2tfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0Zsb3dfTG9naWNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0Zsb3dfTG9naWNzKSkgdGhpcy5ibG9ja19GbG93X0xvZ2ljcyhvYmouYmxvY2tfRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIm9iai5ibG9ja19FbGVtZW50X01hcHBpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19FbGVtZW50X01hcHBpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MpKSB0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3Mob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ibG9ja19GbG93X1NuYXBzaG90cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ibG9ja19GbG93X1NuYXBzaG90cykpIHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5zdG9yZSgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19ibG9jaycpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfYmxvY2snLCBbJyonXSlbJ3N5c19odWJfZmxvd19ibG9jayddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwibXNnOiBcIiArIEpTT04uc3RyaW5naWZ5KG1zZywgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0iLCJwYXlsb2FkIjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7IC8vdGVzdFxuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1RyYW5zZm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0udHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2xhYmVsJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2Rlc2NyaXB0aW9uJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2h1Yl9waWxsX2NvbXBvdW5kLnRyYW5zZm9ybV9kZWZpbml0aW9uX2lkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbi50cmFuc2Zvcm1fZGVmaW5pdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUocGF5bG9hZCkpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bGFiZWw6IG9iai5nZXRWYWx1ZShcImxhYmVsXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwiZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhYmVsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5sYWJlbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHRvYmouZGVzY3JpcHRpb24gPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLmRlc2NyaXB0aW9uKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRyYW5zZm9ybVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5sYWJlbCA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2NyaXB0aW9uID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQuZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgcmV0LmRlc2NyaXB0aW9uID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LmRlc2NyaXB0aW9uKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyA9IHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyA9IHRoaXMudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibGFiZWxcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzY3JpcHRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhYmVsJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2xhYmVsJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdsYWJlbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdsYWJlbCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Rlc2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZXNjcmlwdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNjcmlwdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSkgdGhpcy50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMob2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKSkgdGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyhvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwicGF5bG9hZCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmRlZmluaXRpb25fRmxvd19EYXRhcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlZmluaXRpb25fRmxvd19EYXRhcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19EYXRhcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19EYXRhc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbl9GbG93X0RhdGFzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdzeXNfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZc3lzX2Zsb3dfZGF0YS5kZWZpbml0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFwYXlsb2FkKSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJFbXB0eSBwYXlsb2FkXCIpO1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0c3lzX25hbWU6IG9iai5nZXRWYWx1ZShcInN5c19uYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zeXNfbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouc3lzX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdG9iai5yZW1hcmsgPSBTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRhdGFfRGVmaW5pdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN5c19uYW1lID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uX0Zsb3dfRGF0YXMgPSB0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN5c19uYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3lzX25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3lzX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N5c19uYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N5c19uYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblxuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXG5cdFx0XHRpZiAoX29iai5kYXRlICYmIHR5cGVvZihfb2JqLmRhdGUuZ2V0RGlzcGxheVZhbHVlSW50ZXJuYWwpICE9PSAnZnVuY3Rpb24nKSBfb2JqLmRhdGUgPSBuZXcgR2xpZGVEYXRlVGltZShfb2JqLmRhdGUpO1xuXG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlZmluaXRpb25fRmxvd19EYXRhczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykpIHRoaXMuZGVmaW5pdGlvbl9GbG93X0RhdGFzKG9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbiIsInBheWxvYWQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduIGV4dGVuZHMgc2hzX2FyYmZ3X1Rhc2sge1xuXHRjb25zdHJ1Y3RvcihpZCkgeyAvL3Rlc3Rcblx0XHQvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfU29sdXRpb25fRGVzaWduXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Rlc2lnbl9WZXJzaW9uX0hpc3RvcnlzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX1ZlcnNpb25fSGlzdG9yeXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbl9WZXJzaW9uX0hpc3RvcnlzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ25fU29sdXRpb25fU2VjdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9kZXNpZ25fU29sdXRpb25fU2VjdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSAvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5fdG9FUXVlcnkuY2FsbCh0aGlzLCAqLyBzdXBlci5fdG9FUXVlcnkoc1BhdGgpIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ251bWJlcicgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3Nob3J0X2Rlc2NyaXB0aW9uJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5LmRlc2lnbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUll4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uLmRlc2lnbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZeF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXguZGVzaWduLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZSgoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShwYXlsb2FkKSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdGlmICghcGF5bG9hZCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2ludm9rZSgpOiBcIiArIFwiRW1wdHkgcGF5bG9hZFwiKTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl9mcm9tRG9jdW1lbnQuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyLl9mcm9tRG9jdW1lbnQob2JqKVxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRudW1iZXI6IG9iai5nZXRWYWx1ZShcIm51bWJlclwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRzaG9ydF9kZXNjcmlwdGlvbjogb2JqLmdldFZhbHVlKFwic2hvcnRfZGVzY3JpcHRpb25cIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubnVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5udW1iZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNob3J0X2Rlc2NyaXB0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5zaG9ydF9kZXNjcmlwdGlvbik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0b2JqLnJlbWFyayA9IFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMobmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9EZXNpZ25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSAvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5fdG9Eb2N1bWVudC5jYWxsKHRoaXMsICovIHN1cGVyLl90b0RvY3VtZW50KGFyRmllbGRzKSB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm51bWJlciA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNob3J0X2Rlc2NyaXB0aW9uID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMgPSB0aGlzLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zID0gdGhpcy5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyA9IHRoaXMuZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpO1xuXG5cdFx0LypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3VuaXF1ZS5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIuX3VuaXF1ZShrZXlzLCByZXQpXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJudW1iZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzaG9ydF9kZXNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nKTtcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl9xdWVyeS5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIuX3F1ZXJ5KGdxKVxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbnVtYmVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ251bWJlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbnVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ251bWJlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2hvcnRfZGVzY3JpcHRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2hvcnRfZGVzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Nob3J0X2Rlc2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Nob3J0X2Rlc2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicpO1xuXG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cblx0XHRcdGlmIChfb2JqLmRhdGUgJiYgdHlwZW9mKF9vYmouZGF0ZS5nZXREaXNwbGF5VmFsdWVJbnRlcm5hbCkgIT09ICdmdW5jdGlvbicpIF9vYmouZGF0ZSA9IG5ldyBHbGlkZURhdGVUaW1lKF9vYmouZGF0ZSk7XG5cblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSkgdGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyhvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG9iai5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIm9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLnN0b3JlKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obXNnKSB7IC8vIG5lZWRlZCBmb3IgbG9nIGNhbGxzIGluIFNuU2NyaXB0XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kQWxsKCk6IFwiICsgXCJtc2c6IFwiICsgSlNPTi5zdHJpbmdpZnkobXNnLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihtc2cpIHsgLy8gbmVlZGVkIGZvciBsb2cgY2FsbHMgaW4gU25TY3JpcHRcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmQoKTogXCIgKyBcIm1zZzogXCIgKyBKU09OLnN0cmluZ2lmeShtc2csIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In1d",
	"cluster": "APISERVER",
	"topic": "apiserver.shs_arbfw",
	"direction": "input",
	"state": "ready",
	"sender": "apiserver.shs_arbfw",
	"recipient": "instance_name",
	"__keys": ["code", "name", "cluster", "topic", "direction", "sender", "recipient", "responseTo"],
	"active": true,
	"enabled": true,
	"__trMap": []
}