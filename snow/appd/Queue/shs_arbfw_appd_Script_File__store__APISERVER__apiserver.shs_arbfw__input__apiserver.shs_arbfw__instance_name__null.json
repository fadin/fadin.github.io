{
	"Id": "7202bc903963deacb0001b289082f906b253de4a",
	"code": "shs_arbfw_appd_Script_File",
	"date": "2025-06-29T19:42:51.915Z",
	"name": "store",
	"remark": "W3siYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsIl9fY29uc3VtZXIiOiJcbiAgICAoZnVuY3Rpb24ocyl7XG5cdGdzLmluZm8ocy5hcGlfbmFtZSArICc6ICcgKyBzLnN5c19pZCk7XG5cdGlmKHMuc3lzX3Njb3BlLm5hbWUhPSdBcHBsaWNhdGlvbiBEZXNpZ25lcicpIHJldHVybjtcblxuXHR2YXIgc2dyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0c2dyLmFkZFF1ZXJ5KCduYW1lJywgJz0nLCBzLm5hbWUpO1xuXHRzZ3IucXVlcnkoKTtcblx0aWYgKCFzZ3IubmV4dCgpKSBzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0T2JqZWN0LmtleXMocykuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRyZXR1cm4gay5pbmRleE9mKCdfXycpIDwgMDtcblx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0c2dyLnNldFZhbHVlKGssIHNba10pO1xuXHR9KTtcblx0c2dyLnVwZGF0ZSgpO1xuXHRcblx0dmFyIGVzZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lc19sYXRlc3Rfc2NyaXB0Jyk7XG5cdGVzZ3IuYWRkUXVlcnkoJ2lkJywgc2dyLnN5c19pZCk7XG5cdGVzZ3IuYWRkUXVlcnkoJ3RhYmxlJywgJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRlc2dyLnF1ZXJ5KCk7XG5cdGlmKCFlc2dyLm5leHQoKSkgZXNnciA9IG5ldyBHbGlkZVJlY29yZChlc2dyLmdldFRhYmxlTmFtZSgpKTtcblx0ZXNnci5zZXRWYWx1ZSgnaWQnLCBzZ3Iuc3lzX2lkKTtcblx0ZXNnci5zZXRWYWx1ZSgndGFibGUnLCAnc3lzX3NjcmlwdF9pbmNsdWRlJyk7XG5cdGVzZ3Iuc2V0VmFsdWUoJ3VzZV9lc19sYXRlc3QnLCB0cnVlKTtcblx0ZXNnci51cGRhdGUoKTtcblx0XG5cdGlmKCFzLmRlc2NyaXB0aW9uKSByZXR1cm47XG5cbiAgICB2YXIgb1RhYmxlID0gSlNPTi5wYXJzZShzLmRlc2NyaXB0aW9uKTtcblxuICAgIHZhciB0ID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZGJfb2JqZWN0Jyk7XG4gICAgdC5hZGRRdWVyeSgnbmFtZScsIG9UYWJsZS5uYW1lKTtcbiAgICB0LnNldExpbWl0KDEpO1xuICAgIHQucXVlcnkoKTtcbiAgICBpZih0Lm5leHQoKSl7XG4gICAgICAgIG9UYWJsZS5JZCA9IHQuc3lzX2lkLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgdmFyIHNjID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2NvcGUnKTtcbiAgICBzYy5nZXQoJ3Njb3BlJywgJ3hfMTc5MDU5M19hcmJvYXJkJyk7XG5cbiAgICBpZih0LnN5c19zY29wZS5zY29wZT09J3hfMTc5MDU5M19hcmJvYXJkJyl7XG4gICAgICAgIHZhciBhY2xPcHMgPSB7cmVhZDogJ2ZpbmQnLCB3cml0ZTogJ3VwZGF0ZScsIGNyZWF0ZTogJ2luc2VydCcvKiwgZGVsZXRlOiAnJywgZXhlY3V0ZTogJycqL307XG4gICAgICAgIE9iamVjdC5rZXlzKGFjbE9wcykuZm9yRWFjaChmdW5jdGlvbihhayl7XG4gICAgICAgICAgICB2YXIgYWNsID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2VjdXJpdHlfYWNsJyk7XG4gICAgICAgICAgICB2YXIgb0FDTCA9IHthY3RpdmU6IHRydWUsIGFkbWluX292ZXJyaWRlczogZmFsc2UsIGFkdmFuY2VkOiB0cnVlLCBuYW1lOiBvVGFibGUubmFtZSsnLionLFxuICAgICAgICAgICAgICAgIHNjcmlwdDogJ2Fuc3dlciA9IG5ldyAnICsgcy5uYW1lICsgJygpLl9mcm9tR2xpZGVSZWNvcmQoY3VycmVudCkuXycgKyBhY2xPcHNbYWtdICsgJ0Fzc2VydCgpOycsXG4gICAgICAgICAgICAgICAgZGVjaXNpb25fdHlwZTogJ2FsbG93JywgdHlwZTogJ3JlY29yZCcsIG9wZXJhdGlvbjogYWssXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdBbGxvdyAnICsgYWsgKyAnIGZvciBhbGwgZmllbGRzIGluICcgKyBvVGFibGUubGFiZWwgKyAnKCcgKyBvVGFibGUubmFtZSArICcpLCBpZiB0aGUgQUNMIHNjcmlwdCBhbnN3ZXJzIHRydWUuJ307XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ25hbWUnLCBvQUNMLm5hbWUpO1xuICAgICAgICAgICAgYWNsLmFkZFF1ZXJ5KCdvcGVyYXRpb24nLCBvQUNMLm9wZXJhdGlvbik7XG4gICAgICAgICAgICBhY2wuYWRkUXVlcnkoJ3R5cGUnLCBvQUNMLnR5cGUpO1xuICAgICAgICAgICAgYWNsLnNldExpbWl0KDEpO1xuICAgICAgICAgICAgYWNsLnF1ZXJ5KCk7XG4gICAgICAgICAgICBpZighYWNsLm5leHQoKSkgYWNsID0gbmV3IEdsaWRlUmVjb3JkKGFjbC5nZXRUYWJsZU5hbWUoKSk7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvQUNMKS5mb3JFYWNoKGZ1bmN0aW9uKGspe2FjbC5zZXRWYWx1ZShrLCBvQUNMW2tdKTt9KTtcbiAgICAgICAgICAgIGFjbC51cGRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYnIgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHQnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ2NvbGxlY3Rpb24nLCBvVGFibGUubmFtZSk7XG4gICAgICAgIGJyLmFkZFF1ZXJ5KCdzeXNfc2NvcGUnLCBzYy5zeXNfaWQpO1xuICAgICAgICBici5hZGRRdWVyeSgnd2hlbicsICdiZWZvcmUnKTtcbiAgICAgICAgYnIuYWRkUXVlcnkoJ25hbWUnLCBvVGFibGUubGFiZWwgKyAnIGFzc2VydGlvbicpO1xuICAgICAgICBici5zZXRMaW1pdCgxKTtcbiAgICAgICAgYnIucXVlcnkoKTtcbiAgICAgICAgLy9ncy5pbmZvKFwiYnIgY291bnQ6IFwiICsgYnIuZ2V0Um93Q291bnQoKSArIFwiLCBxdWVyeTogXCIgKyBici5nZXRFbmNvZGVkUXVlcnkoKSk7XG4gICAgICAgIGlmKCFici5uZXh0KCkpIGJyID0gbmV3IEdsaWRlUmVjb3JkKGJyLmdldFRhYmxlTmFtZSgpKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGl2ZScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnY29sbGVjdGlvbicsIG9UYWJsZS5uYW1lKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3N5c19zY29wZScsIHNjLnN5c19pZCk7XG4gICAgICAgIGJyLnNldFZhbHVlKCd3aGVuJywgJ2JlZm9yZScpO1xuICAgICAgICBici5zZXRWYWx1ZSgnbmFtZScsIG9UYWJsZS5sYWJlbCArICcgYXNzZXJ0aW9uJyk7XG4gICAgICAgIGJyLnNldFZhbHVlKCdkZXNjcmlwdGlvbicsICdSdWxlIGZvciAnICsgb1RhYmxlLmxhYmVsICsgJygnICsgb1RhYmxlLm5hbWUgKyAnKSwgdG8gYXNzZXJ0IG9wZXJhdGlvbiB2YWxpZGl0eS4nKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9pbnNlcnQnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl91cGRhdGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9kZWxldGUnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ2FjdGlvbl9xdWVyeScsIHRydWUpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWJvcnRfYWN0aW9uJywgZmFsc2UpO1xuICAgICAgICBici5zZXRWYWx1ZSgnYWRkX21lc3NhZ2UnLCB0cnVlKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ21lc3NhZ2UnLCAnT3BlcmF0aW9uIGFib3J0ZWQ6IGFzc2VydGlvbiBmYWlsZWQnKTtcbiAgICAgICAgYnIuc2V0VmFsdWUoJ3NjcmlwdCcsICdjdXJyZW50LnNldEFib3J0QWN0aW9uKCFuZXcgJyArIHMubmFtZSArICcoKS5fZnJvbUdsaWRlUmVjb3JkKGN1cnJlbnQpW1wiX1wiICsgKHtpbnNlcnQ6IFwiaW5zZXJ0XCIsIHVwZGF0ZTogXCJ1cGRhdGVcIiwgcXVlcnk6IFwiZmluZFwiLCBkZWxldGU6IFwidXBkYXRlXCJ9KVtjdXJyZW50Lm9wZXJhdGlvbigpIHx8IFwiaW5zZXJ0XCJdICsgXCJBc3NlcnRcIl0oKSk7Jyk7XG4gICAgICAgIGJyLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBcbiAgICBpZih0LmlzVmFsaWRSZWNvcmQoKSkgcmV0dXJuO1xuXG4gICAgdCA9IG5ldyBHbGlkZVJlY29yZCh0LmdldFRhYmxlTmFtZSgpKTtcbiAgICB0LnNldE5ld0d1aWRWYWx1ZShvVGFibGUuSWQpO1xuICAgIFsnbmFtZScsICdsYWJlbCcsICdzeXNfbmFtZSddLmZvckVhY2goZnVuY3Rpb24oZil7dC5zZXRWYWx1ZShmLCBvVGFibGVbZl0pO30pO1xuICAgIHQuc3lzX3Njb3BlID0gc2Muc3lzX2lkO1xuICAgIGlmKG9UYWJsZS5zdXBlcl9jbGFzcykge1xuICAgICAgICB2YXIgc3VwZXJfY2xhc3MgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kYl9vYmplY3QnKTtcbiAgICAgICAgc3VwZXJfY2xhc3MuZ2V0KCduYW1lJywgb1RhYmxlLnN1cGVyX2NsYXNzKTtcbiAgICAgICAgaWYoc3VwZXJfY2xhc3MuaXNWYWxpZFJlY29yZCgpKSB0LnNldFZhbHVlKCdzdXBlcl9jbGFzcycsIHN1cGVyX2NsYXNzLnN5c19pZCk7XG4gICAgfVxuICAgIGdzLmluZm8oJ2NyZWF0aW5nIHRhYmxlOiAnICsgb1RhYmxlLm5hbWUgKyBcIiB4XzE3OTA1OTNfYXJib2FyZCAtIFwiICsgcy5zeXNfaWQpO1xuICAgIFxuICAgIHQuaW5zZXJ0KCk7XG4gICAgXG4gICAgb1RhYmxlLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjKXtcbiAgICAgICAgdmFyIGdyYyA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RpY3Rpb25hcnknKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYykuZm9yRWFjaChmdW5jdGlvbihmKXtncmMuc2V0VmFsdWUoZiwgY1tmXSk7fSk7XG4gICAgICAgIGdyYy5pbnNlcnQoKTtcbiAgICB9KTtcbiAgICBcblx0fSlcbiAgICAiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhbHVlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92YWx1ZSA9IHY7XG5cdFx0XHR0aGlzLl92YWx1ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YWx1ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5pbnN0YW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluc3RhbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9pbnN0YW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9pbnN0YW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmFjdGlvbklucHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uSW5wdXQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbklucHV0ID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbklucHV0O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLmZsb3dJbnB1dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dJbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvd0lucHV0ID0gdjtcblx0XHRcdHRoaXMuX2Zsb3dJbnB1dF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93SW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUubWFwcGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hcHBpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hcHBpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWFwcGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYXBwaW5nO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhbHVlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndmFsdWUnICsgKHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nKSArIHRoaXMudmFsdWUoKTtcblxuXHRcdGlmICh0aGlzLl9pbnN0YW5jZSkgcmV0ICs9IC8qKHRoaXMuX2luc3RhbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuaW5zdGFuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAnaW5zdGFuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb25JbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uSW5wdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uSW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvd0lucHV0KSByZXQgKz0gLyoodGhpcy5fZmxvd0lucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvd0lucHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3dJbnB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl9tYXBwaW5nKSByZXQgKz0gLyoodGhpcy5fbWFwcGluZ19jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWFwcGluZy4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR2YWx1ZTogb2JqLmdldFZhbHVlKFwidmFsdWVcIiksXG5cblx0XHRcdFx0XHRcdGluc3RhbmNlOiBvYmouZ2V0VmFsdWUoXCJpbnN0YW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0YWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25cIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbklucHV0OiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25JbnB1dFwiKSxcblxuXHRcdFx0XHRcdFx0Zmxvd0lucHV0OiBvYmouZ2V0VmFsdWUoXCJmbG93SW5wdXRcIiksXG5cblx0XHRcdFx0XHRcdG1hcHBpbmc6IG9iai5nZXRWYWx1ZShcIm1hcHBpbmdcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52YWx1ZShTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnZhbHVlKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZhbHVlKG9iai52YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmluc3RhbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uSW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbklucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25JbnB1dCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dJbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvd0lucHV0KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd0lucHV0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFwcGluZyhuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubWFwcGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJWYXJpYWJsZV9WYWx1ZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92YWx1ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudmFsdWUgPSB0aGlzLnZhbHVlKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnZhbHVlKSA9PT0gJ29iamVjdCcpIHJldC52YWx1ZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC52YWx1ZSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW5zdGFuY2UgPSB0aGlzLmluc3RhbmNlKCk7XG5cblx0XHRcdGlmIChyZXQuaW5zdGFuY2UpIHtcblx0XHRcdFx0cmV0Lmluc3RhbmNlID0gcmV0Lmluc3RhbmNlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lmluc3RhbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5pbnN0YW5jZSkubGVuZ3RoKSByZXQuaW5zdGFuY2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGlvbiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYWN0aW9uKSB7XG5cdFx0XHRcdHJldC5hY3Rpb24gPSByZXQuYWN0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uKS5sZW5ndGgpIHJldC5hY3Rpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb25JbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aW9uSW5wdXQgPSB0aGlzLmFjdGlvbklucHV0KCk7XG5cblx0XHRcdGlmIChyZXQuYWN0aW9uSW5wdXQpIHtcblx0XHRcdFx0cmV0LmFjdGlvbklucHV0ID0gcmV0LmFjdGlvbklucHV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbklucHV0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hY3Rpb25JbnB1dCkubGVuZ3RoKSByZXQuYWN0aW9uSW5wdXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93SW5wdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3dJbnB1dCA9IHRoaXMuZmxvd0lucHV0KCk7XG5cblx0XHRcdGlmIChyZXQuZmxvd0lucHV0KSB7XG5cdFx0XHRcdHJldC5mbG93SW5wdXQgPSByZXQuZmxvd0lucHV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3dJbnB1dCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvd0lucHV0KS5sZW5ndGgpIHJldC5mbG93SW5wdXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYXBwaW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tYXBwaW5nID0gdGhpcy5tYXBwaW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWFwcGluZykge1xuXHRcdFx0XHRyZXQubWFwcGluZyA9IHJldC5tYXBwaW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1hcHBpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1hcHBpbmcpLmxlbmd0aCkgcmV0Lm1hcHBpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YWx1ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhbHVlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhbHVlKHRoaXMudmFsdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnN0YW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmluc3RhbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmluc3RhbmNlKHRoaXMuaW5zdGFuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25JbnB1dFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGlvbklucHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbklucHV0KHRoaXMuYWN0aW9uSW5wdXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd0lucHV0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvd0lucHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dJbnB1dCh0aGlzLmZsb3dJbnB1dCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYXBwaW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFwcGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYXBwaW5nKHRoaXMubWFwcGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl92YWx1ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl92YWx1ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudmFsdWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZhbHVlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFsdWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhbHVlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhbHVlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2luc3RhbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5faW5zdGFuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlZhcmlhYmxlIFZhbHVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcImluc3RhbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJpbnN0YW5jZVtpbnN0YW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnN0YW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdpbnN0YW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2luc3RhbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdpbnN0YW5jZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb25JbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGlvbklucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uSW5wdXQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWYXJpYWJsZSBWYWx1ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb25JbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwiYWN0aW9uSW5wdXRbYWN0aW9uSW5wdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uSW5wdXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aW9uaW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb25pbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uaW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uaW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvd0lucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZmxvd0lucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvd0lucHV0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwiZmxvd0lucHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiICsgXCJmbG93SW5wdXRbZmxvd0lucHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3dJbnB1dCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmbG93aW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93aW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3dpbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93aW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hcHBpbmdfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYXBwaW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVmFyaWFibGUgVmFsdWVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwibWFwcGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9xdWVyeSgpOiBcIiArIFwibWFwcGluZ1ttYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1hcHBpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFwcGluZycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFwcGluZycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3ZhcmlhYmxlX3ZhbHVlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3ZhcmlhYmxlX3ZhbHVlJywgWycqJ10pWydzeXNfdmFyaWFibGVfdmFsdWUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZhcmlhYmxlX1ZhbHVlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmFyaWFibGVfVmFsdWUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWYXJpYWJsZV9WYWx1ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c192YXJpYWJsZV92YWx1ZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdmFyaWFibGVfdmFsdWUnLCBbJyonXSlbJ3N5c192YXJpYWJsZV92YWx1ZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWYXJpYWJsZV9WYWx1ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZhcmlhYmxlX1ZhbHVlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmFyaWFibGVfVmFsdWUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19BZ2VuZGFfSXRlbSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0FnZW5kYV9JdGVtIiwibmFtZSI6InNoc19hcmJmd19BZ2VuZGFfSXRlbSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19BZ2VuZGFfSXRlbSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQWdlbmRhX0l0ZW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5hZ2VuZGEgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhZ2VuZGEodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FnZW5kYSA9IHY7XG5cdFx0XHR0aGlzLl9hZ2VuZGFfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWdlbmRhO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FnZW5kYSkgcmV0ICs9IC8qKHRoaXMuX2FnZW5kYV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFnZW5kYSgpLl90b0VRdWVyeShzUGF0aCArICdhZ2VuZGEuJyk7XG5cblx0XHRpZiAodGhpcy5fcmVxdWlyZW1lbnQpIHJldCArPSAvKih0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlcXVpcmVtZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlcXVpcmVtZW50LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0YWdlbmRhOiBvYmouZ2V0VmFsdWUoXCJhZ2VuZGFcIiksXG5cblx0XHRcdFx0XHRcdHJlcXVpcmVtZW50OiBvYmouZ2V0VmFsdWUoXCJyZXF1aXJlbWVudFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFnZW5kYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWdlbmRhKG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG9iai5hZ2VuZGEpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVxdWlyZW1lbnQobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFnZW5kYV9JdGVtXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWVcblxuXHRcdFx0JiZcblx0XHRcdCgoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9pbnNlcnRBc3NlcnQoKTogXCIgKyBcIkV4Y2VwdGlvbiBpbiBfaW5zZXJ0QXNzZXJ0OjooKTogXCIgKyBleC5nZXRNZXNzYWdlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KSh0aGlzKSk7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlXG5cblx0XHRcdCYmXG5cdFx0XHQoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc3RvcmVBc3NlcnQoKTogXCIgKyBcIkV4Y2VwdGlvbiBpbiBfc3RvcmVBc3NlcnQ6OigpOiBcIiArIGV4LmdldE1lc3NhZ2UoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pKHRoaXMpKTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hZ2VuZGEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFnZW5kYSA9IHRoaXMuYWdlbmRhKCk7XG5cblx0XHRcdGlmIChyZXQuYWdlbmRhKSB7XG5cdFx0XHRcdHJldC5hZ2VuZGEgPSByZXQuYWdlbmRhLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFnZW5kYSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWdlbmRhKS5sZW5ndGgpIHJldC5hZ2VuZGEgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVxdWlyZW1lbnQgPSB0aGlzLnJlcXVpcmVtZW50KCk7XG5cblx0XHRcdGlmIChyZXQucmVxdWlyZW1lbnQpIHtcblx0XHRcdFx0cmV0LnJlcXVpcmVtZW50ID0gcmV0LnJlcXVpcmVtZW50Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJlcXVpcmVtZW50KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZXF1aXJlbWVudCkubGVuZ3RoKSByZXQucmVxdWlyZW1lbnQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hZ2VuZGEodGhpcy5hZ2VuZGEoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhZ2VuZGFcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hZ2VuZGEoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhKHRoaXMuYWdlbmRhKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlcXVpcmVtZW50XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVxdWlyZW1lbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVxdWlyZW1lbnQodGhpcy5yZXF1aXJlbWVudCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWdlbmRhKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWdlbmRhX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWdlbmRhKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWdlbmRhIEl0ZW1cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwiYWdlbmRhIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiICsgXCJhZ2VuZGFbYWdlbmRhXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFnZW5kYSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhZ2VuZGEnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhZ2VuZGEnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FnZW5kYScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhZ2VuZGEnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlcXVpcmVtZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWdlbmRhIEl0ZW1cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwicmVxdWlyZW1lbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIgKyBcInJlcXVpcmVtZW50W3JlcXVpcmVtZW50XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlcXVpcmVtZW50KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlcXVpcmVtZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlcXVpcmVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYWdlbmRhX2l0ZW0nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2FnZW5kYV9pdGVtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9hZ2VuZGFfaXRlbSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGFyZW50ID0gdjtcblx0XHRcdHRoaXMuX3BhcmVudF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnN1YmZsb3cgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdWJmbG93KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdWJmbG93ID0gdjtcblx0XHRcdHRoaXMuX3N1YmZsb3dfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3ViZmxvdztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2luc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2UuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0aW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGFyZW50KSByZXQgKz0gLyoodGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGFyZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3BhcmVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fc3ViZmxvdykgcmV0ICs9IC8qKHRoaXMuX3N1YmZsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zdWJmbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3N1YmZsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5zdGFuY2VfSW5wdXQuaW5zdGFuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVmFyaWFibGVfVmFsdWUuaW5zdGFuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRwYXJlbnQ6IG9iai5nZXRWYWx1ZShcInBhcmVudFwiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRzdWJmbG93OiBvYmouZ2V0VmFsdWUoXCJzdWJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wYXJlbnQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdWJmbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdWJmbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc3ViZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMobmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19JbnN0YW5jZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudCkge1xuXHRcdFx0XHRyZXQucGFyZW50ID0gcmV0LnBhcmVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudCkubGVuZ3RoKSByZXQucGFyZW50ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3ViZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3ViZmxvdyA9IHRoaXMuc3ViZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LnN1YmZsb3cpIHtcblx0XHRcdFx0cmV0LnN1YmZsb3cgPSByZXQuc3ViZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zdWJmbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5zdWJmbG93KS5sZW5ndGgpIHJldC5zdWJmbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyA9IHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdWJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3ViZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdWJmbG93KHRoaXMuc3ViZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInBhcmVudCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJwYXJlbnRbcGFyZW50XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BhcmVudCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGFyZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BhcmVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdWJmbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3ViZmxvd19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN1YmZsb3coKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwic3ViZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJzdWJmbG93W3N1YmZsb3ddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc3ViZmxvdygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdWJmbG93JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdWJmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdWJmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1YmZsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwib2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cykpIHRoaXMuaW5zdGFuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMob2JqLmluc3RhbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKSkgdGhpcy5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMob2JqLmluc3RhbmNlX1ZhcmlhYmxlX1ZhbHVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2Uuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2UnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuaW5zdGFuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnN0YW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5faW5zdGFuY2UgPSB2O1xuXHRcdFx0dGhpcy5faW5zdGFuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5zdGFuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX19rZXlzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJanBiSW1Wc1pXMWxiblFpTENKdGIyUmxiRjlwWkNKZGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0Lk1vZGVsX0lEIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfSUQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5Nb2RlbF9UYWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX1RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Lk1vZGVsX1RhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdjM2x6WDJoMVlsOW1iRzkzT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5ME9pQW5jM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwSnl3Z2MzbHpYM1poY21saFlteGxYM1poYkhWbE9pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5emRXSmZabXh2ZDE5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkMTlzYjJkcFkxOWxlSFJmYVc1d2RYUW5MQ0J6ZVhOZmFIVmlYMkZqZEdsdmJsOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZHlkOUtWdDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFhTaytQaUlzSWw5VFpYSjJhV05sVG05M0lqb2lQRHdrWlhocGMzUnpLQ29xVzJac2IzZGZSbXh2ZDE5SmJuQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJR1pzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQm1iRzkzWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2lna1pYaHBjM1J6S0NvcVczTnVZWEJ6YUc5MFgwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFNCdmNpQnpibUZ3YzJodmRGOUdiRzkzWDA5MWRIQjFkSE5iYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZElHOXlJSE51WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZjMjVoY0hOb2IzUW5PaWdrWlhocGMzUnpLQ29xVzJsdWMzUmhibU5sWDBac2IzZGZTVzV6ZEdGdVkyVmZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzZGZiRzluYVdOZlpYaDBYMmx1Y0hWMEp6b29KR1Y0YVhOMGN5Z3FLbHRoWTNScGIyNWZWbUZ5YVdGaWJHVmZWbUZzZFdWelcyRmpkR2x2YmtsdWNIVjBXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYxZElHOXlJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZkR0ZpYkdVOUozdDdhV1I5ZlNkZFhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pY25LU2twUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuQXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfQXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2luc3RhbmNlKSByZXQgKz0gLyoodGhpcy5faW5zdGFuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5pbnN0YW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdpbnN0YW5jZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGluc3RhbmNlOiBvYmouZ2V0VmFsdWUoXCJpbnN0YW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG9iai50eXBlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1hbmRhdG9yeShvYmoubWFuZGF0b3J5KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlZmVyZW5jZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2UpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5pbnN0YW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuaW5zdGFuY2UobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5pbnN0YW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0luc3RhbmNlX0lucHV0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5faW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmluc3RhbmNlID0gdGhpcy5pbnN0YW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0Lmluc3RhbmNlKSB7XG5cdFx0XHRcdHJldC5pbnN0YW5jZSA9IHJldC5pbnN0YW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5pbnN0YW5jZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuaW5zdGFuY2UpLmxlbmd0aCkgcmV0Lmluc3RhbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5sZW5ndGgoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGVuZ3RoID0gdGhpcy5sZW5ndGgoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9JRCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9JRCA9IHRoaXMuTW9kZWxfSUQoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5Nb2RlbF9UYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5Nb2RlbF9UYWJsZSA9IHRoaXMuTW9kZWxfVGFibGUoKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5BdHRyaWJ1dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LkF0dHJpYnV0ZXMgPSB0aGlzLkF0dHJpYnV0ZXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuaW5zdGFuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5zdGFuY2UodGhpcy5pbnN0YW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiaW5zdGFuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5pbnN0YW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5pbnN0YW5jZSh0aGlzLmluc3RhbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5zdGFuY2UgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5faW5zdGFuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9pbnN0YW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmluc3RhbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnN0YW5jZSBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImluc3RhbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIgKyBcImluc3RhbmNlW2luc3RhbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmluc3RhbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2luc3RhbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnN0YW5jZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW5zdGFuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW5zdGFuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZV9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N1Yl9mbG93X2luc3RhbmNlX2lucHV0cycsIFsnKiddKVsnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnN0YW5jZV9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdWJfZmxvd19pbnN0YW5jZV9pbnB1dHMnLCBbJyonXSlbJ3N5c19odWJfc3ViX2Zsb3dfaW5zdGFuY2VfaW5wdXRzJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5zdGFuY2VfSW5wdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0luc3RhbmNlX0lucHV0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnN0YW5jZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGFyZW50KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wYXJlbnQgPSB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0luc3RhbmNlLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb25fVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGFyZW50KSByZXQgKz0gLyoodGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGFyZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3BhcmVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYWN0aW9uKSByZXQgKz0gLyoodGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWN0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FjdGlvbi4nKTtcblxuXHRcdCh0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZhcmlhYmxlX1ZhbHVlLmFjdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBhcmVudDogb2JqLmdldFZhbHVlKFwicGFyZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wYXJlbnQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX0luc3RhbmNlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAocmV0LnBhcmVudCkge1xuXHRcdFx0XHRyZXQucGFyZW50ID0gcmV0LnBhcmVudC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wYXJlbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBhcmVudCkubGVuZ3RoKSByZXQucGFyZW50ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMgPSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl9pbnN0YW5jZScsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25faW5zdGFuY2UnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJwYXJlbnRbcGFyZW50XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBhcmVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwYXJlbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGFyZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwYXJlbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGFyZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBJbnN0YW5jZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIEluc3RhbmNlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hY3Rpb25fVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMob2JqLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnN0YW5jZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnN0YW5jZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5zdGFuY2UuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5zdGFuY2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0luc3RhbmNlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWxcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnBsdXJhbCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBsdXJhbCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGx1cmFsID0gdjtcblx0XHRcdHRoaXMuX3BsdXJhbF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wbHVyYWw7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwubGFuZ3VhZ2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYW5ndWFnZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbGFuZ3VhZ2UgPSB2O1xuXHRcdFx0dGhpcy5fbGFuZ3VhZ2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbGFuZ3VhZ2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuaW5wdXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRpbnB1dCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5faW5wdXQgPSB2O1xuXHRcdFx0dGhpcy5faW5wdXRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5wdXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwub3V0cHV0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3V0cHV0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vdXRwdXQgPSB2O1xuXHRcdFx0dGhpcy5fb3V0cHV0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX291dHB1dDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC52YXJpYWJsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhcmlhYmxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92YXJpYWJsZSA9IHY7XG5cdFx0XHR0aGlzLl92YXJpYWJsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl92YXJpYWJsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5jb2x1bW4gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2x1bW4odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbiA9IHY7XG5cdFx0XHR0aGlzLl9jb2x1bW5fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BsdXJhbCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3BsdXJhbCcgKyAodGhpcy5fcGx1cmFsX2Nvb3AgfHwgJz0nKSArIHRoaXMucGx1cmFsKCk7XG5cblx0XHRpZiAodGhpcy5fbGFuZ3VhZ2UpIHJldCArPSAnXicgKyBzUGF0aCArICdsYW5ndWFnZScgKyAodGhpcy5fbGFuZ3VhZ2VfY29vcCB8fCAnPScpICsgdGhpcy5sYW5ndWFnZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9pbnB1dCkgcmV0ICs9IC8qKHRoaXMuX2lucHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuaW5wdXQoKS5fdG9FUXVlcnkoc1BhdGggKyAnaW5wdXQuJyk7XG5cblx0XHRpZiAodGhpcy5fb3V0cHV0KSByZXQgKz0gLyoodGhpcy5fb3V0cHV0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMub3V0cHV0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ291dHB1dC4nKTtcblxuXHRcdGlmICh0aGlzLl92YXJpYWJsZSkgcmV0ICs9IC8qKHRoaXMuX3ZhcmlhYmxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudmFyaWFibGUoKS5fdG9FUXVlcnkoc1BhdGggKyAndmFyaWFibGUuJyk7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uKSByZXQgKz0gLyoodGhpcy5fY29sdW1uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuY29sdW1uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2NvbHVtbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRwbHVyYWw6IG9iai5nZXRWYWx1ZShcInBsdXJhbFwiKSxcblxuXHRcdFx0XHRcdFx0bGFuZ3VhZ2U6IG9iai5nZXRWYWx1ZShcImxhbmd1YWdlXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdGlucHV0OiBvYmouZ2V0VmFsdWUoXCJpbnB1dFwiKSxcblxuXHRcdFx0XHRcdFx0b3V0cHV0OiBvYmouZ2V0VmFsdWUoXCJvdXRwdXRcIiksXG5cblx0XHRcdFx0XHRcdHZhcmlhYmxlOiBvYmouZ2V0VmFsdWUoXCJ2YXJpYWJsZVwiKSxcblxuXHRcdFx0XHRcdFx0Y29sdW1uOiBvYmouZ2V0VmFsdWUoXCJjb2x1bW5cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGx1cmFsKG9iai5wbHVyYWwpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmxhbmd1YWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5sYW5ndWFnZShvYmoubGFuZ3VhZ2UpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmlucHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5pbnB1dChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmlucHV0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3V0cHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vdXRwdXQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvYmoub3V0cHV0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudmFyaWFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZhcmlhYmxlKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoudmFyaWFibGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2x1bW4pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvbHVtbihuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvYmouY29sdW1uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZpZWxkX0xhYmVsXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsdXJhbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGx1cmFsID0gdGhpcy5wbHVyYWwoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lmxhbmd1YWdlID0gdGhpcy5sYW5ndWFnZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuaW5wdXQgPSB0aGlzLmlucHV0KCk7XG5cblx0XHRcdGlmIChyZXQuaW5wdXQpIHtcblx0XHRcdFx0cmV0LmlucHV0ID0gcmV0LmlucHV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmlucHV0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5pbnB1dCkubGVuZ3RoKSByZXQuaW5wdXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vdXRwdXQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm91dHB1dCA9IHRoaXMub3V0cHV0KCk7XG5cblx0XHRcdGlmIChyZXQub3V0cHV0KSB7XG5cdFx0XHRcdHJldC5vdXRwdXQgPSByZXQub3V0cHV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm91dHB1dCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQub3V0cHV0KS5sZW5ndGgpIHJldC5vdXRwdXQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92YXJpYWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudmFyaWFibGUgPSB0aGlzLnZhcmlhYmxlKCk7XG5cblx0XHRcdGlmIChyZXQudmFyaWFibGUpIHtcblx0XHRcdFx0cmV0LnZhcmlhYmxlID0gcmV0LnZhcmlhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnZhcmlhYmxlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC52YXJpYWJsZSkubGVuZ3RoKSByZXQudmFyaWFibGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2x1bW4pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbHVtbiA9IHRoaXMuY29sdW1uKCk7XG5cblx0XHRcdGlmIChyZXQuY29sdW1uKSB7XG5cdFx0XHRcdHJldC5jb2x1bW4gPSByZXQuY29sdW1uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmNvbHVtbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuY29sdW1uKS5sZW5ndGgpIHJldC5jb2x1bW4gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmxhbmd1YWdlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxhbmd1YWdlKHRoaXMubGFuZ3VhZ2UoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGx1cmFsXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGx1cmFsKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBsdXJhbCh0aGlzLnBsdXJhbCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxhbmd1YWdlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubGFuZ3VhZ2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGFuZ3VhZ2UodGhpcy5sYW5ndWFnZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJpbnB1dFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmlucHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmlucHV0KHRoaXMuaW5wdXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3V0cHV0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3V0cHV0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm91dHB1dCh0aGlzLm91dHB1dCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YXJpYWJsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhcmlhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhcmlhYmxlKHRoaXMudmFyaWFibGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29sdW1uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29sdW1uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbih0aGlzLmNvbHVtbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RvY3VtZW50YXRpb24nLCBbJyonXSlbJ3N5c19kb2N1bWVudGF0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZG9jdW1lbnRhdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGx1cmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGx1cmFsX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3BsdXJhbF9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGx1cmFsKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwbHVyYWwnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwbHVyYWwnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BsdXJhbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwbHVyYWwnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbGFuZ3VhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9sYW5ndWFnZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9sYW5ndWFnZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubGFuZ3VhZ2UoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xhbmd1YWdlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbGFuZ3VhZ2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xhbmd1YWdlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xhbmd1YWdlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9pbnB1dCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2lucHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuaW5wdXQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGaWVsZCBMYWJlbFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJpbnB1dCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiaW5wdXRbaW5wdXRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuaW5wdXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignaW5wdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdpbnB1dCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnaW5wdXQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnaW5wdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3V0cHV0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3V0cHV0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3V0cHV0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwib3V0cHV0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiICsgXCJvdXRwdXRbb3V0cHV0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm91dHB1dCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvdXRwdXQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvdXRwdXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ291dHB1dCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvdXRwdXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFyaWFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl92YXJpYWJsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnZhcmlhYmxlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmllbGQgTGFiZWxcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIrIFwidmFyaWFibGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fcXVlcnkoKTogXCIgKyBcInZhcmlhYmxlW3ZhcmlhYmxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnZhcmlhYmxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3ZhcmlhYmxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFyaWFibGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhcmlhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhcmlhYmxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpZWxkIExhYmVsXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3F1ZXJ5KCk6IFwiKyBcImNvbHVtbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIiArIFwiY29sdW1uW2NvbHVtbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5jb2x1bW4oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29sdW1uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2x1bW4nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29sdW1uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2RvY3VtZW50YXRpb24nKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaWVsZF9MYWJlbC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZG9jdW1lbnRhdGlvbicsIFsnKiddKVsnc3lzX2RvY3VtZW50YXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpZWxkX0xhYmVsLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmllbGRfTGFiZWwuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaWVsZF9MYWJlbC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kb2N1bWVudGF0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kb2N1bWVudGF0aW9uJywgWycqJ10pWydzeXNfZG9jdW1lbnRhdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaWVsZF9MYWJlbC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpZWxkX0xhYmVsLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmllbGRfTGFiZWwuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQubG9naWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsb2dpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbG9naWMgPSB2O1xuXHRcdFx0dGhpcy5fbG9naWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9naWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZFRhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZWRUYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3JlZmVyZW5jZWRUYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQucmVmZXJlbmNlZFRhYmxlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyeHZaMmxqWDBac2IzZGZTVzV3ZFhSZlUyTnlhWEIwYzF0eVpXWmxjbVZ1WTJWa1gzUmhZbXhsUFZ3aWUzdHBaSDE5WENKZFhTNXdZWEpsYm5SZlFXTjBhVzl1WDBsdWMzUmhibU5sY3lrL0ozTjVjMTlvZFdKZllXTjBhVzl1WDJsdWMzUmhibU5sSnpvbmMzbHpYMmgxWWw5bWJHOTNYMnh2WjJsakp6NCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9sb2dpYykgcmV0ICs9IC8qKHRoaXMuX2xvZ2ljX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubG9naWMoKS5fdG9FUXVlcnkoc1BhdGggKyAnbG9naWMuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0bG9naWM6IG9iai5nZXRWYWx1ZShcImxvZ2ljXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5sb2dpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubG9naWMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5sb2dpYykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0lucHV0X1NjcmlwdFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9sb2dpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubG9naWMgPSB0aGlzLmxvZ2ljKCk7XG5cblx0XHRcdGlmIChyZXQubG9naWMpIHtcblx0XHRcdFx0cmV0LmxvZ2ljID0gcmV0LmxvZ2ljLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmxvZ2ljKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5sb2dpYykubGVuZ3RoKSByZXQubG9naWMgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZWRUYWJsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VkVGFibGUgPSB0aGlzLnJlZmVyZW5jZWRUYWJsZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubG9naWMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubG9naWModGhpcy5sb2dpYygpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImxvZ2ljXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubG9naWMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubG9naWModGhpcy5sb2dpYygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJywgWycqJ10pWydzeXNfaHViX2lucHV0X3NjcmlwdHMnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbG9naWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9sb2dpY19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmxvZ2ljKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnB1dCBTY3JpcHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwibG9naWMgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fcXVlcnkoKTogXCIgKyBcImxvZ2ljW2xvZ2ljXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmxvZ2ljKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2xvZ2ljJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbG9naWMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2xvZ2ljJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2xvZ2ljJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycsIFsnKiddKVsnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2lucHV0X3NjcmlwdHMnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2lucHV0X3NjcmlwdHMnLCBbJyonXSlbJ3N5c19odWJfaW5wdXRfc2NyaXB0cyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dF9TY3JpcHQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0X1NjcmlwdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXRfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfaW5wdXRfc2NyaXB0cycsIFsnKiddKVsnc3lzX2h1Yl9pbnB1dF9zY3JpcHRzJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXRfU2NyaXB0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dF9TY3JpcHQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0X1NjcmlwdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfTWVldGluZ19BZ2VuZGEiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX0FnZW5kYVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLm1lZXRpbmcgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tZWV0aW5nID0gdjtcblx0XHRcdHRoaXMuX21lZXRpbmdfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVldGluZztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5hZ2VuZGFfQWdlbmRhX0l0ZW1zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWdlbmRhX0FnZW5kYV9JdGVtcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hZ2VuZGFfQWdlbmRhX0l0ZW1zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hZ2VuZGFfQWdlbmRhX0l0ZW1zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX21lZXRpbmcpIHJldCArPSAvKih0aGlzLl9tZWV0aW5nX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubWVldGluZygpLl90b0VRdWVyeShzUGF0aCArICdtZWV0aW5nLicpO1xuXG5cdFx0KHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWdlbmRhX0l0ZW0uYWdlbmRhLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRtZWV0aW5nOiBvYmouZ2V0VmFsdWUoXCJtZWV0aW5nXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVldGluZyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWdlbmRhX0FnZW5kYV9JdGVtcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMobmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nX0FnZW5kYVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWVldGluZykge1xuXHRcdFx0XHRyZXQubWVldGluZyA9IHJldC5tZWV0aW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhX0FnZW5kYV9JdGVtcyA9IHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lZXRpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVldGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nIEFnZW5kYVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJtZWV0aW5nIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiICsgXCJtZWV0aW5nW21lZXRpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVldGluZygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZWV0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZWV0aW5nJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19hZ2VuZGEnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJvYmouYWdlbmRhX0FnZW5kYV9JdGVtczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWdlbmRhX0FnZW5kYV9JdGVtcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zKSkgdGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQWdlbmRhX0l0ZW0oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfYWdlbmRhJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX2FnZW5kYSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfQWdlbmRhLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlIiwibmFtZSI6InNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTWVldGluZ19NaW51dGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5tZWV0aW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVldGluZyA9IHY7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmc7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRtZWV0aW5nOiBvYmouZ2V0VmFsdWUoXCJtZWV0aW5nXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVldGluZyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfTWludXRlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1lZXRpbmcgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdFx0aWYgKHJldC5tZWV0aW5nKSB7XG5cdFx0XHRcdHJldC5tZWV0aW5nID0gcmV0Lm1lZXRpbmcuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubWVldGluZykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWVldGluZykubGVuZ3RoKSByZXQubWVldGluZyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lZXRpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVldGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nIE1pbnV0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJtZWV0aW5nIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiICsgXCJtZWV0aW5nW21lZXRpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVldGluZygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZWV0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZWV0aW5nJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZ19NaW51dGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19taW51dGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfbWludXRlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX21pbnV0ZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYyBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWNcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGFyZW50ID0gdjtcblx0XHRcdHRoaXMuX3BhcmVudF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmRlZmluaXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVmaW5pdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5wYXJlbnRfRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwYXJlbnRfRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wYXJlbnRfRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wYXJlbnRfRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudF9GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnBhcmVudF9GbG93X0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9GbG93X0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9GbG93X0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X0Zsb3dfSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwYXJlbnRfQWN0aW9uX0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9BY3Rpb25fSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcGFyZW50X0FjdGlvbl9JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudF9BY3Rpb25fSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbG9naWNfRmxvd19JbnB1dF9TY3JpcHRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbG9naWNfRmxvd19JbnB1dF9TY3JpcHRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9sb2dpY19GbG93X0lucHV0X1NjcmlwdHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGFyZW50KSByZXQgKz0gLyoodGhpcy5fcGFyZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGFyZW50KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3BhcmVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHRpZiAodGhpcy5fZGVmaW5pdGlvbikgcmV0ICs9IC8qKHRoaXMuX2RlZmluaXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZWZpbml0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlZmluaXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYmxvY2spIHJldCArPSAvKih0aGlzLl9ibG9ja19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJsb2NrKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Jsb2NrLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0aGlzLnBhcmVudF9GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19Mb2dpYy5wYXJlbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnBhcmVudF9GbG93X0luc3RhbmNlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnN0YW5jZS5wYXJlbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5zdGFuY2UucGFyZW50LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5wdXRfU2NyaXB0LmxvZ2ljLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cGFyZW50OiBvYmouZ2V0VmFsdWUoXCJwYXJlbnRcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0ZGVmaW5pdGlvbjogb2JqLmdldFZhbHVlKFwiZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wYXJlbnQobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGVmaW5pdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudF9GbG93X0xvZ2ljcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBhcmVudF9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnBhcmVudF9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucGFyZW50X0Zsb3dfSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfTG9naWNcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGFyZW50ID0gdGhpcy5wYXJlbnQoKTtcblxuXHRcdFx0aWYgKHJldC5wYXJlbnQpIHtcblx0XHRcdFx0cmV0LnBhcmVudCA9IHJldC5wYXJlbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucGFyZW50KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wYXJlbnQpLmxlbmd0aCkgcmV0LnBhcmVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlZmluaXRpb24gPSB0aGlzLmRlZmluaXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5kZWZpbml0aW9uKSB7XG5cdFx0XHRcdHJldC5kZWZpbml0aW9uID0gcmV0LmRlZmluaXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZGVmaW5pdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVmaW5pdGlvbikubGVuZ3RoKSByZXQuZGVmaW5pdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5ibG9jayA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHJldC5ibG9jaykge1xuXHRcdFx0XHRyZXQuYmxvY2sgPSByZXQuYmxvY2suX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYmxvY2spID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJsb2NrKS5sZW5ndGgpIHJldC5ibG9jayA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudF9GbG93X0xvZ2ljcyA9IHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50X0Zsb3dfSW5zdGFuY2VzID0gdGhpcy5wYXJlbnRfRmxvd19JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzID0gdGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cyA9IHRoaXMubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwYXJlbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wYXJlbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGFyZW50KHRoaXMucGFyZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWZpbml0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVmaW5pdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uKHRoaXMuZGVmaW5pdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWMnLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpYyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2xvZ2ljJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwYXJlbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBMb2dpY1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kZWZpbml0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgTG9naWNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJkZWZpbml0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIgKyBcImRlZmluaXRpb25bZGVmaW5pdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWZpbml0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RlZmluaXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlZmluaXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVmaW5pdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYmxvY2soKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYmxvY2tbYmxvY2tdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2soKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYmxvY2snKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdibG9jaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IExvZ2ljXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWMnLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpYyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfbG9naWMnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucGFyZW50X0Zsb3dfTG9naWNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBhcmVudF9GbG93X0xvZ2ljcykpIHRoaXMucGFyZW50X0Zsb3dfTG9naWNzKG9iai5wYXJlbnRfRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuX3NhdmUoKTogXCIgKyBcIm9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9GbG93X0luc3RhbmNlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wYXJlbnRfRmxvd19JbnN0YW5jZXMpKSB0aGlzLnBhcmVudF9GbG93X0luc3RhbmNlcyhvYmoucGFyZW50X0Zsb3dfSW5zdGFuY2VzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLl9zYXZlKCk6IFwiICsgXCJvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBhcmVudF9BY3Rpb25fSW5zdGFuY2VzKSkgdGhpcy5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhvYmoucGFyZW50X0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5fc2F2ZSgpOiBcIiArIFwib2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmxvZ2ljX0Zsb3dfSW5wdXRfU2NyaXB0cykpIHRoaXMubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKG9iai5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXRfU2NyaXB0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0xvZ2ljLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19Mb2dpYy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19Mb2dpYy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X2xvZ2ljJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpYycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfTG9naWMuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfTG9naWMuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0xvZ2ljLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfUGxhblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19QbGFuLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1BsYW4uc25hcHNob3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc25hcHNob3QgPSB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3Q7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfUGxhbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zbmFwc2hvdChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZsb3dfUGxhblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19zdWJmbG93X3BsYW4nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFBsYW5cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1BsYW4uX3F1ZXJ5KCk6IFwiKyBcInNuYXBzaG90IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19QbGFuLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19QbGFuLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N1YmZsb3dfcGxhbicsIFsnKiddKVsnc3lzX2Zsb3dfc3ViZmxvd19wbGFuJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfUGxhbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfUGxhbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1BsYW4uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUiLCJuYW1lIjoic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnBlcnNvbkRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBlcnNvbkRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGVyc29uRGF5ID0gdjtcblx0XHRcdHRoaXMuX3BlcnNvbkRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wZXJzb25EYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmVmZm9ydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVmZm9ydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWZmb3J0ID0gdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGVyc29uRGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncGVyc29uRGF5JyArICh0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPScpICsgdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdGlmICh0aGlzLl9lZmZvcnQpIHJldCArPSAvKih0aGlzLl9lZmZvcnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lZmZvcnQoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWZmb3J0LicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlcXVpcmVtZW50KSByZXQgKz0gLyoodGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZXF1aXJlbWVudCgpLl90b0VRdWVyeShzUGF0aCArICdyZXF1aXJlbWVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBlcnNvbkRheTogb2JqLmdldFZhbHVlKFwicGVyc29uRGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRlZmZvcnQ6IG9iai5nZXRWYWx1ZShcImVmZm9ydFwiKSxcblxuXHRcdFx0XHRcdFx0cmVxdWlyZW1lbnQ6IG9iai5nZXRWYWx1ZShcInJlcXVpcmVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRyb2xlOiBvYmouZ2V0VmFsdWUoXCJyb2xlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBlcnNvbkRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGVyc29uRGF5KG9iai5wZXJzb25EYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWZmb3J0KG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvYmouZWZmb3J0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlcXVpcmVtZW50KG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJvbGUobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJFZmZvcnRfRXN0aW1hdGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBlcnNvbkRheSA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWZmb3J0ID0gdGhpcy5lZmZvcnQoKTtcblxuXHRcdFx0aWYgKHJldC5lZmZvcnQpIHtcblx0XHRcdFx0cmV0LmVmZm9ydCA9IHJldC5lZmZvcnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZWZmb3J0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5lZmZvcnQpLmxlbmd0aCkgcmV0LmVmZm9ydCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHJldC5yZXF1aXJlbWVudCkge1xuXHRcdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJvbGUgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHJldC5yb2xlKSB7XG5cdFx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucm9sZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucm9sZSkubGVuZ3RoKSByZXQucm9sZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGVyc29uRGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGVyc29uRGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBlcnNvbkRheSh0aGlzLnBlcnNvbkRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVmZm9ydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVmZm9ydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnQodGhpcy5lZmZvcnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVxdWlyZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXF1aXJlbWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudCh0aGlzLnJlcXVpcmVtZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJvbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yb2xlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGUodGhpcy5yb2xlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcGVyc29uRGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcGVyc29uRGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwZXJzb25kYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGVyc29uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdwZXJzb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncGVyc29uZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VmZm9ydF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVmZm9ydCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwiZWZmb3J0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwiZWZmb3J0W2VmZm9ydF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5lZmZvcnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZWZmb3J0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VmZm9ydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWZmb3J0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VmZm9ydCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJFZmZvcnQgRXN0aW1hdGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInJlcXVpcmVtZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwicmVxdWlyZW1lbnRbcmVxdWlyZW1lbnRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVxdWlyZW1lbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVxdWlyZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVxdWlyZW1lbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlcXVpcmVtZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yb2xlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucm9sZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVmZm9ydCBFc3RpbWF0ZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwicm9sZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIgKyBcInJvbGVbcm9sZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yb2xlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JvbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyb2xlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydF9lc3RpbWF0ZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0X2VzdGltYXRlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnRfRXN0aW1hdGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19NZWV0aW5nIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfTWVldGluZyIsIm5hbWUiOiJzaHNfYXJiZndfTWVldGluZyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19NZWV0aW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuc3RhcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLnN0YXJ0KCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fc3RhcnQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5lbmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0YXJ0ZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuc3RhcnRlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3N0YXJ0ZWQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdGFydGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZW5kZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmRlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLmVuZGVkKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZW5kZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5kZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zZXJpZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzZXJpZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NlcmllcyA9IHY7XG5cdFx0XHR0aGlzLl9zZXJpZXNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VyaWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcub3JnYW5pemVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JnYW5pemVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmdhbml6ZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JnYW5pemVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1vZGVyYXRvciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9kZXJhdG9yID0gdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2RlcmF0b3I7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5wcm9qZWN0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvamVjdCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5ib2FyZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ib2FyZCA9IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmRlY2lzaW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlY2lzaW9uID0gdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX0FnZW5kYXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfQWdlbmRhcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX0FnZW5kYXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfTWludXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX01pbnV0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3RhcnQnICsgKHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnQoKTtcblxuXHRcdGlmICh0aGlzLl9lbmQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmQnICsgKHRoaXMuX2VuZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuZCgpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0ZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydGVkJyArICh0aGlzLl9zdGFydGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kZWQnICsgKHRoaXMuX2VuZGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kZWQoKTtcblxuXHRcdGlmICh0aGlzLl9zZXJpZXMpIHJldCArPSAvKih0aGlzLl9zZXJpZXNfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zZXJpZXMoKS5fdG9FUXVlcnkoc1BhdGggKyAnc2VyaWVzLicpO1xuXG5cdFx0aWYgKHRoaXMuX29yZ2FuaXplcikgcmV0ICs9IC8qKHRoaXMuX29yZ2FuaXplcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9yZ2FuaXplcigpLl90b0VRdWVyeShzUGF0aCArICdvcmdhbml6ZXIuJyk7XG5cblx0XHRpZiAodGhpcy5fbW9kZXJhdG9yKSByZXQgKz0gLyoodGhpcy5fbW9kZXJhdG9yX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubW9kZXJhdG9yKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21vZGVyYXRvci4nKTtcblxuXHRcdGlmICh0aGlzLl9wcm9qZWN0KSByZXQgKz0gLyoodGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2plY3QoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvamVjdC4nKTtcblxuXHRcdGlmICh0aGlzLl9ib2FyZCkgcmV0ICs9IC8qKHRoaXMuX2JvYXJkX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYm9hcmQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYm9hcmQuJyk7XG5cblx0XHRpZiAodGhpcy5fZGVjaXNpb24pIHJldCArPSAvKih0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlY2lzaW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlY2lzaW9uLicpO1xuXG5cdFx0KHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmdfQWdlbmRhLm1lZXRpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nX01pbnV0ZS5tZWV0aW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydDogb2JqLmdldFZhbHVlKFwic3RhcnRcIiksXG5cblx0XHRcdFx0XHRcdGVuZDogb2JqLmdldFZhbHVlKFwiZW5kXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydGVkOiBvYmouZ2V0VmFsdWUoXCJzdGFydGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmRlZDogb2JqLmdldFZhbHVlKFwiZW5kZWRcIiksXG5cblx0XHRcdFx0XHRcdHNlcmllczogb2JqLmdldFZhbHVlKFwic2VyaWVzXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmdhbml6ZXI6IG9iai5nZXRWYWx1ZShcIm9yZ2FuaXplclwiKSxcblxuXHRcdFx0XHRcdFx0bW9kZXJhdG9yOiBvYmouZ2V0VmFsdWUoXCJtb2RlcmF0b3JcIiksXG5cblx0XHRcdFx0XHRcdHByb2plY3Q6IG9iai5nZXRWYWx1ZShcInByb2plY3RcIiksXG5cblx0XHRcdFx0XHRcdGJvYXJkOiBvYmouZ2V0VmFsdWUoXCJib2FyZFwiKSxcblxuXHRcdFx0XHRcdFx0ZGVjaXNpb246IG9iai5nZXRWYWx1ZShcImRlY2lzaW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RhcnQob2JqLnN0YXJ0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuZChvYmouZW5kKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGFydGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGFydGVkKG9iai5zdGFydGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5kZWQob2JqLmVuZGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNlcmllcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvYmouc2VyaWVzKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmdhbml6ZXIobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoub3JnYW5pemVyKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kZXJhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tb2RlcmF0b3IobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kZXJhdG9yKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucHJvamVjdChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai5wcm9qZWN0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBzaHNfYXJiZndfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWNpc2lvbihuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKG5ldyBzaHNfYXJiZndfTWVldGluZ19BZ2VuZGEoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcyhuZXcgc2hzX2FyYmZ3X01lZXRpbmdfTWludXRlKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJNZWV0aW5nXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RhcnQgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRcdGlmIChyZXQuc3RhcnQgJiYgdHlwZW9mKHJldC5zdGFydC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydCA9IHJldC5zdGFydC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmQgPSB0aGlzLmVuZCgpO1xuXG5cdFx0XHRpZiAocmV0LmVuZCAmJiB0eXBlb2YocmV0LmVuZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmQgPSByZXQuZW5kLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdGFydGVkID0gdGhpcy5zdGFydGVkKCk7XG5cblx0XHRcdGlmIChyZXQuc3RhcnRlZCAmJiB0eXBlb2YocmV0LnN0YXJ0ZWQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnRlZCA9IHJldC5zdGFydGVkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5kZWQgPSB0aGlzLmVuZGVkKCk7XG5cblx0XHRcdGlmIChyZXQuZW5kZWQgJiYgdHlwZW9mKHJldC5lbmRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5lbmRlZCA9IHJldC5lbmRlZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zZXJpZXMgPSB0aGlzLnNlcmllcygpO1xuXG5cdFx0XHRpZiAocmV0LnNlcmllcykge1xuXHRcdFx0XHRyZXQuc2VyaWVzID0gcmV0LnNlcmllcy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zZXJpZXMpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNlcmllcykubGVuZ3RoKSByZXQuc2VyaWVzID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JnYW5pemVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmdhbml6ZXIgPSB0aGlzLm9yZ2FuaXplcigpO1xuXG5cdFx0XHRpZiAocmV0Lm9yZ2FuaXplcikge1xuXHRcdFx0XHRyZXQub3JnYW5pemVyID0gcmV0Lm9yZ2FuaXplci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5vcmdhbml6ZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm9yZ2FuaXplcikubGVuZ3RoKSByZXQub3JnYW5pemVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kZXJhdG9yKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb2RlcmF0b3IgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1vZGVyYXRvcikge1xuXHRcdFx0XHRyZXQubW9kZXJhdG9yID0gcmV0Lm1vZGVyYXRvci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tb2RlcmF0b3IpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1vZGVyYXRvcikubGVuZ3RoKSByZXQubW9kZXJhdG9yID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJvamVjdCA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0XHRpZiAocmV0LnByb2plY3QpIHtcblx0XHRcdFx0cmV0LnByb2plY3QgPSByZXQucHJvamVjdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wcm9qZWN0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wcm9qZWN0KS5sZW5ndGgpIHJldC5wcm9qZWN0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJvYXJkID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAocmV0LmJvYXJkKSB7XG5cdFx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ib2FyZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYm9hcmQpLmxlbmd0aCkgcmV0LmJvYXJkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlY2lzaW9uID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRcdHJldC5kZWNpc2lvbiA9IHJldC5kZWNpc2lvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWNpc2lvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVjaXNpb24pLmxlbmd0aCkgcmV0LmRlY2lzaW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyA9IHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmdfTWVldGluZ19NaW51dGVzID0gdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXJ0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RhcnQodGhpcy5zdGFydCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmQodGhpcy5lbmQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhcnRlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydGVkKHRoaXMuc3RhcnRlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuZGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5kZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5kZWQodGhpcy5lbmRlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNlcmllc1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlcmllcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZXJpZXModGhpcy5zZXJpZXMoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JnYW5pemVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JnYW5pemVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcih0aGlzLm9yZ2FuaXplcigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb2RlcmF0b3JcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb2RlcmF0b3IoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZXJhdG9yKHRoaXMubW9kZXJhdG9yKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInByb2plY3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9qZWN0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnByb2plY3QodGhpcy5wcm9qZWN0KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJvYXJkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYm9hcmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYm9hcmQodGhpcy5ib2FyZCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZWNpc2lvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlY2lzaW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlY2lzaW9uKHRoaXMuZGVjaXNpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGFydF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN0YXJ0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0YXJ0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5kX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5kJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGFydGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGFydGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXJ0ZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuZGVkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmRlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5kZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2VyaWVzX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInNlcmllcyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJzZXJpZXNbc2VyaWVzXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNlcmllcygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzZXJpZXMnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NlcmllcycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2VyaWVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NlcmllcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmdhbml6ZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmdhbml6ZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwib3JnYW5pemVyIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcIm9yZ2FuaXplcltvcmdhbml6ZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3JnYW5pemVyKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZ2FuaXplcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JnYW5pemVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmdhbml6ZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JnYW5pemVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vZGVyYXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vZGVyYXRvcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJtb2RlcmF0b3IgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwibW9kZXJhdG9yW21vZGVyYXRvcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2RlcmF0b3IoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9kZXJhdG9yJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb2RlcmF0b3InKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vZGVyYXRvcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2RlcmF0b3InLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInByb2plY3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwicHJvamVjdFtwcm9qZWN0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnByb2plY3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncHJvamVjdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJib2FyZCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJib2FyZFtib2FyZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ib2FyZCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdib2FyZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2JvYXJkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2JvYXJkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJkZWNpc2lvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJkZWNpc2lvbltkZWNpc2lvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWNpc2lvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWNpc2lvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlY2lzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMpKSB0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmdfQWdlbmRhKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKSkgdGhpcy5tZWV0aW5nX01lZXRpbmdfTWludXRlcyhvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmcnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQucmVmZXJlbmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZWZlcmVuY2UgPSB2O1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuYWN0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3Rpb24gPSB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnRiMlJsYkY5cFpDSmRmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9JbnB1dC5Nb2RlbF9JRCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX0lEID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX0lucHV0Lk1vZGVsX1RhYmxlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX1RhYmxlKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfVGFibGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuQXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfQXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodGhpcy5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZhcmlhYmxlX1ZhbHVlLmFjdGlvbklucHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJBY3Rpb25fSW5wdXRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX0lEKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX0lEID0gdGhpcy5Nb2RlbF9JRCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX1RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX1RhYmxlID0gdGhpcy5Nb2RlbF9UYWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl9pbnB1dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWFuZGF0b3J5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInJlZmVyZW5jZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmbG93Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Zsb3cnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNuYXBzaG90KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIElucHV0XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIgKyBcInNuYXBzaG90W3NuYXBzaG90XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnNuYXBzaG90KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NuYXBzaG90JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImFjdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9hY3Rpb25faW5wdXQnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25faW5wdXQnLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX2lucHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbklucHV0X1ZhcmlhYmxlX1ZhbHVlcykpIHRoaXMuYWN0aW9uSW5wdXRfVmFyaWFibGVfVmFsdWVzKG9iai5hY3Rpb25JbnB1dF9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9JbnB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfYWN0aW9uX2lucHV0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX2lucHV0JywgWycqJ10pWydzeXNfaHViX2FjdGlvbl9pbnB1dCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fSW5wdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fSW5wdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX0lucHV0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Qub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5ibG9jayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ibG9jayA9IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9jaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19PdXRwdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfRmxvd19PdXRwdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19PdXRwdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9GbG93X091dHB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9GbG93X0luc3RhbmNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X0luc3RhbmNlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3RfQWN0aW9uX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdF9BY3Rpb25fSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3Quc25hcHNob3RfRmxvd19QbGFucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90X0Zsb3dfUGxhbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9GbG93X1BsYW5zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19QbGFuc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc25hcHNob3RfRmxvd19QbGFucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fYmxvY2spIHJldCArPSAvKih0aGlzLl9ibG9ja19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJsb2NrKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Jsb2NrLicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0lucHV0LnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfT3V0cHV0LnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19WYXJpYWJsZS5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfTG9naWMuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5wdXQuc25hcHNob3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfUGxhbi5zbmFwc2hvdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19EYXRhX1ZhcmlhYmxlLnNuYXBzaG90LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZnJvbUZsb3dcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5mcm9tRmxvdyhwYXlsb2FkW1wiZmxvd1wiXSwgKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdGJsb2NrOiBvYmouZ2V0VmFsdWUoXCJibG9ja1wiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2spICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJsb2NrKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2spKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfT3V0cHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfRmxvd19WYXJpYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdF9GbG93X1BsYW5zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc25hcHNob3RfRmxvd19QbGFucyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19QbGFuKCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3RfRmxvd19QbGFucykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1NuYXBzaG90XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdFx0cmV0LmJsb2NrID0gcmV0LmJsb2NrLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfSW5wdXRzID0gdGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfT3V0cHV0cyA9IHRoaXMuc25hcHNob3RfRmxvd19PdXRwdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcyA9IHRoaXMuc25hcHNob3RfRmxvd19WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0Zsb3dfTG9naWNzID0gdGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19JbnN0YW5jZXMgPSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdF9BY3Rpb25fSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90X0FjdGlvbl9JbnB1dHMgPSB0aGlzLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90X0Zsb3dfUGxhbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3RfRmxvd19QbGFucyA9IHRoaXMuc25hcHNob3RfRmxvd19QbGFucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3RfRmxvd19EYXRhX1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzID0gdGhpcy5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJsb2NrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYmxvY2soKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2sodGhpcy5ibG9jaygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfc25hcHNob3QnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBTbmFwc2hvdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgU25hcHNob3RcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYmxvY2snKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgU25hcHNob3RcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3NuYXBzaG90J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3NuYXBzaG90JywgWycqJ10pWydzeXNfaHViX2Zsb3dfc25hcHNob3QnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfRmxvd19JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfSW5wdXRzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0lucHV0cyhvYmouc25hcHNob3RfRmxvd19JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X091dHB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfT3V0cHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X091dHB1dHMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfT3V0cHV0cyhvYmouc25hcHNob3RfRmxvd19PdXRwdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X1ZhcmlhYmxlcykpIHRoaXMuc25hcHNob3RfRmxvd19WYXJpYWJsZXMob2JqLnNuYXBzaG90X0Zsb3dfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfRmxvd19Mb2dpY3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfTG9naWNzKSkgdGhpcy5zbmFwc2hvdF9GbG93X0xvZ2ljcyhvYmouc25hcHNob3RfRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfRmxvd19JbnN0YW5jZXMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfSW5zdGFuY2VzKG9iai5zbmFwc2hvdF9GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5fc2F2ZSgpOiBcIiArIFwib2JqLnNuYXBzaG90X0FjdGlvbl9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNuYXBzaG90X0FjdGlvbl9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cykpIHRoaXMuc25hcHNob3RfQWN0aW9uX0lucHV0cyhvYmouc25hcHNob3RfQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90Ll9zYXZlKCk6IFwiICsgXCJvYmouc25hcHNob3RfRmxvd19QbGFuczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc25hcHNob3RfRmxvd19QbGFucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zbmFwc2hvdF9GbG93X1BsYW5zKSkgdGhpcy5zbmFwc2hvdF9GbG93X1BsYW5zKG9iai5zbmFwc2hvdF9GbG93X1BsYW5zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1BsYW4oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuX3NhdmUoKTogXCIgKyBcIm9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zbmFwc2hvdF9GbG93X0RhdGFfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMpKSB0aGlzLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMob2JqLnNuYXBzaG90X0Zsb3dfRGF0YV9WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU25hcHNob3QuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU25hcHNob3QuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfZmxvd19zbmFwc2hvdCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfc25hcHNob3QnLCBbJyonXSlbJ3N5c19odWJfZmxvd19zbmFwc2hvdCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NuYXBzaG90LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyb21GbG93KF9fZXZlbnQsIGZsb3cpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0ZmxvdyA9IGV2SlNPTi5mbG93O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TbmFwc2hvdC5mcm9tRmxvdygpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSBldkpTT047XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NuYXBzaG90LmZyb21GbG93KCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5nZXRQYXJhbWV0ZXIpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihmbG93KSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRoaXMuZ2V0UGFyYW1ldGVyKCdmbG93JykpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRmbG93ID0gdGhpcy5nZXRQYXJhbWV0ZXIoJ2Zsb3cnKTtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0lucHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LmlucHV0X0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGlucHV0X0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2lucHV0X0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW5wdXRfRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Ll9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFtcImVsZW1lbnRcIiwgXCJtb2RlbF9pZFwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5sZW5ndGggRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bGVuZ3RoKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfbGVuZ3RoID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiAoe1xuXHRcdFx0XHRcdFx0XCJTdHJpbmdcIjogMjU1LFxuXHRcdFx0XHRcdFx0XCJUZXh0XCI6IDQwMDAsXG5cdFx0XHRcdFx0fSlbdGhpcy50eXBlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Lmxlbmd0aCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtDa2dQVDRnS0h0Y2JseDBYSFJjZEZ4MFhDSlRkSEpwYm1kY0lqb2dNalUxTEZ4dVhIUmNkRngwWEhSY0lsUmxlSFJjSWpvZ05EQXdNQ3hjYmx4MFhIUmNkSDBwVzNSb2FYTXVkSGx3WlNncFhTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuTW9kZWxfVGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9UYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0Lk1vZGVsX0lEIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdE1vZGVsX0lEKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfTW9kZWxfSUQgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5BdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdEF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9BdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LkF0dHJpYnV0ZXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NkbGJHVnRaVzUwWDIxaGNIQnBibWRmY0hKdmRtbGtaWEk5WTI5dExtZHNhV1JsTG1ac2IzZGZaR1Z6YVdkdUxtRmpkR2x2Ymk1a1lYUmhMa1pzYjNkRVpYTnBaMjVXWVhKcFlXSnNaVTFoY0hCbGNpeDFhVlI1Y0dVOUp5dDdlMTlmZlgwdWFXNTBaWEp1WVd4ZmRIbHdaU3NuTEhWcFZXNXBjWFZsU1dROUp5dDdlMTlmZlgwdVNXUXBQajRpTENKZlUyVnlkbWxqWlU1dmR5STZJanc4SjJWc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjajFqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUxIVnBWSGx3WlQwbkpudDdYMTk5ZlM1cGJuUmxjbTVoYkY5MGVYQmxKaWNzZFdsVmJtbHhkV1ZKWkQwbkpudDdYMTk5ZlM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlZmVyZW5jZSkgcmV0ICs9IC8qKHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJlZmVyZW5jZSgpLl90b0VRdWVyeShzUGF0aCArICdyZWZlcmVuY2UuJyk7XG5cblx0XHRpZiAodGhpcy5fZmxvdykgcmV0ICs9IC8qKHRoaXMuX2Zsb3dfY29vcCB8fCAnPScpICsgKi8gdGhpcy5mbG93KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2Zsb3cuJyk7XG5cblx0XHRpZiAodGhpcy5fc25hcHNob3QpIHJldCArPSAvKih0aGlzLl9zbmFwc2hvdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnNuYXBzaG90KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NuYXBzaG90LicpO1xuXG5cdFx0KHRoaXMuaW5wdXRfRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGaWVsZF9MYWJlbC5pbnB1dCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVmFyaWFibGVfVmFsdWUuZmxvd0lucHV0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmlucHV0X0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmlucHV0X0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5pbnB1dF9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzKG5ldyBzaHNfYXJiZndfYXBwZF9WYXJpYWJsZV9WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X0lucHV0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuaW5wdXRfRmllbGRfTGFiZWxzID0gdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcyA9IHRoaXMuZmxvd0lucHV0X1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfVGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfVGFibGUgPSB0aGlzLk1vZGVsX1RhYmxlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfSUQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfSUQgPSB0aGlzLk1vZGVsX0lEKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuQXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5BdHRyaWJ1dGVzID0gdGhpcy5BdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlZmVyZW5jZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlZmVyZW5jZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2UodGhpcy5yZWZlcmVuY2UoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZmxvd1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic25hcHNob3RcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfaW5wdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19pbnB1dCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2lucHV0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlZmVyZW5jZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIiArIFwicmVmZXJlbmNlW3JlZmVyZW5jZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZWZlcmVuY2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVmZXJlbmNlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBJbnB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcImZsb3cgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NuYXBzaG90JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2lucHV0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19pbnB1dCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2lucHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfaW5wdXQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0Ll9zYXZlKCk6IFwiICsgXCJvYmouaW5wdXRfRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5pbnB1dF9GaWVsZF9MYWJlbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouaW5wdXRfRmllbGRfTGFiZWxzKSkgdGhpcy5pbnB1dF9GaWVsZF9MYWJlbHMob2JqLmlucHV0X0ZpZWxkX0xhYmVscy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93SW5wdXRfVmFyaWFibGVfVmFsdWVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMob2JqLmZsb3dJbnB1dF9WYXJpYWJsZV9WYWx1ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1ZhcmlhYmxlX1ZhbHVlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0lucHV0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19JbnB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X2lucHV0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19pbnB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2lucHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfSW5wdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfSW5wdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0lucHV0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuZmxvdyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3codiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Zsb3cgPSB2O1xuXHRcdFx0dGhpcy5fZmxvd19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0Lm91dHB1dF9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvdXRwdXRfRmllbGRfTGFiZWxzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fb3V0cHV0X0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX291dHB1dF9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX291dHB1dF9GaWVsZF9MYWJlbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQubGVuZ3RoIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxlbmd0aCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2xlbmd0aCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gKHtcblx0XHRcdFx0XHRcdFwiU3RyaW5nXCI6IDI1NSxcblx0XHRcdFx0XHRcdFwiVGV4dFwiOiA0MDAwLFxuXHRcdFx0XHRcdH0pW3RoaXMudHlwZSgpXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuTW9kZWxfSUQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9JRCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuTW9kZWxfSUQoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2UzQndZWFJvZlgwdVgxOTBlWEJsUFQwbmMzbHpYM1poY21saFlteGxYM1poYkhWbEp5QW1KaUI3ZTE5ZmZYMHVjM1ZpWm14dmR5ay9lM3RmWDMxOUxuTjFZbVpzYjNjdVNXUTZlM3R3Y0dGMGFIMTlMa2xrS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBGc3FLbHRtYkc5M1gwWnNiM2RmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMlpzYjNkZlJteHZkMTlXWVhKcFlXSnNaWE5iYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFM1SlpDd2dLaXBiYzI1aGNITm9iM1JmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlQZFhSd2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXM051WVhCemFHOTBYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDJsa1BTZDdlMmxrZlgwblhWMHVTV1FzSUNvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYVjB1YzNWaVpteHZkeTVKWkN3Z0tpcGJZV04wYVc5dVgxWmhjbWxoWW14bFgxWmhiSFZsYzF0aFkzUnBiMjVKYm5CMWRGdHRiMlJsYkY5cFpEMG5lM3RwWkgxOUoxMWRYUzU3WENKSlpGd2lPaUJjSWw5bWUyZHpMbWx1Wm04b1gzUnZVM1J5YVc1bklDc2dKem9nUmtsS1UwOU9PaUFuSUNzZ1NsTlBUaTV6ZEhKcGJtZHBabmtvY21WbWN5NXRZVzU1VW1WbWN5a3BmVndpZlM1SlpGMWJNRjArUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuTW9kZWxfVGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9UYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuQXR0cmlidXRlcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfQXR0cmlidXRlcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICd0eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGaWVsZF9MYWJlbC5vdXRwdXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLm91dHB1dF9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X091dHB1dFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm91dHB1dF9GaWVsZF9MYWJlbHMgPSB0aGlzLm91dHB1dF9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX0lEKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX0lEID0gdGhpcy5Nb2RlbF9JRCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX1RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX1RhYmxlID0gdGhpcy5Nb2RlbF9UYWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19vdXRwdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19vdXRwdXQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd19vdXRwdXQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3R5cGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnR5cGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBPdXRwdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlZmVyZW5jZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZWZlcmVuY2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Zsb3dfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBPdXRwdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIiArIFwiZmxvd1tmbG93XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZsb3coKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZmxvdycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X091dHB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IE91dHB1dFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIisgXCJzbmFwc2hvdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X291dHB1dCcsIFsnKiddKVsnc3lzX2h1Yl9mbG93X291dHB1dCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X291dHB1dCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19vdXRwdXQnLCBbJyonXSlbJ3N5c19odWJfZmxvd19vdXRwdXQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0Ll9zYXZlKCk6IFwiICsgXCJvYmoub3V0cHV0X0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoub3V0cHV0X0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5vdXRwdXRfRmllbGRfTGFiZWxzKSkgdGhpcy5vdXRwdXRfRmllbGRfTGFiZWxzKG9iai5vdXRwdXRfRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19PdXRwdXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X091dHB1dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfT3V0cHV0LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X291dHB1dCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfb3V0cHV0JywgWycqJ10pWydzeXNfaHViX2Zsb3dfb3V0cHV0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfT3V0cHV0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19PdXRwdXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X091dHB1dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUubWFuZGF0b3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWFuZGF0b3J5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tYW5kYXRvcnkgPSB2O1xuXHRcdFx0dGhpcy5fbWFuZGF0b3J5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hbmRhdG9yeTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnJlZmVyZW5jZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVmZXJlbmNlID0gdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2U7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5zbmFwc2hvdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNuYXBzaG90KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zbmFwc2hvdCA9IHY7XG5cdFx0XHR0aGlzLl9zbmFwc2hvdF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zbmFwc2hvdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnZhcmlhYmxlX0ZpZWxkX0xhYmVscyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHZhcmlhYmxlX0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3ZhcmlhYmxlX0ZpZWxkX0xhYmVscyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3ZhcmlhYmxlX0ZpZWxkX0xhYmVsc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmFyaWFibGVfRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1wiZWxlbWVudFwiLCBcIm1vZGVsX2lkXCJdO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnRiMlJsYkY5cFpDSmRmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLmxlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUubGVuZ3RoKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdLSHRjYmx4MFhIUmNkRngwWENKVGRISnBibWRjSWpvZ01qVTFMRnh1WEhSY2RGeDBYSFJjSWxSbGVIUmNJam9nTkRBd01DeGNibHgwWEhSY2RIMHBXM1JvYVhNdWRIbHdaU2dwWFNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5Nb2RlbF9JRCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9JRCgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX0lEID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuTW9kZWxfVGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfVGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9UYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5Nb2RlbF9UYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2g3YzNselgyaDFZbDltYkc5M09pQW5jM2x6WDJoMVlsOW1iRzkzSnl3Z2MzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBPaUFuYzNselgyaDFZbDltYkc5M1gzTnVZWEJ6YUc5MEp5d2djM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOXpkV0pmWm14dmQxOXBibk4wWVc1alpUb2dKM041YzE5b2RXSmZabXh2ZDE5c2IyZHBZMTlsZUhSZmFXNXdkWFFuTENCemVYTmZhSFZpWDJGamRHbHZibDlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmR5ZDlLVnQ3ZTNCd1lYUm9mWDB1WDE5MGVYQmxYU2srUGlJc0lsOVRaWEoyYVdObFRtOTNJam9pUER3a1pYaHBjM1J6S0NvcVcyWnNiM2RmUm14dmQxOUpibkIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUdac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJtYkc5M1gwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNjbk9pZ2taWGhwYzNSektDb3FXM051WVhCemFHOTBYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhTQnZjaUJ6Ym1Gd2MyaHZkRjlHYkc5M1gwOTFkSEIxZEhOYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRJRzl5SUhOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYzI1aGNITm9iM1FuT2lna1pYaHBjM1J6S0NvcVcybHVjM1JoYm1ObFgwWnNiM2RmU1c1emRHRnVZMlZmU1c1d2RYUnpXMjF2WkdWc1gzUmhZbXhsUFNkN2UybGtmWDBuWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2RmYkc5bmFXTmZaWGgwWDJsdWNIVjBKem9vSkdWNGFYTjBjeWdxS2x0aFkzUnBiMjVmVm1GeWFXRmliR1ZmVm1Gc2RXVnpXMkZqZEdsdmJrbHVjSFYwVzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMWRJRzl5SUNvcVcybHVjM1JoYm1ObFgxWmhjbWxoWW14bFgxWmhiSFZsYzF0bWJHOTNTVzV3ZFhSYmJXOWtaV3hmZEdGaWJHVTlKM3Q3YVdSOWZTZGRYVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWNuS1NrcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLkF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX0F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuQXR0cmlidXRlcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLQ2RsYkdWdFpXNTBYMjFoY0hCcGJtZGZjSEp2ZG1sa1pYSTlZMjl0TG1kc2FXUmxMbVpzYjNkZlpHVnphV2R1TG1GamRHbHZiaTVrWVhSaExrWnNiM2RFWlhOcFoyNVdZWEpwWVdKc1pVMWhjSEJsY2l4MWFWUjVjR1U5Snl0N2UxOWZmWDB1YVc1MFpYSnVZV3hmZEhsd1pTc25MSFZwVlc1cGNYVmxTV1E5Snl0N2UxOWZmWDB1U1dRcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKMlZzWlcxbGJuUmZiV0Z3Y0dsdVoxOXdjbTkyYVdSbGNqMWpiMjB1WjJ4cFpHVXVabXh2ZDE5a1pYTnBaMjR1WVdOMGFXOXVMbVJoZEdFdVJteHZkMFJsYzJsbmJsWmhjbWxoWW14bFRXRndjR1Z5TEhWcFZIbHdaVDBuSm50N1gxOTlmUzVwYm5SbGNtNWhiRjkwZVhCbEppY3NkV2xWYm1seGRXVkpaRDBuSm50N1gxOTlmUzVKWkQ0K0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAnXicgKyBzUGF0aCArICd0eXBlJyArICh0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArIHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHRoaXMuX21hbmRhdG9yeSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21hbmRhdG9yeScgKyAodGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nKSArIHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRpZiAodGhpcy5fcmVmZXJlbmNlKSByZXQgKz0gLyoodGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVmZXJlbmNlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JlZmVyZW5jZS4nKTtcblxuXHRcdGlmICh0aGlzLl9mbG93KSByZXQgKz0gLyoodGhpcy5fZmxvd19jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZsb3coKS5fdG9FUXVlcnkoc1BhdGggKyAnZmxvdy4nKTtcblxuXHRcdGlmICh0aGlzLl9zbmFwc2hvdCkgcmV0ICs9IC8qKHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc25hcHNob3QoKS5fdG9FUXVlcnkoc1BhdGggKyAnc25hcHNob3QuJyk7XG5cblx0XHQodGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZpZWxkX0xhYmVsLnZhcmlhYmxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0bWFuZGF0b3J5OiBvYmouZ2V0VmFsdWUoXCJtYW5kYXRvcnlcIiksXG5cblx0XHRcdFx0XHRcdHJlZmVyZW5jZTogb2JqLmdldFZhbHVlKFwicmVmZXJlbmNlXCIpLFxuXG5cdFx0XHRcdFx0XHRmbG93OiBvYmouZ2V0VmFsdWUoXCJmbG93XCIpLFxuXG5cdFx0XHRcdFx0XHRzbmFwc2hvdDogb2JqLmdldFZhbHVlKFwic25hcHNob3RcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShvYmoudHlwZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tYW5kYXRvcnkob2JqLm1hbmRhdG9yeSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZWZlcmVuY2UobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZmxvdyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3cpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc25hcHNob3QobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fZnJvbURvY3VtZW50KG9iai5zbmFwc2hvdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnZhcmlhYmxlX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1ZhcmlhYmxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZmxvdykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZmxvdyA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAocmV0LmZsb3cpIHtcblx0XHRcdFx0cmV0LmZsb3cgPSByZXQuZmxvdy5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mbG93KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5mbG93KS5sZW5ndGgpIHJldC5mbG93ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNuYXBzaG90ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAocmV0LnNuYXBzaG90KSB7XG5cdFx0XHRcdHJldC5zbmFwc2hvdCA9IHJldC5zbmFwc2hvdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5zbmFwc2hvdCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc25hcHNob3QpLmxlbmd0aCkgcmV0LnNuYXBzaG90ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudmFyaWFibGVfRmllbGRfTGFiZWxzID0gdGhpcy52YXJpYWJsZV9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9fa2V5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5fX2tleXMgPSB0aGlzLl9fa2V5cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxlbmd0aCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sZW5ndGggPSB0aGlzLmxlbmd0aCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX0lEKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX0lEID0gdGhpcy5Nb2RlbF9JRCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLk1vZGVsX1RhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lk1vZGVsX1RhYmxlID0gdGhpcy5Nb2RlbF9UYWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLkF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuQXR0cmlidXRlcyA9IHRoaXMuQXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0eXBlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHlwZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlKHRoaXMudHlwZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1hbmRhdG9yeVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1hbmRhdG9yeSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYW5kYXRvcnkodGhpcy5tYW5kYXRvcnkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZsb3dcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mbG93KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3codGhpcy5mbG93KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNuYXBzaG90XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc25hcHNob3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc25hcHNob3QodGhpcy5zbmFwc2hvdCgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJywgWycqJ10pWydzeXNfaHViX2Zsb3dfdmFyaWFibGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19odWJfZmxvd192YXJpYWJsZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21hbmRhdG9yeScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZWZlcmVuY2UpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwicmVmZXJlbmNlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcInJlZmVyZW5jZVtyZWZlcmVuY2VdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVmZXJlbmNlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlZmVyZW5jZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgVmFyaWFibGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJmbG93IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Zsb3cnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZmxvdycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zbmFwc2hvdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NuYXBzaG90X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJGbG93IFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIiArIFwic25hcHNob3Rbc25hcHNob3RdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuc25hcHNob3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc25hcHNob3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NuYXBzaG90Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzbmFwc2hvdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfdmFyaWFibGUnLCBbJyonXSlbJ3N5c19odWJfZmxvd192YXJpYWJsZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX2Zsb3dfdmFyaWFibGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd192YXJpYWJsZScsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVsczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudmFyaWFibGVfRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnZhcmlhYmxlX0ZpZWxkX0xhYmVscykpIHRoaXMudmFyaWFibGVfRmllbGRfTGFiZWxzKG9iai52YXJpYWJsZV9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1ZhcmlhYmxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19WYXJpYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd192YXJpYWJsZScsIFsnKiddKVsnc3lzX2h1Yl9mbG93X3ZhcmlhYmxlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfVmFyaWFibGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1ZhcmlhYmxlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5tYW5kYXRvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYW5kYXRvcnkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21hbmRhdG9yeSA9IHY7XG5cdFx0XHR0aGlzLl9tYW5kYXRvcnlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWFuZGF0b3J5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLnNuYXBzaG90IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c25hcHNob3QodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NuYXBzaG90ID0gdjtcblx0XHRcdHRoaXMuX3NuYXBzaG90X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NuYXBzaG90O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibW9kZWxfaWRcIl07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJbVZzWlcxbGJuUWlMQ0p0YjJSbGJGOXBaQ0pkZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLmxlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfSUQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0TW9kZWxfSUQoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9Nb2RlbF9JRCA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLk1vZGVsX0lEKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDaDdlM0J3WVhSb2ZYMHVYMTkwZVhCbFBUMG5jM2x6WDNaaGNtbGhZbXhsWDNaaGJIVmxKeUFtSmlCN2UxOWZmWDB1YzNWaVpteHZkeWsvZTN0ZlgzMTlMbk4xWW1ac2IzY3VTV1E2ZTN0d2NHRjBhSDE5TGtsa0tUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQRnNxS2x0bWJHOTNYMFpzYjNkZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJac2IzZGZSbXh2ZDE5V1lYSnBZV0pzWlhOYmJXOWtaV3hmYVdROUozdDdhV1I5ZlNkZFhTNUpaQ3dnS2lwYmMyNWhjSE5vYjNSZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmFXUTlKM3Q3YVdSOWZTZGRYUzVKWkN3Z0tpcGJjMjVoY0hOb2IzUmZSbXh2ZDE5UGRYUndkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzNOdVlYQnphRzkwWDBac2IzZGZWbUZ5YVdGaWJHVnpXMjF2WkdWc1gybGtQU2Q3ZTJsa2ZYMG5YVjB1U1dRc0lDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYMmxrUFNkN2UybGtmWDBuWFYwdVNXUXNJQ29xVzJsdWMzUmhibU5sWDFaaGNtbGhZbXhsWDFaaGJIVmxjMXRtYkc5M1NXNXdkWFJiYlc5a1pXeGZhV1E5SjN0N2FXUjlmU2RkWFYwdWMzVmlabXh2ZHk1SlpDd2dLaXBiWVdOMGFXOXVYMVpoY21saFlteGxYMVpoYkhWbGMxdGhZM1JwYjI1SmJuQjFkRnR0YjJSbGJGOXBaRDBuZTN0cFpIMTlKMTFkWFM1N1hDSkpaRndpT2lCY0lsOW1lMmR6TG1sdVptOG9YM1J2VTNSeWFXNW5JQ3NnSnpvZ1JrbEtVMDlPT2lBbklDc2dTbE5QVGk1emRISnBibWRwWm5rb2NtVm1jeTV0WVc1NVVtVm1jeWtwZlZ3aWZTNUpaRjFiTUYwK1BpSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5Nb2RlbF9UYWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRNb2RlbF9UYWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX01vZGVsX1RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuTW9kZWxfVGFibGUoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0NoN2MzbHpYMmgxWWw5bWJHOTNPaUFuYzNselgyaDFZbDltYkc5M0p5d2djM2x6WDJoMVlsOW1iRzkzWDNOdVlYQnphRzkwT2lBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKeXdnYzNselgzWmhjbWxoWW14bFgzWmhiSFZsT2lBbmMzbHpYMmgxWWw5bWJHOTNKeXdnYzNselgyaDFZbDl6ZFdKZlpteHZkMTlwYm5OMFlXNWpaVG9nSjNONWMxOW9kV0pmWm14dmQxOXNiMmRwWTE5bGVIUmZhVzV3ZFhRbkxDQnplWE5mYUhWaVgyRmpkR2x2Ymw5cGJuTjBZVzVqWlRvZ0ozTjVjMTlvZFdKZlpteHZkeWQ5S1Z0N2UzQndZWFJvZlgwdVgxOTBlWEJsWFNrK1BpSXNJbDlUWlhKMmFXTmxUbTkzSWpvaVBEd2taWGhwYzNSektDb3FXMlpzYjNkZlJteHZkMTlKYm5CMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlHWnNiM2RmUm14dmQxOVBkWFJ3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCbWJHOTNYMFpzYjNkZlZtRnlhV0ZpYkdWelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjBwUHlkemVYTmZhSFZpWDJac2IzY25PaWdrWlhocGMzUnpLQ29xVzNOdVlYQnphRzkwWDBac2IzZGZTVzV3ZFhSelcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YU0J2Y2lCemJtRndjMmh2ZEY5R2JHOTNYMDkxZEhCMWRITmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkSUc5eUlITnVZWEJ6YUc5MFgwWnNiM2RmVm1GeWFXRmliR1Z6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmMyNWhjSE5vYjNRbk9pZ2taWGhwYzNSektDb3FXMmx1YzNSaGJtTmxYMFpzYjNkZlNXNXpkR0Z1WTJWZlNXNXdkWFJ6VzIxdlpHVnNYM1JoWW14bFBTZDdlMmxrZlgwblhWMHBQeWR6ZVhOZmFIVmlYMlpzYjNkZmJHOW5hV05mWlhoMFgybHVjSFYwSnpvb0pHVjRhWE4wY3lncUtsdGhZM1JwYjI1ZlZtRnlhV0ZpYkdWZlZtRnNkV1Z6VzJGamRHbHZia2x1Y0hWMFcyMXZaR1ZzWDNSaFlteGxQU2Q3ZTJsa2ZYMG5YVjFkSUc5eUlDb3FXMmx1YzNSaGJtTmxYMVpoY21saFlteGxYMVpoYkhWbGMxdG1iRzkzU1c1d2RYUmJiVzlrWld4ZmRHRmliR1U5SjN0N2FXUjlmU2RkWFYwcFB5ZHplWE5mYUhWaVgyWnNiM2NuT2ljbktTa3BQajRpZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhX1ZhcmlhYmxlLkF0dHJpYnV0ZXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0QXR0cmlidXRlcygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX0F0dHJpYnV0ZXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5BdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektDZGxiR1Z0Wlc1MFgyMWhjSEJwYm1kZmNISnZkbWxrWlhJOVkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaXgxYVZSNWNHVTlKeXQ3ZTE5ZmZYMHVhVzUwWlhKdVlXeGZkSGx3WlNzbkxIVnBWVzVwY1hWbFNXUTlKeXQ3ZTE5ZmZYMHVTV1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OEoyVnNaVzFsYm5SZmJXRndjR2x1WjE5d2NtOTJhV1JsY2oxamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlMSFZwVkhsd1pUMG5KbnQ3WDE5OWZTNXBiblJsY201aGJGOTBlWEJsSmljc2RXbFZibWx4ZFdWSlpEMG5KbnQ3WDE5OWZTNUpaRDQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R5cGUnICsgKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgdGhpcy50eXBlKCk7XG5cblx0XHRpZiAodGhpcy5fbWFuZGF0b3J5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbWFuZGF0b3J5JyArICh0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPScpICsgdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0aWYgKHRoaXMuX3NuYXBzaG90KSByZXQgKz0gLyoodGhpcy5fc25hcHNob3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zbmFwc2hvdCgpLl90b0VRdWVyeShzUGF0aCArICdzbmFwc2hvdC4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0cmVmZXJlbmNlOiBvYmouZ2V0VmFsdWUoXCJyZWZlcmVuY2VcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdHNuYXBzaG90OiBvYmouZ2V0VmFsdWUoXCJzbmFwc2hvdFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLnR5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmZsb3cobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5mbG93KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc25hcHNob3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNuYXBzaG90KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouc25hcHNob3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19EYXRhX1ZhcmlhYmxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1hbmRhdG9yeSA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UoKTtcblxuXHRcdFx0aWYgKHJldC5yZWZlcmVuY2UpIHtcblx0XHRcdFx0cmV0LnJlZmVyZW5jZSA9IHJldC5yZWZlcmVuY2UuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVmZXJlbmNlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5yZWZlcmVuY2UpLmxlbmd0aCkgcmV0LnJlZmVyZW5jZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZsb3cgPSB0aGlzLmZsb3coKTtcblxuXHRcdFx0aWYgKHJldC5mbG93KSB7XG5cdFx0XHRcdHJldC5mbG93ID0gcmV0LmZsb3cuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZmxvdykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZmxvdykubGVuZ3RoKSByZXQuZmxvdyA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zbmFwc2hvdCA9IHRoaXMuc25hcHNob3QoKTtcblxuXHRcdFx0aWYgKHJldC5zbmFwc2hvdCkge1xuXHRcdFx0XHRyZXQuc25hcHNob3QgPSByZXQuc25hcHNob3QuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuc25hcHNob3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNuYXBzaG90KS5sZW5ndGgpIHJldC5zbmFwc2hvdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfSUQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfSUQgPSB0aGlzLk1vZGVsX0lEKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuTW9kZWxfVGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuTW9kZWxfVGFibGUgPSB0aGlzLk1vZGVsX1RhYmxlKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuQXR0cmlidXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5BdHRyaWJ1dGVzID0gdGhpcy5BdHRyaWJ1dGVzKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zbmFwc2hvdCh0aGlzLnNuYXBzaG90KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHlwZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSh0aGlzLnR5cGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtYW5kYXRvcnlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tYW5kYXRvcnkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWFuZGF0b3J5KHRoaXMubWFuZGF0b3J5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVmZXJlbmNlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVmZXJlbmNlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZSh0aGlzLnJlZmVyZW5jZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzbmFwc2hvdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNuYXBzaG90KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNuYXBzaG90KHRoaXMuc25hcHNob3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfdmFyJywgWycqJ10pWydzeXNfZmxvd19kYXRhX3ZhciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2Zsb3dfZGF0YV92YXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHlwZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90eXBlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0eXBlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tYW5kYXRvcnkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tYW5kYXRvcnlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21hbmRhdG9yeScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21hbmRhdG9yeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtYW5kYXRvcnknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBEYXRhIFZhcmlhYmxlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgRGF0YSBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NuYXBzaG90KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc25hcHNob3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zbmFwc2hvdCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgRGF0YSBWYXJpYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fcXVlcnkoKTogXCIrIFwic25hcHNob3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiICsgXCJzbmFwc2hvdFtzbmFwc2hvdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zbmFwc2hvdCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzbmFwc2hvdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzbmFwc2hvdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc25hcHNob3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc25hcHNob3QnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhX1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2Zsb3dfZGF0YV92YXInKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhX1ZhcmlhYmxlLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfZGF0YV92YXInKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YV92YXInLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfdmFyJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YV9WYXJpYWJsZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGFfVmFyaWFibGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19SZXF1aXJlbWVudCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1JlcXVpcmVtZW50IiwibmFtZSI6InNoc19hcmJmd19SZXF1aXJlbWVudCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19SZXF1aXJlbWVudCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUmVxdWlyZW1lbnRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5wcm9qZWN0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvamVjdCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuY2FwYWJpbGl0eSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNhcGFiaWxpdHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NhcGFiaWxpdHkgPSB2O1xuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jYXBhYmlsaXR5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcHJvamVjdCkgcmV0ICs9IC8qKHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wcm9qZWN0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3Byb2plY3QuJyk7XG5cblx0XHRpZiAodGhpcy5fY2FwYWJpbGl0eSkgcmV0ICs9IC8qKHRoaXMuX2NhcGFiaWxpdHlfY29vcCB8fCAnPScpICsgKi8gdGhpcy5jYXBhYmlsaXR5KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2NhcGFiaWxpdHkuJyk7XG5cblx0XHQodGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllFZmZvcnRfRXN0aW1hdGUucmVxdWlyZW1lbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWdlbmRhX0l0ZW0ucmVxdWlyZW1lbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHByb2plY3Q6IG9iai5nZXRWYWx1ZShcInByb2plY3RcIiksXG5cblx0XHRcdFx0XHRcdGNhcGFiaWxpdHk6IG9iai5nZXRWYWx1ZShcImNhcGFiaWxpdHlcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wcm9qZWN0KG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3QpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jYXBhYmlsaXR5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jYXBhYmlsaXR5KG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLmNhcGFiaWxpdHkpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyhuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcyhuZXcgc2hzX2FyYmZ3X0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUmVxdWlyZW1lbnRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJvamVjdCA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0XHRpZiAocmV0LnByb2plY3QpIHtcblx0XHRcdFx0cmV0LnByb2plY3QgPSByZXQucHJvamVjdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wcm9qZWN0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wcm9qZWN0KS5sZW5ndGgpIHJldC5wcm9qZWN0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2FwYWJpbGl0eSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY2FwYWJpbGl0eSA9IHRoaXMuY2FwYWJpbGl0eSgpO1xuXG5cdFx0XHRpZiAocmV0LmNhcGFiaWxpdHkpIHtcblx0XHRcdFx0cmV0LmNhcGFiaWxpdHkgPSByZXQuY2FwYWJpbGl0eS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5jYXBhYmlsaXR5KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5jYXBhYmlsaXR5KS5sZW5ndGgpIHJldC5jYXBhYmlsaXR5ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMgPSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgPSB0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcm9qZWN0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucHJvamVjdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0KHRoaXMucHJvamVjdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjYXBhYmlsaXR5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY2FwYWJpbGl0eSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jYXBhYmlsaXR5KHRoaXMuY2FwYWJpbGl0eSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUmVxdWlyZW1lbnRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwicHJvamVjdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIiArIFwicHJvamVjdFtwcm9qZWN0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnByb2plY3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncHJvamVjdCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3Byb2plY3QnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2plY3QnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncHJvamVjdCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jYXBhYmlsaXR5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY2FwYWJpbGl0eV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNhcGFiaWxpdHkoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJSZXF1aXJlbWVudFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJjYXBhYmlsaXR5IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiICsgXCJjYXBhYmlsaXR5W2NhcGFiaWxpdHldIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY2FwYWJpbGl0eSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjYXBhYmlsaXR5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY2FwYWJpbGl0eScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY2FwYWJpbGl0eScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjYXBhYmlsaXR5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yZXF1aXJlbWVudCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKSkgdGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKG9iai5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0X0VzdGltYXRlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwib2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcykpIHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19BZ2VuZGFfSXRlbSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcmVxdWlyZW1lbnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JlcXVpcmVtZW50J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlciBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5jb2x1bW4gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2x1bW4odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbiA9IHY7XG5cdFx0XHR0aGlzLl9jb2x1bW5fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29sdW1uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLnN1YnNjcmlwdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YnNjcmlwdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uID0gdjtcblx0XHRcdHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uKSByZXQgKz0gLyoodGhpcy5fY29sdW1uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuY29sdW1uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2NvbHVtbi4nKTtcblxuXHRcdGlmICh0aGlzLl9zdWJzY3JpcHRpb24pIHJldCArPSAvKih0aGlzLl9zdWJzY3JpcHRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5zdWJzY3JpcHRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnc3Vic2NyaXB0aW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGNvbHVtbjogb2JqLmdldFZhbHVlKFwiY29sdW1uXCIpLFxuXG5cdFx0XHRcdFx0XHRzdWJzY3JpcHRpb246IG9iai5nZXRWYWx1ZShcInN1YnNjcmlwdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29sdW1uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2x1bW4obmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQob2JqLmNvbHVtbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YnNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3Vic2NyaXB0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnN1YnNjcmlwdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTdWJzY3JpcHRpb25fVHJpZ2dlclwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2x1bW4pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvbHVtbiA9IHRoaXMuY29sdW1uKCk7XG5cblx0XHRcdGlmIChyZXQuY29sdW1uKSB7XG5cdFx0XHRcdHJldC5jb2x1bW4gPSByZXQuY29sdW1uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmNvbHVtbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuY29sdW1uKS5sZW5ndGgpIHJldC5jb2x1bW4gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdWJzY3JpcHRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN1YnNjcmlwdGlvbiA9IHRoaXMuc3Vic2NyaXB0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuc3Vic2NyaXB0aW9uKSB7XG5cdFx0XHRcdHJldC5zdWJzY3JpcHRpb24gPSByZXQuc3Vic2NyaXB0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN1YnNjcmlwdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc3Vic2NyaXB0aW9uKS5sZW5ndGgpIHJldC5zdWJzY3JpcHRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2x1bW5cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2x1bW4oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29sdW1uKHRoaXMuY29sdW1uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN1YnNjcmlwdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN1YnNjcmlwdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdWJzY3JpcHRpb24odGhpcy5zdWJzY3JpcHRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJywgWycqJ10pWydTdWJzY3JpcHRpb25fVHJpZ2dlciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnU3Vic2NyaXB0aW9uX1RyaWdnZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvbHVtbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvbHVtbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvbHVtbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlN1YnNjcmlwdGlvbiBUcmlnZ2VyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcImNvbHVtbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIiArIFwiY29sdW1uW2NvbHVtbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5jb2x1bW4oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29sdW1uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29sdW1uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2x1bW4nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29sdW1uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1YnNjcmlwdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N1YnNjcmlwdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN1YnNjcmlwdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlN1YnNjcmlwdGlvbiBUcmlnZ2VyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3F1ZXJ5KCk6IFwiKyBcInN1YnNjcmlwdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIiArIFwic3Vic2NyaXB0aW9uW3N1YnNjcmlwdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zdWJzY3JpcHRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3Vic2NyaXB0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3Vic2NyaXB0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdWJzY3JpcHRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3Vic2NyaXB0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJywgWycqJ10pWydTdWJzY3JpcHRpb25fVHJpZ2dlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnU3Vic2NyaXB0aW9uX1RyaWdnZXInKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTdWJzY3JpcHRpb25fVHJpZ2dlcicsIFsnKiddKVsnU3Vic2NyaXB0aW9uX1RyaWdnZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFN1YnNjcmlwdGlvbl9UcmlnZ2VyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1N1YnNjcmlwdGlvbl9UcmlnZ2VyJywgWycqJ10pWydTdWJzY3JpcHRpb25fVHJpZ2dlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTdWJzY3JpcHRpb25fVHJpZ2dlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlN1YnNjcmlwdGlvbl9UcmlnZ2VyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU3Vic2NyaXB0aW9uX1RyaWdnZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmciLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfU2V0dGluZy5mbG93IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvdyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZmxvdyA9IHY7XG5cdFx0XHR0aGlzLl9mbG93X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3c7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19TZXR0aW5nLnNvdXJjZVR5cGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c291cmNlVHlwZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3NvdXJjZVR5cGUgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwic3lzX2h1Yl9mbG93XCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zb3VyY2VUeXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNselgyaDFZbDltYkc5M0luMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Zsb3cpIHJldCArPSAvKih0aGlzLl9mbG93X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZmxvdygpLl90b0VRdWVyeShzUGF0aCArICdmbG93LicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGZsb3c6IG9iai5nZXRWYWx1ZShcImZsb3dcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mbG93KG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvdykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93X1NldHRpbmdcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mbG93KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mbG93ID0gdGhpcy5mbG93KCk7XG5cblx0XHRcdGlmIChyZXQuZmxvdykge1xuXHRcdFx0XHRyZXQuZmxvdyA9IHJldC5mbG93Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZsb3cpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZsb3cpLmxlbmd0aCkgcmV0LmZsb3cgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNvdXJjZVR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc291cmNlVHlwZSA9IHRoaXMuc291cmNlVHlwZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZsb3coKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvdyh0aGlzLmZsb3coKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmbG93XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZmxvdygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93KHRoaXMuZmxvdygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZXhlY3V0aW9uX3NldHRpbmcnLCBbJyonXSlbJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Zsb3cpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9mbG93X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZmxvdygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3cgU2V0dGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwiZmxvdyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIgKyBcImZsb3dbZmxvd10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mbG93KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2Zsb3cnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZmxvdycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmbG93JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TZXR0aW5nKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU2V0dGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfU2V0dGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2V4ZWN1dGlvbl9zZXR0aW5nJywgWycqJ10pWydzeXNfZmxvd19leGVjdXRpb25fc2V0dGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X1NldHRpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X1NldHRpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19TZXR0aW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0Zsb3ciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0Zsb3ciLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvdyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0Zsb3cgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9GbG93XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmJsb2NrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2sodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Jsb2NrID0gdjtcblx0XHRcdHRoaXMuX2Jsb2NrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc2VjdXJpdHlDb250cm9sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VjdXJpdHlDb250cm9sKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZWN1cml0eUNvbnRyb2wgPSB2O1xuXHRcdFx0dGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlY3VyaXR5Q29udHJvbDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0Zsb3dfSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfRmxvd19JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfT3V0cHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19PdXRwdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X091dHB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfT3V0cHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X091dHB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0Zsb3dfVmFyaWFibGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Zmxvd19GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mbG93X0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfTG9naWNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnN1YmZsb3dfRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdWJmbG93X0Zsb3dfSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc3ViZmxvd19GbG93X0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1YmZsb3dfRmxvd19JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5mbG93X0FjdGlvbl9JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmbG93X0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9mbG93X0FjdGlvbl9JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zsb3dfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19TZXR0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TZXR0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19TZXR0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NldHRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuZmxvd19GbG93X1NuYXBzaG90cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19TbmFwc2hvdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mbG93X0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZmxvd19GbG93X1NuYXBzaG90c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X1NuYXBzaG90cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Zsb3dfRmxvd19EYXRhX1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmxvd19GbG93X0RhdGFfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuY2xpZW50Q2FsbGFibGUgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2xpZW50Q2FsbGFibGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9jbGllbnRDYWxsYWJsZSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5jbGllbnRDYWxsYWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeHpLSHQ3WDE5OWZTNWhZMnh6UHlkMGNuVmxKem9uWm1Gc2MyVW5LVDQrSWl3aVgxTmxjblpwWTJWT2IzY2lPaUk4UENSbGVHbHpkSE1vZTN0ZlgzMTlMbUZqYkhNcFBqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LnBvbGljeSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwb2xpY3koKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9wb2xpY3kgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cucG9saWN5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelB5ZHdjbTkwWldOMFpXUW5PaWNuS1Q0K0lpd2lYMU5sY25acFkyVk9iM2NpT2lJOFBDUmxlR2x6ZEhNb2UzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhNcFB5ZHdjbTkwWldOMFpXUW5PaWNuUGo0aWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc3RhdHVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXR1cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3N0YXR1cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdGF0dXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lQRHh6S0h0N1gxOTlmUzVtYkc5M1gwWnNiM2RmVTI1aGNITm9iM1J6UHlkd2RXSnNhWE5vWldRbk9pZGtjbUZtZENjcFBqNGlMQ0pmVTJWeWRtbGpaVTV2ZHlJNklqdzhKR1Y0YVhOMGN5aDdlMTlmZlgwdVpteHZkMTlHYkc5M1gxTnVZWEJ6YUc5MGN5ay9KM0IxWW14cGMyaGxaQ2M2SjJSeVlXWjBKejQrSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy50eXBlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl90eXBlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN1YmZsb3dcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy50eXBlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYzNWaVpteHZkeUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lmxhc3RTbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsYXN0U25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYXN0U25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubGFzdFNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSelAzdDdYMTk5ZlM1bWJHOTNYMFpzYjNkZlUyNWhjSE5vYjNSeld6QmRMa2xrT2ljbktUNCtJaXdpWDFObGNuWnBZMlZPYjNjaU9pSThQSHQ3WDE5OWZTNW1iRzkzWDBac2IzZGZVMjVoY0hOb2IzUnpXekJkTGtsa1BqNGlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93Lm1haW5TbmFwc2hvdCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYWluU25hcHNob3QoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9tYWluU25hcHNob3QgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cubWFpblNuYXBzaG90KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pUER4ektIdDdYMTk5ZlM1c1lYUmxjM1JmYzI1aGNITm9iM1FwUGo0aUxDSmZVMlZ5ZG1salpVNXZkeUk2SWp3OGUzdGZYMzE5TG1ac2IzZGZSbXh2ZDE5VGJtRndjMmh2ZEhOYk1GMHVTV1ErUGlKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5hdHRyaWJ1dGVzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGF0dHJpYnV0ZXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9hdHRyaWJ1dGVzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcImJyb3dzZXJBY3RpdmF0ZWRJbj1jaHJvbWUsaW50ZWdyYXRpb25BY3RpdmF0ZWRJbj1zdGFuZGFsb25lLGxhYmVsQ2FjaGVDbGVhblVwRXhlY3V0ZWQ9dHJ1ZSx0aW1lRnJvbUNyZWF0ZVRvQWN0aXZhdGU9Mzk3MDAwLHZpZXdBY3RpdmF0ZWRJbj1uYXR1cmFsTGFuZ3VhZ2VcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5hdHRyaWJ1dGVzKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pWW5KdmQzTmxja0ZqZEdsMllYUmxaRWx1UFdOb2NtOXRaU3hwYm5SbFozSmhkR2x2YmtGamRHbDJZWFJsWkVsdVBYTjBZVzVrWVd4dmJtVXNiR0ZpWld4RFlXTm9aVU5zWldGdVZYQkZlR1ZqZFhSbFpEMTBjblZsTEhScGJXVkdjbTl0UTNKbFlYUmxWRzlCWTNScGRtRjBaVDB6T1Rjd01EQXNkbWxsZDBGamRHbDJZWFJsWkVsdVBXNWhkSFZ5WVd4TVlXNW5kV0ZuWlNKOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5sYWJlbENhY2hlIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGxhYmVsQ2FjaGUoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sYWJlbENhY2hlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSAoKSA9PiBgPDwkYXBwZW5kKCRhcHBlbmQoKioucGFyZW50X0Zsb3dfSW5zdGFuY2VzW2xhYmVsX2NhY2hlPSd7e2lkfX0nXS57XCJuYW1lXCI6IHVpX2lkJlwiLlwiJnN1YmZsb3cuaW50ZXJuYWxfbmFtZSwgXCJyZWZlcmVuY2VfZGlzcGxheVwiOiAnJHt0aGlzLkVudGl0eUNsYXNzLk5hbWV9JywgXCJsYWJlbFwiOiBvcmRlciYnIC0gJyZzdWJmbG93Lm5hbWUmJ1xcdTI3OWInJnN1YmZsb3cubmFtZSwgXCJiYXNlX3R5cGVcIjogaW50ZXJuYWxfdHlwZSwgXCJ0eXBlXCI6IGludGVybmFsX3R5cGUsIFwiYXR0cmlidXRlc1wiOiB7XCJlbGVtZW50X21hcHBpbmdfcHJvdmlkZXJcIjogJ2NvbS5nbGlkZS5mbG93X2Rlc2lnbi5hY3Rpb24uZGF0YS5GbG93RGVzaWduVmFyaWFibGVNYXBwZXInLCBcInVpVHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInVpVW5pcXVlSWRcIjogSWR9fVskXSxcblxuJC5mbG93X0Zsb3dfVmFyaWFibGVzLntcIm5hbWVcIjogJ2Zsb3dfdmFyaWFibGUuJyZlbGVtZW50LCBcInJlZmVyZW5jZV9kaXNwbGF5XCI6ICdsYWJlbCdcbiwgXCJsYWJlbFwiOiAnRmxvdyBWYXJpYWJsZXNcXHUyNzliJyZlbGVtZW50LCBcImJhc2VfdHlwZVwiOiBpbnRlcm5hbF90eXBlLFxuXCJ0eXBlXCI6IGludGVybmFsX3R5cGUsIFwiYXR0cmlidXRlc1wiOiB7XG4gICAgXCJlbGVtZW50X21hcHBpbmdfcHJvdmlkZXJcIjogJ2NvbS5nbGlkZS5mbG93X2Rlc2lnbi5hY3Rpb24uZGF0YS5GbG93RGVzaWduVmFyaWFibGVNYXBwZXInLFxuICAgIFwidWlUeXBlXCI6IGludGVybmFsX3R5cGUsIFwidWlVbmlxdWVJZFwiOiBJZFxufVxufSlcbixcbiQuZmxvd19GbG93X0lucHV0cy57XCJuYW1lXCI6ICdzdWJmbG93LicmZWxlbWVudCwgXCJyZWZlcmVuY2VfZGlzcGxheVwiOiAnbGFiZWwnXG4sIFwibGFiZWxcIjogJ0lucHV0XFx1Mjc5YicmZWxlbWVudCwgXCJiYXNlX3R5cGVcIjogaW50ZXJuYWxfdHlwZSxcblwidHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcImF0dHJpYnV0ZXNcIjoge1xuICAgIFwiZWxlbWVudF9tYXBwaW5nX3Byb3ZpZGVyXCI6ICdjb20uZ2xpZGUuZmxvd19kZXNpZ24uYWN0aW9uLmRhdGEuRmxvd0Rlc2lnblZhcmlhYmxlTWFwcGVyJyxcbiAgICBcInVpVHlwZVwiOiBpbnRlcm5hbF90eXBlLCBcInVpVW5pcXVlSWRcIjogSWRcbn19KT4+YDtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5sYWJlbENhY2hlKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdZRHc4SkdGd2NHVnVaQ2drWVhCd1pXNWtLQ29xTG5CaGNtVnVkRjlHYkc5M1gwbHVjM1JoYm1ObGMxdHNZV0psYkY5allXTm9aVDBuZTN0cFpIMTlKMTB1ZTF3aWJtRnRaVndpT2lCMWFWOXBaQ1pjSWk1Y0lpWnpkV0ptYkc5M0xtbHVkR1Z5Ym1Gc1gyNWhiV1VzSUZ3aWNtVm1aWEpsYm1ObFgyUnBjM0JzWVhsY0lqb2dKMXhjSkh0MGFHbHpMa1Z1ZEdsMGVVTnNZWE56TGs1aGJXVjlKeXdnWENKc1lXSmxiRndpT2lCdmNtUmxjaVluSUMwZ0p5WnpkV0ptYkc5M0xtNWhiV1VtSjF4Y1hGeDFNamM1WWljbWMzVmlabXh2ZHk1dVlXMWxMQ0JjSW1KaGMyVmZkSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0luUjVjR1ZjSWpvZ2FXNTBaWEp1WVd4ZmRIbHdaU3dnWENKaGRIUnlhV0oxZEdWelhDSTZJSHRjSW1Wc1pXMWxiblJmYldGd2NHbHVaMTl3Y205MmFXUmxjbHdpT2lBblkyOXRMbWRzYVdSbExtWnNiM2RmWkdWemFXZHVMbUZqZEdsdmJpNWtZWFJoTGtac2IzZEVaWE5wWjI1V1lYSnBZV0pzWlUxaGNIQmxjaWNzSUZ3aWRXbFVlWEJsWENJNklHbHVkR1Z5Ym1Gc1gzUjVjR1VzSUZ3aWRXbFZibWx4ZFdWSlpGd2lPaUJKWkgxOVd5UmRMRnh1WEc0a0xtWnNiM2RmUm14dmQxOVdZWEpwWVdKc1pYTXVlMXdpYm1GdFpWd2lPaUFuWm14dmQxOTJZWEpwWVdKc1pTNG5KbVZzWlcxbGJuUXNJRndpY21WbVpYSmxibU5sWDJScGMzQnNZWGxjSWpvZ0oyeGhZbVZzSjF4dUxDQmNJbXhoWW1Wc1hDSTZJQ2RHYkc5M0lGWmhjbWxoWW14bGMxeGNYRngxTWpjNVlpY21aV3hsYldWdWRDd2dYQ0ppWVhObFgzUjVjR1ZjSWpvZ2FXNTBaWEp1WVd4ZmRIbHdaU3hjYmx3aWRIbHdaVndpT2lCcGJuUmxjbTVoYkY5MGVYQmxMQ0JjSW1GMGRISnBZblYwWlhOY0lqb2dlMXh1SUNBZ0lGd2laV3hsYldWdWRGOXRZWEJ3YVc1blgzQnliM1pwWkdWeVhDSTZJQ2RqYjIwdVoyeHBaR1V1Wm14dmQxOWtaWE5wWjI0dVlXTjBhVzl1TG1SaGRHRXVSbXh2ZDBSbGMybG5ibFpoY21saFlteGxUV0Z3Y0dWeUp5eGNiaUFnSUNCY0luVnBWSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0luVnBWVzVwY1hWbFNXUmNJam9nU1dSY2JuMWNibjBwWEc0c1hHNGtMbVpzYjNkZlJteHZkMTlKYm5CMWRITXVlMXdpYm1GdFpWd2lPaUFuYzNWaVpteHZkeTRuSm1Wc1pXMWxiblFzSUZ3aWNtVm1aWEpsYm1ObFgyUnBjM0JzWVhsY0lqb2dKMnhoWW1Wc0oxeHVMQ0JjSW14aFltVnNYQ0k2SUNkSmJuQjFkRnhjWEZ4MU1qYzVZaWNtWld4bGJXVnVkQ3dnWENKaVlYTmxYM1I1Y0dWY0lqb2dhVzUwWlhKdVlXeGZkSGx3WlN4Y2Jsd2lkSGx3WlZ3aU9pQnBiblJsY201aGJGOTBlWEJsTENCY0ltRjBkSEpwWW5WMFpYTmNJam9nZTF4dUlDQWdJRndpWld4bGJXVnVkRjl0WVhCd2FXNW5YM0J5YjNacFpHVnlYQ0k2SUNkamIyMHVaMnhwWkdVdVpteHZkMTlrWlhOcFoyNHVZV04wYVc5dUxtUmhkR0V1Um14dmQwUmxjMmxuYmxaaGNtbGhZbXhsVFdGd2NHVnlKeXhjYmlBZ0lDQmNJblZwVkhsd1pWd2lPaUJwYm5SbGNtNWhiRjkwZVhCbExDQmNJblZwVlc1cGNYVmxTV1JjSWpvZ1NXUmNibjE5S1Q0K1lDSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHRpZiAodGhpcy5fc2VjdXJpdHlDb250cm9sKSByZXQgKz0gLyoodGhpcy5fc2VjdXJpdHlDb250cm9sX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2VjdXJpdHlDb250cm9sKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3NlY3VyaXR5Q29udHJvbC4nKTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5wdXQuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfT3V0cHV0LmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfVmFyaWFibGUuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19Mb2dpYy5mbG93LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlLnN1YmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX0lucHV0LmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19TZXR0aW5nLmZsb3csPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfU25hcHNob3QuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0RhdGFfVmFyaWFibGUuZmxvdyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0YmxvY2s6IG9iai5nZXRWYWx1ZShcImJsb2NrXCIpLFxuXG5cdFx0XHRcdFx0XHRzZWN1cml0eUNvbnRyb2w6IG9iai5nZXRWYWx1ZShcInNlY3VyaXR5Q29udHJvbFwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYmxvY2sobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fZnJvbURvY3VtZW50KG9iai5ibG9jaykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNlY3VyaXR5Q29udHJvbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2VjdXJpdHlDb250cm9sKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmouc2VjdXJpdHlDb250cm9sKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfT3V0cHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X091dHB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19PdXRwdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0Zsb3dfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X1ZhcmlhYmxlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfRmxvd19WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfTG9naWNzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3ViZmxvd19GbG93X0luc3RhbmNlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fZnJvbURvY3VtZW50KG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5mbG93X0FjdGlvbl9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLmZsb3dfQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X1NldHRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X1NldHRpbmdzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfU2V0dGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NuYXBzaG90KCkuX2Zyb21Eb2N1bWVudChvYmouZmxvd19GbG93X1NuYXBzaG90cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGbG93XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdFx0cmV0LmJsb2NrID0gcmV0LmJsb2NrLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZWN1cml0eUNvbnRyb2wpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNlY3VyaXR5Q29udHJvbCA9IHRoaXMuc2VjdXJpdHlDb250cm9sKCk7XG5cblx0XHRcdGlmIChyZXQuc2VjdXJpdHlDb250cm9sKSB7XG5cdFx0XHRcdHJldC5zZWN1cml0eUNvbnRyb2wgPSByZXQuc2VjdXJpdHlDb250cm9sLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNlY3VyaXR5Q29udHJvbCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc2VjdXJpdHlDb250cm9sKS5sZW5ndGgpIHJldC5zZWN1cml0eUNvbnRyb2wgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0lucHV0cyA9IHRoaXMuZmxvd19GbG93X0lucHV0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X091dHB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X091dHB1dHMgPSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZsb3dfRmxvd19WYXJpYWJsZXMgPSB0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19Mb2dpY3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0xvZ2ljcyA9IHRoaXMuZmxvd19GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc3ViZmxvd19GbG93X0luc3RhbmNlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzID0gdGhpcy5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0FjdGlvbl9JbnB1dHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19BY3Rpb25fSW5wdXRzID0gdGhpcy5mbG93X0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfU2V0dGluZ3MgPSB0aGlzLmZsb3dfRmxvd19TZXR0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZmxvd19GbG93X1NuYXBzaG90cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mbG93X0Zsb3dfU25hcHNob3RzID0gdGhpcy5mbG93X0Zsb3dfU25hcHNob3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZmxvd19GbG93X0RhdGFfVmFyaWFibGVzID0gdGhpcy5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNsaWVudENhbGxhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNsaWVudENhbGxhYmxlID0gdGhpcy5jbGllbnRDYWxsYWJsZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBvbGljeSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wb2xpY3kgPSB0aGlzLnBvbGljeSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnN0YXR1cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGF0dXMgPSB0aGlzLnN0YXR1cygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnR5cGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxhc3RTbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5sYXN0U25hcHNob3QgPSB0aGlzLmxhc3RTbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1haW5TbmFwc2hvdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tYWluU25hcHNob3QgPSB0aGlzLm1haW5TbmFwc2hvdCgpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmF0dHJpYnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlcygpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmxhYmVsQ2FjaGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubGFiZWxDYWNoZSA9IHRoaXMubGFiZWxDYWNoZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJsb2NrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYmxvY2soKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYmxvY2sodGhpcy5ibG9jaygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzZWN1cml0eUNvbnRyb2xcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zZWN1cml0eUNvbnRyb2woKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2VjdXJpdHlDb250cm9sKHRoaXMuc2VjdXJpdHlDb250cm9sKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJibG9jayBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYmxvY2snKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Jsb2NrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Jsb2NrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlY3VyaXR5Q29udHJvbCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NlY3VyaXR5Q29udHJvbF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNlY3VyaXR5Q29udHJvbCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZsb3dcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIisgXCJzZWN1cml0eUNvbnRyb2wgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9xdWVyeSgpOiBcIiArIFwic2VjdXJpdHlDb250cm9sW3NlY3VyaXR5Q29udHJvbF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zZWN1cml0eUNvbnRyb2woKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2VjdXJpdHljb250cm9sJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzZWN1cml0eWNvbnRyb2wnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NlY3VyaXR5Y29udHJvbCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzZWN1cml0eWNvbnRyb2wnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93Jyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvdy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3cnLCBbJyonXSlbJ3N5c19odWJfZmxvdyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfSW5wdXRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19JbnB1dHMpKSB0aGlzLmZsb3dfRmxvd19JbnB1dHMob2JqLmZsb3dfRmxvd19JbnB1dHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfT3V0cHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZmxvd19GbG93X091dHB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZmxvd19GbG93X091dHB1dHMpKSB0aGlzLmZsb3dfRmxvd19PdXRwdXRzKG9iai5mbG93X0Zsb3dfT3V0cHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19WYXJpYWJsZXMpKSB0aGlzLmZsb3dfRmxvd19WYXJpYWJsZXMob2JqLmZsb3dfRmxvd19WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfVmFyaWFibGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfTG9naWNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfTG9naWNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19Mb2dpY3MpKSB0aGlzLmZsb3dfRmxvd19Mb2dpY3Mob2JqLmZsb3dfRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5zdWJmbG93X0Zsb3dfSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMpKSB0aGlzLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMob2JqLnN1YmZsb3dfRmxvd19JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2UoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0FjdGlvbl9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0FjdGlvbl9JbnB1dHMpKSB0aGlzLmZsb3dfQWN0aW9uX0lucHV0cyhvYmouZmxvd19BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfU2V0dGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19TZXR0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfU2V0dGluZ3MpKSB0aGlzLmZsb3dfRmxvd19TZXR0aW5ncyhvYmouZmxvd19GbG93X1NldHRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1NldHRpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfU25hcHNob3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mbG93X0Zsb3dfU25hcHNob3RzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMpKSB0aGlzLmZsb3dfRmxvd19TbmFwc2hvdHMob2JqLmZsb3dfRmxvd19TbmFwc2hvdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuX3NhdmUoKTogXCIgKyBcIm9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5mbG93X0Zsb3dfRGF0YV9WYXJpYWJsZXMpKSB0aGlzLmZsb3dfRmxvd19EYXRhX1ZhcmlhYmxlcyhvYmouZmxvd19GbG93X0RhdGFfVmFyaWFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3cuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3cnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93JywgWycqJ10pWydzeXNfaHViX2Zsb3cnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvdy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvdy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3cuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uc2NoZW1hIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2NoZW1hKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zY2hlbWEgPSB2O1xuXHRcdFx0dGhpcy5fc2NoZW1hX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NjaGVtYTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi50YWJsZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRhYmxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90YWJsZSA9IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5wcm9maWxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvZmlsZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvZmlsZSA9IHY7XG5cdFx0XHR0aGlzLl9wcm9maWxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2ZpbGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uYXBwbGljYXRpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYXBwbGljYXRpb24gPSB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9zY2hlbWEpIHJldCArPSAnXicgKyBzUGF0aCArICdzY2hlbWEnICsgKHRoaXMuX3NjaGVtYV9jb29wIHx8ICc9JykgKyB0aGlzLnNjaGVtYSgpO1xuXG5cdFx0aWYgKHRoaXMuX3RhYmxlKSByZXQgKz0gLyoodGhpcy5fdGFibGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50YWJsZSgpLl90b0VRdWVyeShzUGF0aCArICd0YWJsZS4nKTtcblxuXHRcdGlmICh0aGlzLl9wcm9maWxlKSByZXQgKz0gLyoodGhpcy5fcHJvZmlsZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2ZpbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvZmlsZS4nKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHQodGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTdWJzY3JpcHRpb25fVHJpZ2dlci5zdWJzY3JpcHRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzY2hlbWE6IG9iai5nZXRWYWx1ZShcInNjaGVtYVwiKSxcblxuXHRcdFx0XHRcdFx0dGFibGU6IG9iai5nZXRWYWx1ZShcInRhYmxlXCIpLFxuXG5cdFx0XHRcdFx0XHRwcm9maWxlOiBvYmouZ2V0VmFsdWUoXCJwcm9maWxlXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjaGVtYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc2NoZW1hKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmouc2NoZW1hKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNjaGVtYShvYmouc2NoZW1hKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudGFibGUobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoudGFibGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9maWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wcm9maWxlKG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoucHJvZmlsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zdWJzY3JpcHRpb25fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTYXZlX1N1YnNjcmlwdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY2hlbWEpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNjaGVtYSA9IHRoaXMuc2NoZW1hKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnNjaGVtYSkgPT09ICdvYmplY3QnKSByZXQuc2NoZW1hID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNjaGVtYSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90YWJsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGFibGUgPSB0aGlzLnRhYmxlKCk7XG5cblx0XHRcdGlmIChyZXQudGFibGUpIHtcblx0XHRcdFx0cmV0LnRhYmxlID0gcmV0LnRhYmxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRhYmxlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50YWJsZSkubGVuZ3RoKSByZXQudGFibGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9maWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9maWxlID0gdGhpcy5wcm9maWxlKCk7XG5cblx0XHRcdGlmIChyZXQucHJvZmlsZSkge1xuXHRcdFx0XHRyZXQucHJvZmlsZSA9IHJldC5wcm9maWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2ZpbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2ZpbGUpLmxlbmd0aCkgcmV0LnByb2ZpbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyA9IHRoaXMuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NoZW1hXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2NoZW1hKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjaGVtYSh0aGlzLnNjaGVtYSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRhYmxlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGUodGhpcy50YWJsZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcm9maWxlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucHJvZmlsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9maWxlKHRoaXMucHJvZmlsZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1NhdmVfU3Vic2NyaXB0aW9uJywgWycqJ10pWydTYXZlX1N1YnNjcmlwdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnU2F2ZV9TdWJzY3JpcHRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NjaGVtYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NjaGVtYV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9zY2hlbWFfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNjaGVtYSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2NoZW1hJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2NoZW1hJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY2hlbWEnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2NoZW1hJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGFibGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNhdmUgU3Vic2NyaXB0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRhYmxlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJ0YWJsZVt0YWJsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50YWJsZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0YWJsZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RhYmxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0YWJsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0YWJsZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9maWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcHJvZmlsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2ZpbGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTYXZlIFN1YnNjcmlwdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJwcm9maWxlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJwcm9maWxlW3Byb2ZpbGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucHJvZmlsZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9maWxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvZmlsZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvZmlsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9maWxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNhdmUgU3Vic2NyaXB0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdTYXZlX1N1YnNjcmlwdGlvbicsIFsnKiddKVsnU2F2ZV9TdWJzY3JpcHRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ1NhdmVfU3Vic2NyaXB0aW9uJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignU2F2ZV9TdWJzY3JpcHRpb24nLCBbJyonXSlbJ1NhdmVfU3Vic2NyaXB0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnN1YnNjcmlwdGlvbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycykpIHRoaXMuc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycyhvYmouc3Vic2NyaXB0aW9uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU3Vic2NyaXB0aW9uX1RyaWdnZXIoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNhdmVfU3Vic2NyaXB0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2F2ZV9TdWJzY3JpcHRpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTYXZlX1N1YnNjcmlwdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ1NhdmVfU3Vic2NyaXB0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ1NhdmVfU3Vic2NyaXB0aW9uJywgWycqJ10pWydTYXZlX1N1YnNjcmlwdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTYXZlX1N1YnNjcmlwdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNhdmVfU3Vic2NyaXB0aW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2F2ZV9TdWJzY3JpcHRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGFyZW50ID0gdjtcblx0XHRcdHRoaXMuX3BhcmVudF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmVsZW1lbnRNYXBwaW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWxlbWVudE1hcHBpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nID0gdjtcblx0XHRcdHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VsZW1lbnRNYXBwaW5nO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQudHJhbnNmb3JtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHJhbnNmb3JtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90cmFuc2Zvcm0gPSB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RyYW5zZm9ybTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLnBhcmVudF9QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBhcmVudF9QaWxsX0NvbXBvdW5kcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BhcmVudF9QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3BhcmVudF9QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50X1BpbGxfQ29tcG91bmRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuX19rZXlzIEVGOiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdF9fa2V5cygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX19fa2V5cyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gW1widWlfaWRcIiwgXCJhdHRhY2hlZF90b1wiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqcGJJblZwWDJsa0lpd2lZWFIwWVdOb1pXUmZkRzhpWFgwPWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5VSWQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0VUlkKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfVUlkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLlVJZCgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEeDdlMTlmZlgwdVNXUStQaUo5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmF0dGFjaGVkVG8gRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXR0YWNoZWRUbygpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX2F0dGFjaGVkVG8gPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuYXR0YWNoZWRUbygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaVBEd3FLa0FrWmx0ZlgzUjVjR1VnYVc0Z1d5ZHplWE5mYUhWaVgyWnNiM2NuTENBbmMzbHpYMmgxWWw5bWJHOTNYM051WVhCemFHOTBKMTBnWVc1a0lIdDdibko5ZlYwdUpHWXVlM3RmWDMxOUxpUm1XeTB4WFM1SlpENCtJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wYXJlbnQpIHJldCArPSAvKih0aGlzLl9wYXJlbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5wYXJlbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncGFyZW50LicpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdGlmICh0aGlzLl9lbGVtZW50TWFwcGluZykgcmV0ICs9IC8qKHRoaXMuX2VsZW1lbnRNYXBwaW5nX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZWxlbWVudE1hcHBpbmcoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWxlbWVudE1hcHBpbmcuJyk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybS4nKTtcblxuXHRcdCh0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUGlsbF9Db21wb3VuZC5wYXJlbnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRwYXJlbnQ6IG9iai5nZXRWYWx1ZShcInBhcmVudFwiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRlbGVtZW50TWFwcGluZzogb2JqLmdldFZhbHVlKFwiZWxlbWVudE1hcHBpbmdcIiksXG5cblx0XHRcdFx0XHRcdHRyYW5zZm9ybTogb2JqLmdldFZhbHVlKFwidHJhbnNmb3JtXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGFyZW50KG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnRNYXBwaW5nKG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai5lbGVtZW50TWFwcGluZykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHJhbnNmb3JtKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfUGlsbF9Db21wb3VuZHMobmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQaWxsX0NvbXBvdW5kXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wYXJlbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBhcmVudCA9IHRoaXMucGFyZW50KCk7XG5cblx0XHRcdGlmIChyZXQucGFyZW50KSB7XG5cdFx0XHRcdHJldC5wYXJlbnQgPSByZXQucGFyZW50Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnBhcmVudCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucGFyZW50KS5sZW5ndGgpIHJldC5wYXJlbnQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbGVtZW50TWFwcGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWxlbWVudE1hcHBpbmcgPSB0aGlzLmVsZW1lbnRNYXBwaW5nKCk7XG5cblx0XHRcdGlmIChyZXQuZWxlbWVudE1hcHBpbmcpIHtcblx0XHRcdFx0cmV0LmVsZW1lbnRNYXBwaW5nID0gcmV0LmVsZW1lbnRNYXBwaW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmVsZW1lbnRNYXBwaW5nKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5lbGVtZW50TWFwcGluZykubGVuZ3RoKSByZXQuZWxlbWVudE1hcHBpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90cmFuc2Zvcm0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRyYW5zZm9ybSA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRcdGlmIChyZXQudHJhbnNmb3JtKSB7XG5cdFx0XHRcdHJldC50cmFuc2Zvcm0gPSByZXQudHJhbnNmb3JtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRyYW5zZm9ybSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudHJhbnNmb3JtKS5sZW5ndGgpIHJldC50cmFuc2Zvcm0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnRfUGlsbF9Db21wb3VuZHMgPSB0aGlzLnBhcmVudF9QaWxsX0NvbXBvdW5kcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuVUlkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LlVJZCA9IHRoaXMuVUlkKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXR0YWNoZWRUbygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hdHRhY2hlZFRvID0gdGhpcy5hdHRhY2hlZFRvKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInBhcmVudFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBhcmVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wYXJlbnQodGhpcy5wYXJlbnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVsZW1lbnRNYXBwaW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZWxlbWVudE1hcHBpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWxlbWVudE1hcHBpbmcodGhpcy5lbGVtZW50TWFwcGluZygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0cmFuc2Zvcm1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3BpbGxfY29tcG91bmQnLCBbJyonXSlbJ3N5c19odWJfcGlsbF9jb21wb3VuZCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BhcmVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BhcmVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnBhcmVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlBpbGwgQ29tcG91bmRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJwYXJlbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIiArIFwicGFyZW50W3BhcmVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJlbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGFyZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwYXJlbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BhcmVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwYXJlbnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZWxlbWVudE1hcHBpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbGVtZW50TWFwcGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVsZW1lbnRNYXBwaW5nKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcImVsZW1lbnRNYXBwaW5nIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIgKyBcImVsZW1lbnRNYXBwaW5nW2VsZW1lbnRNYXBwaW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVsZW1lbnRNYXBwaW5nKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VsZW1lbnRtYXBwaW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbGVtZW50bWFwcGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZWxlbWVudG1hcHBpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZWxlbWVudG1hcHBpbmcnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHJhbnNmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHJhbnNmb3JtKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUGlsbCBDb21wb3VuZFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiKyBcInRyYW5zZm9ybSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3F1ZXJ5KCk6IFwiICsgXCJ0cmFuc2Zvcm1bdHJhbnNmb3JtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRyYW5zZm9ybSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0cmFuc2Zvcm0nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RyYW5zZm9ybScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHJhbnNmb3JtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RyYW5zZm9ybScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3BpbGxfY29tcG91bmQnLCBbJyonXSlbJ3N5c19odWJfcGlsbF9jb21wb3VuZCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfaHViX3BpbGxfY29tcG91bmQnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfcGlsbF9jb21wb3VuZCcsIFsnKiddKVsnc3lzX2h1Yl9waWxsX2NvbXBvdW5kJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5fc2F2ZSgpOiBcIiArIFwib2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucGFyZW50X1BpbGxfQ29tcG91bmRzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnBhcmVudF9QaWxsX0NvbXBvdW5kcykpIHRoaXMucGFyZW50X1BpbGxfQ29tcG91bmRzKG9iai5wYXJlbnRfUGlsbF9Db21wb3VuZHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1BpbGxfQ29tcG91bmQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBpbGxfQ29tcG91bmQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQaWxsX0NvbXBvdW5kLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX3BpbGxfY29tcG91bmQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9waWxsX2NvbXBvdW5kJywgWycqJ10pWydzeXNfaHViX3BpbGxfY29tcG91bmQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGlsbF9Db21wb3VuZC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGlsbF9Db21wb3VuZC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBpbGxfQ29tcG91bmQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2xcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLm9wZXJhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9wZXJhdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3BlcmF0aW9uID0gdjtcblx0XHRcdHRoaXMuX29wZXJhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcGVyYXRpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnNlY3VyaXR5Q29udHJvbF9GbG93cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNlY3VyaXR5Q29udHJvbF9GbG93cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3NlY3VyaXR5Q29udHJvbF9GbG93cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3NlY3VyaXR5Q29udHJvbF9GbG93c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VjdXJpdHlDb250cm9sX0Zsb3dzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAvKih0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHlwZSgpLl90b0VRdWVyeShzUGF0aCArICd0eXBlLicpO1xuXG5cdFx0aWYgKHRoaXMuX29wZXJhdGlvbikgcmV0ICs9IC8qKHRoaXMuX29wZXJhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9wZXJhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdvcGVyYXRpb24uJyk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93LnNlY3VyaXR5Q29udHJvbCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHR5cGU6IG9iai5nZXRWYWx1ZShcInR5cGVcIiksXG5cblx0XHRcdFx0XHRcdG9wZXJhdGlvbjogb2JqLmdldFZhbHVlKFwib3BlcmF0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHlwZShuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcGVyYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9wZXJhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmoub3BlcmF0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2VjdXJpdHlDb250cm9sX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU2VjdXJpdHlfQ29udHJvbFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudHlwZSA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAocmV0LnR5cGUpIHtcblx0XHRcdFx0cmV0LnR5cGUgPSByZXQudHlwZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50eXBlKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50eXBlKS5sZW5ndGgpIHJldC50eXBlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3BlcmF0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcGVyYXRpb24gPSB0aGlzLm9wZXJhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0Lm9wZXJhdGlvbikge1xuXHRcdFx0XHRyZXQub3BlcmF0aW9uID0gcmV0Lm9wZXJhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5vcGVyYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm9wZXJhdGlvbikubGVuZ3RoKSByZXQub3BlcmF0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFwcGxpY2F0aW9uKSB7XG5cdFx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHJldC5hcHBsaWNhdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hcHBsaWNhdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYXBwbGljYXRpb24pLmxlbmd0aCkgcmV0LmFwcGxpY2F0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zZWN1cml0eUNvbnRyb2xfRmxvd3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2VjdXJpdHlDb250cm9sX0Zsb3dzID0gdGhpcy5zZWN1cml0eUNvbnRyb2xfRmxvd3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm9wZXJhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcGVyYXRpb24odGhpcy5vcGVyYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9wZXJhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9wZXJhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcGVyYXRpb24odGhpcy5vcGVyYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfYWNsJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90eXBlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNlY3VyaXR5IENvbnRyb2xcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0eXBlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIgKyBcInR5cGVbdHlwZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50eXBlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3R5cGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R5cGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHlwZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcGVyYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcGVyYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcGVyYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBDb250cm9sXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIrIFwib3BlcmF0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5fcXVlcnkoKTogXCIgKyBcIm9wZXJhdGlvbltvcGVyYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMub3BlcmF0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29wZXJhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3BlcmF0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcGVyYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3BlcmF0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNlY3VyaXR5IENvbnRyb2xcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV9hY2wnLCBbJyonXSlbJ3N5c19zZWN1cml0eV9hY2wnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X2FjbCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X2FjbCcsIFsnKiddKVsnc3lzX3NlY3VyaXR5X2FjbCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuX3NhdmUoKTogXCIgKyBcIm9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNlY3VyaXR5Q29udHJvbF9GbG93cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zZWN1cml0eUNvbnRyb2xfRmxvd3MpKSB0aGlzLnNlY3VyaXR5Q29udHJvbF9GbG93cyhvYmouc2VjdXJpdHlDb250cm9sX0Zsb3dzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9Db250cm9sLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfQ29udHJvbC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X2FjbCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfYWNsJywgWycqJ10pWydzeXNfc2VjdXJpdHlfYWNsJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X0NvbnRyb2wuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X0NvbnRyb2wuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9Db250cm9sLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19UZWFtX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfVGVhbV9NZW1iZXIiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfVGVhbV9NZW1iZXIgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1fTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIudGVhbSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RlYW0gPSB2O1xuXHRcdFx0dGhpcy5fdGVhbV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm1lbWJlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVtYmVyID0gdjtcblx0XHRcdHRoaXMuX21lbWJlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIucm9sZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJvbGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JvbGUgPSB2O1xuXHRcdFx0dGhpcy5fcm9sZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yb2xlO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3RlYW0pIHJldCArPSAvKih0aGlzLl90ZWFtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGVhbSgpLl90b0VRdWVyeShzUGF0aCArICd0ZWFtLicpO1xuXG5cdFx0aWYgKHRoaXMuX21lbWJlcikgcmV0ICs9IC8qKHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lbWJlcigpLl90b0VRdWVyeShzUGF0aCArICdtZW1iZXIuJyk7XG5cblx0XHRpZiAodGhpcy5fcm9sZSkgcmV0ICs9IC8qKHRoaXMuX3JvbGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yb2xlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3JvbGUuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0ZWFtOiBvYmouZ2V0VmFsdWUoXCJ0ZWFtXCIpLFxuXG5cdFx0XHRcdFx0XHRtZW1iZXI6IG9iai5nZXRWYWx1ZShcIm1lbWJlclwiKSxcblxuXHRcdFx0XHRcdFx0cm9sZTogb2JqLmdldFZhbHVlKFwicm9sZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRlYW0obmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVtYmVyKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJvbGUobmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUZWFtX01lbWJlclwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50ZWFtID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmIChyZXQudGVhbSkge1xuXHRcdFx0XHRyZXQudGVhbSA9IHJldC50ZWFtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnRlYW0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRlYW0pLmxlbmd0aCkgcmV0LnRlYW0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1lbWJlciA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmIChyZXQubWVtYmVyKSB7XG5cdFx0XHRcdHJldC5tZW1iZXIgPSByZXQubWVtYmVyLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lbWJlcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubWVtYmVyKS5sZW5ndGgpIHJldC5tZW1iZXIgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yb2xlID0gdGhpcy5yb2xlKCk7XG5cblx0XHRcdGlmIChyZXQucm9sZSkge1xuXHRcdFx0XHRyZXQucm9sZSA9IHJldC5yb2xlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJvbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJvbGUpLmxlbmd0aCkgcmV0LnJvbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGVhbVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRlYW0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbSh0aGlzLnRlYW0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWVtYmVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVtYmVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcih0aGlzLm1lbWJlcigpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyb2xlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucm9sZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yb2xlKHRoaXMucm9sZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RlYW1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwidGVhbVt0ZWFtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRlYW0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RlYW0nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RlYW0nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGVhbScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tZW1iZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUZWFtIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIgKyBcIm1lbWJlclttZW1iZXJdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVtYmVyKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21lbWJlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21lbWJlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21lbWJlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcm9sZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUZWFtIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJyb2xlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJyb2xlW3JvbGVdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucm9sZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyb2xlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncm9sZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyb2xlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbV9NZW1iZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdGVhbV9tZW1iZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW1fbWVtYmVyJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtX21lbWJlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW1fTWVtYmVyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29sdW1uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9Db2x1bW4iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29sdW1uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQ29sdW1uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHlwZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHlwZSA9IHY7XG5cdFx0XHR0aGlzLl90eXBlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLm1hbmRhdG9yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1hbmRhdG9yeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWFuZGF0b3J5ID0gdjtcblx0XHRcdHRoaXMuX21hbmRhdG9yeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tYW5kYXRvcnk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLnRhYmxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RhYmxlID0gdjtcblx0XHRcdHRoaXMuX3RhYmxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RhYmxlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5yZWZlcmVuY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlZmVyZW5jZSA9IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2Vycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2NvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5jb2x1bW5fRmllbGRfTGFiZWxzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29sdW1uX0ZpZWxkX0xhYmVscyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2NvbHVtbl9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9jb2x1bW5fRmllbGRfTGFiZWxzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2x1bW5fRmllbGRfTGFiZWxzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbHVtbi5fX2tleXMgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19rZXlzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19rZXlzID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBbXCJlbGVtZW50XCIsIFwibmFtZVwiXTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9fa2V5cygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpwYkltVnNaVzFsYm5RaUxDSnVZVzFsSWwxOWApLCAoa2V5LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZih2YWx1ZSkgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUuaW5kZXhPZihcIj0+XCIpID4gMCkgcmV0dXJuIGV2YWwoXCIoXCIgKyB2YWx1ZSArIFwiKVwiKTtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdFx0XHR9KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpKCkpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29sdW1uLmxlbmd0aCBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRsZW5ndGgoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9sZW5ndGggPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9ICgpID0+ICh7XG5cdFx0XHRcdFx0XHRcIlN0cmluZ1wiOiAyNTUsXG5cdFx0XHRcdFx0XHRcIlRleHRcIjogNDAwMCxcblx0XHRcdFx0XHR9KVt0aGlzLnR5cGUoKV07XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5sZW5ndGgoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lLQ2tnUFQ0Z0tIdGNibHgwWEhSY2RGeDBYQ0pUZEhKcGJtZGNJam9nTWpVMUxGeHVYSFJjZEZ4MFhIUmNJbFJsZUhSY0lqb2dOREF3TUN4Y2JseDBYSFJjZEgwcFczUm9hWE11ZEhsd1pTZ3BYU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZGlzcGxheSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkaXNwbGF5KCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfZGlzcGxheSA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKCkgPT4gdHlwZW9mKHRoaXMudGFibGUoKSkgPT09IFwib2JqZWN0XCIgJiYgdGhpcy50YWJsZSgpLnRhYmxlX0NvbHVtbnMoKS5maW5kKGMgPT4gYy50eXBlKCkgPT0gJ1N0cmluZycpID09IHRoaXM7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5kaXNwbGF5KCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pS0NrZ1BUNGdkSGx3Wlc5bUtIUm9hWE11ZEdGaWJHVW9LU2tnUFQwOUlGd2liMkpxWldOMFhDSWdKaVlnZEdocGN5NTBZV0pzWlNncExuUmhZbXhsWDBOdmJIVnRibk1vS1M1bWFXNWtLR01nUFQ0Z1l5NTBlWEJsS0NrZ1BUMGdKMU4wY21sdVp5Y3BJRDA5SUhSb2FYTWlmUT09YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90eXBlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndHlwZScgKyAodGhpcy5fdHlwZV9jb29wIHx8ICc9JykgKyB0aGlzLnR5cGUoKTtcblxuXHRcdGlmICh0aGlzLl9tYW5kYXRvcnkpIHJldCArPSAnXicgKyBzUGF0aCArICdtYW5kYXRvcnknICsgKHRoaXMuX21hbmRhdG9yeV9jb29wIHx8ICc9JykgKyB0aGlzLm1hbmRhdG9yeSgpO1xuXG5cdFx0aWYgKHRoaXMuX3RhYmxlKSByZXQgKz0gLyoodGhpcy5fdGFibGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50YWJsZSgpLl90b0VRdWVyeShzUGF0aCArICd0YWJsZS4nKTtcblxuXHRcdGlmICh0aGlzLl9yZWZlcmVuY2UpIHJldCArPSAvKih0aGlzLl9yZWZlcmVuY2VfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZWZlcmVuY2UoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVmZXJlbmNlLicpO1xuXG5cdFx0KHRoaXMuY29sdW1uX1N1YnNjcmlwdGlvbl9UcmlnZ2VycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU3Vic2NyaXB0aW9uX1RyaWdnZXIuY29sdW1uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGaWVsZF9MYWJlbC5jb2x1bW4sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0eXBlOiBvYmouZ2V0VmFsdWUoXCJ0eXBlXCIpLFxuXG5cdFx0XHRcdFx0XHRtYW5kYXRvcnk6IG9iai5nZXRWYWx1ZShcIm1hbmRhdG9yeVwiKSxcblxuXHRcdFx0XHRcdFx0dGFibGU6IG9iai5nZXRWYWx1ZShcInRhYmxlXCIpLFxuXG5cdFx0XHRcdFx0XHRyZWZlcmVuY2U6IG9iai5nZXRWYWx1ZShcInJlZmVyZW5jZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR5cGUob2JqLnR5cGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWFuZGF0b3J5KG9iai5tYW5kYXRvcnkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50YWJsZShuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKS5fZnJvbURvY3VtZW50KG9iai50YWJsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVmZXJlbmNlKG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKG5ldyBzaHNfYXJiZndfYXBwZF9TdWJzY3JpcHRpb25fVHJpZ2dlcigpLl9mcm9tRG9jdW1lbnQob2JqLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5jb2x1bW5fRmllbGRfTGFiZWxzKG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9mcm9tRG9jdW1lbnQob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJDb2x1bW5cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21hbmRhdG9yeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWFuZGF0b3J5ID0gdGhpcy5tYW5kYXRvcnkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGFibGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRhYmxlID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0XHRpZiAocmV0LnRhYmxlKSB7XG5cdFx0XHRcdHJldC50YWJsZSA9IHJldC50YWJsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50YWJsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudGFibGUpLmxlbmd0aCkgcmV0LnRhYmxlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSgpO1xuXG5cdFx0XHRpZiAocmV0LnJlZmVyZW5jZSkge1xuXHRcdFx0XHRyZXQucmVmZXJlbmNlID0gcmV0LnJlZmVyZW5jZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5yZWZlcmVuY2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlZmVyZW5jZSkubGVuZ3RoKSByZXQucmVmZXJlbmNlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMgPSB0aGlzLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNvbHVtbl9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29sdW1uX0ZpZWxkX0xhYmVscyA9IHRoaXMuY29sdW1uX0ZpZWxkX0xhYmVscygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19rZXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9fa2V5cyA9IHRoaXMuX19rZXlzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubGVuZ3RoKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lmxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGlzcGxheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kaXNwbGF5ID0gdGhpcy5kaXNwbGF5KCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMudGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGUodGhpcy50YWJsZSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibWFuZGF0b3J5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWFuZGF0b3J5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hbmRhdG9yeSh0aGlzLm1hbmRhdG9yeSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRhYmxlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGFibGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGFibGUodGhpcy50YWJsZSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWZlcmVuY2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWZlcmVuY2UoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVmZXJlbmNlKHRoaXMucmVmZXJlbmNlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGljdGlvbmFyeScsIFsnKiddKVsnc3lzX2RpY3Rpb25hcnknXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fdHlwZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHlwZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWFuZGF0b3J5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWFuZGF0b3J5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWFuZGF0b3J5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtYW5kYXRvcnknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWFuZGF0b3J5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtYW5kYXRvcnknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWFuZGF0b3J5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RhYmxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGFibGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkNvbHVtblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGFibGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiICsgXCJ0YWJsZVt0YWJsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50YWJsZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0YWJsZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0YWJsZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndGFibGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGFibGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVmZXJlbmNlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVmZXJlbmNlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVmZXJlbmNlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQ29sdW1uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJyZWZlcmVuY2UgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3F1ZXJ5KCk6IFwiICsgXCJyZWZlcmVuY2VbcmVmZXJlbmNlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJlZmVyZW5jZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZWZlcmVuY2UnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVmZXJlbmNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWZlcmVuY2UnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVmZXJlbmNlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbHVtbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIm9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5jb2x1bW5fU3Vic2NyaXB0aW9uX1RyaWdnZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMpKSB0aGlzLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMob2JqLmNvbHVtbl9TdWJzY3JpcHRpb25fVHJpZ2dlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1N1YnNjcmlwdGlvbl9UcmlnZ2VyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uX3NhdmUoKTogXCIgKyBcIm9iai5jb2x1bW5fRmllbGRfTGFiZWxzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5jb2x1bW5fRmllbGRfTGFiZWxzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMpKSB0aGlzLmNvbHVtbl9GaWVsZF9MYWJlbHMob2JqLmNvbHVtbl9GaWVsZF9MYWJlbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpZWxkX0xhYmVsKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbHVtbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19kaWN0aW9uYXJ5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kaWN0aW9uYXJ5JywgWycqJ10pWydzeXNfZGljdGlvbmFyeSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb2x1bW4uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb2x1bW4uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29sdW1uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5IiwibmFtZSI6InNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnlcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBWZXJzaW9uX0hpc3RvcnkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5kZXNpZ24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Rlc2lnbiA9IHY7XG5cdFx0XHR0aGlzLl9kZXNpZ25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVzaWduO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFZlcnNpb25fSGlzdG9yeS5lZGl0b3IgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlZGl0b3IodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VkaXRvciA9IHY7XG5cdFx0XHR0aGlzLl9lZGl0b3JfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWRpdG9yO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Rlc2lnbikgcmV0ICs9IC8qKHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlc2lnbigpLl90b0VRdWVyeShzUGF0aCArICdkZXNpZ24uJyk7XG5cblx0XHRpZiAodGhpcy5fZWRpdG9yKSByZXQgKz0gLyoodGhpcy5fZWRpdG9yX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZWRpdG9yKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2VkaXRvci4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRlc2lnbjogb2JqLmdldFZhbHVlKFwiZGVzaWduXCIpLFxuXG5cdFx0XHRcdFx0XHRlZGl0b3I6IG9iai5nZXRWYWx1ZShcImVkaXRvclwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVkaXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWRpdG9yKG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLmVkaXRvcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJWZXJzaW9uX0hpc3RvcnlcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRcdHJldC5kZXNpZ24gPSByZXQuZGVzaWduLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lZGl0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVkaXRvciA9IHRoaXMuZWRpdG9yKCk7XG5cblx0XHRcdGlmIChyZXQuZWRpdG9yKSB7XG5cdFx0XHRcdHJldC5lZGl0b3IgPSByZXQuZWRpdG9yLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmVkaXRvcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZWRpdG9yKS5sZW5ndGgpIHJldC5lZGl0b3IgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlc2lnblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRlc2lnbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZXNpZ24odGhpcy5kZXNpZ24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZWRpdG9yXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZWRpdG9yKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVkaXRvcih0aGlzLmVkaXRvcigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlZlcnNpb24gSGlzdG9yeVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwiZGVzaWduIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzaWduJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVzaWduJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2Rlc2lnbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lZGl0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lZGl0b3JfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lZGl0b3IoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJWZXJzaW9uIEhpc3RvcnlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcImVkaXRvciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fcXVlcnkoKTogXCIgKyBcImVkaXRvcltlZGl0b3JdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZWRpdG9yKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VkaXRvcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlZGl0b3InKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VkaXRvcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlZGl0b3InLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3ZlcnNpb25faGlzdG9yeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1ZlcnNpb25fSGlzdG9yeSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJWZXJzaW9uX0hpc3RvcnkuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJWZXJzaW9uX0hpc3Rvcnkuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfdmVyc2lvbl9oaXN0b3J5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF92ZXJzaW9uX2hpc3RvcnknXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVmVyc2lvbl9IaXN0b3J5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVmVyc2lvbl9IaXN0b3J5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlZlcnNpb25fSGlzdG9yeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5kZXNpZ24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2Rlc2lnbiA9IHY7XG5cdFx0XHR0aGlzLl9kZXNpZ25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVzaWduO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24udHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R5cGUgPSB2O1xuXHRcdFx0dGhpcy5fdHlwZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90eXBlO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2Rlc2lnbikgcmV0ICs9IC8qKHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlc2lnbigpLl90b0VRdWVyeShzUGF0aCArICdkZXNpZ24uJyk7XG5cblx0XHRpZiAodGhpcy5fdHlwZSkgcmV0ICs9IC8qKHRoaXMuX3R5cGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy50eXBlKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3R5cGUuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkZXNpZ246IG9iai5nZXRWYWx1ZShcImRlc2lnblwiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZXNpZ24obmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9TZWN0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRcdHJldC5kZXNpZ24gPSByZXQuZGVzaWduLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChyZXQudHlwZSkge1xuXHRcdFx0XHRyZXQudHlwZSA9IHJldC50eXBlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnR5cGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnR5cGUpLmxlbmd0aCkgcmV0LnR5cGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkZXNpZ25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZXNpZ24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVzaWduKHRoaXMuZGVzaWduKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Rlc2lnbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2Rlc2lnbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRlc2lnbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNvbHV0aW9uIFNlY3Rpb25cIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJkZXNpZ24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwiZGVzaWduW2Rlc2lnbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZXNpZ24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVzaWduJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gU2VjdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInR5cGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIiArIFwidHlwZVt0eXBlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHlwZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0eXBlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc2VjdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zZWN0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3NlY3Rpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU2VjdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU2VjdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1NlY3Rpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmciLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZyIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90eXBlID0gdjtcblx0XHRcdHRoaXMuX3R5cGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmFnZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JhZ2UodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3N0b3JhZ2UgPSB2O1xuXHRcdFx0dGhpcy5fc3RvcmFnZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdG9yYWdlO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3R5cGUpIHJldCArPSAvKih0aGlzLl90eXBlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHlwZSgpLl90b0VRdWVyeShzUGF0aCArICd0eXBlLicpO1xuXG5cdFx0aWYgKHRoaXMuX3N0b3JhZ2UpIHJldCArPSAvKih0aGlzLl9zdG9yYWdlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc3RvcmFnZSgpLl90b0VRdWVyeShzUGF0aCArICdzdG9yYWdlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dHlwZTogb2JqLmdldFZhbHVlKFwidHlwZVwiKSxcblxuXHRcdFx0XHRcdFx0c3RvcmFnZTogb2JqLmdldFZhbHVlKFwic3RvcmFnZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50eXBlKG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0b3JhZ2UpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0b3JhZ2UobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX2Zyb21Eb2N1bWVudChvYmouc3RvcmFnZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90eXBlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50eXBlID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmIChyZXQudHlwZSkge1xuXHRcdFx0XHRyZXQudHlwZSA9IHJldC50eXBlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnR5cGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnR5cGUpLmxlbmd0aCkgcmV0LnR5cGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdG9yYWdlID0gdGhpcy5zdG9yYWdlKCk7XG5cblx0XHRcdGlmIChyZXQuc3RvcmFnZSkge1xuXHRcdFx0XHRyZXQuc3RvcmFnZSA9IHJldC5zdG9yYWdlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnN0b3JhZ2UpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnN0b3JhZ2UpLmxlbmd0aCkgcmV0LnN0b3JhZ2UgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR5cGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50eXBlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR5cGUodGhpcy50eXBlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0b3JhZ2VcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdG9yYWdlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0b3JhZ2UodGhpcy5zdG9yYWdlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHlwZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R5cGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50eXBlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gU3RvcmFnZSBNYXBwaW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0eXBlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIiArIFwidHlwZVt0eXBlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHlwZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0eXBlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3R5cGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RvcmFnZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0b3JhZ2VfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdG9yYWdlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gU3RvcmFnZSBNYXBwaW5nXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJzdG9yYWdlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIiArIFwic3RvcmFnZVtzdG9yYWdlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnN0b3JhZ2UoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RvcmFnZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdG9yYWdlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdG9yYWdlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0b3JhZ2UnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2VfbWFwcGluZycsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fc3RvcmFnZV9tYXBwaW5nJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlX21hcHBpbmcnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0JvYXJkX01lbWJlciIsIm5hbWUiOiJzaHNfYXJiZndfQm9hcmRfTWVtYmVyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0JvYXJkX01lbWJlciBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRfTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuc3RhcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGFydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RhcnQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydCA9IHY7XG5cdFx0XHR0aGlzLl9zdGFydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdGFydDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZW5kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm1lbWJlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVtYmVyID0gdjtcblx0XHRcdHRoaXMuX21lbWJlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXI7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc3RhcnQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydCcgKyAodGhpcy5fc3RhcnRfY29vcCB8fCAnPScpICsgdGhpcy5zdGFydCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZCcgKyAodGhpcy5fZW5kX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kKCk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX21lbWJlcikgcmV0ICs9IC8qKHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lbWJlcigpLl90b0VRdWVyeShzUGF0aCArICdtZW1iZXIuJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRzdGFydDogb2JqLmdldFZhbHVlKFwic3RhcnRcIiksXG5cblx0XHRcdFx0XHRcdGVuZDogb2JqLmdldFZhbHVlKFwiZW5kXCIpLFxuXG5cdFx0XHRcdFx0XHRib2FyZDogb2JqLmdldFZhbHVlKFwiYm9hcmRcIiksXG5cblx0XHRcdFx0XHRcdG1lbWJlcjogb2JqLmdldFZhbHVlKFwibWVtYmVyXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdGFydChvYmouc3RhcnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5kKG9iai5lbmQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ib2FyZChuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lbWJlcihuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXIpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQm9hcmRfTWVtYmVyXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXJ0ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAocmV0LnN0YXJ0ICYmIHR5cGVvZihyZXQuc3RhcnQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnQgPSByZXQuc3RhcnQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5kID0gdGhpcy5lbmQoKTtcblxuXHRcdFx0aWYgKHJldC5lbmQgJiYgdHlwZW9mKHJldC5lbmQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZW5kID0gcmV0LmVuZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJvYXJkID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAocmV0LmJvYXJkKSB7XG5cdFx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ib2FyZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYm9hcmQpLmxlbmd0aCkgcmV0LmJvYXJkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZW1iZXIgPSB0aGlzLm1lbWJlcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1lbWJlcikge1xuXHRcdFx0XHRyZXQubWVtYmVyID0gcmV0Lm1lbWJlci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZW1iZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lbWJlcikubGVuZ3RoKSByZXQubWVtYmVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0YXJ0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0KHRoaXMuc3RhcnQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5kKHRoaXMuZW5kKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lbWJlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1lbWJlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXIodGhpcy5tZW1iZXIoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGFydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3RhcnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXJ0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXJ0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5kJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkJvYXJkIE1lbWJlclwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwiYm9hcmQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJib2FyZFtib2FyZF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ib2FyZCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdib2FyZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdib2FyZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYm9hcmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQm9hcmQgTWVtYmVyXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJtZW1iZXJbbWVtYmVyXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lbWJlcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZW1iZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVtYmVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZF9tZW1iZXInLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmRfbWVtYmVyJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19DYXBhYmlsaXR5IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfQ2FwYWJpbGl0eSIsIm5hbWUiOiJzaHNfYXJiZndfQ2FwYWJpbGl0eSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19DYXBhYmlsaXR5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19DYXBhYmlsaXR5XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkubW9kdWxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9kdWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb2R1bGUgPSB2O1xuXHRcdFx0dGhpcy5fbW9kdWxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZHVsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2FwYWJpbGl0eV9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2NhcGFiaWxpdHlfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9tb2R1bGUpIHJldCArPSAvKih0aGlzLl9tb2R1bGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tb2R1bGUoKS5fdG9FUXVlcnkoc1BhdGggKyAnbW9kdWxlLicpO1xuXG5cdFx0KHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVJlcXVpcmVtZW50LmNhcGFiaWxpdHksPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdG1vZHVsZTogb2JqLmdldFZhbHVlKFwibW9kdWxlXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vZHVsZShuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ2FwYWJpbGl0eVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9kdWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb2R1bGUgPSB0aGlzLm1vZHVsZSgpO1xuXG5cdFx0XHRpZiAocmV0Lm1vZHVsZSkge1xuXHRcdFx0XHRyZXQubW9kdWxlID0gcmV0Lm1vZHVsZS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tb2R1bGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1vZHVsZSkubGVuZ3RoKSByZXQubW9kdWxlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyA9IHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb2R1bGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb2R1bGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kdWxlKHRoaXMubW9kdWxlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vZHVsZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vZHVsZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vZHVsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkNhcGFiaWxpdHlcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJtb2R1bGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIiArIFwibW9kdWxlW21vZHVsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tb2R1bGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9kdWxlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb2R1bGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vZHVsZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2R1bGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwib2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cykpIHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDYXBhYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9jYXBhYmlsaXR5Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2NhcGFiaWxpdHknXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Qcm9qZWN0IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfUHJvamVjdCIsIm5hbWUiOiJzaHNfYXJiZndfUHJvamVjdCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Qcm9qZWN0IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19Qcm9qZWN0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QudGVhbSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RlYW0gPSB2O1xuXHRcdFx0dGhpcy5fdGVhbV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuYnVkZ2V0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YnVkZ2V0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9idWRnZXQgPSB2O1xuXHRcdFx0dGhpcy5fYnVkZ2V0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdF9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnByb2plY3RfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9qZWN0X01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcHJvamVjdF9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3RfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdGVhbSkgcmV0ICs9IC8qKHRoaXMuX3RlYW1fY29vcCB8fCAnPScpICsgKi8gdGhpcy50ZWFtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RlYW0uJyk7XG5cblx0XHRpZiAodGhpcy5fYnVkZ2V0KSByZXQgKz0gLyoodGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYnVkZ2V0KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2J1ZGdldC4nKTtcblxuXHRcdCh0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllSZXF1aXJlbWVudC5wcm9qZWN0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5wcm9qZWN0X01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nLnByb2plY3QsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiYWN0dWFsQ29zdFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmFjdHVhbENvc3QocGF5bG9hZFtcInRpbGxEYXRlXCJdLCApO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHRlYW06IG9iai5nZXRWYWx1ZShcInRlYW1cIiksXG5cblx0XHRcdFx0XHRcdGJ1ZGdldDogb2JqLmdldFZhbHVlKFwiYnVkZ2V0XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50ZWFtKG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5idWRnZXQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJ1ZGdldChuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQob2JqLmJ1ZGdldCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMobmV3IHNoc19hcmJmd19SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9qZWN0X01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucHJvamVjdF9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5wcm9qZWN0X01lZXRpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUHJvamVjdFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGVhbSA9IHRoaXMudGVhbSgpO1xuXG5cdFx0XHRpZiAocmV0LnRlYW0pIHtcblx0XHRcdFx0cmV0LnRlYW0gPSByZXQudGVhbS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50ZWFtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50ZWFtKS5sZW5ndGgpIHJldC50ZWFtID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5idWRnZXQgPSB0aGlzLmJ1ZGdldCgpO1xuXG5cdFx0XHRpZiAocmV0LmJ1ZGdldCkge1xuXHRcdFx0XHRyZXQuYnVkZ2V0ID0gcmV0LmJ1ZGdldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5idWRnZXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJ1ZGdldCkubGVuZ3RoKSByZXQuYnVkZ2V0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0X1JlcXVpcmVtZW50cyA9IHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnByb2plY3RfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdF9NZWV0aW5ncyA9IHRoaXMucHJvamVjdF9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRlYW1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50ZWFtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW0odGhpcy50ZWFtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJ1ZGdldFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJ1ZGdldCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5idWRnZXQodGhpcy5idWRnZXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RlYW1fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50ZWFtKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUHJvamVjdFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRlYW0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIiArIFwidGVhbVt0ZWFtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRlYW0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGVhbScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndGVhbScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd0ZWFtJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2J1ZGdldCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2J1ZGdldF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmJ1ZGdldCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlByb2plY3RcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJidWRnZXQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIiArIFwiYnVkZ2V0W2J1ZGdldF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5idWRnZXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYnVkZ2V0JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdidWRnZXQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2J1ZGdldCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdidWRnZXQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3Byb2plY3QnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0Jyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwib2JqLnByb2plY3RfUmVxdWlyZW1lbnRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wcm9qZWN0X1JlcXVpcmVtZW50cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5wcm9qZWN0X1JlcXVpcmVtZW50cykpIHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMob2JqLnByb2plY3RfUmVxdWlyZW1lbnRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUmVxdWlyZW1lbnQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIm9iai5wcm9qZWN0X01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5wcm9qZWN0X01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnByb2plY3RfTWVldGluZ3MpKSB0aGlzLnByb2plY3RfTWVldGluZ3Mob2JqLnByb2plY3RfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfcHJvamVjdCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9wcm9qZWN0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmFjdHVhbENvc3QoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3R1YWxDb3N0KF9fZXZlbnQsIHRpbGxEYXRlKSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZihldkpTT04udGlsbERhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aWxsRGF0ZSA9IGV2SlNPTi50aWxsRGF0ZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZ2V0UGFyYW1ldGVyKSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YodGlsbERhdGUpID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YodGhpcy5nZXRQYXJhbWV0ZXIoJ3RpbGxEYXRlJykpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aWxsRGF0ZSA9IHRoaXMuZ2V0UGFyYW1ldGVyKCd0aWxsRGF0ZScpO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5IGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHlcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LnNjcmlwdEZpbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzY3JpcHRGaWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlID0gdjtcblx0XHRcdHRoaXMuX3NjcmlwdEZpbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0RmlsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS50YWJsZSBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZSgpIHtcblx0XHRyZXR1cm4gLyp0aGlzLmVmX3RhYmxlID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcInN5c19zY3JpcHRfaW5jbHVkZVwiO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09ICdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoXCJzKFwiKSAmJiBfX3JldC5lbmRzV2l0aChcIilcIikpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gdGhpcy5ydW5TY3JpcHQoX19yZXQuc2xpY2UoMiwgLTEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihfX3JldCkgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0X19yZXQgPSBfX3JldCh0aGlzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gX19yZXQ7XG5cblx0XHRcdFx0fSBjYXRjaCAoX3ZPZkV4KSB7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS50YWJsZSgpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaWMzbHpYM05qY21sd2RGOXBibU5zZFdSbEluMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3NjcmlwdEZpbGUpIHJldCArPSAvKih0aGlzLl9zY3JpcHRGaWxlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuc2NyaXB0RmlsZSgpLl90b0VRdWVyeShzUGF0aCArICdzY3JpcHRGaWxlLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfQ29tcGF0aWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHNjcmlwdEZpbGU6IG9iai5nZXRWYWx1ZShcInNjcmlwdEZpbGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdEZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNjcmlwdEZpbGUobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChvYmouc2NyaXB0RmlsZSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTY3JpcHRfQ29tcGF0aWJpbGl0eVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zY3JpcHRGaWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zY3JpcHRGaWxlID0gdGhpcy5zY3JpcHRGaWxlKCk7XG5cblx0XHRcdGlmIChyZXQuc2NyaXB0RmlsZSkge1xuXHRcdFx0XHRyZXQuc2NyaXB0RmlsZSA9IHJldC5zY3JpcHRGaWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNjcmlwdEZpbGUpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnNjcmlwdEZpbGUpLmxlbmd0aCkgcmV0LnNjcmlwdEZpbGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnRhYmxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRhYmxlID0gdGhpcy50YWJsZSgpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5zY3JpcHRGaWxlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjcmlwdEZpbGUodGhpcy5zY3JpcHRGaWxlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2NyaXB0RmlsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNjcmlwdEZpbGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2NyaXB0RmlsZSh0aGlzLnNjcmlwdEZpbGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lc19sYXRlc3Rfc2NyaXB0JywgWycqJ10pWydzeXNfZXNfbGF0ZXN0X3NjcmlwdCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NjcmlwdEZpbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zY3JpcHRGaWxlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2NyaXB0RmlsZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlNjcmlwdCBDb21wYXRpYmlsaXR5XCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInNjcmlwdEZpbGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fcXVlcnkoKTogXCIgKyBcInNjcmlwdEZpbGVbc2NyaXB0RmlsZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zY3JpcHRGaWxlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3NjcmlwdGZpbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzY3JpcHRmaWxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzY3JpcHRmaWxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NjcmlwdGZpbGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfZXNfbGF0ZXN0X3NjcmlwdCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lc19sYXRlc3Rfc2NyaXB0JywgWycqJ10pWydzeXNfZXNfbGF0ZXN0X3NjcmlwdCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0NvbXBhdGliaWxpdHkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2VzX2xhdGVzdF9zY3JpcHQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VzX2xhdGVzdF9zY3JpcHQnLCBbJyonXSlbJ3N5c19lc19sYXRlc3Rfc2NyaXB0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9Db21wYXRpYmlsaXR5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0NvbXBhdGliaWxpdHkuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfQ29tcGF0aWJpbGl0eS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5hY3Rpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3Rpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FjdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFjdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhY3Rpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0YWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJhY3Rpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJBY3Rpb25fU3RlcFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGlvbiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYWN0aW9uKSB7XG5cdFx0XHRcdHJldC5hY3Rpb24gPSByZXQuYWN0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFjdGlvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYWN0aW9uKS5sZW5ndGgpIHJldC5hY3Rpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3Rpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uKHRoaXMuYWN0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3RlcF9pbnN0YW5jZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3Rpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3Rpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJBY3Rpb24gU3RlcFwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9xdWVyeSgpOiBcIisgXCJhY3Rpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIgKyBcImFjdGlvblthY3Rpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3RlcF9pbnN0YW5jZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9zdGVwX2luc3RhbmNlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9zdGVwX2luc3RhbmNlJywgWycqJ10pWydzeXNfaHViX3N0ZXBfaW5zdGFuY2UnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXAuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19odWJfc3RlcF9pbnN0YW5jZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX3N0ZXBfaW5zdGFuY2UnLCBbJyonXSlbJ3N5c19odWJfc3RlcF9pbnN0YW5jZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXAuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0IiwibmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuYWN0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3Rpb24gPSB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hY3Rpb24pIHJldCArPSAvKih0aGlzLl9hY3Rpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hY3Rpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYWN0aW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGFjdGlvbjogb2JqLmdldFZhbHVlKFwiYWN0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWN0aW9uX1N0ZXBfSW5wdXRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3Rpb24gPSB0aGlzLmFjdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmFjdGlvbikge1xuXHRcdFx0XHRyZXQuYWN0aW9uID0gcmV0LmFjdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5hY3Rpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFjdGlvbikubGVuZ3RoKSByZXQuYWN0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGlvbih0aGlzLmFjdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0JywgWycqJ10pWydzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQWN0aW9uIFN0ZXAgSW5wdXRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fcXVlcnkoKTogXCIrIFwiYWN0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiICsgXCJhY3Rpb25bYWN0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFjdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0JywgWycqJ10pWydzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXBfSW5wdXQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X3N0ZXBfZGVmaW5pdGlvbl9pbnB1dCcsIFsnKiddKVsnc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fU3RlcF9JbnB1dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9TdGVwX0lucHV0LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1N0ZXBfSW5wdXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfc3RlcF9kZWZpbml0aW9uX2lucHV0JywgWycqJ10pWydzeXNfZmxvd19zdGVwX2RlZmluaXRpb25faW5wdXQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1N0ZXBfSW5wdXQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fU3RlcF9JbnB1dC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9TdGVwX0lucHV0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCIsIm5hbWUiOiJzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXggZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXgubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguZGVzaWduIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZXNpZ24gPSB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZXNpZ24pIHJldCArPSAvKih0aGlzLl9kZXNpZ25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZXNpZ24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVzaWduLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVzaWduOiBvYmouZ2V0VmFsdWUoXCJkZXNpZ25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0FwcGVuZGl4KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlc2lnbihuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlc2lnbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTb2x1dGlvbl9BcHBlbmRpeFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZXNpZ24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlc2lnbiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmIChyZXQuZGVzaWduKSB7XG5cdFx0XHRcdHJldC5kZXNpZ24gPSByZXQuZGVzaWduLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlc2lnbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVzaWduKS5sZW5ndGgpIHJldC5kZXNpZ24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVzaWduXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVzaWduKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbih0aGlzLmRlc2lnbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVzaWduKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVzaWduX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVzaWduKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU29sdXRpb24gQXBwZW5kaXhcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fcXVlcnkoKTogXCIrIFwiZGVzaWduIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiICsgXCJkZXNpZ25bZGVzaWduXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlc2lnbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZXNpZ24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZXNpZ24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2Rlc2lnbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkZXNpZ24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4Ll9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9hcHBlbmRpeCddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fQXBwZW5kaXguc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9BcHBlbmRpeC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0FwcGVuZGl4LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fYXBwZW5kaXgnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2FwcGVuZGl4J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0FwcGVuZGl4LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fQXBwZW5kaXguZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9BcHBlbmRpeC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZGVjaXNpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVjaXNpb24gPSB2O1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGVjaXNpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVjaXNpb24pIHJldCArPSAvKih0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlY2lzaW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlY2lzaW9uLicpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVjaXNpb246IG9iai5nZXRWYWx1ZShcImRlY2lzaW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kZWNpc2lvbihuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRGVjaXNpb25fT3B0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVjaXNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRlY2lzaW9uID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlY2lzaW9uKSB7XG5cdFx0XHRcdHJldC5kZWNpc2lvbiA9IHJldC5kZWNpc2lvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWNpc2lvbikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZGVjaXNpb24pLmxlbmd0aCkgcmV0LmRlY2lzaW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlY2lzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkRlY2lzaW9uIE9wdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwiZGVjaXNpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiICsgXCJkZWNpc2lvbltkZWNpc2lvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5kZWNpc2lvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkZWNpc2lvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWNpc2lvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGVjaXNpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRGVjaXNpb25fT3B0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbl9PcHRpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbl9vcHRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb25fT3B0aW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfTWVldGluZ19TZXJpZXMiLCJuYW1lIjoic2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01lZXRpbmdfU2VyaWVzIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19NZWV0aW5nX1Nlcmllc1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZyZXF1ZW5jeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZnJlcXVlbmN5ID0gdjtcblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9mcmVxdWVuY3k7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc2VyaWVzX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VyaWVzX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fc2VyaWVzX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zZXJpZXNfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZnJlcXVlbmN5KSByZXQgKz0gLyoodGhpcy5fZnJlcXVlbmN5X2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZnJlcXVlbmN5KCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2ZyZXF1ZW5jeS4nKTtcblxuXHRcdCh0aGlzLnNlcmllc19NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5zZXJpZXMsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGZyZXF1ZW5jeTogb2JqLmdldFZhbHVlKFwiZnJlcXVlbmN5XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mcmVxdWVuY3kobmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3kpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZXJpZXNfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5zZXJpZXNfTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouc2VyaWVzX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ19TZXJpZXNcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5mcmVxdWVuY3kgPSB0aGlzLmZyZXF1ZW5jeSgpO1xuXG5cdFx0XHRpZiAocmV0LmZyZXF1ZW5jeSkge1xuXHRcdFx0XHRyZXQuZnJlcXVlbmN5ID0gcmV0LmZyZXF1ZW5jeS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5mcmVxdWVuY3kpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmZyZXF1ZW5jeSkubGVuZ3RoKSByZXQuZnJlcXVlbmN5ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5zZXJpZXNfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2VyaWVzX01lZXRpbmdzID0gdGhpcy5zZXJpZXNfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJlcXVlbmN5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZnJlcXVlbmN5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyZXF1ZW5jeSh0aGlzLmZyZXF1ZW5jeSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJlcXVlbmN5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZnJlcXVlbmN5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZnJlcXVlbmN5KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZyBTZXJpZXNcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwiZnJlcXVlbmN5IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiICsgXCJmcmVxdWVuY3lbZnJlcXVlbmN5XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmZyZXF1ZW5jeSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmcmVxdWVuY3knKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdmcmVxdWVuY3knKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2ZyZXF1ZW5jeScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdmcmVxdWVuY3knLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcycpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9tZWV0aW5nX3NlcmllcyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIm9iai5zZXJpZXNfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnNlcmllc19NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zZXJpZXNfTWVldGluZ3MpKSB0aGlzLnNlcmllc19NZWV0aW5ncyhvYmouc2VyaWVzX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21lZXRpbmdfc2VyaWVzJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X01vZHVsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X01vZHVsZSIsIm5hbWUiOiJzaHNfYXJiZndfTW9kdWxlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X01vZHVsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfTW9kdWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUucGxhdGZvcm0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwbGF0Zm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGxhdGZvcm0gPSB2O1xuXHRcdFx0dGhpcy5fcGxhdGZvcm1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcGxhdGZvcm07XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLm1vZHVsZV9DYXBhYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZHVsZV9DYXBhYmlsaXR5cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kdWxlX0NhcGFiaWxpdHlzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3BsYXRmb3JtKSByZXQgKz0gLyoodGhpcy5fcGxhdGZvcm1fY29vcCB8fCAnPScpICsgKi8gdGhpcy5wbGF0Zm9ybSgpLl90b0VRdWVyeShzUGF0aCArICdwbGF0Zm9ybS4nKTtcblxuXHRcdCh0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQ2FwYWJpbGl0eS5tb2R1bGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBsYXRmb3JtOiBvYmouZ2V0VmFsdWUoXCJwbGF0Zm9ybVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGxhdGZvcm0obmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQob2JqLnBsYXRmb3JtKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kdWxlX0NhcGFiaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG5ldyBzaHNfYXJiZndfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1vZHVsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3BsYXRmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wbGF0Zm9ybSA9IHRoaXMucGxhdGZvcm0oKTtcblxuXHRcdFx0aWYgKHJldC5wbGF0Zm9ybSkge1xuXHRcdFx0XHRyZXQucGxhdGZvcm0gPSByZXQucGxhdGZvcm0uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucGxhdGZvcm0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnBsYXRmb3JtKS5sZW5ndGgpIHJldC5wbGF0Zm9ybSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vZHVsZV9DYXBhYmlsaXR5cyA9IHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfTW9kdWxlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwbGF0Zm9ybVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnBsYXRmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBsYXRmb3JtKHRoaXMucGxhdGZvcm0oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGxhdGZvcm0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNb2R1bGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInBsYXRmb3JtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIiArIFwicGxhdGZvcm1bcGxhdGZvcm1dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucGxhdGZvcm0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncGxhdGZvcm0nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BsYXRmb3JtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BsYXRmb3JtJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Nb2R1bGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTW9kdWxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfbW9kdWxlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwib2JqLm1vZHVsZV9DYXBhYmlsaXR5czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubW9kdWxlX0NhcGFiaWxpdHlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19DYXBhYmlsaXR5KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9tb2R1bGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX21vZHVsZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTW9kdWxlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9hcHBsaWNhdGlvbikgcmV0ICs9IC8qKHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYXBwbGljYXRpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnYXBwbGljYXRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Sb2xsYmFja19Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJSb2xsYmFja19Db250ZXh0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfcm9sbGJhY2tfY29udGV4dCcsIFsnKiddKVsnc3lzX3JvbGxiYWNrX2NvbnRleHQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19yb2xsYmFja19jb250ZXh0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlJvbGxiYWNrIENvbnRleHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19yb2xsYmFja19jb250ZXh0JywgWycqJ10pWydzeXNfcm9sbGJhY2tfY29udGV4dCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfcm9sbGJhY2tfY29udGV4dCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3JvbGxiYWNrX2NvbnRleHQnLCBbJyonXSlbJ3N5c19yb2xsYmFja19jb250ZXh0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGxiYWNrX0NvbnRleHQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19yb2xsYmFja19jb250ZXh0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19yb2xsYmFja19jb250ZXh0JywgWycqJ10pWydzeXNfcm9sbGJhY2tfY29udGV4dCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xsYmFja19Db250ZXh0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xsYmFja19Db250ZXh0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sbGJhY2tfQ29udGV4dC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNjcmlwdF9Db21wYXRpYmlsaXR5LnNjcmlwdEZpbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMobmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9Db21wYXRpYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJTY3JpcHRfRmlsZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmIChyZXQuYXBwbGljYXRpb24pIHtcblx0XHRcdFx0cmV0LmFwcGxpY2F0aW9uID0gcmV0LmFwcGxpY2F0aW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmFwcGxpY2F0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hcHBsaWNhdGlvbikubGVuZ3RoKSByZXQuYXBwbGljYXRpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzID0gdGhpcy5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9pbmNsdWRlJywgWycqJ10pWydzeXNfc2NyaXB0X2luY2x1ZGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2NyaXB0IEZpbGVcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfaW5jbHVkZScsIFsnKiddKVsnc3lzX3NjcmlwdF9pbmNsdWRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NjcmlwdF9GaWxlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0ZpbGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2NyaXB0X2luY2x1ZGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2luY2x1ZGUnLCBbJyonXSlbJ3N5c19zY3JpcHRfaW5jbHVkZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuX3NhdmUoKTogXCIgKyBcIm9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouc2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMpKSB0aGlzLnNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzKG9iai5zY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2NyaXB0X0NvbXBhdGliaWxpdHkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNjcmlwdF9GaWxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2NyaXB0X0ZpbGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTY3JpcHRfRmlsZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHRfaW5jbHVkZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2luY2x1ZGUnLCBbJyonXSlbJ3N5c19zY3JpcHRfaW5jbHVkZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTY3JpcHRfRmlsZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNjcmlwdF9GaWxlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2NyaXB0X0ZpbGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GaXhfU2NyaXB0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFwcGxpY2F0aW9uKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkZpeF9TY3JpcHRcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NyaXB0X2ZpeCcsIFsnKiddKVsnc3lzX3NjcmlwdF9maXgnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19zY3JpcHRfZml4Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkZpeCBTY3JpcHRcIj09XCJDb2x1bW5cIikgKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FwcGxpY2F0aW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGaXhfU2NyaXB0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0ZpeF9TY3JpcHQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2NyaXB0X2ZpeCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NjcmlwdF9maXgnLCBbJyonXSlbJ3N5c19zY3JpcHRfZml4J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRml4X1NjcmlwdC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZpeF9TY3JpcHQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZpeF9TY3JpcHQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19zY3JpcHRfZml4Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY3JpcHRfZml4JywgWycqJ10pWydzeXNfc2NyaXB0X2ZpeCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGaXhfU2NyaXB0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGaXhfU2NyaXB0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRml4X1NjcmlwdC5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UYWJsZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfVGFibGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVGFibGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9UYWJsZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1RhYmxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS50YWJsZV9Db2x1bW5zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGFibGVfQ29sdW1ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RhYmxlX0NvbHVtbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9Db2x1bW5zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90YWJsZV9Db2x1bW5zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9Db2x1bW5zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0NvbHVtbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQ29sdW1ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9Db2x1bW5zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfQ29sdW1ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19JbnB1dHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWZlcmVuY2VfRmxvd19JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19JbnB1dHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlZmVyZW5jZV9GbG93X0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19PdXRwdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X091dHB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfRmxvd19PdXRwdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVmZXJlbmNlX0FjdGlvbl9JbnB1dHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JlZmVyZW5jZV9BY3Rpb25fSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZWZlcmVuY2VfQWN0aW9uX0lucHV0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuZXh0ZW5kcyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRleHRlbmRzKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfZXh0ZW5kcyA9ICovICgoXG5cdFx0XHRmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdGxldCBfX3JldCA9IHVuZGVmaW5lZDtcblxuXHRcdFx0XHRcdF9fcmV0ID0gKF90aGlzKSA9PiBfdGhpcy5fbWFwKCdjbGFzcy5leHRlbmRzJywgZmFsc2UsICdfdG9KU09OJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgX3RoaXMubmFtZSgpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZXh0ZW5kcygpOiBcIiArICd2YWx1ZU9mJywgX3ZPZkV4LCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZih0aGlzLl9hdG9iKSAhPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSBcInVuZGVmaW5lZFwiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpUWlhKMmFXTmxUbTkzSWpvaUtGOTBhR2x6S1NBOVBpQmZkR2hwY3k1ZmJXRndLQ2RqYkdGemN5NWxlSFJsYm1Sekp5d2dabUZzYzJVc0lDZGZkRzlLVTA5T0p5d2dkVzVrWldacGJtVmtMQ0IxYm1SbFptbHVaV1FzSUhWdVpHVm1hVzVsWkN3Z1gzUm9hWE11Ym1GdFpTZ3BLU0o5YCksIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHZhbHVlKSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmRleE9mKFwiPT5cIikgPiAwKSByZXR1cm4gZXZhbChcIihcIiArIHZhbHVlICsgXCIpXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdH0pKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCkoKSk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5fX2lkRmllbGQgRUY6IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0X19pZEZpZWxkKCkge1xuXHRcdHJldHVybiAvKnRoaXMuZWZfX19pZEZpZWxkID0gKi8gKChcblx0XHRcdGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0bGV0IF9fcmV0ID0gdW5kZWZpbmVkO1xuXG5cdFx0XHRcdFx0X19yZXQgPSBcIm5hbWVcIjtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSAnc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKFwicyhcIikgJiYgX19yZXQuZW5kc1dpdGgoXCIpXCIpKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsIC0xKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0eXBlb2YoX19yZXQpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRcdF9fcmV0ID0gX19yZXQodGhpcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIF9fcmV0O1xuXG5cdFx0XHRcdH0gY2F0Y2ggKF92T2ZFeCkge1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX19pZEZpZWxkKCk6IFwiICsgJ3ZhbHVlT2YnLCBfdk9mRXgsIEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09IFwidW5kZWZpbmVkXCIgPyBfRnJFTUQuX2F0b2IgOiBhdG9iKSkoYGV5SlRaWEoyYVdObFRtOTNJam9pYm1GdFpTSjlgKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0aGlzLnRhYmxlX0NvbHVtbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUNvbHVtbi50YWJsZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0NvbHVtbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUNvbHVtbi5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2F2ZV9TdWJzY3JpcHRpb24udGFibGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19JbnB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfT3V0cHV0LnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X1ZhcmlhYmxlLnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0luc3RhbmNlX0lucHV0LnJlZmVyZW5jZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFjdGlvbl9JbnB1dC5yZWZlcmVuY2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0RhdGFfVmFyaWFibGUucmVmZXJlbmNlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYXBwbGljYXRpb24obmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50YWJsZV9Db2x1bW5zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudGFibGVfQ29sdW1ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvYmoudGFibGVfQ29sdW1ucykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0NvbHVtbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfQ29sdW1ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfQ29sdW1uKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0NvbHVtbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fZnJvbURvY3VtZW50KG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9GbG93X0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9GbG93X0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfT3V0cHV0KCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X1ZhcmlhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfSW5zdGFuY2VfSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnB1dCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGFfVmFyaWFibGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRhYmxlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGFibGVfQ29sdW1ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50YWJsZV9Db2x1bW5zID0gdGhpcy50YWJsZV9Db2x1bW5zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfQ29sdW1ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfQ29sdW1ucyA9IHRoaXMucmVmZXJlbmNlX0NvbHVtbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMgPSB0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X0lucHV0cyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfRmxvd19PdXRwdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X091dHB1dHMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X091dHB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMgPSB0aGlzLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyA9IHRoaXMucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cyA9IHRoaXMucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzID0gdGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZXh0ZW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5leHRlbmRzID0gdGhpcy5leHRlbmRzKCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX19pZEZpZWxkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Ll9faWRGaWVsZCA9IHRoaXMuX19pZEZpZWxkKCk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfVGFibGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZGJfb2JqZWN0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYWJsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJUYWJsZVwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYXBwbGljYXRpb24nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYXBwbGljYXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2RiX29iamVjdCcsIFsnKiddKVsnc3lzX2RiX29iamVjdCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2RiX29iamVjdCcpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19kYl9vYmplY3QnLCBbJyonXSlbJ3N5c19kYl9vYmplY3QnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoudGFibGVfQ29sdW1uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudGFibGVfQ29sdW1ucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50YWJsZV9Db2x1bW5zKSkgdGhpcy50YWJsZV9Db2x1bW5zKG9iai50YWJsZV9Db2x1bW5zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Db2x1bW4oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0NvbHVtbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9Db2x1bW5zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9Db2x1bW5zKSkgdGhpcy5yZWZlcmVuY2VfQ29sdW1ucyhvYmoucmVmZXJlbmNlX0NvbHVtbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0NvbHVtbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50YWJsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKSB0aGlzLnRhYmxlX1NhdmVfU3Vic2NyaXB0aW9ucyhvYmoudGFibGVfU2F2ZV9TdWJzY3JpcHRpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19JbnB1dHMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0lucHV0cyhvYmoucmVmZXJlbmNlX0Zsb3dfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X091dHB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cykpIHRoaXMucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cyhvYmoucmVmZXJlbmNlX0Zsb3dfT3V0cHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19PdXRwdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVmZXJlbmNlX0Zsb3dfVmFyaWFibGVzKSkgdGhpcy5yZWZlcmVuY2VfRmxvd19WYXJpYWJsZXMob2JqLnJlZmVyZW5jZV9GbG93X1ZhcmlhYmxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuX3NhdmUoKTogXCIgKyBcIm9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfRmxvd19JbnN0YW5jZV9JbnB1dHMpKSB0aGlzLnJlZmVyZW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhvYmoucmVmZXJlbmNlX0Zsb3dfSW5zdGFuY2VfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0luc3RhbmNlX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZWZlcmVuY2VfQWN0aW9uX0lucHV0cykpIHRoaXMucmVmZXJlbmNlX0FjdGlvbl9JbnB1dHMob2JqLnJlZmVyZW5jZV9BY3Rpb25fSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLl9zYXZlKCk6IFwiICsgXCJvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlZmVyZW5jZV9GbG93X0RhdGFfVmFyaWFibGVzKSkgdGhpcy5yZWZlcmVuY2VfRmxvd19EYXRhX1ZhcmlhYmxlcyhvYmoucmVmZXJlbmNlX0Zsb3dfRGF0YV9WYXJpYWJsZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YV9WYXJpYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFibGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYWJsZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhYmxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2RiX29iamVjdCcpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZGJfb2JqZWN0JywgWycqJ10pWydzeXNfZGJfb2JqZWN0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhYmxlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFibGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYWJsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZyIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmciLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmdcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dmFsdWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3ZhbHVlID0gdjtcblx0XHRcdHRoaXMuX3ZhbHVlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3ZhbHVlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5ibG9jayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ibG9jayA9IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9jaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21hcHBpbmdfVmFyaWFibGVfVmFsdWVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWFwcGluZ19WYXJpYWJsZV9WYWx1ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21hcHBpbmdfVmFyaWFibGVfVmFsdWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVsZW1lbnRfTWFwcGluZy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWxlbWVudF9NYXBwaW5nLl9fa2V5cyBFRjogR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRfX2tleXMoKSB7XG5cdFx0cmV0dXJuIC8qdGhpcy5lZl9fX2tleXMgPSAqLyAoKFxuXHRcdFx0ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRsZXQgX19yZXQgPSB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRfX3JldCA9IFwiWydpZCcsICdmaWVsZCcsICd0YWJsZSddXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gJ3N0cmluZycgJiYgX19yZXQuc3RhcnRzV2l0aChcInMoXCIpICYmIF9fcmV0LmVuZHNXaXRoKFwiKVwiKSkge1xuXHRcdFx0XHRcdFx0X19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLCAtMSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodHlwZW9mKF9fcmV0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRfX3JldCA9IF9fcmV0KHRoaXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBfX3JldDtcblxuXHRcdFx0XHR9IGNhdGNoIChfdk9mRXgpIHtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fX2tleXMoKTogXCIgKyAndmFsdWVPZicsIF92T2ZFeCwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09IFwidW5kZWZpbmVkXCIpID8gdGhpcy5fYXRvYiA6ICh0eXBlb2YoX0ZyRU1EKSAhPT0gXCJ1bmRlZmluZWRcIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVFpYSjJhV05sVG05M0lqb2lXeWRwWkNjc0lDZG1hV1ZzWkNjc0lDZDBZV0pzWlNkZEluMD1gKSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YodmFsdWUpID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluZGV4T2YoXCI9PlwiKSA+IDApIHJldHVybiBldmFsKFwiKFwiICsgdmFsdWUgKyBcIilcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KSgpKTtcblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3ZhbHVlKSByZXQgKz0gJ14nICsgc1BhdGggKyAndmFsdWUnICsgKHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nKSArIHRoaXMudmFsdWUoKTtcblxuXHRcdGlmICh0aGlzLl9ibG9jaykgcmV0ICs9IC8qKHRoaXMuX2Jsb2NrX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYmxvY2soKS5fdG9FUXVlcnkoc1BhdGggKyAnYmxvY2suJyk7XG5cblx0XHQodGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVmFyaWFibGVfVmFsdWUubWFwcGluZyw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVBpbGxfQ29tcG91bmQuZWxlbWVudE1hcHBpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR2YWx1ZTogb2JqLmdldFZhbHVlKFwidmFsdWVcIiksXG5cblx0XHRcdFx0XHRcdGJsb2NrOiBvYmouZ2V0VmFsdWUoXCJibG9ja1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZhbHVlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy52YWx1ZShvYmoudmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ibG9jayhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9mcm9tRG9jdW1lbnQob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWxlbWVudF9NYXBwaW5nXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdmFsdWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZhbHVlID0gdGhpcy52YWx1ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ibG9jaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYmxvY2sgPSB0aGlzLmJsb2NrKCk7XG5cblx0XHRcdGlmIChyZXQuYmxvY2spIHtcblx0XHRcdFx0cmV0LmJsb2NrID0gcmV0LmJsb2NrLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJsb2NrKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ibG9jaykubGVuZ3RoKSByZXQuYmxvY2sgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzID0gdGhpcy5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMgPSB0aGlzLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fX2tleXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuX19rZXlzID0gdGhpcy5fX2tleXMoKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2YWx1ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnZhbHVlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnZhbHVlKHRoaXMudmFsdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJibG9ja1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJsb2NrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrKHRoaXMuYmxvY2soKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19lbGVtZW50X21hcHBpbmcnLCBbJyonXSlbJ3N5c19lbGVtZW50X21hcHBpbmcnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92YWx1ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3ZhbHVlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3ZhbHVlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy52YWx1ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndmFsdWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmFsdWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3ZhbHVlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3ZhbHVlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2Jsb2NrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYmxvY2tfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ibG9jaygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkVsZW1lbnQgTWFwcGluZ1wiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fcXVlcnkoKTogXCIrIFwiYmxvY2sgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiICsgXCJibG9ja1tibG9ja10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdibG9jaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdibG9jaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYmxvY2snKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYmxvY2snLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9FbGVtZW50X01hcHBpbmcoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0VsZW1lbnRfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuX3NhdmUoKTogXCIgKyBcIm9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWFwcGluZ19WYXJpYWJsZV9WYWx1ZXMpKSB0aGlzLm1hcHBpbmdfVmFyaWFibGVfVmFsdWVzKG9iai5tYXBwaW5nX1ZhcmlhYmxlX1ZhbHVlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVmFyaWFibGVfVmFsdWUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5fc2F2ZSgpOiBcIiArIFwib2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcykpIHRoaXMuZWxlbWVudE1hcHBpbmdfUGlsbF9Db21wb3VuZHMob2JqLmVsZW1lbnRNYXBwaW5nX1BpbGxfQ29tcG91bmRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVsZW1lbnRfTWFwcGluZy5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19lbGVtZW50X21hcHBpbmcnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2VsZW1lbnRfbWFwcGluZycsIFsnKiddKVsnc3lzX2VsZW1lbnRfbWFwcGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFbGVtZW50X01hcHBpbmcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFbGVtZW50X01hcHBpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWxlbWVudF9NYXBwaW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGVcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFwcGxpY2F0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uID0gdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9JbnN0YW5jZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fSW5zdGFuY2VzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX0luc3RhbmNlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX0lucHV0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbl9BY3Rpb25fSW5wdXRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX0lucHV0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX0FjdGlvbl9JbnB1dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuYWN0aW9uX0FjdGlvbl9TdGVwcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGlvbl9BY3Rpb25fU3RlcHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX0FjdGlvbl9TdGVwcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2FwcGxpY2F0aW9uKSByZXQgKz0gLyoodGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5hcHBsaWNhdGlvbigpLl90b0VRdWVyeShzUGF0aCArICdhcHBsaWNhdGlvbi4nKTtcblxuXHRcdCh0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fSW5zdGFuY2UuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX0lucHV0LmFjdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQWN0aW9uX1N0ZXAuYWN0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fU3RlcF9JbnB1dC5hY3Rpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhcHBsaWNhdGlvbjogb2JqLmdldFZhbHVlKFwiYXBwbGljYXRpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fSW5wdXQoKS5fZnJvbURvY3VtZW50KG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX0FjdGlvbl9TdGVwcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwKCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX0FjdGlvbl9TdGVwcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcF9JbnB1dHMobmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9TdGVwX0lucHV0KCkuX2Zyb21Eb2N1bWVudChvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFjdGlvbl9UeXBlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hY3Rpb25fQWN0aW9uX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX0lucHV0cyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9JbnB1dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFjdGlvbl9BY3Rpb25fU3RlcHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aW9uX0FjdGlvbl9TdGVwcyA9IHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzID0gdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhcHBsaWNhdGlvblwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uKHRoaXMuYXBwbGljYXRpb24oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYXBwbGljYXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hcHBsaWNhdGlvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFjdGlvbiBUeXBlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcImFwcGxpY2F0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiICsgXCJhcHBsaWNhdGlvblthcHBsaWNhdGlvbl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5hcHBsaWNhdGlvbigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhcHBsaWNhdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1R5cGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9UeXBlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2FjdGlvbl90eXBlX2RlZmluaXRpb24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFjdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX0luc3RhbmNlcyhvYmouYWN0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai5hY3Rpb25fQWN0aW9uX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX0FjdGlvbl9JbnB1dHMpKSB0aGlzLmFjdGlvbl9BY3Rpb25fSW5wdXRzKG9iai5hY3Rpb25fQWN0aW9uX0lucHV0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0lucHV0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwib2JqLmFjdGlvbl9BY3Rpb25fU3RlcHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFjdGlvbl9BY3Rpb25fU3RlcHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYWN0aW9uX0FjdGlvbl9TdGVwcykpIHRoaXMuYWN0aW9uX0FjdGlvbl9TdGVwcyhvYmouYWN0aW9uX0FjdGlvbl9TdGVwcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX1N0ZXAoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYWN0aW9uX0FjdGlvbl9TdGVwX0lucHV0cywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKSkgdGhpcy5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzKG9iai5hY3Rpb25fQWN0aW9uX1N0ZXBfSW5wdXRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fU3RlcF9JbnB1dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWN0aW9uX1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBY3Rpb25fVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfYWN0aW9uX3R5cGVfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9hY3Rpb25fdHlwZV9kZWZpbml0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFjdGlvbl9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQWN0aW9uX1R5cGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24iLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnRyYW5zZm9ybSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRyYW5zZm9ybSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHJhbnNmb3JtID0gdjtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90cmFuc2Zvcm07XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdHJhbnNmb3JtKSByZXQgKz0gLyoodGhpcy5fdHJhbnNmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudHJhbnNmb3JtKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ3RyYW5zZm9ybS4nKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHR0cmFuc2Zvcm06IG9iai5nZXRWYWx1ZShcInRyYW5zZm9ybVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHJhbnNmb3JtKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHJhbnNmb3JtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50cmFuc2Zvcm0gPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0XHRpZiAocmV0LnRyYW5zZm9ybSkge1xuXHRcdFx0XHRyZXQudHJhbnNmb3JtID0gcmV0LnRyYW5zZm9ybS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50cmFuc2Zvcm0pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnRyYW5zZm9ybSkubGVuZ3RoKSByZXQudHJhbnNmb3JtID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm0oKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHJhbnNmb3JtXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudHJhbnNmb3JtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybSh0aGlzLnRyYW5zZm9ybSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RyYW5zZm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RyYW5zZm9ybV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRyYW5zZm9ybSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlRyYW5zZm9ybSBDb21wb3NpdGlvblwiPT1cIkNvbHVtblwiKSAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidHJhbnNmb3JtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9xdWVyeSgpOiBcIiArIFwidHJhbnNmb3JtW3RyYW5zZm9ybV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy50cmFuc2Zvcm0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHJhbnNmb3JtJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3RyYW5zZm9ybScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndHJhbnNmb3JtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RyYW5zZm9ybScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybV9Db21wb3NpdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtX0NvbXBvc2l0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3RyYW5zZm9ybV9jb21wb3NpdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJywgWycqJ10pWydzeXNfdHJhbnNmb3JtX2NvbXBvc2l0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybV9Db21wb3NpdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm1fQ29tcG9zaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9GbG93X0RhdGEiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19EYXRhLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfRGF0YS5kZWZpbml0aW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVmaW5pdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWZpbml0aW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlZmluaXRpb247XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGVmaW5pdGlvbikgcmV0ICs9IC8qKHRoaXMuX2RlZmluaXRpb25fY29vcCB8fCAnPScpICsgKi8gdGhpcy5kZWZpbml0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlZmluaXRpb24uJyk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0ZGVmaW5pdGlvbjogb2JqLmdldFZhbHVlKFwiZGVmaW5pdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlZmluaXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRlZmluaXRpb24obmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlZmluaXRpb24pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19EYXRhXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVmaW5pdGlvbiA9IHRoaXMuZGVmaW5pdGlvbigpO1xuXG5cdFx0XHRpZiAocmV0LmRlZmluaXRpb24pIHtcblx0XHRcdFx0cmV0LmRlZmluaXRpb24gPSByZXQuZGVmaW5pdGlvbi5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5kZWZpbml0aW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWZpbml0aW9uKS5sZW5ndGgpIHJldC5kZWZpbml0aW9uID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlZmluaXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZWZpbml0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlZmluaXRpb24odGhpcy5kZWZpbml0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhJywgWycqJ10pWydzeXNfZmxvd19kYXRhJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19kYXRhJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfRGF0YS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGVmaW5pdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RlZmluaXRpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWZpbml0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRmxvdyBEYXRhXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJkZWZpbml0aW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIiArIFwiZGVmaW5pdGlvbltkZWZpbml0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlZmluaXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVmaW5pdGlvbicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkZWZpbml0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkZWZpbml0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlZmluaXRpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19EYXRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfRGF0YSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2RhdGEnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfRGF0YS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c19mbG93X2RhdGEnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2Zsb3dfZGF0YScsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0RhdGEuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0RhdGEuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19EYXRhLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJBcHBsaWNhdGlvbiBEZXNpZ25lclwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9TZWN1cml0eV9Db250cm9scyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU2VjdXJpdHlfQ29udHJvbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVfU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2VjdXJpdHlfQ29udHJvbC50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0YXBwbGljYXRpb246IG9iai5nZXRWYWx1ZShcImFwcGxpY2F0aW9uXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9Db250cm9sKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3VyaXR5X1R5cGVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHlwZV9TZWN1cml0eV9Db250cm9scygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlX1NlY3VyaXR5X0NvbnRyb2xzID0gdGhpcy50eXBlX1NlY3VyaXR5X0NvbnRyb2xzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFwcGxpY2F0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYXBwbGljYXRpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb24odGhpcy5hcHBsaWNhdGlvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX3NlY3VyaXR5X3R5cGUnLCBbJyonXSlbJ3N5c19zZWN1cml0eV90eXBlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfdHlwZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hcHBsaWNhdGlvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FwcGxpY2F0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJTZWN1cml0eSBUeXBlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwiYXBwbGljYXRpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIiArIFwiYXBwbGljYXRpb25bYXBwbGljYXRpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYXBwbGljYXRpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYXBwbGljYXRpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfdHlwZScsIFsnKiddKVsnc3lzX3NlY3VyaXR5X3R5cGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X1R5cGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9UeXBlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X3R5cGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zZWN1cml0eV90eXBlJywgWycqJ10pWydzeXNfc2VjdXJpdHlfdHlwZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuX3NhdmUoKTogXCIgKyBcIm9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NlY3VyaXR5X0NvbnRyb2xzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMpKSB0aGlzLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMob2JqLnR5cGVfU2VjdXJpdHlfQ29udHJvbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9UeXBlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfc2VjdXJpdHlfdHlwZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfdHlwZScsIFsnKiddKVsnc3lzX3NlY3VyaXR5X3R5cGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfVHlwZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfVHlwZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X1R5cGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdXJpdHlfT3BlcmF0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5hcHBsaWNhdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbiA9IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN1cml0eV9PcGVyYXRpb24ub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fb3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fb3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYXBwbGljYXRpb24pIHJldCArPSAvKih0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmFwcGxpY2F0aW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FwcGxpY2F0aW9uLicpO1xuXG5cdFx0KHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTZWN1cml0eV9Db250cm9sLm9wZXJhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGFwcGxpY2F0aW9uOiBvYmouZ2V0VmFsdWUoXCJhcHBsaWNhdGlvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hcHBsaWNhdGlvbihuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9mcm9tRG9jdW1lbnQob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3VyaXR5X09wZXJhdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FwcGxpY2F0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb24oKTtcblxuXHRcdFx0aWYgKHJldC5hcHBsaWNhdGlvbikge1xuXHRcdFx0XHRyZXQuYXBwbGljYXRpb24gPSByZXQuYXBwbGljYXRpb24uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYXBwbGljYXRpb24pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmFwcGxpY2F0aW9uKS5sZW5ndGgpIHJldC5hcHBsaWNhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scyA9IHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9TZWN1cml0eV9PcGVyYXRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYXBwbGljYXRpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hcHBsaWNhdGlvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbih0aGlzLmFwcGxpY2F0aW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYXBwbGljYXRpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hcHBsaWNhdGlvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFwcGxpY2F0aW9uKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiU2VjdXJpdHkgT3BlcmF0aW9uXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9xdWVyeSgpOiBcIisgXCJhcHBsaWNhdGlvbiBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIgKyBcImFwcGxpY2F0aW9uW2FwcGxpY2F0aW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmFwcGxpY2F0aW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FwcGxpY2F0aW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FwcGxpY2F0aW9uJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhcHBsaWNhdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhcHBsaWNhdGlvbicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5fc2F2ZSgpOiBcIiArIFwib2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9sczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm9wZXJhdGlvbl9TZWN1cml0eV9Db250cm9scykpIHRoaXMub3BlcmF0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKG9iai5vcGVyYXRpb25fU2VjdXJpdHlfQ29udHJvbHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdXJpdHlfT3BlcmF0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3NlY3VyaXR5X29wZXJhdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJywgWycqJ10pWydzeXNfc2VjdXJpdHlfb3BlcmF0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3VyaXR5X09wZXJhdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN1cml0eV9PcGVyYXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19QbGF0Zm9ybSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1BsYXRmb3JtIiwibmFtZSI6InNoc19hcmJmd19QbGF0Zm9ybSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19QbGF0Zm9ybSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUGxhdGZvcm1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5wbGF0Zm9ybV9Nb2R1bGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGxhdGZvcm1fTW9kdWxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX01vZHVsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wbGF0Zm9ybV9Nb2R1bGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wbGF0Zm9ybV9Nb2R1bGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMucGxhdGZvcm1fTW9kdWxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTW9kdWxlLnBsYXRmb3JtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImluaXRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5pbml0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYXRmb3JtX01vZHVsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wbGF0Zm9ybV9Nb2R1bGVzKG5ldyBzaHNfYXJiZndfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvYmoucGxhdGZvcm1fTW9kdWxlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlBsYXRmb3JtXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucGxhdGZvcm1fTW9kdWxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wbGF0Zm9ybV9Nb2R1bGVzID0gdGhpcy5wbGF0Zm9ybV9Nb2R1bGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUGxhdGZvcm0oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9wbGF0Zm9ybScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1BsYXRmb3JtKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwib2JqLnBsYXRmb3JtX01vZHVsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnBsYXRmb3JtX01vZHVsZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGxhdGZvcm1fTW9kdWxlcykpIHRoaXMucGxhdGZvcm1fTW9kdWxlcyhvYmoucGxhdGZvcm1fTW9kdWxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01vZHVsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfcGxhdGZvcm0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3BsYXRmb3JtJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUGxhdGZvcm0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uaW5pdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluaXQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlBsYXRmb3JtLmluaXQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1VzZXIiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Vc2VyIiwibmFtZSI6InNoc19hcmJmd19Vc2VyIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1VzZXIgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1VzZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9lZGl0b3JfVmVyc2lvbl9IaXN0b3J5c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5vcmdhbml6ZXJfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmdhbml6ZXJfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm1vZGVyYXRvcl9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9kZXJhdG9yX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX0JvYXJkX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXJfQm9hcmRfTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX0JvYXJkX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIubWVtYmVyX1RlYW1fTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcl9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZW1iZXJfVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllWZXJzaW9uX0hpc3RvcnkuZWRpdG9yLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcub3JnYW5pemVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcubW9kZXJhdG9yLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZQm9hcmRfTWVtYmVyLm1lbWJlciw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVGVhbV9NZW1iZXIubWVtYmVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Vc2VyKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Vc2VyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZ2FuaXplcl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5vcmdhbml6ZXJfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncyhuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tb2RlcmF0b3JfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMobmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVtYmVyX1RlYW1fTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMobmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJVc2VyXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzID0gdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZ2FuaXplcl9NZWV0aW5ncyA9IHRoaXMub3JnYW5pemVyX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9kZXJhdG9yX01lZXRpbmdzID0gdGhpcy5tb2RlcmF0b3JfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcl9Cb2FyZF9NZW1iZXJzID0gdGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVtYmVyX1RlYW1fTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXJfVGVhbV9NZW1iZXJzID0gdGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVXNlcigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3VzZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1VzZXIoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVXNlcigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c191c2VyJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdXNlcicsIFsnKiddKVsnc3lzX3VzZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVkaXRvcl9WZXJzaW9uX0hpc3RvcnlzKSkgdGhpcy5lZGl0b3JfVmVyc2lvbl9IaXN0b3J5cyhvYmouZWRpdG9yX1ZlcnNpb25fSGlzdG9yeXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5vcmdhbml6ZXJfTWVldGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm9yZ2FuaXplcl9NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5vcmdhbml6ZXJfTWVldGluZ3MpKSB0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncyhvYmoub3JnYW5pemVyX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwib2JqLm1vZGVyYXRvcl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoubW9kZXJhdG9yX01lZXRpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1vZGVyYXRvcl9NZWV0aW5ncykpIHRoaXMubW9kZXJhdG9yX01lZXRpbmdzKG9iai5tb2RlcmF0b3JfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJvYmoubWVtYmVyX0JvYXJkX01lbWJlcnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKSkgdGhpcy5tZW1iZXJfQm9hcmRfTWVtYmVycyhvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuX3NhdmUoKTogXCIgKyBcIm9iai5tZW1iZXJfVGVhbV9NZW1iZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5tZW1iZXJfVGVhbV9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpKSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UZWFtX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlVzZXIuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c191c2VyJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c191c2VyJywgWycqJ10pWydzeXNfdXNlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJVc2VyLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVXNlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X0VmZm9ydCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0VmZm9ydCIsIm5hbWUiOiJzaHNfYXJiZndfRWZmb3J0Iiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X0VmZm9ydCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRWZmb3J0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlZmZvcnRfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUVmZm9ydF9Fc3RpbWF0ZS5lZmZvcnQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWZmb3J0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyA9IHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19FZmZvcnQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRWZmb3J0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0VmZm9ydCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19FZmZvcnQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJFZmZvcnQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9lZmZvcnQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSkgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2VmZm9ydCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZWZmb3J0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkVmZm9ydC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJFZmZvcnQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19CdWRnZXQiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19CdWRnZXQiLCJuYW1lIjoic2hzX2FyYmZ3X0J1ZGdldCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19CdWRnZXQgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0J1ZGdldFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmJ1ZGdldF9Qcm9qZWN0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJ1ZGdldF9Qcm9qZWN0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2J1ZGdldF9Qcm9qZWN0cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2J1ZGdldF9Qcm9qZWN0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYnVkZ2V0X1Byb2plY3RzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllQcm9qZWN0LmJ1ZGdldCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5idWRnZXRfUHJvamVjdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5idWRnZXRfUHJvamVjdHMobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0X1Byb2plY3RzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQnVkZ2V0XCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5idWRnZXRfUHJvamVjdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYnVkZ2V0X1Byb2plY3RzID0gdGhpcy5idWRnZXRfUHJvamVjdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19CdWRnZXQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0Jyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfQnVkZ2V0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0J10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19CdWRnZXQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCdWRnZXQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9idWRnZXQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJvYmouYnVkZ2V0X1Byb2plY3RzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5idWRnZXRfUHJvamVjdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYnVkZ2V0X1Byb2plY3RzKSkgdGhpcy5idWRnZXRfUHJvamVjdHMob2JqLmJ1ZGdldF9Qcm9qZWN0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0Jyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2J1ZGdldCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYnVkZ2V0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCdWRnZXQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19UYXNrIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfVGFzayIsIm5hbWUiOiJzaHNfYXJiZndfVGFzayIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19UYXNrIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19UYXNrXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGFzaygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVGFzaygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Rhc2soKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRhc2tcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X1Rhc2soKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd0YXNrJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUYXNrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19UYXNrKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd0YXNrJywgWycqJ10pWyd0YXNrJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfVGFzaygpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UYXNrKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAndGFzaycpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigndGFzaycsIFsnKiddKVsndGFzayddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRhc2suc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUYXNrLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUYXNrLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd0YXNrJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3Rhc2snLCBbJyonXSlbJ3Rhc2snXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGFzay5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGFzay5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRhc2suZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19TZWN0aW9uX1R5cGUiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19TZWN0aW9uX1R5cGUiLCJuYW1lIjoic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19TZWN0aW9uX1R5cGUgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NlY3Rpb25fVHlwZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTZWN0aW9uX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNlY3Rpb25fVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnR5cGVfU29sdXRpb25fU2VjdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0eXBlX1NvbHV0aW9uX1NlY3Rpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fdHlwZV9Tb2x1dGlvbl9TZWN0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU2VjdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R5cGVfU29sdXRpb25fU2VjdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3R5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU2VjdGlvbi50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZy50eXBlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU29sdXRpb25fU2VjdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNlY3Rpb25fVHlwZVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50eXBlX1NvbHV0aW9uX1NlY3Rpb25zID0gdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzID0gdGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU2VjdGlvbl9UeXBlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NlY3Rpb25fdHlwZScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NlY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19TZWN0aW9uX1R5cGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmoudHlwZV9Tb2x1dGlvbl9TZWN0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHlwZV9Tb2x1dGlvbl9TZWN0aW9ucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKSkgdGhpcy50eXBlX1NvbHV0aW9uX1NlY3Rpb25zKG9iai50eXBlX1NvbHV0aW9uX1NlY3Rpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fU2VjdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLl9zYXZlKCk6IFwiICsgXCJvYmoudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudHlwZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKSkgdGhpcy50eXBlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3Mob2JqLnR5cGVfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTZWN0aW9uX1R5cGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc2VjdGlvbl90eXBlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zZWN0aW9uX3R5cGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU2VjdGlvbl9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU2VjdGlvbl9UeXBlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNlY3Rpb25fVHlwZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlIiwibmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nLnN0b3JhZ2UsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyhuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlNvbHV0aW9uX1N0b3JhZ2VcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncyA9IHRoaXMuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfU29sdXRpb25fU3RvcmFnZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1N0b3JhZ2UoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5fc2F2ZSgpOiBcIiArIFwib2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnN0b3JhZ2VfU29sdXRpb25fU3RvcmFnZV9NYXBwaW5ncykpIHRoaXMuc3RvcmFnZV9Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmdzKG9iai5zdG9yYWdlX1NvbHV0aW9uX1N0b3JhZ2VfTWFwcGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TdG9yYWdlX01hcHBpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2Uuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9TdG9yYWdlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9zdG9yYWdlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX3N0b3JhZ2UnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fU3RvcmFnZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fU3RvcmFnZS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX1N0b3JhZ2UuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19EZWNpc2lvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0RlY2lzaW9uIiwibmFtZSI6InNoc19hcmJmd19EZWNpc2lvbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19EZWNpc2lvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfRGVjaXNpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRlY2lzaW9uX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb25fTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWURlY2lzaW9uX09wdGlvbi5kZWNpc2lvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcuZGVjaXNpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyhuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuZGVjaXNpb25fTWVldGluZ3MobmV3IHNoc19hcmJmd19NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb25fTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJEZWNpc2lvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9IHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fTWVldGluZ3MgPSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfRGVjaXNpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZGVjaXNpb24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykpIHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyhvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0RlY2lzaW9uX09wdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWNpc2lvbl9NZWV0aW5nczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVjaXNpb25fTWVldGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouZGVjaXNpb25fTWVldGluZ3MpKSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKG9iai5kZWNpc2lvbl9NZWV0aW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X01lZXRpbmcoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2RlY2lzaW9uJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9kZWNpc2lvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRlY2lzaW9uLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Cb2FyZCIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X0JvYXJkIiwibmFtZSI6InNoc19hcmJmd19Cb2FyZCIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Cb2FyZCBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfQm9hcmRcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5ib2FyZF9NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYm9hcmRfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYm9hcmRfQm9hcmRfTWVtYmVycyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkX0JvYXJkX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVyc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmRfQm9hcmRfTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJvYXJkX01lZXRpbmdzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nLmJvYXJkLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllCb2FyZF9NZW1iZXIuYm9hcmQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ib2FyZF9NZWV0aW5ncykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmJvYXJkX01lZXRpbmdzKG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLmJvYXJkX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycyhuZXcgc2hzX2FyYmZ3X0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJCb2FyZFwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJvYXJkX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJvYXJkX01lZXRpbmdzID0gdGhpcy5ib2FyZF9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZF9Cb2FyZF9NZW1iZXJzID0gdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfQm9hcmQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCcsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X0JvYXJkKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Cb2FyZCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfYm9hcmQnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwib2JqLmJvYXJkX01lZXRpbmdzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ib2FyZF9NZWV0aW5ncywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9NZWV0aW5ncykpIHRoaXMuYm9hcmRfTWVldGluZ3Mob2JqLmJvYXJkX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIm9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMpKSB0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Cb2FyZF9NZW1iZXIoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJCb2FyZC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2JvYXJkJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9ib2FyZCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkJvYXJkLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19GcmVxdWVuY3kiLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19GcmVxdWVuY3kiLCJuYW1lIjoic2hzX2FyYmZ3X0ZyZXF1ZW5jeSIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19GcmVxdWVuY3kgZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X0ZyZXF1ZW5jeVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRhaWx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGFpbHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RhaWx5ID0gdjtcblx0XHRcdHRoaXMuX2RhaWx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhaWx5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS53ZWVrbHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR3ZWVrbHkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3dlZWtseSA9IHY7XG5cdFx0XHR0aGlzLl93ZWVrbHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fd2Vla2x5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5tb250aGx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9udGhseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9udGhseSA9IHY7XG5cdFx0XHR0aGlzLl9tb250aGx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vbnRobHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnF1YXJ0ZXJseSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHF1YXJ0ZXJseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcXVhcnRlcmx5ID0gdjtcblx0XHRcdHRoaXMuX3F1YXJ0ZXJseV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9xdWFydGVybHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmRheXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXlzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kYXlzID0gdjtcblx0XHRcdHRoaXMuX2RheXNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kubW9uZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9uZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb25kYXkgPSB2O1xuXHRcdFx0dGhpcy5fbW9uZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vbmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kudHVlc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHR1ZXNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3R1ZXNkYXkgPSB2O1xuXHRcdFx0dGhpcy5fdHVlc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90dWVzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS53ZWRuZXNkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR3ZWRuZXNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3dlZG5lc2RheSA9IHY7XG5cdFx0XHR0aGlzLl93ZWRuZXNkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fd2VkbmVzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS50aHVyc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRodXJzZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90aHVyc2RheSA9IHY7XG5cdFx0XHR0aGlzLl90aHVyc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90aHVyc2RheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZnJpZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZnJpZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9mcmlkYXkgPSB2O1xuXHRcdFx0dGhpcy5fZnJpZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ZyaWRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc2F0dXJkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzYXR1cmRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc2F0dXJkYXkgPSB2O1xuXHRcdFx0dGhpcy5fc2F0dXJkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F0dXJkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnN1bmRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN1bmRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3VuZGF5ID0gdjtcblx0XHRcdHRoaXMuX3N1bmRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zdW5kYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fZGFpbHkpIHJldCArPSAnXicgKyBzUGF0aCArICdkYWlseScgKyAodGhpcy5fZGFpbHlfY29vcCB8fCAnPScpICsgdGhpcy5kYWlseSgpO1xuXG5cdFx0aWYgKHRoaXMuX3dlZWtseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3dlZWtseScgKyAodGhpcy5fd2Vla2x5X2Nvb3AgfHwgJz0nKSArIHRoaXMud2Vla2x5KCk7XG5cblx0XHRpZiAodGhpcy5fbW9udGhseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21vbnRobHknICsgKHRoaXMuX21vbnRobHlfY29vcCB8fCAnPScpICsgdGhpcy5tb250aGx5KCk7XG5cblx0XHRpZiAodGhpcy5fcXVhcnRlcmx5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncXVhcnRlcmx5JyArICh0aGlzLl9xdWFydGVybHlfY29vcCB8fCAnPScpICsgdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdGlmICh0aGlzLl9kYXlzKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF5cycgKyAodGhpcy5fZGF5c19jb29wIHx8ICc9JykgKyB0aGlzLmRheXMoKTtcblxuXHRcdGlmICh0aGlzLl9tb25kYXkpIHJldCArPSAnXicgKyBzUGF0aCArICdtb25kYXknICsgKHRoaXMuX21vbmRheV9jb29wIHx8ICc9JykgKyB0aGlzLm1vbmRheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3R1ZXNkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICd0dWVzZGF5JyArICh0aGlzLl90dWVzZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMudHVlc2RheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3dlZG5lc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3dlZG5lc2RheScgKyAodGhpcy5fd2VkbmVzZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMud2VkbmVzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fdGh1cnNkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICd0aHVyc2RheScgKyAodGhpcy5fdGh1cnNkYXlfY29vcCB8fCAnPScpICsgdGhpcy50aHVyc2RheSgpO1xuXG5cdFx0aWYgKHRoaXMuX2ZyaWRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2ZyaWRheScgKyAodGhpcy5fZnJpZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMuZnJpZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fc2F0dXJkYXkpIHJldCArPSAnXicgKyBzUGF0aCArICdzYXR1cmRheScgKyAodGhpcy5fc2F0dXJkYXlfY29vcCB8fCAnPScpICsgdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0aWYgKHRoaXMuX3N1bmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N1bmRheScgKyAodGhpcy5fc3VuZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMuc3VuZGF5KCk7XG5cblx0XHQodGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nX1Nlcmllcy5mcmVxdWVuY3ksPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRhaWx5OiBvYmouZ2V0VmFsdWUoXCJkYWlseVwiKSxcblxuXHRcdFx0XHRcdFx0d2Vla2x5OiBvYmouZ2V0VmFsdWUoXCJ3ZWVrbHlcIiksXG5cblx0XHRcdFx0XHRcdG1vbnRobHk6IG9iai5nZXRWYWx1ZShcIm1vbnRobHlcIiksXG5cblx0XHRcdFx0XHRcdHF1YXJ0ZXJseTogb2JqLmdldFZhbHVlKFwicXVhcnRlcmx5XCIpLFxuXG5cdFx0XHRcdFx0XHRkYXlzOiBvYmouZ2V0VmFsdWUoXCJkYXlzXCIpLFxuXG5cdFx0XHRcdFx0XHRtb25kYXk6IG9iai5nZXRWYWx1ZShcIm1vbmRheVwiKSxcblxuXHRcdFx0XHRcdFx0dHVlc2RheTogb2JqLmdldFZhbHVlKFwidHVlc2RheVwiKSxcblxuXHRcdFx0XHRcdFx0d2VkbmVzZGF5OiBvYmouZ2V0VmFsdWUoXCJ3ZWRuZXNkYXlcIiksXG5cblx0XHRcdFx0XHRcdHRodXJzZGF5OiBvYmouZ2V0VmFsdWUoXCJ0aHVyc2RheVwiKSxcblxuXHRcdFx0XHRcdFx0ZnJpZGF5OiBvYmouZ2V0VmFsdWUoXCJmcmlkYXlcIiksXG5cblx0XHRcdFx0XHRcdHNhdHVyZGF5OiBvYmouZ2V0VmFsdWUoXCJzYXR1cmRheVwiKSxcblxuXHRcdFx0XHRcdFx0c3VuZGF5OiBvYmouZ2V0VmFsdWUoXCJzdW5kYXlcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGFpbHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhaWx5KG9iai5kYWlseSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoud2Vla2x5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy53ZWVrbHkob2JqLndlZWtseSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9udGhseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubW9udGhseShvYmoubW9udGhseSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucXVhcnRlcmx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5xdWFydGVybHkob2JqLnF1YXJ0ZXJseSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF5cyhvYmouZGF5cyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9uZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tb25kYXkob2JqLm1vbmRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHVlc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudHVlc2RheShvYmoudHVlc2RheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoud2VkbmVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy53ZWRuZXNkYXkob2JqLndlZG5lc2RheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGh1cnNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRodXJzZGF5KG9iai50aHVyc2RheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZnJpZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5mcmlkYXkob2JqLmZyaWRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2F0dXJkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNhdHVyZGF5KG9iai5zYXR1cmRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3VuZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdW5kYXkob2JqLnN1bmRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MobmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJGcmVxdWVuY3lcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYWlseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGFpbHkgPSB0aGlzLmRhaWx5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3dlZWtseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQud2Vla2x5ID0gdGhpcy53ZWVrbHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9udGhseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubW9udGhseSA9IHRoaXMubW9udGhseSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9xdWFydGVybHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnF1YXJ0ZXJseSA9IHRoaXMucXVhcnRlcmx5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RheXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRheXMgPSB0aGlzLmRheXMoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9uZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb25kYXkgPSB0aGlzLm1vbmRheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90dWVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC50dWVzZGF5ID0gdGhpcy50dWVzZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3dlZG5lc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQud2VkbmVzZGF5ID0gdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGh1cnNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRodXJzZGF5ID0gdGhpcy50aHVyc2RheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mcmlkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZyaWRheSA9IHRoaXMuZnJpZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zYXR1cmRheSA9IHRoaXMuc2F0dXJkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3VuZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdW5kYXkgPSB0aGlzLnN1bmRheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyA9IHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGFpbHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYWlseSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYWlseSh0aGlzLmRhaWx5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwid2Vla2x5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMud2Vla2x5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LndlZWtseSh0aGlzLndlZWtseSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vbnRobHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb250aGx5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vbnRobHkodGhpcy5tb250aGx5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicXVhcnRlcmx5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucXVhcnRlcmx5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnF1YXJ0ZXJseSh0aGlzLnF1YXJ0ZXJseSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRheXNcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRheXModGhpcy5kYXlzKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibW9uZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMubW9uZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1vbmRheSh0aGlzLm1vbmRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInR1ZXNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50dWVzZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnR1ZXNkYXkodGhpcy50dWVzZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwid2VkbmVzZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMud2VkbmVzZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LndlZG5lc2RheSh0aGlzLndlZG5lc2RheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRodXJzZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGh1cnNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGh1cnNkYXkodGhpcy50aHVyc2RheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImZyaWRheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmZyaWRheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mcmlkYXkodGhpcy5mcmlkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzYXR1cmRheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNhdHVyZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNhdHVyZGF5KHRoaXMuc2F0dXJkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdW5kYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdW5kYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3VuZGF5KHRoaXMuc3VuZGF5KCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5J10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYWlseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhaWx5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGFpbHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhaWx5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhaWx5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYWlseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYWlseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWVrbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl93ZWVrbHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy53ZWVrbHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZWtseScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd3ZWVrbHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3dlZWtseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd3ZWVrbHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbW9udGhseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vbnRobHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tb250aGx5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb250aGx5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ21vbnRobHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vbnRobHknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbW9udGhseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9xdWFydGVybHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9xdWFydGVybHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3F1YXJ0ZXJseScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdxdWFydGVybHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3F1YXJ0ZXJseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdxdWFydGVybHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RheXNfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXlzKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXlzJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RheXMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RheXMnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF5cycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb25kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tb25kYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tb25kYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21vbmRheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vbmRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb25kYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdHVlc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3R1ZXNkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy50dWVzZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0dWVzZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R1ZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R1ZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHVlc2RheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWRuZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl93ZWRuZXNkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZG5lc2RheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd3ZWRuZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3dlZG5lc2RheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd3ZWRuZXNkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGh1cnNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90aHVyc2RheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0aHVyc2RheScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0aHVyc2RheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndGh1cnNkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndGh1cnNkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZnJpZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZnJpZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZnJpZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdmcmlkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZnJpZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmcmlkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZnJpZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2F0dXJkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2F0dXJkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2F0dXJkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3NhdHVyZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NhdHVyZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N1bmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N1bmRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnN1bmRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc3VuZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N1bmRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3VuZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N1bmRheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19GcmVxdWVuY3koKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeScpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX2ZyZXF1ZW5jeSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcIm9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpKSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3Mob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19NZWV0aW5nX1NlcmllcygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfZnJlcXVlbmN5JywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9mcmVxdWVuY3knXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRnJlcXVlbmN5LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJTSFNfQVJCRlcifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X1RlYW0iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19UZWFtIiwibmFtZSI6InNoc19hcmJmd19UZWFtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X1RlYW0gZXh0ZW5kcyBnbG9iYWwuQWJzdHJhY3RBamF4UHJvY2Vzc29yIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHQvKkFic3RyYWN0QWpheFByb2Nlc3Nvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1RlYW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS50ZWFtX1Byb2plY3RzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbV9Qcm9qZWN0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90ZWFtX1Byb2plY3RzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtX1Byb2plY3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0udGVhbV9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGVhbV9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudGVhbV9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUHJvamVjdC50ZWFtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy50ZWFtX1RlYW1fTWVtYmVycygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVGVhbV9NZW1iZXIudGVhbSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfVGVhbSgpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfVGVhbSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGVhbV9Qcm9qZWN0cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRlYW1fUHJvamVjdHMobmV3IHNoc19hcmJmd19Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbV9Qcm9qZWN0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudGVhbV9UZWFtX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy50ZWFtX1RlYW1fTWVtYmVycyhuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbV9UZWFtX01lbWJlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJUZWFtXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnRlYW1fUHJvamVjdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbV9Qcm9qZWN0cyA9IHRoaXMudGVhbV9Qcm9qZWN0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGVhbV9UZWFtX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbV9UZWFtX01lbWJlcnMgPSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfVGVhbSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3RlYW0nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19UZWFtKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1RlYW0oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwib2JqLnRlYW1fUHJvamVjdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRlYW1fUHJvamVjdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9Qcm9qZWN0cykpIHRoaXMudGVhbV9Qcm9qZWN0cyhvYmoudGVhbV9Qcm9qZWN0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1Byb2plY3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uX3NhdmUoKTogXCIgKyBcIm9iai50ZWFtX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudGVhbV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9UZWFtX01lbWJlcnMpKSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKG9iai50ZWFtX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfdGVhbScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF90ZWFtJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRlYW0uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUZWFtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IlNIU19BUkJGVyJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfUm9sZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X1JvbGUiLCJuYW1lIjoic2hzX2FyYmZ3X1JvbGUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfUm9sZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJzaHNfYXJiZndfUm9sZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJvbGVfRWZmb3J0X0VzdGltYXRlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJvbGVfRWZmb3J0X0VzdGltYXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZV9FZmZvcnRfRXN0aW1hdGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUucm9sZV9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlX1RlYW1fTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcm9sZV9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllFZmZvcnRfRXN0aW1hdGUucm9sZSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucm9sZV9UZWFtX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVRlYW1fTWVtYmVyLnJvbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JvbGUoKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcyhuZXcgc2hzX2FyYmZ3X0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZV9UZWFtX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yb2xlX1RlYW1fTWVtYmVycyhuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZV9UZWFtX01lbWJlcnMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJSb2xlXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfaW5zZXJ0QXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3VwZGF0ZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9zdG9yZUFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF9maW5kQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgPSB0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucm9sZV9UZWFtX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZV9UZWFtX01lbWJlcnMgPSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfUm9sZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3JvbGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Sb2xlKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1JvbGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJyk7XG5cdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcykpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG9iai5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuX3NhdmUoKTogXCIgKyBcIm9iai5yb2xlX1RlYW1fTWVtYmVyczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucm9sZV9UZWFtX01lbWJlcnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucm9sZV9UZWFtX01lbWJlcnMpKSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKG9iai5yb2xlX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUm9sZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgneF8xNzkwNTkzX2FyYm9hcmRfcm9sZScpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9yb2xlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlJvbGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJSb2xlLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLnZlcnNpb24gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR2ZXJzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl92ZXJzaW9uID0gdjtcblx0XHRcdHRoaXMuX3ZlcnNpb25fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdmVyc2lvbjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRml4X1NjcmlwdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRml4X1NjcmlwdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1RhYmxlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1RhYmxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1RhYmxlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fVGFibGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9uc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0Zsb3dzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fRmxvd3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9GbG93cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9GbG93X0xvZ2ljc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9sc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fdmVyc2lvbikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3ZlcnNpb24nICsgKHRoaXMuX3ZlcnNpb25fY29vcCB8fCAnPScpICsgdGhpcy52ZXJzaW9uKCk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUm9sbGJhY2tfQ29udGV4dC5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTY3JpcHRfRmlsZS5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZpeF9TY3JpcHQuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZVGFibGUuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2F2ZV9TdWJzY3JpcHRpb24uYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93LmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZpZWxkX0xhYmVsLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvd19Mb2dpYy5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfSW5zdGFuY2UuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUFjdGlvbl9JbnN0YW5jZS5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBY3Rpb25fVHlwZS5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfU25hcHNob3QuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllQaWxsX0NvbXBvdW5kLmFwcGxpY2F0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU2VjdXJpdHlfQ29udHJvbC5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNlY3VyaXR5X1R5cGUuYXBwbGljYXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNlY3VyaXR5X09wZXJhdGlvbi5hcHBsaWNhdGlvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHZlcnNpb246IG9iai5nZXRWYWx1ZShcInZlcnNpb25cIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnZlcnNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnZlcnNpb24ob2JqLnZlcnNpb24pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMobmV3IHNoc19hcmJmd19hcHBkX1JvbGxiYWNrX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzKG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMobmV3IHNoc19hcmJmd19hcHBkX1RhYmxlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fVGFibGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMobmV3IHNoc19hcmJmd19hcHBkX1NhdmVfU3Vic2NyaXB0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9GbG93cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93KCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fRmxvd3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmllbGRfTGFiZWwoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fRmxvd19Mb2dpY3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfQWN0aW9uX0luc3RhbmNlKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fQWN0aW9uX0luc3RhbmNlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzKG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMobmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X0NvbnRyb2woKS5fZnJvbURvY3VtZW50KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucyhuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfT3BlcmF0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfT3BlcmF0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkFwcGxpY2F0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3ZlcnNpb24pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnZlcnNpb24gPSB0aGlzLnZlcnNpb24oKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cyA9IHRoaXMuYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMgPSB0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRml4X1NjcmlwdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRml4X1NjcmlwdHMgPSB0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fVGFibGVzID0gdGhpcy5hcHBsaWNhdGlvbl9UYWJsZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMgPSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd3MgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmllbGRfTGFiZWxzID0gdGhpcy5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzID0gdGhpcy5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMgPSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMgPSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcyA9IHRoaXMuYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzID0gdGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMgPSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMgPSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ2ZXJzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudmVyc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC52ZXJzaW9uKHRoaXMudmVyc2lvbigpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NvcGUnLCBbJyonXSlbJ3N5c19zY29wZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX3Njb3BlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl92ZXJzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdmVyc2lvbl9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl92ZXJzaW9uX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy52ZXJzaW9uKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd2ZXJzaW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndmVyc2lvbicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgndmVyc2lvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd2ZXJzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BcHBsaWNhdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0FwcGxpY2F0aW9uKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfQXBwbGljYXRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICdzeXNfc2NvcGUnKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfc2NvcGUnLCBbJyonXSlbJ3N5c19zY29wZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUm9sbGJhY2tfQ29udGV4dHMpKSB0aGlzLmFwcGxpY2F0aW9uX1JvbGxiYWNrX0NvbnRleHRzKG9iai5hcHBsaWNhdGlvbl9Sb2xsYmFja19Db250ZXh0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUm9sbGJhY2tfQ29udGV4dCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TY3JpcHRfRmlsZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1NjcmlwdF9GaWxlcyhvYmouYXBwbGljYXRpb25fU2NyaXB0X0ZpbGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TY3JpcHRfRmlsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRml4X1NjcmlwdHMpKSB0aGlzLmFwcGxpY2F0aW9uX0ZpeF9TY3JpcHRzKG9iai5hcHBsaWNhdGlvbl9GaXhfU2NyaXB0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRml4X1NjcmlwdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9UYWJsZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1RhYmxlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9UYWJsZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1RhYmxlcyhvYmouYXBwbGljYXRpb25fVGFibGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UYWJsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9TYXZlX1N1YnNjcmlwdGlvbnMpKSB0aGlzLmFwcGxpY2F0aW9uX1NhdmVfU3Vic2NyaXB0aW9ucyhvYmouYXBwbGljYXRpb25fU2F2ZV9TdWJzY3JpcHRpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd3MpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dzKG9iai5hcHBsaWNhdGlvbl9GbG93cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvdygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9GaWVsZF9MYWJlbHMpKSB0aGlzLmFwcGxpY2F0aW9uX0ZpZWxkX0xhYmVscyhvYmouYXBwbGljYXRpb25fRmllbGRfTGFiZWxzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GaWVsZF9MYWJlbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19Mb2dpY3MpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfTG9naWNzKG9iai5hcHBsaWNhdGlvbl9GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19JbnN0YW5jZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfSW5zdGFuY2VzKG9iai5hcHBsaWNhdGlvbl9GbG93X0luc3RhbmNlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fSW5zdGFuY2VzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9JbnN0YW5jZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0FjdGlvbl9JbnN0YW5jZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5hcHBsaWNhdGlvbl9BY3Rpb25fVHlwZXMpKSB0aGlzLmFwcGxpY2F0aW9uX0FjdGlvbl9UeXBlcyhvYmouYXBwbGljYXRpb25fQWN0aW9uX1R5cGVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9BY3Rpb25fVHlwZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90czogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fRmxvd19TbmFwc2hvdHMpKSB0aGlzLmFwcGxpY2F0aW9uX0Zsb3dfU25hcHNob3RzKG9iai5hcHBsaWNhdGlvbl9GbG93X1NuYXBzaG90cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fUGlsbF9Db21wb3VuZHMpKSB0aGlzLmFwcGxpY2F0aW9uX1BpbGxfQ29tcG91bmRzKG9iai5hcHBsaWNhdGlvbl9QaWxsX0NvbXBvdW5kcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfUGlsbF9Db21wb3VuZCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9sczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfQ29udHJvbHMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X0NvbnRyb2xzKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9Db250cm9scy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfQ29udHJvbCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYXBwbGljYXRpb25fU2VjdXJpdHlfVHlwZXMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X1R5cGVzKG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9UeXBlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2VjdXJpdHlfVHlwZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5hcHBsaWNhdGlvbl9TZWN1cml0eV9PcGVyYXRpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMpKSB0aGlzLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMob2JqLmFwcGxpY2F0aW9uX1NlY3VyaXR5X09wZXJhdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1NlY3VyaXR5X09wZXJhdGlvbigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQXBwbGljYXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBcHBsaWNhdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkFwcGxpY2F0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX3Njb3BlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19zY29wZScsIFsnKiddKVsnc3lzX3Njb3BlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFwcGxpY2F0aW9uLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQXBwbGljYXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJBcHBsaWNhdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwic3lzX3Njb3BlIjp7Im5hbWUiOiJBcHBsaWNhdGlvbiBEZXNpZ25lciJ9LCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzY3JpcHRGaWxlX1NjcmlwdF9Db21wYXRpYmlsaXR5cyI6W3siYWN0aXZlIjp0cnVlLCJlbmFibGVkIjp0cnVlfV0sImNsaWVudF9jYWxsYWJsZSI6dHJ1ZSwic3lzX25hbWUiOiJzaHNfYXJiZndfYXBwZF9RdWV1ZSIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfUXVldWUiLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfUXVldWUiLCJzY3JpcHQiOiJjbGFzcyBzaHNfYXJiZndfYXBwZF9RdWV1ZSBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX1F1ZXVlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5jbHVzdGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2x1c3Rlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2x1c3RlciA9IHY7XG5cdFx0XHR0aGlzLl9jbHVzdGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NsdXN0ZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUudG9waWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0b3BpYyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdG9waWMgPSB2O1xuXHRcdFx0dGhpcy5fdG9waWNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdG9waWM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucHJvY2Vzc2VkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvY2Vzc2VkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3NlZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX3Byb2Nlc3NlZCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9jZXNzZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvY2Vzc2VkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmRpcmVjdGlvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRpcmVjdGlvbih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGlyZWN0aW9uID0gdjtcblx0XHRcdHRoaXMuX2RpcmVjdGlvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fc3RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fc3RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c2VuZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zZW5kZXIgPSB2O1xuXHRcdFx0dGhpcy5fc2VuZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3NlbmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZWNpcGllbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZWNpcGllbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlY2lwaWVudCA9IHY7XG5cdFx0XHR0aGlzLl9yZWNpcGllbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVjaXBpZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLnJlc3BvbnNlVG8gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXNwb25zZVRvKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvID0gdjtcblx0XHRcdHRoaXMuX3Jlc3BvbnNlVG9fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUbztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5yZXNwb25zZVRvX1F1ZXVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlc3BvbnNlVG9fUXVldWVzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcmVzcG9uc2VUb19RdWV1ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXNwb25zZVRvX1F1ZXVlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVzcG9uc2VUb19RdWV1ZXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fY2x1c3RlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NsdXN0ZXInICsgKHRoaXMuX2NsdXN0ZXJfY29vcCB8fCAnPScpICsgdGhpcy5jbHVzdGVyKCk7XG5cblx0XHRpZiAodGhpcy5fdG9waWMpIHJldCArPSAnXicgKyBzUGF0aCArICd0b3BpYycgKyAodGhpcy5fdG9waWNfY29vcCB8fCAnPScpICsgdGhpcy50b3BpYygpO1xuXG5cdFx0aWYgKHRoaXMuX3Byb2Nlc3NlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3Byb2Nlc3NlZCcgKyAodGhpcy5fcHJvY2Vzc2VkX2Nvb3AgfHwgJz0nKSArIHRoaXMucHJvY2Vzc2VkKCk7XG5cblx0XHRpZiAodGhpcy5fZGlyZWN0aW9uKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGlyZWN0aW9uJyArICh0aGlzLl9kaXJlY3Rpb25fY29vcCB8fCAnPScpICsgdGhpcy5kaXJlY3Rpb24oKTtcblxuXHRcdGlmICh0aGlzLl9zdGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3N0YXRlJyArICh0aGlzLl9zdGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLnN0YXRlKCk7XG5cblx0XHRpZiAodGhpcy5fc2VuZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnc2VuZGVyJyArICh0aGlzLl9zZW5kZXJfY29vcCB8fCAnPScpICsgdGhpcy5zZW5kZXIoKTtcblxuXHRcdGlmICh0aGlzLl9yZWNpcGllbnQpIHJldCArPSAnXicgKyBzUGF0aCArICdyZWNpcGllbnQnICsgKHRoaXMuX3JlY2lwaWVudF9jb29wIHx8ICc9JykgKyB0aGlzLnJlY2lwaWVudCgpO1xuXG5cdFx0aWYgKHRoaXMuX3Jlc3BvbnNlVG8pIHJldCArPSAvKih0aGlzLl9yZXNwb25zZVRvX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVzcG9uc2VUbygpLl90b0VRdWVyeShzUGF0aCArICdyZXNwb25zZVRvLicpO1xuXG5cdFx0KHRoaXMucmVzcG9uc2VUb19RdWV1ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVF1ZXVlLnJlc3BvbnNlVG8sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJwcm9jZXNzXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvY2VzcygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0Y2x1c3Rlcjogb2JqLmdldFZhbHVlKFwiY2x1c3RlclwiKSxcblxuXHRcdFx0XHRcdFx0dG9waWM6IG9iai5nZXRWYWx1ZShcInRvcGljXCIpLFxuXG5cdFx0XHRcdFx0XHRwcm9jZXNzZWQ6IG9iai5nZXRWYWx1ZShcInByb2Nlc3NlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZGlyZWN0aW9uOiBvYmouZ2V0VmFsdWUoXCJkaXJlY3Rpb25cIiksXG5cblx0XHRcdFx0XHRcdHN0YXRlOiBvYmouZ2V0VmFsdWUoXCJzdGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0c2VuZGVyOiBvYmouZ2V0VmFsdWUoXCJzZW5kZXJcIiksXG5cblx0XHRcdFx0XHRcdHJlY2lwaWVudDogb2JqLmdldFZhbHVlKFwicmVjaXBpZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRyZXNwb25zZVRvOiBvYmouZ2V0VmFsdWUoXCJyZXNwb25zZVRvXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jbHVzdGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jbHVzdGVyKG9iai5jbHVzdGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50b3BpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudG9waWMob2JqLnRvcGljKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9jZXNzZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnByb2Nlc3NlZChvYmoucHJvY2Vzc2VkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kaXJlY3Rpb24pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRpcmVjdGlvbihvYmouZGlyZWN0aW9uKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RhdGUob2JqLnN0YXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5zZW5kZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnNlbmRlcihvYmouc2VuZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZWNpcGllbnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlY2lwaWVudChvYmoucmVjaXBpZW50KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXNwb25zZVRvKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZXNwb25zZVRvKG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlVG8pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXNwb25zZVRvX1F1ZXVlcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJlc3BvbnNlVG9fUXVldWVzKG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlVG9fUXVldWVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiUXVldWVcIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2x1c3RlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY2x1c3RlciA9IHRoaXMuY2x1c3RlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90b3BpYykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudG9waWMgPSB0aGlzLnRvcGljKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2Nlc3NlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJvY2Vzc2VkID0gdGhpcy5wcm9jZXNzZWQoKTtcblxuXHRcdFx0aWYgKHJldC5wcm9jZXNzZWQgJiYgdHlwZW9mKHJldC5wcm9jZXNzZWQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQucHJvY2Vzc2VkID0gcmV0LnByb2Nlc3NlZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGlyZWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc3RhdGUgPSB0aGlzLnN0YXRlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlbmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuc2VuZGVyID0gdGhpcy5zZW5kZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVjaXBpZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZWNpcGllbnQgPSB0aGlzLnJlY2lwaWVudCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZXNwb25zZVRvKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXNwb25zZVRvID0gdGhpcy5yZXNwb25zZVRvKCk7XG5cblx0XHRcdGlmIChyZXQucmVzcG9uc2VUbykge1xuXHRcdFx0XHRyZXQucmVzcG9uc2VUbyA9IHJldC5yZXNwb25zZVRvLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnJlc3BvbnNlVG8pID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlc3BvbnNlVG8pLmxlbmd0aCkgcmV0LnJlc3BvbnNlVG8gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlc3BvbnNlVG9fUXVldWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG9fUXVldWVzID0gdGhpcy5yZXNwb25zZVRvX1F1ZXVlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY2x1c3RlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jbHVzdGVyKHRoaXMuY2x1c3RlcigpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnRvcGljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRvcGljKHRoaXMudG9waWMoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5kaXJlY3Rpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuc2VuZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlbmRlcih0aGlzLnNlbmRlcigpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLnJlY2lwaWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZWNpcGllbnQodGhpcy5yZWNpcGllbnQoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5yZXNwb25zZVRvKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlc3BvbnNlVG8odGhpcy5yZXNwb25zZVRvKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY2x1c3RlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNsdXN0ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY2x1c3Rlcih0aGlzLmNsdXN0ZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0b3BpY1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnRvcGljKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRvcGljKHRoaXMudG9waWMoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcm9jZXNzZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wcm9jZXNzZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvY2Vzc2VkKHRoaXMucHJvY2Vzc2VkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGlyZWN0aW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGlyZWN0aW9uKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRpcmVjdGlvbih0aGlzLmRpcmVjdGlvbigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc3RhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc3RhdGUodGhpcy5zdGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNlbmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnNlbmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZW5kZXIodGhpcy5zZW5kZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZWNpcGllbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZWNpcGllbnQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVjaXBpZW50KHRoaXMucmVjaXBpZW50KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVzcG9uc2VUb1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlc3BvbnNlVG8oKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVzcG9uc2VUbyh0aGlzLnJlc3BvbnNlVG8oKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdlY2NfcXVldWUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NsdXN0ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jbHVzdGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NsdXN0ZXJfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNsdXN0ZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NsdXN0ZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjbHVzdGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjbHVzdGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NsdXN0ZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdG9waWMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90b3BpY19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl90b3BpY19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudG9waWMoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RvcGljJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndG9waWMnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RvcGljJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RvcGljJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Byb2Nlc3NlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2Nlc3NlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2Nlc3NlZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdwcm9jZXNzZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdwcm9jZXNzZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3Byb2Nlc3NlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9jZXNzZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGlyZWN0aW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGlyZWN0aW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2RpcmVjdGlvbl9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGlyZWN0aW9uKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkaXJlY3Rpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkaXJlY3Rpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RpcmVjdGlvbicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkaXJlY3Rpb24nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9zdGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9zdGF0ZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3RhdGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0YXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N0YXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3N0YXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NlbmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3NlbmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9zZW5kZXJfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnNlbmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2VuZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc2VuZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzZW5kZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2VuZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlY2lwaWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlY2lwaWVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZWNpcGllbnRfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlY2lwaWVudCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVjaXBpZW50JykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVjaXBpZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZWNpcGllbnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVjaXBpZW50JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3Jlc3BvbnNlVG8pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXNwb25zZVRvX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVzcG9uc2VUbygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlF1ZXVlXCI9PVwiQ29sdW1uXCIpICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInJlc3BvbnNlVG8gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fcXVlcnkoKTogXCIgKyBcInJlc3BvbnNlVG9bcmVzcG9uc2VUb10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXNwb25zZVRvKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Jlc3BvbnNldG8nKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZXNwb25zZXRvJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZXNwb25zZXRvJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3Jlc3BvbnNldG8nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1F1ZXVlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignZWNjX3F1ZXVlJywgWycqJ10pWydlY2NfcXVldWUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfUXVldWUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ2VjY19xdWV1ZScpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5fc2F2ZSgpOiBcIiArIFwib2JqLnJlc3BvbnNlVG9fUXVldWVzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5yZXNwb25zZVRvX1F1ZXVlcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yZXNwb25zZVRvX1F1ZXVlcykpIHRoaXMucmVzcG9uc2VUb19RdWV1ZXMob2JqLnJlc3BvbnNlVG9fUXVldWVzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9RdWV1ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBRdWV1ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ2VjY19xdWV1ZScsIFsnKiddKVsnZWNjX3F1ZXVlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFF1ZXVlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiUXVldWUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUXVldWUucHJvY2VzcygpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2Nlc3MoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJRdWV1ZS5wcm9jZXNzKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlF1ZXVlLnByb2Nlc3MoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0dGhpcy5zdGF0ZShcInByb2Nlc3NpbmdcIikucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnJlc3BvbnNlVG8obnVsbCkuc3RvcmUoKTtcblxuXHRcdFx0dmFyIHIgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmRpcmVjdGlvbihcIm91dHB1dFwiKS5uYW1lKHRoaXMubmFtZSgpKS50b3BpYyh0aGlzLnRvcGljKCkpLmNsdXN0ZXIodGhpcy5jbHVzdGVyKCkpLnNlbmRlcih0aGlzLnJlY2lwaWVudCgpKS5yZWNpcGllbnQodGhpcy5zZW5kZXIoKSkuY29kZSh0aGlzLmNvZGUoKSkuc3RhdGUoXCJwcm9jZXNzZWRcIikucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnJlc3BvbnNlVG8odGhpcyk7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRsZXQgcmV0ID0gbmV3IHRoaXMuX19vU2NvcGVbdGhpcy5jb2RlKCldLl9pbnZva2UodGhpcy5uYW1lKCksIHRoaXMucmVtYXJrKCkpO1xuXHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ci5yZW1hcmsocmV0KTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdHIuc3RhdGUoXCJlcnJvclwiKS5yZW1hcmsoZXgudG9TdHJpbmcoKSk7XG5cdFx0XHR9XG5cdFx0XHRyLnN0b3JlKCk7XG5cblx0XHRcdHRoaXMucHJvY2Vzc2VkKG5ldyBEYXRlKCkpLnN0YXRlKFwicHJvY2Vzc2VkXCIpLnN0b3JlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Byb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllTYXZlX1N1YnNjcmlwdGlvbi5wcm9maWxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpcztcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfQ29ubmVjdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKG5ldyBzaHNfYXJiZndfYXBwZF9TYXZlX1N1YnNjcmlwdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQ29ubmVjdGlvblwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucyA9IHRoaXMucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdDb25uZWN0aW9uJywgWycqJ10pWydDb25uZWN0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdDb25uZWN0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiQ29ubmVjdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0Nvbm5lY3Rpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Db25uZWN0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnQ29ubmVjdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignQ29ubmVjdGlvbicsIFsnKiddKVsnQ29ubmVjdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uX3NhdmUoKTogXCIgKyBcIm9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucHJvZmlsZV9TYXZlX1N1YnNjcmlwdGlvbnMpKSB0aGlzLnByb2ZpbGVfU2F2ZV9TdWJzY3JpcHRpb25zKG9iai5wcm9maWxlX1NhdmVfU3Vic2NyaXB0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfU2F2ZV9TdWJzY3JpcHRpb24oKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENvbm5lY3Rpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDb25uZWN0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJDb25uZWN0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25uZWN0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ0Nvbm5lY3Rpb24nLCBbJyonXSlbJ0Nvbm5lY3Rpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ29ubmVjdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiQ29ubmVjdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkNvbm5lY3Rpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb25cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmRlZmluaXRpb25fRmxvd19Mb2dpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWZpbml0aW9uX0Zsb3dfTG9naWNzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlZmluaXRpb25fRmxvd19Mb2dpY3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlZmluaXRpb25fRmxvd19Mb2dpY3M7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllGbG93X0xvZ2ljLmRlZmluaXRpb24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfTG9naWNfRGVmaW5pdGlvbigpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlZmluaXRpb25fRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0xvZ2ljKCkuX2Zyb21Eb2N1bWVudChvYmouZGVmaW5pdGlvbl9GbG93X0xvZ2ljcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkxvZ2ljX0RlZmluaXRpb25cIil7XG5cdFx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVmaW5pdGlvbl9GbG93X0xvZ2ljcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWZpbml0aW9uX0Zsb3dfTG9naWNzID0gdGhpcy5kZWZpbml0aW9uX0Zsb3dfTG9naWNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0xvZ2ljX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9Mb2dpY19EZWZpbml0aW9uKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19sb2dpY19kZWZpbml0aW9uJywgWycqJ10pWydzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5kZWZpbml0aW9uX0Zsb3dfTG9naWNzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlZmluaXRpb25fRmxvd19Mb2dpY3MpKSB0aGlzLmRlZmluaXRpb25fRmxvd19Mb2dpY3Mob2JqLmRlZmluaXRpb25fRmxvd19Mb2dpY3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfTG9naWMoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIExvZ2ljX0RlZmluaXRpb24uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJMb2dpY19EZWZpbml0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfbG9naWNfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2xvZ2ljX2RlZmluaXRpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTG9naWNfRGVmaW5pdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiTG9naWNfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkxvZ2ljX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayIsIm5hbWUiOiJzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jayBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2tcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInNoc19hcmJmd19hcHBkXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2submFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2sucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmJsb2NrX0Zsb3dzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2tfRmxvd3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9ja19GbG93cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmJsb2NrX0Zsb3dfTG9naWNzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YmxvY2tfRmxvd19Mb2dpY3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93X0xvZ2ljcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Jsb2NrX0Zsb3dfTG9naWNzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ibG9ja19GbG93X0xvZ2ljcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRibG9ja19FbGVtZW50X01hcHBpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYmxvY2tfRWxlbWVudF9NYXBwaW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Jsb2NrX0VsZW1lbnRfTWFwcGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Jsb2NrX0VsZW1lbnRfTWFwcGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5ibG9ja19GbG93X1NuYXBzaG90cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJsb2NrX0Zsb3dfU25hcHNob3RzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYmxvY2tfRmxvd19TbmFwc2hvdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ibG9ja19GbG93X1NuYXBzaG90c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYmxvY2tfRmxvd19TbmFwc2hvdHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5ibG9ja19GbG93cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRmxvdy5ibG9jayw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYmxvY2tfRmxvd19Mb2dpY3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfTG9naWMuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUVsZW1lbnRfTWFwcGluZy5ibG9jayw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfU25hcHNob3QuYmxvY2ssPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0aWYgKG9iai5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgb2JqLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcblx0XHRcdFx0dmFyIG1zZyA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7XG5cdFx0XHRcdG1zZy5zZXRFbmRwb2ludChvYmopO1xuXHRcdFx0XHRtc2cuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblx0XHRcdFx0bXNnLnNldEh0dHBNZXRob2QoJ2dldCcpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG1zZy5leGVjdXRlKCkuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJsb2NrX0Zsb3dzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRmxvd3MobmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fZnJvbURvY3VtZW50KG9iai5ibG9ja19GbG93cykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2tfRmxvd19Mb2dpY3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ibG9ja19GbG93X0xvZ2ljcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrX0Zsb3dfTG9naWNzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5ibG9ja19FbGVtZW50X01hcHBpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncyhuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYmxvY2tfRmxvd19TbmFwc2hvdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ibG9ja19GbG93X1NuYXBzaG90cyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19TbmFwc2hvdCgpLl9mcm9tRG9jdW1lbnQob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRmxvd19CbG9ja1wiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5ibG9ja19GbG93cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19GbG93cyA9IHRoaXMuYmxvY2tfRmxvd3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJsb2NrX0Zsb3dfTG9naWNzID0gdGhpcy5ibG9ja19GbG93X0xvZ2ljcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19FbGVtZW50X01hcHBpbmdzID0gdGhpcy5ibG9ja19FbGVtZW50X01hcHBpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5ibG9ja19GbG93X1NuYXBzaG90cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ibG9ja19GbG93X1NuYXBzaG90cyA9IHRoaXMuYmxvY2tfRmxvd19TbmFwc2hvdHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfaHViX2Zsb3dfYmxvY2snLCBbJyonXSlbJ3N5c19odWJfZmxvd19ibG9jayddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgnc3lzX2h1Yl9mbG93X2Jsb2NrJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRmxvd19CbG9jay5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfQmxvY2soKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19odWJfZmxvd19ibG9jaycsIFsnKiddKVsnc3lzX2h1Yl9mbG93X2Jsb2NrJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0Jsb2NrKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19CbG9jaygpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19odWJfZmxvd19ibG9jaycpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJvYmouYmxvY2tfRmxvd3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0Zsb3dzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0Zsb3dzKSkgdGhpcy5ibG9ja19GbG93cyhvYmouYmxvY2tfRmxvd3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3coKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suX3NhdmUoKTogXCIgKyBcIm9iai5ibG9ja19GbG93X0xvZ2ljczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouYmxvY2tfRmxvd19Mb2dpY3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRmxvd19Mb2dpY3MpKSB0aGlzLmJsb2NrX0Zsb3dfTG9naWNzKG9iai5ibG9ja19GbG93X0xvZ2ljcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19Mb2dpYygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5fc2F2ZSgpOiBcIiArIFwib2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3M6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0VsZW1lbnRfTWFwcGluZ3MsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncykpIHRoaXMuYmxvY2tfRWxlbWVudF9NYXBwaW5ncyhvYmouYmxvY2tfRWxlbWVudF9NYXBwaW5ncy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRWxlbWVudF9NYXBwaW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLl9zYXZlKCk6IFwiICsgXCJvYmouYmxvY2tfRmxvd19TbmFwc2hvdHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJsb2NrX0Zsb3dfU25hcHNob3RzKSkgdGhpcy5ibG9ja19GbG93X1NuYXBzaG90cyhvYmouYmxvY2tfRmxvd19TbmFwc2hvdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0Zsb3dfU25hcHNob3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZsb3dfQmxvY2suc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGbG93X0Jsb2NrLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJGbG93X0Jsb2NrLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdzeXNfaHViX2Zsb3dfYmxvY2snKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZignc3lzX2h1Yl9mbG93X2Jsb2NrJywgWycqJ10pWydzeXNfaHViX2Zsb3dfYmxvY2snXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRmxvd19CbG9jay5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRmxvd19CbG9jay5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkZsb3dfQmxvY2suZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiQXBwbGljYXRpb24gRGVzaWduZXIifSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic2NyaXB0RmlsZV9TY3JpcHRfQ29tcGF0aWJpbGl0eXMiOlt7ImFjdGl2ZSI6dHJ1ZSwiZW5hYmxlZCI6dHJ1ZX1dLCJjbGllbnRfY2FsbGFibGUiOnRydWUsInN5c19uYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIiwiYXBpX25hbWUiOiJ4XzE3OTA1OTNfYXJib2FyZC5zaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0iLCJuYW1lIjoic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIiwic2NyaXB0IjoiY2xhc3Mgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtIGV4dGVuZHMgZ2xvYmFsLkFic3RyYWN0QWpheFByb2Nlc3NvciB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypBYnN0cmFjdEFqYXhQcm9jZXNzb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgKi9cblx0XHRzdXBlcihpZClcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiQXBwbGljYXRpb24gRGVzaWduZXJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJzaHNfYXJiZndfYXBwZFwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX29TY29wZSA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiBzaHNfYXJiZncpO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVHJhbnNmb3JtLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvLyh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRyYW5zZm9ybS50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl90cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0udHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3RyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllQaWxsX0NvbXBvdW5kLnRyYW5zZm9ybSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVRyYW5zZm9ybV9Db21wb3NpdGlvbi50cmFuc2Zvcm0sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm0oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmIChvYmouc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IG9iai5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG5cdFx0XHRcdHZhciBtc2cgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpO1xuXHRcdFx0XHRtc2cuc2V0RW5kcG9pbnQob2JqKTtcblx0XHRcdFx0bXNnLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cdFx0XHRcdG1zZy5zZXRIdHRwTWV0aG9kKCdnZXQnKTtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChtc2cuZXhlY3V0ZSgpLmdldEJvZHkoKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX2Zyb21Eb2N1bWVudChvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKG5ldyBzaHNfYXJiZndfYXBwZF9UcmFuc2Zvcm1fQ29tcG9zaXRpb24oKS5fZnJvbURvY3VtZW50KG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRyYW5zZm9ybVwiKXtcblx0XHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9pbnNlcnRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdXBkYXRlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X3N0b3JlQXNzZXJ0KCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0X2ZpbmRBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyA9IHRoaXMudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucyA9IHRoaXMudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX3RyYW5zZm9ybV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiVHJhbnNmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX1RyYW5zZm9ybSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlRyYW5zZm9ybS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIm9iai50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai50cmFuc2Zvcm1fUGlsbF9Db21wb3VuZHMpKSB0aGlzLnRyYW5zZm9ybV9QaWxsX0NvbXBvdW5kcyhvYmoudHJhbnNmb3JtX1BpbGxfQ29tcG91bmRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9QaWxsX0NvbXBvdW5kKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uX3NhdmUoKTogXCIgKyBcIm9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMsIG51bGwsIDQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMpKSB0aGlzLnRyYW5zZm9ybV9UcmFuc2Zvcm1fQ29tcG9zaXRpb25zKG9iai50cmFuc2Zvcm1fVHJhbnNmb3JtX0NvbXBvc2l0aW9ucy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfVHJhbnNmb3JtX0NvbXBvc2l0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlRyYW5zZm9ybS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbicpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfdHJhbnNmb3JtX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c190cmFuc2Zvcm1fZGVmaW5pdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUcmFuc2Zvcm0uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJUcmFuc2Zvcm0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiVHJhbnNmb3JtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJzeXNfc2NvcGUiOnsibmFtZSI6IkFwcGxpY2F0aW9uIERlc2lnbmVyIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbiIsImFwaV9uYW1lIjoieF8xNzkwNTkzX2FyYm9hcmQuc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uIiwibmFtZSI6InNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbiBleHRlbmRzIGdsb2JhbC5BYnN0cmFjdEFqYXhQcm9jZXNzb3Ige1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdC8qQWJzdHJhY3RBamF4UHJvY2Vzc29yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsICovXG5cdFx0c3VwZXIoaWQpXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIkFwcGxpY2F0aW9uIERlc2lnbmVyXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3X2FwcGRcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInNoc19hcmJmd1wiO1xuXHRcdHRoaXMuX19vU2NvcGUgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogc2hzX2FyYmZ3KTtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly8odHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGF0YV9EZWZpbml0aW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEYXRhX0RlZmluaXRpb24uZGVmaW5pdGlvbl9GbG93X0RhdGFzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVmaW5pdGlvbl9GbG93X0RhdGFzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0RhdGFzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVmaW5pdGlvbl9GbG93X0RhdGFzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWZpbml0aW9uX0Zsb3dfRGF0YXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHQodGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUZsb3dfRGF0YS5kZWZpbml0aW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiBuZXcgc2hzX2FyYmZ3X2FwcGRfRGF0YV9EZWZpbml0aW9uKCkuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBzaHNfYXJiZndfYXBwZF9EYXRhX0RlZmluaXRpb24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcyhuZXcgc2hzX2FyYmZ3X2FwcGRfRmxvd19EYXRhKCkuX2Zyb21Eb2N1bWVudChvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRGF0YV9EZWZpbml0aW9uXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVmaW5pdGlvbl9GbG93X0RhdGFzID0gdGhpcy5kZWZpbml0aW9uX0Zsb3dfRGF0YXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbiddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19hcHBkX0RhdGFfRGVmaW5pdGlvbigpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicpO1xuXHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCdzeXNfZmxvd19kYXRhX2RlZmluaXRpb24nLCBbJyonXSlbJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uX3NhdmUoKTogXCIgKyBcIm9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlZmluaXRpb25fRmxvd19EYXRhcywgbnVsbCwgNCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5kZWZpbml0aW9uX0Zsb3dfRGF0YXMpKSB0aGlzLmRlZmluaXRpb25fRmxvd19EYXRhcyhvYmouZGVmaW5pdGlvbl9GbG93X0RhdGFzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfYXBwZF9GbG93X0RhdGEoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiRGF0YV9EZWZpbml0aW9uLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJyk7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3N5c19mbG93X2RhdGFfZGVmaW5pdGlvbicsIFsnKiddKVsnc3lzX2Zsb3dfZGF0YV9kZWZpbml0aW9uJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERhdGFfRGVmaW5pdGlvbi5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIkRhdGFfRGVmaW5pdGlvbi5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJEYXRhX0RlZmluaXRpb24uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsInN5c19zY29wZSI6eyJuYW1lIjoiU0hTX0FSQkZXIn0sImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInNjcmlwdEZpbGVfU2NyaXB0X0NvbXBhdGliaWxpdHlzIjpbeyJhY3RpdmUiOnRydWUsImVuYWJsZWQiOnRydWV9XSwiY2xpZW50X2NhbGxhYmxlIjp0cnVlLCJzeXNfbmFtZSI6InNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJhcGlfbmFtZSI6InhfMTc5MDU5M19hcmJvYXJkLnNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24iLCJuYW1lIjoic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbiIsInNjcmlwdCI6ImNsYXNzIHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24gZXh0ZW5kcyBzaHNfYXJiZndfVGFzayB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0LypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyKGlkKVxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwic2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwic2hzX2FyYmZ3XCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJzaHNfYXJiZndcIjtcblx0XHR0aGlzLl9fb1Njb3BlID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHNoc19hcmJmdyk7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFNvbHV0aW9uX0Rlc2lnbi5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1ZlcnNpb25fSGlzdG9yeXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9WZXJzaW9uX0hpc3RvcnlzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBTb2x1dGlvbl9EZXNpZ24uZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZXNpZ25fU29sdXRpb25fU2VjdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVzaWduX1NvbHV0aW9uX0FwcGVuZGl4cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Rlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gLypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3RvRVF1ZXJ5LmNhbGwodGhpcywgKi8gc3VwZXIuX3RvRVF1ZXJ5KHNQYXRoKSB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVZlcnNpb25fSGlzdG9yeS5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZU29sdXRpb25fU2VjdGlvbi5kZXNpZ24sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVNvbHV0aW9uX0FwcGVuZGl4LmRlc2lnbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7XG5cblx0XHQvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5fZnJvbURvY3VtZW50LmNhbGwodGhpcywgKi9cblx0XHRzdXBlci5fZnJvbURvY3VtZW50KG9iailcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRpZiAob2JqLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBvYmouc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuXHRcdFx0XHR2YXIgbXNnID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTtcblx0XHRcdFx0bXNnLnNldEVuZHBvaW50KG9iaik7XG5cdFx0XHRcdG1zZy5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXHRcdFx0XHRtc2cuc2V0SHR0cE1ldGhvZCgnZ2V0Jyk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQobXNnLmV4ZWN1dGUoKS5nZXRCb2R5KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0LyoodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKG5ldyBzaHNfYXJiZndfVmVyc2lvbl9IaXN0b3J5KCkuX2Zyb21Eb2N1bWVudChvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucyhuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX1NlY3Rpb24oKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKG5ldyBzaHNfYXJiZndfU29sdXRpb25fQXBwZW5kaXgoKS5fZnJvbURvY3VtZW50KG9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiU29sdXRpb25fRGVzaWduXCIpe1xuXHRcdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2luc2VydEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF91cGRhdGVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfc3RvcmVBc3NlcnQoKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRfZmluZEFzc2VydCgpIHtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gLypzaHNfYXJiZndfVGFzay5wcm90b3R5cGUuX3RvRG9jdW1lbnQuY2FsbCh0aGlzLCAqLyBzdXBlci5fdG9Eb2N1bWVudChhckZpZWxkcykgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzID0gdGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucyA9IHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMgPSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKTtcblxuXHRcdC8qc2hzX2FyYmZ3X1Rhc2sucHJvdG90eXBlLl91bmlxdWUuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyLl91bmlxdWUoa2V5cywgcmV0KVxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nLCBbJyonXSlbJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJyk7XG5cblx0XHQvKnNoc19hcmJmd19UYXNrLnByb3RvdHlwZS5fcXVlcnkuY2FsbCh0aGlzLCAqL1xuXHRcdHN1cGVyLl9xdWVyeShncSlcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiAodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJz9hbGVydDpncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qICh0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBzaHNfYXJiZndfU29sdXRpb25fRGVzaWduKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfMTc5MDU5M19hcmJvYXJkX3NvbHV0aW9uX2Rlc2lnbicsIFsnKiddKVsneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgc2hzX2FyYmZ3X1NvbHV0aW9uX0Rlc2lnbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9EZXNpZ24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnP2FsZXJ0OmdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nKTtcblx0XHRcdC8qKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCc/YWxlcnQ6Z3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLl9zYXZlKCk6IFwiICsgXCJvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXM6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9WZXJzaW9uX0hpc3RvcnlzKSkgdGhpcy5kZXNpZ25fVmVyc2lvbl9IaXN0b3J5cyhvYmouZGVzaWduX1ZlcnNpb25fSGlzdG9yeXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19WZXJzaW9uX0hpc3RvcnkoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5fc2F2ZSgpOiBcIiArIFwib2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9uczogXCIgKyBKU09OLnN0cmluZ2lmeShvYmouZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9TZWN0aW9ucykpIHRoaXMuZGVzaWduX1NvbHV0aW9uX1NlY3Rpb25zKG9iai5kZXNpZ25fU29sdXRpb25fU2VjdGlvbnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9TZWN0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uX3NhdmUoKTogXCIgKyBcIm9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iai5kZXNpZ25fU29sdXRpb25fQXBwZW5kaXhzLCBudWxsLCA0KSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMpKSB0aGlzLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMob2JqLmRlc2lnbl9Tb2x1dGlvbl9BcHBlbmRpeHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHNoc19hcmJmd19Tb2x1dGlvbl9BcHBlbmRpeCgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0KHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IGFsZXJ0IDogZ3MuaW5mbykoXCJTb2x1dGlvbl9EZXNpZ24uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF8xNzkwNTkzX2FyYm9hcmRfc29sdXRpb25fZGVzaWduJywgWycqJ10pWyd4XzE3OTA1OTNfYXJib2FyZF9zb2x1dGlvbl9kZXNpZ24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogU29sdXRpb25fRGVzaWduLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdCh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgPyBhbGVydCA6IGdzLmluZm8pKFwiU29sdXRpb25fRGVzaWduLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnID8gYWxlcnQgOiBncy5pbmZvKShcIlNvbHV0aW9uX0Rlc2lnbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifV0=",
	"cluster": "APISERVER",
	"topic": "apiserver.shs_arbfw",
	"direction": "input",
	"state": "ready",
	"sender": "apiserver.shs_arbfw",
	"recipient": "instance_name",
	"__keys": ["code", "name", "cluster", "topic", "direction", "sender", "recipient", "responseTo"],
	"active": true,
	"enabled": true,
	"__trMap": []
}